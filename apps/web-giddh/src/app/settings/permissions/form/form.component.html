<form name="permissionForm" [formGroup]="permissionForm" [ngClass]="{'permissionForm': isHorizntl}"
    (ngSubmit)="submitPermissionForm()">
    <div class="row">
        <div class="col-xl-10 col-md-12">

            <div class="row">
                <div class="col-xl-3 col-md-6 col-sm-4 pr-0">
                    <div class="form-group ml-0">
                        <label *ngIf="isLblShow">Unique Name/Email ID</label>
                        <input type="text" name="emailId" formControlName="emailId" placeholder="Unique Name/Email ID" class="form-control"
                            [attr.readonly]="userdata?.uniqueName" />
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-4 pr-0">
                    <div class="form-group">
                        <label *ngIf="isLblShow">Role Name</label>
                        <!-- <select name="roleUniqueName" formControlName="roleUniqueName" class="form-control ">
                                            <option [value]="role.uniqueName" *ngFor="let role of allRoles">{{role.name}}</option>
                                        </select> -->
                        <sh-select placeholder="Select role" formControlName="roleUniqueName"
                            [forceClearReactive]="permissionRoleClear$ | async" [options]="allRoles"></sh-select>
                    </div>
                </div>
                <div class="col-xl-2 col-md-6 col-sm-4 pr-0">
                    <!-- time span -->
                    <div class="form-group" [exclude]="'.time-span-dropdown'" [attachOutsideOnClick]="true"
                        (clickOutside)="methodForToggleSection('timeSpanSection')">
                        <label *ngIf="isLblShow">Time Span</label>
                        <div class="btn-group" [ngClass]="{'open': showTimeSpan, 'btn-group-liq': !isHorizntl}">
                            <button (click)="showTimeSpan = !showTimeSpan" type="button" class="form-control text-left ">
                                {{selectedTimeSpan}}
                                <span class="pull-right"><span class="fa fa-caret-down"></span></span>
                            </button>
                            <section class="dropdown-menu custom-dropdown mr-b1 time-span-dropdown" [ngClass]="{'open': showTimeSpan}">

                                <div class="clearfix pd-1 option-box">

                                    <span class="p-0 mr-3" (click)="isOpenedInModal ? handleTimeSpanChange('daterange'): ''">
                                        <input id="dateRange" class="radio-custom cp ml-0" type="radio" name="periodOptions"
                                            formControlName="periodOptions" value="daterange">
                                        <label for="dateRange" class="radio-custom-label">Date Range</label>
                                    </span>

                                    <span class="p-0 mr-3" (click)="isOpenedInModal ? handleTimeSpanChange('pastperiod'): ''">
                                        <input id="pastPeriod" class="radio-custom cp ml-0" type="radio" name="periodOptions"
                                            formControlName="periodOptions" value="pastperiod">
                                        <label for="pastPeriod" class="radio-custom-label">Past Period</label>
                                    </span>

                                </div>

                                <section class="periods container-fluid mr-b1"
                                    *ngIf="permissionForm.get('periodOptions').value === 'daterange'">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label>From - To</label>
                                            <input name="DateRangePicker" [bsValue]="dateRangePickerValue"
                                                (bsValueChange)="onSelectDateRange($event)" placeholder="Select Date Range" type="text"
                                                class="form-control" bsDaterangepicker container="body">

                                            <!-- <input class="form-control " name="from" formControlName="from" type="text" placeholder="DD-MM-YYYY" /> -->
                                        </div>
                                        <!-- <div class="col-xs-6">
                                                    <label>To</label>
                                                    <input class="form-control " name="to" formControlName="to" type="text" placeholder="DD-MM-YYYY" />
                                                </div> -->
                                    </div>
                                </section>

                                <section class="periods container-fluid mr-b1"
                                    *ngIf="permissionForm.get('periodOptions').value === 'pastperiod'">
                                    <label>Select Past Period</label>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <input class="form-control " name="duration" digitsOnlyDirective formControlName="duration"
                                                type="number" placeholder="Number in Days" />
                                        </div>
                                        <!-- <div class="col-xs-6 col-sm-6 pl-0 lh-34">
                                            Days
                                        </div> -->
                                    </div>
                                </section>

                            </section>
                        </div>
                    </div>
                    <!-- time span end -->
                </div>
                <div class="col-xl-2 col-md-6 col-sm-4 pr-0">
                    <div class="form-group" [exclude]="'.ip-addresses-dropdown'" [attachOutsideOnClick]="true"
                        (clickOutside)="methodForToggleSection('rangeSpanSection')">
                        <label *ngIf="isLblShow">IP Addresses</label>
                        <div class="btn-group " [ngClass]="{'open': showIPWrap, 'btn-group-liq': !isHorizntl}">
                            <button (click)="showIPWrap = !showIPWrap" type="button" class="form-control text-left ">
                                {{selectedIPRange}}
                                <span class="pull-right"><span class="fa fa-caret-down"></span></span>
                            </button>
                            <section class="dropdown-menu custom-dropdown ip-addresses-dropdown" role="menu"
                                [ngClass]="{'open': showIPWrap}">
                                <div class="clearfix option-box pd-1">

                                    <span (click)="isOpenedInModal ? handleIpAddressChange('cidr_range'): ''" class="p-0 mr-3">
                                        <input id="cidrRange" class="radio-custom cp ml-0" type="radio" name="ipOptions"
                                            formControlName="ipOptions" value="cidr_range">
                                        <label for="cidrRange" class="radio-custom-label">CIDR Range</label>
                                    </span>

                                    <span (click)="isOpenedInModal ? handleIpAddressChange('ip_address'): ''" class="p-0 mr-3">
                                        <input id="address" class="radio-custom cp ml-0" type="radio" name="ipOptions"
                                            formControlName="ipOptions" value="ip_address">
                                        <label for="address" class="radio-custom-label">Address</label>
                                    </span>

                                </div>

                                <section formArrayName="allowedCidrs" class="ip-range container-fluid"
                                    *ngIf="permissionForm.get('ipOptions').value === 'cidr_range'">
                                    <div class="row mr-b1"
                                        *ngFor="let item of permissionForm.get('allowedCidrs')['controls']; let i = index; let l = last"
                                        [formGroupName]="i">
                                        <div class="col-11">
                                            <input class="form-control " name="item_{{i}}" formControlName="range" type="text"
                                                placeholder="192.168.1.0/24" />
                                        </div>
                                        <div class="pull-left lh-34">
                                            <i *ngIf="!l" (click)="delRow('allowedCidrs', i, $event)"
                                                class="fa fa-trash-o cursor-pointer"></i>
                                            <i *ngIf="l" (click)="addNewRow('allowedCidrs', item, $event)"
                                                class="icon-plus cursor-pointer"></i>
                                        </div>
                                    </div>
                                </section>

                                <section formArrayName="allowedIps" class="ip-range container-fluid"
                                    *ngIf="permissionForm.get('ipOptions').value === 'ip_address'">
                                    <div class="row mr-b1"
                                        *ngFor="let item of permissionForm.get('allowedIps')['controls']; let i = index; let l = last"
                                        [formGroupName]="i">
                                        <div class="col-11">
                                            <input class="form-control" (keypress)="allowOnlyNumbersAndDot($event)" name="item_{{i}}"
                                                formControlName="range" type="text" placeholder="192.168.1.0" />
                                        </div>
                                        <div class="pull-left lh-34">
                                            <i *ngIf="!l" (click)="delRow('allowedIps', i, $event)"
                                                class="fa fa-trash-o cursor-pointer"></i>
                                            <i *ngIf="l" (click)="addNewRow('allowedIps', item, $event)"
                                                class="icon-plus cursor-pointer"></i>
                                        </div>
                                    </div>
                                </section>

                            </section>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-md-6 col-sm-4 pr-0">

                    <div class="form-group add-btn">
                        <label class="d-block" *ngIf="isUpdtCase">&nbsp;</label>
                        <button [ladda]="createPermissionInProcess$ | async" [disabled]="permissionForm.invalid" class="btn btn-success">
                            <span *ngIf="!isUpdtCase">Add</span>
                            <span *ngIf="isUpdtCase">Update</span>
                        </button>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-xl-2 col-md-12" *ngIf="isSuperAdminCompany" >
            <a href="javascript:void(0)" *ngIf="!isUpdtCase" class="btn btn-sky-blue pull-right create-btn mr-0"
                [routerLink]="['/pages/permissions/list']" [queryParams]="{ tab: 'settings' }">+ Custom Role</a>
        </div>
    </div>
</form>
