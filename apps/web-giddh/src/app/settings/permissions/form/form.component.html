<form
    name="permissionForm"
    [formGroup]="permissionForm"
    [ngClass]="{ 'permission-form': isHorizntl }"
    (ngSubmit)="submitPermissionForm()"
    autocomplete="off"
>
    <div class="row align-items-center">
        <div class="col-md-12" [ngClass]="{ 'col-xl-12': isUpdtCase, 'col-xl-10': !isUpdtCase }">
            <div class="row mr-0 ml-0 align-items-center">
                <div class="col-xl-3 col-md-6 col-sm-4 pl-0">
                    <div class="form-group ml-0">
                        <input-field
                            [label]="isLblShow ? localeData?.unique_name_email_label : ''"
                            [type]="'text'"
                            [name]="'emailId'"
                            formControlName="emailId"
                            [placeholder]="localeData?.unique_name_email_placeholder"
                            [readonly]="userdata?.uniqueName"
                        ></input-field>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-4 pl-0">
                    <div class="form-group">
                        <dropdown-field
                            [label]="isLblShow ? localeData?.role_name_label : ''"
                            [placeholder]="localeData?.role_name_placeholder"
                            [options]="allRoles"
                            (selectedOption)="permissionForm.get('roleUniqueName')?.patchValue($event.value)"
                            [defaultValue]="userdata?.roleName"
                            [required]="true"
                            (onClear)="onSearchClear()"
                            [allowValueReset]="true"
                            (dynamicSearchedQuery)="onRoleSearchQueryChange($event)"
                            [enableDynamicSearch]="true"
                        ></dropdown-field>
                    </div>
                </div>
                <div class="col-xl-2 col-md-6 col-sm-4 pl-0">
                    <!-- time span -->
                    <div
                        class="form-group menu-btn"
                        [exclude]="'.time-span-dropdown'"
                        [attachOutsideOnClick]="true"
                        (clickOutside)="methodForToggleSection('timeSpanSection')"
                    >
                        <div class="btn-group" [ngClass]="{ 'open': showTimeSpan, 'btn-group-liq': !isHorizntl }">
                            <button
                                mat-button
                                [matMenuTriggerFor]="menu"
                                (click)="showTimeSpan = !showTimeSpan"
                                type="button"
                                class="mat-select-btn text-left w-100"
                            >
                                <span class="d-flex w-100">
                                    {{ selectedTimeSpan }}
                                    <span class="ml-auto"><span class="fa fa-caret-down"></span></span>
                                </span>
                            </button>
                            <mat-menu #menu="matMenu">
                                <section
                                    class="mr-b1 time-span-dropdown custom-date-range-menu"
                                    (click)="$event.stopPropagation()"
                                >
                                    <div class="pd-1">
                                        <mat-radio-group formControlName="periodOptions" class="d-flex flex-column">
                                            <mat-radio-button
                                                value="daterange"
                                                id="dateRange"
                                                color="primary"
                                                (click)="isOpenedInModal ? handleTimeSpanChange('daterange') : ''"
                                                class="w-100 mr-0 mb-1"
                                            >
                                                {{ commonLocaleData?.app_date_range }}
                                            </mat-radio-button>
                                            <mat-radio-button
                                                value="pastperiod"
                                                id="pastPeriod"
                                                color="primary"
                                                (click)="isOpenedInModal ? handleTimeSpanChange('pastperiod') : ''"
                                                class="w-100 mr-0 mr-t1"
                                            >
                                                {{ localeData?.past_period }}
                                            </mat-radio-button>
                                        </mat-radio-group>
                                    </div>

                                    <section
                                        class="periods container-fluid mr-b1 mt-3"
                                        *ngIf="permissionForm.get('periodOptions')?.value === 'daterange'"
                                    >
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="date-range-wrapper">
                                                    <mat-form-field
                                                        [matDatepickerToggleIcon]="false"
                                                        appearance="outline"
                                                        (click)="picker.open()"
                                                        class="w-100"                                                     
                                                    >
                                                        <mat-label>{{ localeData?.from_to_label }}</mat-label>
                                                        <mat-date-range-input [rangePicker]="picker">
                                                            <input
                                                                matStartDate
                                                                [placeholder]="commonLocaleData?.app_start_date"
                                                                formControlName="from"
                                                            />
                                                            <input
                                                                matEndDate
                                                                [placeholder]="commonLocaleData?.app_end_date"
                                                                formControlName="to"
                                                            />
                                                        </mat-date-range-input>
                                                        <mat-date-range-picker #picker></mat-date-range-picker>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                        </div>
                                    </section>

                                    <section
                                        class="periods container-fluid mr-b1 mt-2"
                                        *ngIf="permissionForm.get('periodOptions')?.value === 'pastperiod'"
                                    >
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="date-range-wrapper">
                                                    <input-field
                                                        [label]="localeData?.select_past_period_label"
                                                        [name]="'duration'"
                                                        [allowDigitsOnly]="true"
                                                        formControlName="duration"
                                                        [type]="'number'"
                                                        [placeholder]="localeData?.select_past_period_placeholder"
                                                    ></input-field>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </section>
                            </mat-menu>
                        </div>
                    </div>
                    <!-- time span end -->
                </div>
                <div class="col-xl-2 col-md-6 col-sm-4 pl-0">
                    <div
                        class="form-group menu-btn"
                        [exclude]="'.ip-addresses-dropdown'"
                        [attachOutsideOnClick]="true"
                        (clickOutside)="methodForToggleSection('rangeSpanSection')"
                    >
                        <div class="btn-group" [ngClass]="{ 'open': showIPWrap, 'btn-group-liq': !isHorizntl }">
                            <button
                                mat-button
                                [matMenuTriggerFor]="menurange"
                                (click)="showIPWrap = !showIPWrap"
                                type="button"
                                class="mat-select-btn text-left w-100"
                            >
                                {{ selectedIPRange }}
                                <span class="pull-right"><span class="fa fa-caret-down"></span></span>
                            </button>
                            <mat-menu #menurange="matMenu">
                                <section class="ip-addresses-dropdown" role="menu" (click)="$event.stopPropagation()">
                                    <div class="pd-1">  
                                        <mat-radio-group formControlName="ipOptions" class="d-flex flex-column">
                                            <mat-radio-button
                                                value="cidr_range"
                                                id="cidrRange"
                                                color="primary"
                                                (click)="isOpenedInModal ? handleIpAddressChange('cidr_range') : ''"
                                                class="w-100 mr-0"
                                            >
                                                {{ localeData?.cidr_range }}
                                            </mat-radio-button>
                                            <mat-radio-button
                                                value="ip_address"
                                                id="address"
                                                color="primary"
                                                (click)="isOpenedInModal ? handleIpAddressChange('ip_address') : ''"
                                                class="w-100 mr-0 mr-t1"
                                            >
                                                {{ commonLocaleData?.app_address }}
                                            </mat-radio-button>
                                        </mat-radio-group>
                                    </div>

                                    <section
                                        formArrayName="allowedCidrs"
                                        class="ip-range container-fluid mt-2"
                                        *ngIf="permissionForm.get('ipOptions')?.value === 'cidr_range'"
                                    >
                                        <div
                                            class="row mr-b1"
                                            *ngFor="
                                                let item of permissionForm.get('allowedCidrs')['controls'];
                                                let i = index;
                                                let l = last
                                            "
                                            [formGroupName]="i"
                                        >
                                            <div class="col-11">
                                                <input
                                                    class="form-control"
                                                    name="item_{{ i }}"
                                                    formControlName="range"
                                                    type="text"
                                                    [placeholder]="localeData?.cidr_example"
                                                />
                                            </div>
                                            <div class="pull-left lh-34">
                                                <i
                                                    *ngIf="!l"
                                                    (click)="delRow('allowedCidrs', i, $event)"
                                                    class="icon-trash cursor-pointer"
                                                ></i>
                                                <i
                                                    *ngIf="l"
                                                    (click)="addNewRow('allowedCidrs', item, $event)"
                                                    class="icon-plus cursor-pointer"
                                                ></i>
                                            </div>
                                        </div>
                                    </section>

                                    <section
                                        formArrayName="allowedIps"
                                        class="ip-range container-fluid mt-2"
                                        *ngIf="permissionForm.get('ipOptions')?.value === 'ip_address'"
                                    >
                                        <div
                                            class="row mr-b1"
                                            *ngFor="
                                                let item of permissionForm.get('allowedIps')['controls'];
                                                let i = index;
                                                let l = last
                                            "
                                            [formGroupName]="i"
                                        >
                                            <div class="col-11">
                                                <input
                                                    class="form-control"
                                                    (keypress)="allowOnlyNumbersAndDot($event)"
                                                    name="item_{{ i }}"
                                                    formControlName="range"
                                                    type="text"
                                                    [placeholder]="localeData?.ip_example"
                                                />
                                            </div>
                                            <div class="pull-left lh-34">
                                                <i
                                                    *ngIf="!l"
                                                    (click)="delRow('allowedIps', i, $event)"
                                                    class="icon-trash cursor-pointer"
                                                ></i>
                                                <i
                                                    *ngIf="l"
                                                    (click)="addNewRow('allowedIps', item, $event)"
                                                    class="icon-plus cursor-pointer"
                                                ></i>
                                            </div>
                                        </div>
                                    </section>
                                </section>
                            </mat-menu>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-md-12 px-0 text-right text-xl-left" [ngClass]="{ 'text-xl-right' : isUpdtCase}">
                    <div class="form-group add-btn">
                        <button
                            mat-stroked-button
                            color="primary"
                            [ladda]="createPermissionInProcess$ | async"
                            [disabled]="permissionForm.invalid"
                            class="btn custom-btn"
                        >
                            <span *ngIf="!isUpdtCase">{{ commonLocaleData?.app_add }}</span>
                            <span *ngIf="isUpdtCase">{{ commonLocaleData?.app_update }}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-12 text-right text-xl-left" *ngIf="isSuperAdminCompany">
            <button
                mat-stroked-button
                type="button"
                color="primary"
                *ngIf="!isUpdtCase"
                class="btn pull-right create-btn mr-0"
                [routerLink]="['/pages/permissions/list']"
                [queryParams]="{ tab: 'settings' }"
            >
                {{ localeData?.add_custom_role }}
            </button>
        </div>
    </div>
</form>
