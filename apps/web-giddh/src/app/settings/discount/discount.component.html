<ng-container
    appTranslate
    [file]="'settings/discount'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
    (translationComplete)="translationComplete($event)"
>
    <div class="discount box clearfix section-center position-relative">
        <div class="inital-screen position-absolute text-center" *ngIf="!discountList?.length">
            <div class="mb-5">
                <img src="assets/images/create-discounts.png" alt="create discount banner image" width="500px" height="auto">
            </div>
            <button mat-raised-button color="primary" (click)="openCreateEditDiscountAsidePane()">+ {{ localeData?.tab_heading }}</button>
        </div>
        <button *ngIf="discountList?.length" mat-raised-button color="primary" (click)="openCreateEditDiscountAsidePane()">+ {{ localeData?.tab_heading }}</button>
        <div>
            <div class="row mt-4">
                <div class="col-lg-12">
                    <table mat-table [dataSource]="discountList" class="bdr table basic mr-b05 on-mobile-view w-100" *ngIf="discountList?.length">
                        <ng-container matColumnDef="number">
                            <th mat-header-cell *matHeaderCellDef>#</th>
                            <td mat-cell *matCellDef="let element;let i = index">{{ i + 1 }}</td>
                        </ng-container>
                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef>{{ commonLocaleData?.app_name }}</th>
                            <td mat-cell *matCellDef="let element">{{ element.name }}</td>
                        </ng-container>
                        <ng-container matColumnDef="value">
                            <th mat-header-cell *matHeaderCellDef>{{ commonLocaleData?.app_value }}</th>
                            <td mat-cell *matCellDef="let element">{{ element.discountValue }}</td>
                        </ng-container>
                        <ng-container matColumnDef="type">
                            <th mat-header-cell *matHeaderCellDef>{{ localeData?.discount_type }}</th>
                            <td mat-cell *matCellDef="let element">{{ element.discountType === 'FIX_AMOUNT' ? localeData?.fixed_value : commonLocaleData?.app_percent }}</td>
                        </ng-container>
                        <ng-container matColumnDef="action">
                            <th class="text-right" mat-header-cell *matHeaderCellDef>{{ commonLocaleData?.app_action }}</th>
                            <td mat-cell *matCellDef="let element" class="icon-btn text-right">
                                <button mat-stroked-button (click)="editDiscount(element)" class="p-0 mr-3 action-btn">
                                    <i class="icon-edit-pencil"></i>
                                </button>
                                <button mat-stroked-button (click)="showDeleteDiscountDialog(element?.uniqueName)" class="p-0 action-btn">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<!-- open account aside -->
<ng-template #createNew>
    <aside-menu-account
        (closeAsideEvent)="createNewAccountDialogRef?.close()"
        [activeGroupUniqueName]="'discount'"
        [activeAccountDetails]="accInfo"
        [isUpdateAccount]="false"
        [commonLocaleData]="commonLocaleData"
    ></aside-menu-account>
</ng-template>

<!--delete discount confirmation model -->
<ng-template #discountConfirmationDialog>
    <div class="modal-md">
        <div class="modal-content">
            <confirm-modal
                [body]="localeData?.delete_discount"
                (successCallBack)="deleteDiscount()"
                (cancelCallBack)="hideDeleteDiscountModal()"
            ></confirm-modal>
        </div>
    </div>
</ng-template>

<!-- Create/Update Discount -->
<ng-template #createUpdateDiscount>
    <div class="bulk-entry">
        <div class="dialog-header">
            <span mat-dialog-title class="font-16">{{ localeData?.tab_heading }}</span>
            <i (click)="closeCreateEditDiscountAsidePane()" class="icon-cross"></i>
        </div>
        <div mat-dialog-content class="dialog-body d-flex">
            <form #discountForm="ngForm" novalidate (submit)="submit()" class="discount-form-setting-tab">
                <div class="row row-gap align-items-center mt-2">
                    <div class="col-xl-2 col-md-6 col-xs-12">
                        <div class="discount-type">
                            <dropdown-field
                                #discountTypeField
                                [options]="discountTypeList"
                                [name]="'type'"
                                [defaultValue]="getDropdownLabelByValue(discountTypeList, createRequest.type)"
                                [placeholder]="localeData?.discount_type_placeholder"
                                (selectedOption)="createRequest.type = $event.value"
                            ></dropdown-field>
                        </div>
                    </div>
                    <div class="col-xl-2 col-md-6 col-xs-12" *ngIf="createRequest.type">
                        <input-field
                            [label]="commonLocaleData?.app_name"
                            [type]="'text'"
                            [(ngModel)]="createRequest.name"
                            [name]="'name'"
                            [placeholder]="commonLocaleData?.app_name"
                        ></input-field>
                    </div>
        
                    <div class="col-xl-2 col-md-6 col-xs-12" *ngIf="createRequest.type">
                        <input-field
                            [label]="commonLocaleData?.app_value"
                            [type]="'text'"
                            [(ngModel)]="createRequest.discountValue"
                            [name]="'value'"
                            [placeholder]="commonLocaleData?.app_value"
                        ></input-field>
                    </div>
        
                    <div class="col-xl-2 col-md-6 col-xs-12" *ngIf="createRequest.type">
                        <dropdown-field
                            [label]="localeData?.linked_accounts_label"
                            [name]="'account'"
                            [placeholder]="localeData?.linked_accounts_placeholder"
                            [options]="accounts"
                            [cssClass]="'select-linked-accounts'"
                            [defaultValue]="getDropdownLabelByValue(accounts, createRequest.accountUniqueName)"
                            (selectedOption)="createRequest.accountUniqueName = $event.value"
                            (createOption)="openAccountAsidePane($event)"
                            [showCreateNew]="true"
                        ></dropdown-field>
                    </div>
        
                    <div class="col-xl-2 col-md-6 col-xs-12 hide-lable-on-mobile" *ngIf="createRequest.type">
                        <button
                            mat-stroked-button
                            color="primary"
                            type="submit"
                            *ngIf="!createRequest.discountUniqueName"
                            [ladda]="isLoading$ | async"
                        >
                            {{ commonLocaleData?.app_add }}
                        </button>
                        <button
                            mat-stroked-button
                            color="primary"
                            type="submit"
                            *ngIf="createRequest.discountUniqueName"
                            [ladda]="isLoading$ | async"
                        >
                            {{ commonLocaleData?.app_update }}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</ng-template>