<ng-container
    appTranslate
    [file]="'settings/integration'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
>
    <div class="clearfix">
        <mat-tab-group
            [ngClass]="{ 'tab-integration': true, 'hide-payment-tab': !isIndianCompany }"
            id="tab-integration"
        >
            <!-- <tab (selectTab)="loadSmsData($event); tabChanged('sms');">
                <ng-template tabHeading>
                    <span class="icon-chat2"></span> {{localeData?.sms?.tab_heading}}
                </ng-template>

                <div class="box clearfix">
                    <h3 class="font-20 bold mb-2">{{localeData?.sms?.form_heading}}</h3>
                    <form #msgform="ngForm" (ngSubmit)="onSubmitMsgform(msgform)" class="smsForm">
                        <section ngModelGroup="smsFormObj" #smsFormObjCtrl="ngModelGroup">
                            <div class="row">
                                <div class="form-group col-md-5 col-lg-3">

                                    <label>{{localeData?.sms?.auth_key_label}}</label>
                                    <br>
                                    <input type="text" [placeholder]="localeData?.sms?.auth_key_placeholder"
                                        class="form-control" [ngModel]="smsFormObj.authKey" name="authKey" required />

                                </div>
                                <div class="form-group col-md-5 col-lg-3">
                                    <label>{{localeData?.sms?.sender_id_label}}</label>
                                    <br>
                                    <input type="text" [placeholder]="localeData?.sms?.sender_id_placeholder"
                                        class="form-control" [ngModel]="smsFormObj.senderId" name="senderId" required />
                                </div>
                                <div class="form-group col-md-2 col-lg-3">
                                    <div class="empty-label">
                                        <label>&nbsp;</label>
                                        <br>
                                        <button type="submit" class="btn btn-success mr-r1"
                                            [disabled]="smsFormObjCtrl.invalid">{{commonLocaleData?.app_save}}</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </form>
                </div>
            </tab> -->

            <mat-tab label="Communication">
                <!-- Page-1 to Page-3 -->
                <div class="msg91-container" *ngIf="!showTriggerForm">
                    <div class="menu" *ngIf="communicationPlatforms?.MSG91?.isConnected">
                        <button mat-icon-button disableRipple id="edit-model-basic" [matMenuTriggerFor]="beforeMenu">
                            <span class="icon-dots-three-vertical"></span>
                        </button>
                        <mat-menu #beforeMenu="matMenu" xPosition="before">
                            <button mat-menu-item (click)="editCommunicationPlatform = 'MSG91'">
                                <span>{{ localeData?.communication?.edit_platform }}</span>
                            </button>
                            <button
                                mat-menu-item
                                (click)="deleteCommunicationPlatform(communicationPlatforms?.MSG91?.uniqueName)"
                            >
                                <span>{{ localeData?.communication?.remove_platform }}</span>
                            </button>
                        </mat-menu>
                    </div>
                    <div class="image" *ngIf="!communicationPlatforms?.MSG91?.isConnected">
                        <img src="{{ imgPath }}msgOne.png" class="logo" alt="" />
                        <img src="{{ imgPath }}msgTwo.png" class="msg" alt="" />
                    </div>
                    <div class="image" *ngIf="communicationPlatforms?.MSG91?.isConnected">
                        <img src="{{ imgPath }}msgOne-color.png" class="logo" alt="" />
                        <img src="{{ imgPath }}msgTwo-color.png" class="msg" alt="" />
                    </div>
                    <div class="integrate mini-icons" *ngIf="communicationPlatforms?.MSG91?.isConnected">
                        <img src="{{ imgPath }}Bmsg.PNG" alt="" />
                        <img src="{{ imgPath }}p.PNG" alt="" />
                        <img src="{{ imgPath }}wApp.PNG" alt="" />
                        <img src="{{ imgPath }}msg.PNG" alt="" />
                        <img src="{{ imgPath }}9109.PNG" alt="" />
                        <img src="{{ imgPath }}say.PNG" alt="" />
                    </div>
                    <div class="integrate" *ngIf="!communicationPlatforms?.MSG91?.isConnected">
                        <p>{{ localeData?.communication?.integrate_now }}</p>
                    </div>
                </div>
                <div class="form" *ngIf="!isCommunicationPlatformsLoading && editCommunicationPlatform === 'MSG91'">
                    <div class="input-field">
                        <p class="label">
                            {{ communicationPlatforms?.MSG91?.fields?.auth_key?.label
                            }}<span *ngIf="communicationPlatforms?.MSG91?.fields?.auth_key?.mandatory">*</span>
                        </p>
                        <input
                            matInput
                            [attr.placeholder]="communicationPlatforms?.MSG91?.fields?.auth_key?.placeHolder"
                            [(ngModel)]="communicationPlatforms.MSG91.fields.auth_key.value"
                        />
                    </div>
                    <div class="input-field">
                        <p class="label">{{ communicationPlatforms?.MSG91?.fields?.whitelist_ips?.label }}</p>
                        <input
                            matInput
                            [attr.placeholder]="communicationPlatforms?.MSG91?.fields?.whitelist_ips?.placeHolder"
                            [(ngModel)]="communicationPlatforms.MSG91.fields.whitelist_ips.value"
                            readonly
                        />
                    </div>
                    <button
                        mat-flat-button
                        color="primary"
                        [disabled]="isCommunicationPlatformVerificationInProcess"
                        (click)="verifyCommunicationPlatform('MSG91')"
                    >
                        {{ localeData?.communication?.verify_integration }}
                    </button>
                </div>

                <ng-container *ngIf="!editCommunicationPlatform">
                    <button
                        class="new-trigger"
                        mat-flat-button
                        color="primary"
                        *ngIf="!showTriggerForm"
                        (click)="toggleTriggerForm()"
                    >
                        {{ localeData?.communication?.create_new_trigger }}
                    </button>

                    <!-- Page-3 to Page-5 -->
                    <div class="table-one" *ngIf="!isActiveTriggersLoading && !showTriggerForm">
                        <table mat-table [dataSource]="activeTriggersDataSource" class="mat-elevation-z8">
                            <ng-container matColumnDef="title">
                                <th class="active-trigger-title-width" mat-header-cell *matHeaderCellDef>
                                    <!-- <img
                                        class="active-trigger-search"
                                        src="{{ imgPath }}active-trigger-search.svg"
                                        alt=""
                                    /> -->
                                    Active Triggers
                                </th>
                                <td mat-cell *matCellDef="let element">{{ element.title }}</td>
                            </ng-container>

                            <ng-container matColumnDef="type">
                                <th class="channel-width" mat-header-cell *matHeaderCellDef>Type</th>
                                <td mat-cell *matCellDef="let element">{{ element.type }}</td>
                            </ng-container>

                            <ng-container matColumnDef="argsMapping">
                                <th class="args-mapping-width" mat-header-cell *matHeaderCellDef>Fields Mapping</th>
                                <td mat-cell *matCellDef="let element">{{ element.argsMapping }}</td>
                            </ng-container>

                            <ng-container matColumnDef="createdAt">
                                <th class="created-at-width" mat-header-cell *matHeaderCellDef>Created At</th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.createdAt | date: "EEEE, d MMM, yy, h:mm a" }}
                                </td>
                            </ng-container>

                            <ng-container matColumnDef="action">
                                <th class="icons-left" mat-header-cell *matHeaderCellDef>&nbsp;</th>
                                <td mat-cell *matCellDef="let element">
                                    <img class="icon-visibility cursor-pointer" src="{{ imgPath }}copy.svg" alt="" />
                                    <img
                                        class="mr-l2 icon-visibility cursor-pointer"
                                        src="{{ imgPath }}edit.svg"
                                        alt=""
                                        (click)="editTrigger(element)"
                                    />
                                    <a href="javascript:;" (click)="deleteTrigger(element.uniqueName)"
                                        ><img class="mr-l2 icon-visibility" src="{{ imgPath }}delete.svg"
                                    /></a>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="activeTriggersColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: activeTriggersColumns"></tr>
                        </table>
                    </div>
                </ng-container>
                <!-- Page-6 to Page-9 -->
                <div class="trigger-form" *ngIf="!editCommunicationPlatform && showTriggerForm">
                    <div class="trigger-form-left-side">
                        <div class="create-trigger-head">
                            <img class="return" src="{{ imgPath }}return.svg" alt="" (click)="backToListPage($event)" />
                            <p class="trigger-heading">Create Trigger</p>
                        </div>

                        <div class="trigger-input">
                            <p class="trigger-input-label">Title</p>
                            <text-field
                                [type]="'text'"
                                [cssClass]="'form-control mat-field-border'"
                                [placeholder]="'Name Trigger'"
                                [name]="'trigger'"
                                [(ngModel)]="createTrigger.title"
                            >
                            </text-field>
                        </div>
                        <div class="trigger-input">
                            <p class="trigger-input-label">Condition<span>*</span></p>
                            <select-field
                                [cssClass]="'form-control mat-field-border'"
                                [placeholder]="'Select Condition'"
                                [options]="triggerCondition"
                                (selectedOption)="selectConditions($event?.value)"
                                [defaultValue]="triggerAction"
                            ></select-field>
                        </div>
                        <div class="trigger-input">
                            <p class="trigger-input-label">Entity<span>*</span></p>
                            <select-field
                                [cssClass]="'form-control mat-field-border'"
                                [placeholder]="'Select Entity'"
                                [options]="triggerEntity"
                                (selectedOption)="selectEntity($event?.value)"
                                [defaultValue]="triggerEntityValue"
                            ></select-field>
                        </div>
                        <div class="trigger-input">
                            <p class="trigger-input-label">Sub Entity<span>*</span></p>
                            <mat-select
                                name="subentity"
                                class="form-control mat-field-border"
                                placeholder="Select  Sub Entity"
                                multiple
                            >
                                <mat-option
                                    *ngFor="let action of subConditionAction"
                                    [selected]="action?.isChecked"
                                    (onSelectionChange)="selectSubEntity(action)"
                                    >{{ action }}</mat-option
                                >
                            </mat-select>
                        </div>
                        <div class="trigger-input">
                            <p class="trigger-input-label">Campaign<span>*</span></p>
                            <select-field
                                [cssClass]="'form-control mat-field-border'"
                                [placeholder]="'Select Campaign'"
                                [options]="campaignList"
                                (selectedOption)="selectCampaign($event?.value)"
                                [defaultValue]="triggerCampaignSlug"
                            ></select-field>
                        </div>
                        <button mat-flat-button color="primary" (click)="createNewTrigger()">Launch Trigger</button>
                    </div>
                    <div class="trigger-form-right-side" *ngIf="showVariableMapping">
                        <div class="dropdown-box">
                            <div class="compose-trigger-dropdowns">
                                <mat-form-field class="example-chip-list">
                                    <mat-chip-list #chipList>
                                        <mat-chip
                                            *ngFor="let trigger of triggerToChiplist; let indx = index"
                                            [selectable]="selectable"
                                            [removable]="removable"
                                            (removed)="remove(trigger, indx)"
                                        >
                                            {{ trigger }}
                                            <i class="icon-cross" matChipRemove></i>
                                        </mat-chip>
                                        <input
                                            placeholder="Cutomer name"
                                            [matAutocomplete]="auto"
                                            [matChipInputFor]="chipList"
                                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                            [matChipInputAddOnBlur]="addOnBlur"
                                            (matChipInputTokenEnd)="addTriggerTo($event)"
                                        />
                                    </mat-chip-list>
                                    <mat-autocomplete
                                        #auto="matAutocomplete"
                                        (optionSelected)="selectTriggerTo($event)"
                                    >
                                        <mat-option *ngFor="let trigger of triggerTo" [value]="trigger">
                                            {{ trigger.label }}
                                        </mat-option>
                                    </mat-autocomplete>
                                </mat-form-field>
                                <br />
                                <mat-form-field class="example-chip-list">
                                    <mat-chip-list #chipListBcc>
                                        <mat-chip
                                            *ngFor="let trigger of triggerBccChiplist; let indx = index"
                                            [selectable]="selectable"
                                            [removable]="removable"
                                            (removed)="remove(trigger, indx)"
                                        >
                                            {{ trigger }}
                                            <i class="icon-cross" matChipRemove></i>
                                        </mat-chip>
                                        <input
                                            placeholder="Select Bcc"
                                            [matAutocomplete]="auto"
                                            [matChipInputFor]="chipListBcc"
                                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                            [matChipInputAddOnBlur]="addOnBlur"
                                            (matChipInputTokenEnd)="addTriggerBcc($event)"
                                        />
                                    </mat-chip-list>
                                    <mat-autocomplete
                                        #auto="matAutocomplete"
                                        (optionSelected)="selectTriggerTo($event)"
                                    >
                                        <mat-option *ngFor="let trigger of triggerBcc" [value]="trigger">
                                            {{ trigger.label }}
                                        </mat-option>
                                    </mat-autocomplete>
                                </mat-form-field>
                                <br />
                                <mat-form-field class="example-chip-list">
                                    <mat-chip-list #chipListCc>
                                        <mat-chip
                                            *ngFor="let trigger of triggerCcChiplist; let indx = index"
                                            [selectable]="selectable"
                                            [removable]="removable"
                                            (removed)="remove(trigger, indx)"
                                        >
                                            {{ trigger }}
                                            <i class="icon-cross" matChipRemove></i>
                                        </mat-chip>
                                        <input
                                            placeholder="Select CC"
                                            [matAutocomplete]="auto"
                                            [matChipInputFor]="chipListCc"
                                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                            [matChipInputAddOnBlur]="addOnBlur"
                                            (matChipInputTokenEnd)="addTriggerCc($event)"
                                        />
                                    </mat-chip-list>
                                    <mat-autocomplete
                                        #auto="matAutocomplete"
                                        (optionSelected)="selectTriggerCc($event?.value)"
                                    >
                                        <mat-option *ngFor="let trigger of triggerCc" [value]="trigger">
                                            {{ trigger.label }}
                                        </mat-option>
                                    </mat-autocomplete>
                                </mat-form-field>
                                <br />
                                <mat-checkbox
                                    class="trigger-dropdown"
                                    #sendVoucherPdf
                                    color="primary"
                                    name="voucherpdf"
                                    [(ngModel)]="sendVoucherType"
                                    (change)="selectVoucherType($event.checked)"
                                    ><span class="compose">Send Voucher Type</span>
                                </mat-checkbox>
                            </div>
                            <br />
                            <p class="compose">Variables</p>
                            <mat-grid-list class="unit-mapping-grid-list" cols="3" gutterSize="0px" rowHeight="70px">
                                <form class="map-unit-value-form">
                                    <mat-grid-tile
                                        class="grid-box grid-box-content campaign-grid-tile"
                                        *ngFor="let variables of createTrigger.campaignDetails.argsMapping"
                                    >
                                        <div class="unit-value">{{ variables.name }}</div>
                                        <div class="map-unit-value">
                                            <select-field
                                                [cssClass]="'form-control mat-field-border'"
                                                [placeholder]="'Select Suggestion'"
                                                [options]="fieldsSuggestion"
                                                (selectedOption)="
                                                    selectFieldSuggestions((variables.value = $event.value))
                                                "
                                                [defaultValue]="fieldsVariable"
                                            ></select-field>
                                        </div>
                                    </mat-grid-tile>
                                </form>
                            </mat-grid-list>
                            <br />
                        </div>
                    </div>
                </div>
                <!-- <div class="main-content">
                    <p>Giddh Suggested Trigger</p>

                    <table mat-table [dataSource]="table2" class="mat-elevation-z8">
                        <ng-container matColumnDef="triggers">
                            <th mat-header-cell *matHeaderCellDef>Triggers</th>
                            <td class="triggers-content" mat-cell *matCellDef="let element">{{ element.triggers }}</td>
                        </ng-container>

                        <ng-container matColumnDef="type">
                            <th class="type-column" mat-header-cell *matHeaderCellDef>Type</th>
                            <td mat-cell *matCellDef="let element">{{ element.type }}</td>
                        </ng-container>

                        <ng-container matColumnDef="content">
                            <th mat-header-cell *matHeaderCellDef>content</th>
                            <td class="content-text" mat-cell *matCellDef="let element">{{ element.content }}</td>
                        </ng-container>

                        <ng-container matColumnDef="icon">
                            <th mat-header-cell *matHeaderCellDef></th>
                            <td class="icon-container" mat-cell *matCellDef="let element">
                                <img class="hideShow right-side" src="{{ imgPath }}{{ element.icon }}" alt="" />
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="button">
                            <th mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell *matCellDef="let element">
                                <button class="hideShow small-button" mat-flat-button color="primary">
                                    {{ element.button }}
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedtable2Columns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedtable2Columns"></tr>
                    </table>
                </div> -->

                <!-- Page 10 -->
                <!-- <div class="msg91-container">
                    <div class="menu">
                        <button
                            mat-icon-button
                            disableRipple
                            [matMenuTriggerFor]="beforeMenu"
                            aria-label="Example icon-button with a menu"
                        >
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #beforeMenu="matMenu" xPosition="before">
                            <button mat-menu-item>
                                <span>Remove Account</span>
                            </button>
                        </mat-menu>
                    </div>

                    <div class="image">
                        <img src="{{ imgPath }}msgOne-color.png" class="logo" alt="" />
                        <img src="{{ imgPath }}msgTwo-color.png" class="msg" alt="" />
                    </div>
                    <div class="integrate mini-icons">
                        <img src="{{ imgPath }}Bmsg.PNG" alt="" />
                        <img src="{{ imgPath }}p.PNG" alt="" />
                        <img src="{{ imgPath }}wApp.PNG" alt="" />
                        <img src="{{ imgPath }}msg.PNG" alt="" />
                        <img src="{{ imgPath }}9109.PNG" alt="" />
                        <img src="{{ imgPath }}say.PNG" alt="" />
                    </div>
                </div>

                <button class="new-trigger" mat-flat-button color="primary">+ Create New Trigger</button>

                <div class="table-one">
                    <table mat-table [dataSource]="table1" class="mat-elevation-z8">
                        <ng-container matColumnDef="activeTriggers">
                            <th class="activeTriggers-width" mat-header-cell *matHeaderCellDef>
                                <img
                                    class="active-trigger-search"
                                    src="{{ imgPath }}active-trigger-search.svg"
                                    alt=""
                                />
                                Active Triggers
                            </th>
                            <td mat-cell *matCellDef="let element">{{ element.activeTriggers }}</td>
                        </ng-container>

                        <ng-container matColumnDef="type">
                            <th class="type-width" mat-header-cell *matHeaderCellDef>Type</th>
                            <td mat-cell *matCellDef="let element">{{ element.type }}</td>
                        </ng-container>

                        <ng-container matColumnDef="content">
                            <th class="content-width" mat-header-cell *matHeaderCellDef>Content</th>
                            <td class="smaller-font" mat-cell *matCellDef="let element">{{ element.content }}</td>
                        </ng-container>

                        <ng-container matColumnDef="createdOn">
                            <th class="createdOn-width" mat-header-cell *matHeaderCellDef>Created On</th>
                            <td class="smaller-font" mat-cell *matCellDef="let element">{{ element.createdOn }}</td>
                        </ng-container>

                        <ng-container matColumnDef="copy">
                            <th class="icons-left" mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell *matCellDef="let element">
                                <img class="icon-hideShow" src="{{ imgPath }}{{ element.copy }}" alt="" />
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="edit">
                            <th class="icons-left" mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell *matCellDef="let element">
                                <img class="icon-hideShow" src="{{ imgPath }}{{ element.edit }}" alt="" />
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="delete">
                            <th class="icons-right" mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell *matCellDef="let element">
                                <img class="icon-hideShow" src="{{ imgPath }}{{ element.delete }}" alt="" />
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedtable1Columns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedtable1Columns"></tr>
                    </table>
                </div>

                <div class="main-content">
                    <p>Giddh Suggested Trigger</p>

                    <table mat-table [dataSource]="table3" class="mat-elevation-z8">
                        <ng-container matColumnDef="triggers">
                            <th mat-header-cell *matHeaderCellDef>Triggers</th>
                            <td class="triggers-content" mat-cell *matCellDef="let element">{{ element.triggers }}</td>
                        </ng-container>

                        <ng-container matColumnDef="type">
                            <th class="type-column" mat-header-cell *matHeaderCellDef>Type</th>
                            <td mat-cell *matCellDef="let element">{{ element.type }}</td>
                        </ng-container>

                        <ng-container matColumnDef="content">
                            <th mat-header-cell *matHeaderCellDef>content</th>
                            <td class="content-text" mat-cell *matCellDef="let element">{{ element.content }}</td>
                        </ng-container>

                        <ng-container matColumnDef="text">
                            <th class="number-container" mat-header-cell *matHeaderCellDef></th>
                            <td class="number-container" mat-cell *matCellDef="let element">{{ element.text }}</td>
                        </ng-container>

                        <ng-container matColumnDef="button">
                            <th mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell class="table3-button" *matCellDef="let element">
                                <button class="hideShow" mat-flat-button color="primary">{{ element.button }}</button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedtable3Columns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedtable3Columns"></tr>
                    </table>
                </div> -->
            </mat-tab>

            <mat-tab label="Email" (selectTab)="loadEmailData($event); tabChanged('email')">
                <ng-template> <span class="icon-mail"></span> {{ localeData?.email?.tab_heading }} </ng-template>

                <div class="box clearfix mb-2">
                    <h3 class="section-head">{{ localeData?.email?.gmail_integration }}</h3>
                    <div class="d-flex gmail-integration-message">
                        <ng-container *ngIf="!(isGmailIntegrated$ | async)">
                            <a *ngIf="!isElectron" class="btn btn-primary" [href]="gmailAuthCodeUrl$ | async">{{
                                localeData?.email?.connect_gmail
                            }}</a>

                            <a
                                *ngIf="isElectron"
                                class="btn btn-primary"
                                href="javascript:void(0);"
                                (click)="gmailIntegration('google')"
                                >{{ localeData?.email?.connect_gmail }}</a
                            >
                        </ng-container>

                        <h4 *ngIf="isGmailIntegrated$ | async" class="text-success align-self-center">
                            {{ localeData?.email?.gmail_connected }}
                        </h4>
                        <button
                            *ngIf="isGmailIntegrated$ | async"
                            class="btn btn-danger mr-l2"
                            (click)="removegmailintegration.toggle()"
                        >
                            {{ localeData?.email?.remove_account }}
                        </button>
                    </div>
                </div>

                <!--remove account integration confirmation modal-->
                <div bsModal #removegmailintegration="bs-modal" class="modal fade" role="dialog">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <confirm-modal
                                [title]="localeData?.email?.remove_account_title"
                                [body]="localeData?.email?.remove_account_message"
                                (cancelCallBack)="removegmailintegration.toggle()"
                                (successCallBack)="removeGmailAccount(); removegmailintegration.toggle()"
                            >
                            </confirm-modal>
                        </div>
                    </div>
                </div>

                <div class="box clearfix">
                    <h3 class="font-20 bold mb-2">{{ localeData?.email?.form_heading }}</h3>
                    <form #emailform="ngForm" (ngSubmit)="onSubmitEmailform(emailform)">
                        <div class="row">
                            <div class="form-group col-md-5 col-lg-3">
                                <label>{{ localeData?.email?.auth_key_label }}</label>
                                <br />
                                <input
                                    type="text"
                                    [placeholder]="localeData?.email?.auth_key_placeholder"
                                    class="form-control"
                                    [ngModel]="emailFormObj.authKey"
                                    name="authKey"
                                    required
                                />
                            </div>
                            <div class="form-group col-md-5 col-lg-3">
                                <label>{{ localeData?.email?.email_subject_label }}</label>
                                <br />
                                <input
                                    type="text"
                                    [placeholder]="localeData?.email?.email_subject_placeholder"
                                    class="form-control"
                                    [ngModel]="emailFormObj.subject"
                                    name="subject"
                                    required
                                />
                            </div>
                            <div class="form-group col-md-2 col-lg-3 empty-label">
                                <label>&nbsp;</label>
                                <br />
                                <button type="submit" class="btn btn-success mr-r1" [disabled]="emailform.invalid">
                                    {{ commonLocaleData?.app_save }}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </mat-tab>

            <mat-tab label="Collection" (selectTab)="loadCollectionData($event); tabChanged('collection')">
                <ng-template> <span class="icon-card"></span> {{ localeData?.collection?.tab_heading }} </ng-template>

                <div class="box clearfix mb-2">
                    <h3 class="font-20 bold mb-2">{{ localeData?.collection?.razorpay_form_heading }}</h3>
                    <form #razorPayform="ngForm" novalidate class="">
                        <div class="row">
                            <div class="form-group col-lg-4 col-md-6 col-xs-12">
                                <label
                                    >{{ localeData?.collection?.key_id_label }}
                                    <span class="required">*</span>
                                </label>
                                <input
                                    class="form-control"
                                    type="text"
                                    [placeholder]="localeData?.collection?.key_id_placeholder"
                                    name="razorPayObj.userName"
                                    [(ngModel)]="razorPayObj.userName"
                                    required
                                    autocomplete="off"
                                />
                            </div>
                            <div class="form-group col-lg-4 col-md-6 col-xs-12">
                                <label
                                    >{{ localeData?.collection?.secret_key_label }}
                                    <span class="required">*</span>
                                </label>
                                <input
                                    class="form-control"
                                    type="password"
                                    [placeholder]="localeData?.collection?.secret_key_placeholder"
                                    name="razorPayObj.password"
                                    [(ngModel)]="razorPayObj.password"
                                    required
                                    autocomplete="off"
                                />
                            </div>
                        </div>
                        <div>
                            <div class="row">
                                <div class="form-group col-lg-4 col-md-6 col-xs-12">
                                    <div>
                                        <label>{{ localeData?.collection?.link_account_label }}</label>
                                        <div class="input-group">
                                            <sh-select
                                                class="linked-account"
                                                [placeholder]="localeData?.collection?.link_account_placeholder"
                                                name="razorPayObj.account"
                                                [(ngModel)]="razorPayObj.account.uniqueName"
                                                [options]="accounts$ | async"
                                                (selected)="selectAccount($event)"
                                                [forceClearReactive]="forceClearLinkAccount$ | async"
                                                [enableDynamicSearch]="true"
                                                [isPaginationEnabled]="true"
                                                (scrollEnd)="handleScrollEnd()"
                                                (dynamicSearchedQuery)="onAccountSearchQueryChanged($event)"
                                                [fixedValue]="razorPayObj?.account?.name"
                                                [defaultValue]="razorPayObj?.account?.name"
                                            >
                                            </sh-select>
                                            <div
                                                class="input-group-addon cp"
                                                *ngIf="razorPayObj?.account?.uniqueName && razorPayObj?.account?.name"
                                            >
                                                <span (click)="unlinkAccountFromRazorPay()" class="icon-trash"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-lg-4 col-md-6 col-xs-12 mr-t1 empty-label" id="inlnImg">
                                    <label>&nbsp;</label>
                                    <br />
                                    <ngx-switch
                                        [(status)]="razorPayObj.autoCapturePayment"
                                        [onText]="commonLocaleData?.app_on"
                                        [offText]="commonLocaleData?.app_off"
                                        [onColor]="bootstrapToggleSwitch?.On"
                                        [offColor]="bootstrapToggleSwitch?.Off"
                                        [size]="bootstrapToggleSwitch?.Size"
                                    >
                                    </ngx-switch>

                                    {{ localeData?.collection?.automatic_capture_on_payment }}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <button
                                    *ngIf="!updateRazor"
                                    class="btn btn-success"
                                    [disabled]="razorPayform.invalid"
                                    (click)="saveRazorPayDetails()"
                                >
                                    {{ commonLocaleData?.app_save }}
                                </button>
                                <button
                                    *ngIf="updateRazor"
                                    class="btn btn-success"
                                    [disabled]="razorPayform.invalid"
                                    (click)="updateRazorPayDetails()"
                                >
                                    {{ commonLocaleData?.app_update }}
                                </button>
                                <button *ngIf="updateRazor" class="btn btn-danger" (click)="deleteRazorPayDetails()">
                                    {{ commonLocaleData?.app_delete }}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </mat-tab>

            <mat-tab label="E-Commerce" (selectTab)="loadEcommerceData($event); tabChanged('ecommerce')">
                <ng-template> <span class="icon-ecomm"></span> {{ localeData?.ecommerce?.tab_heading }} </ng-template>
                <div class="mr-t2 box clearfix">
                    <h3 class="section-head mb-2">{{ localeData?.ecommerce?.shopify_form_heading }}</h3>
                    <span *ngIf="isEcommerceShopifyUserVerified">{{
                        localeData?.ecommerce?.shopify_connected_message
                    }}</span>
                    <a
                        href="https://shopify.giddh.com/signup.php"
                        target="_blank"
                        *ngIf="!isEcommerceShopifyUserVerified"
                    >
                        <span>{{ localeData?.ecommerce?.connect_shopify }}</span></a
                    >
                </div>
            </mat-tab>

            <mat-tab
                label="Payment"
                (selectTab)="loadPaymentData($event); tabChanged('payment')"
                [hidden]="!isIndianCompany"
            >
                <div *ngIf="isIndianCompany">
                    <ng-template>
                        <span class="icon-payment"></span> {{ localeData?.payment?.tab_heading }}
                    </ng-template>
                    <div class="mb-2 bank-logo">
                        <img src="{{ imgPath }}ICICI-logo.png" />
                    </div>
                    <div class="row">
                        <div class="form-group mr-l2">
                            <button type="button" class="btn btn-sky-blue mr-r2" (click)="openCreateNewAccountModal()">
                                {{ localeData?.payment?.connect_new_account }}
                            </button>
                            <span class="button-separator">|</span> <br />
                            <a
                                href="https://giddh.com/help/how-to-integrate-icici-bank-account-with-giddh"
                                target="_blank"
                                class="font-12"
                                >{{ localeData?.payment?.learn_connect }}</a
                            >
                        </div>
                        <div class="form-group mr-l1">
                            <p class="mb-4 mr-l05 font-12">
                                <a
                                    class="btn icici-button"
                                    href="https://cadigital.icicibank.com/SmartFormWeb/apps/services/www/SmartFormWeb/desktopbrowser/default/index.html?source=BC-application-Giddh#/"
                                    target="_blank"
                                    ><span class="icon-icici-logo"
                                        ><span class="path1"></span><span class="path2"></span
                                        ><span class="path3"></span
                                    ></span>
                                    {{ localeData?.payment?.open_new_current_account }}</a
                                >
                            </p>
                        </div>
                    </div>

                    <div class="connected-accounts">
                        <b class="font-14" *ngIf="!isLoading && connectedBankAccounts?.length > 0">{{
                            localeData?.payment?.connected_accounts
                        }}</b
                        ><br />
                        <giddh-page-loader [cssClass]="'mt-0 mb-0'" *ngIf="isLoading"></giddh-page-loader>
                        <ng-container *ngIf="!isLoading && connectedBankAccounts?.length > 0">
                            <div
                                class="account-wrapper"
                                *ngFor="let bankAccount of connectedBankAccounts; trackBy: trackByAccountUniqueName"
                            >
                                <div class="account-info-background width-100 font-14 row">
                                    <div class="col-md-4">
                                        <span class="field-label">{{ localeData?.payment?.account_number_label }}</span
                                        ><br />
                                        <span class="account-number mt-2 font-16 inline"
                                            ><b>{{ bankAccount?.iciciDetailsResource?.accountNumber }}</b></span
                                        >
                                    </div>
                                    <div class="col-md-4">
                                        <span class="field-label">{{ localeData?.payment?.linked_account }}</span
                                        ><br />
                                        <span class="width-100 view-only-field inline">{{
                                            bankAccount?.account?.name
                                        }}</span>
                                    </div>
                                    <div class="col-md-4">
                                        <span class="field-label">{{ localeData?.payment?.payment_updates }}</span
                                        ><br />
                                        <span
                                            class="payment-updates view-only-field inline"
                                            *ngIf="bankAccount?.iciciDetailsResource?.paymentAlerts?.length > 0"
                                        >
                                            <ng-container
                                                *ngFor="
                                                    let alert of bankAccount?.iciciDetailsResource?.paymentAlerts;
                                                    let i = index;
                                                    trackBy: trackByAlertUniqueName
                                                "
                                                >{{ alert?.name
                                                }}{{
                                                    i < bankAccount?.iciciDetailsResource?.paymentAlerts?.length - 1
                                                        ? ", "
                                                        : ""
                                                }}</ng-container
                                            >
                                        </span>
                                        <span class="mr-l1 action-div">
                                            <a
                                                href="javascript:;"
                                                class="icon-edit-pencil"
                                                (click)="openEditAccountModal(bankAccount)"
                                            ></a>
                                        </span>
                                    </div>
                                </div>
                                <div class="font-14">
                                    <ng-container *ngIf="bankAccount?.iciciDetailsResource?.payor?.length > 0">
                                        <div
                                            class="mt-2"
                                            *ngFor="
                                                let payor of bankAccount?.iciciDetailsResource?.payor;
                                                trackBy: trackByPayorUniqueName
                                            "
                                        >
                                            <div class="width-100">
                                                <div class="col-md-4 v-align-top inline">
                                                    <span class="field-label">{{
                                                        localeData?.payment?.login_id_label
                                                    }}</span
                                                    ><br />
                                                    <span class="width-100 disabled-field inline">{{
                                                        payor?.loginId
                                                    }}</span
                                                    ><br />
                                                    <span class="font-12 field-label">{{ payor?.user?.name }}</span>
                                                </div>
                                                <div class="col-md-4 v-align-top inline">
                                                    <span class="limit-upto field-label">{{
                                                        localeData?.payment?.limit_upto
                                                    }}</span
                                                    ><br />
                                                    <span class="width-100 disabled-field inline limit-upto"
                                                        >{{
                                                            payor?.duration === unlimitedLimit
                                                                ? commonLocaleData?.app_amount_limit?.unlimited
                                                                : activeCompany?.baseCurrencySymbol +
                                                                  " " +
                                                                  (payor?.maxAmount | giddhCurrency)
                                                        }}
                                                        <span
                                                            class="pull-right payor-duration font-12"
                                                            *ngIf="payor?.duration !== unlimitedLimit"
                                                            >/ {{ payor?.duration | titlecase }}</span
                                                        ></span
                                                    ><br />
                                                    <span class="limit-upto font-12 field-label"
                                                        >{{ localeData?.payment?.used }}
                                                        {{ payor?.usedAmount | giddhCurrency }}</span
                                                    >
                                                </div>
                                                <div class="col-md-4 v-align-top inline mt-2">
                                                    <br />
                                                    <span
                                                        class="account-approval-status pending-approval"
                                                        *ngIf="!payor?.isConnected"
                                                        ><i class="icon-alert-2"></i>
                                                        {{ localeData?.payment?.pending_self_approval }}</span
                                                    >
                                                    <span
                                                        class="account-approval-status approved"
                                                        *ngIf="payor?.isConnected"
                                                        ><i class="icon-success"></i>
                                                        {{ localeData?.payment?.connected }}</span
                                                    >
                                                    <span class="mr-l15 user-action-div">
                                                        <a
                                                            *ngIf="payor?.isConnected"
                                                            href="javascript:;"
                                                            class="icon-edit-pencil"
                                                            (click)="openEditAccountUserModal(bankAccount, payor)"
                                                        ></a>
                                                        <a
                                                            href="javascript:;"
                                                            class="fa fa-trash mr-l2"
                                                            (click)="
                                                                showDeleteBankAccountLoginConfirmationModal(
                                                                    bankAccount,
                                                                    payor
                                                                )
                                                            "
                                                        ></a>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="inline mt-2 mb-2" *ngIf="!payor?.isConnected">
                                                <div class="col-md-12">
                                                    <p
                                                        class="font-12"
                                                        [innerHTML]="localeData?.payment?.approval_request_sent"
                                                    ></p>
                                                    <p class="font-10">
                                                        {{ localeData?.payment?.approval_request_accepted }}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <button
                                        type="button"
                                        class="btn btn-light-blue bold font-14 mt-2 mr-l15"
                                        (click)="openCreateNewAccountUserModal(bankAccount)"
                                    >
                                        {{ localeData?.payment?.add_more_users }}
                                    </button>
                                    <a class="btn icici-button font-12 mt-2 pull-right mr-0" href="javascript:;"
                                        ><span class="icon-icici-logo"
                                            ><span class="path1"></span><span class="path2"></span
                                            ><span class="path3"></span
                                        ></span>
                                        {{ localeData?.payment?.get_instant_overdraft }}</a
                                    >
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="Tally" (selectTab)="tabChanged('tally')">
                <ng-template> <span class="icon-card"></span>{{ localeData?.tally?.heading }}</ng-template>
                <div class="box clearfix mb-2">
                    <div class="form-group magic-link-container col-md-9 col-lg-7 d-flex align-items-center">
                        <label class="bold">{{ localeData?.tally?.api_url }}</label>
                        <mat-form-field appearance="fill">
                            <input
                                #apiUrlInput
                                matInput
                                class="dashed tally-url"
                                [readonly]="true"
                                type="text"
                                [(ngModel)]="apiUrl"
                            />
                        </mat-form-field>
                        <span class="input-group-btn">
                            <i
                                class="icon-copy-file"
                                (click)="copyUrl()"
                                [ngxClipboard]="apiUrlInput"
                                [tooltip]="commonLocaleData?.app_copy"
                            ></i>
                        </span>
                        <span class="success copied-url" *ngIf="isCopied">{{ localeData?.tally?.copied }}</span>
                    </div>
                    <div class="form-group clearfix mb-0 doc-link">
                        <a target="_blank" class="btn btn-link" [routerLink]="['/pages/user-details/auth-key']">{{
                            localeData?.email?.auth_key_label
                        }}</a>
                        <a
                            target="_blank"
                            class="btn btn-link"
                            href="https://giddh.com/help/sync-with-tally-1591360375828781"
                            >{{ localeData?.tally?.help_documentation }}</a
                        >
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
    <div bsModal #createNewAccountModal="bs-modal" [config]="{ backdrop: 'static' }" class="modal" role="dialog">
        <div class="modal-dialog account-modal" *ngIf="createNewAccountModal?.isShown">
            <div class="modal-content">
                <icici-account-create-edit
                    [commonLocaleData]="commonLocaleData"
                    (getAllBankAccounts)="getAllBankAccounts()"
                    (closeModalEvent)="closeCreateNewAccountModal()"
                >
                </icici-account-create-edit>
            </div>
        </div>
    </div>
    <div bsModal #editAccountModal="bs-modal" [config]="{ backdrop: 'static' }" class="modal" role="dialog">
        <div class="modal-dialog account-modal" *ngIf="editAccountModal?.isShown">
            <div class="modal-content">
                <icici-account-create-edit
                    [commonLocaleData]="commonLocaleData"
                    [activeBankAccount]="activeBankAccount"
                    (getAllBankAccounts)="getAllBankAccounts()"
                    (closeModalEvent)="closeEditAccountModal()"
                >
                </icici-account-create-edit>
            </div>
        </div>
    </div>
    <div bsModal #createNewAccountUserModal="bs-modal" [config]="{ backdrop: 'static' }" class="modal" role="dialog">
        <div class="modal-dialog user-modal" *ngIf="createNewAccountUserModal?.isShown">
            <div class="modal-content">
                <icici-payor-account-create-edit
                    [commonLocaleData]="commonLocaleData"
                    [activeBankAccount]="activeBankAccount"
                    (getAllBankAccounts)="getAllBankAccounts()"
                    (closeModalEvent)="closeCreateNewAccountUserModal()"
                ></icici-payor-account-create-edit>
            </div>
        </div>
    </div>
    <div bsModal #editAccountUserModal="bs-modal" [config]="{ backdrop: 'static' }" class="modal" role="dialog">
        <div class="modal-dialog user-modal" *ngIf="editAccountUserModal?.isShown">
            <div class="modal-content">
                <icici-payor-account-create-edit
                    [commonLocaleData]="commonLocaleData"
                    [activeBankAccount]="activeBankAccount"
                    [activePayorAccount]="activePayorAccount"
                    (getAllBankAccounts)="getAllBankAccounts()"
                    (closeModalEvent)="closeEditAccountUserModal()"
                >
                </icici-payor-account-create-edit>
            </div>
        </div>
    </div>
    <div
        bsModal
        #confirmationModal="bs-modal"
        [config]="{ backdrop: 'static', keyboard: false }"
        class="modal fade"
        role="dialog"
    >
        <div class="modal-dialog modal-md" *ngIf="confirmationModal?.isShown">
            <div class="modal-content">
                <confirm-modal
                    [body]="localeData?.payment?.delete_login | replace: '[LOGIN_ID]':activeBankAccount?.loginId"
                    (cancelCallBack)="confirmationModal?.hide()"
                    (successCallBack)="deleteBankAccountLogin(true)"
                >
                </confirm-modal>
            </div>
        </div>
    </div>
</ng-container>
