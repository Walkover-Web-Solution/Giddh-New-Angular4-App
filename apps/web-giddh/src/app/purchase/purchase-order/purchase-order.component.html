<div class="container-fluid">
    <div class="d-flex justify-content-between mt-15 purchase-order-header">
        <div class="d-flex date-advanceSearch">
            <form #invoiceForm="ngForm" novalidate class="form-inline">
                <div class="form-group mrR1 d-flex">
                    <div class="input-group">
                        <span class="input-wrapper">
                            <input type="text" name="dateRange" (click)="showGiddhDatepicker($event)"
                                [value]="(selectedDateRangeUi) ? selectedDateRangeUi : ''"
                                class="giddh-datepicker form-control date-range-picker" />
                        </span>
                    </div>
                    <div class="advance-icon" style="align-items: center" tooltip="Advance Search"
                        (click)="openAdvanceSearchModal(purchaseAdvanceSearch)">
                        <span class="icon-advance-filter"></span>
                    </div>
                </div>
            </form>
        </div>
        <div class="clear-filter" *ngIf="showClearFilterButton()">
            <button class="btn btn-default mr-0" (click)="clearFilter()">
                <span class="icon-cross"></span> Clear Filter
            </button>
        </div>
        <div class="d-flex add-invoice">
            <div>
                <div class="btn-group" dropdown #dp="bs-dropdown">
                    <button dropdownToggle type="button" class="btn btn-primary desktop-view-btn dropdown-toggle"
                        aria-controls="dropdown-basic">
                        More
                        <span class="caret"></span>
                    </button>
                    <ul *dropdownMenu class="dropdown-menu fixedDropdownPlus" role="menu"
                        aria-labelledby="button-basic">
                        <!-- <li role="menuitem">
                            <a class="dropdown-item cp" href="javascript:void(0)"
                                (click)="openModalBulkUpdate(template)">Bulk Update</a>
                        </li>
                        <li role="menuitem">
                            <a class="dropdown-item cp" href="javascript:void(0)">
                                Convert to bill</a>
                        </li> -->
                        <li role="menuitem">
                            <a class="dropdown-item cp" href="javascript:void(0)">
                                Expired</a>
                        </li>
                        <li role="menuitem">
                            <a class="dropdown-item cp" href="javascript:void(0)">Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="btn-wrapper">
                <button class="btn btn-pink desktop-view-btn mr-0"
                    [routerLink]="['/pages/purchase-management/create-purchase-order']">+
                    New Order
                </button>
            </div>
        </div>
    </div>
    <div class="mobile-search">
        <div class="clear-filter mr-1" *ngIf="showClearFilterButton()">
            <button class="btn btn-default mr-0" (click)="clearFilter()">
                <span class="icon-cross"></span> Clear Filter
            </button>
        </div>
        <div>
            <div class="btn-group" dropdown #dp="bs-dropdown">
                <button dropdownToggle type="button" class="btn btn-primary desktop-view-btn dropdown-toggle"
                    aria-controls="dropdown-basic">
                    More
                    <span class="caret"></span>
                </button>
                <ul *dropdownMenu class="dropdown-menu fixedDropdownPlus" role="menu" aria-labelledby="button-basic">
                    <!-- <li role="menuitem">
                        <a class="dropdown-item cp" href="javascript:void(0)"
                            (click)="openModalBulkUpdate(template)">Bulk
                            Update</a>
                    </li>
                    <li role="menuitem">
                        <a class="dropdown-item cp" href="javascript:void(0)">
                            Convert to bill</a>
                    </li> -->
                    <li role="menuitem">
                        <a class="dropdown-item cp" href="javascript:void(0)">
                            Expired</a>
                    </li>
                    <li role="menuitem">
                        <a class="dropdown-item cp" href="javascript:void(0)">Delete</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="btn-wrapper">
            <button class="btn btn-pink desktop-view-btn mr-0"
                [routerLink]="['/pages/purchase-management/create-purchase-order']">+
                New Order
            </button>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table basic mt-15 table-bordered giddh-table on-mobile-view">
            <thead class="t-h-bg1">
                <tr>
                    <!-- functioanlity should be like proform/estimate module -->
                    <th width="3%">
                        <div class="table-checkbox-field">
                            #
                            <div class="table-checkbox-field" hidden>
                                <img src="assets/images/unchecked.png">
                                <!-- <img src="assets/images/checked.png"> -->
                            </div>
                        </div>
                    </th>

                    <th width="10%" class="td-search-box">
                        <div class="d-flex">
                            <div>Date</div>
                            <div class="icon-pointer">
                                <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'purchaseDate'}">
                                </ng-container>
                            </div>
                        </div>
                    </th>

                    <th width="15%" class="td-search-box" (clickOutside)="showPurchaseOrderNumberSearch = false">
                        <div>
                            <span [hidden]="showPurchaseOrderNumberSearch">Purchase Order#</span>
                            <i class="icon-search" (click)="showInlineSearch('purchaseOrderNumber', searchBox);"
                                [hidden]="showPurchaseOrderNumberSearch"></i>
                        </div>
                        <div class="input-container" [hidden]="!showPurchaseOrderNumberSearch">
                            <input type="text" placeholder="Search Purchase Order#" class="w100" #searchBox
                                [(ngModel)]="purchaseOrderPostRequest.purchaseOrderNumber" (keyup)="columnSearch()"
                                (keydown)="columnSearch()" />
                        </div>
                    </th>

                    <th width="15%" class="td-search-box" (clickOutside)="showVendorNameSearch = false">
                        <div>
                            <span [hidden]="showVendorNameSearch">Vendor Name</span>
                            <i class="icon-search" (click)="showInlineSearch('vendorName', searchBox);"
                                [hidden]="showVendorNameSearch"></i>
                        </div>
                        <div class="input-container" [hidden]="!showVendorNameSearch">
                            <input type="text" placeholder="Search Vendor Name" class="w100" #searchBox
                                [(ngModel)]="purchaseOrderGetRequest.search" (keyup)="columnSearch()"
                                (keydown)="columnSearch()" />
                        </div>
                    </th>

                    <th width="15%">
                        <div class="d-flex justify-content-end">
                            <div class="text-right"> Total Amt.</div>
                            <div class="icon-pointer">
                                <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'grandTotal'}">
                                </ng-container>
                            </div>
                        </div>
                    </th>

                    <th width="15%">
                        <div class="d-flex">
                            <div>Expected Delivery</div>
                            <div class="icon-pointer">
                                <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'dueDate'}">
                                </ng-container>
                            </div>
                        </div>
                    </th>

                    <th width="15%">
                        <div class="d-flex">
                            <div>Status</div>
                            <div class="icon-pointer">

                            </div>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody *ngIf="!isLoading && purchaseOrders.items && purchaseOrders.items.length > 0">
                <tr *ngFor="let row of purchaseOrders.items; let i = index;">
                    <td data-title="#">
                        {{ (purchaseOrderGetRequest.count * (purchaseOrderGetRequest.page - 1)) + (i+1) }}
                        <!-- make this dynamic , functionality should be like proforma invoice for mobile view only  -->
                        <div class="mh18_img" class="justify-content-sm-start check-uncheck" hidden>
                            <img src="assets/images/unchecked.png" />
                            <img src="assets/images/checked.png" />
                        </div>
                        <div class="download-purchase-order">
                            <i class="icon-download"></i>
                        </div>
                    </td>
                    <td data-title="Date">
                        {{row.voucherDate}}
                    </td>
                    <td data-title="Purchase Order">
                        <a
                            routerLink="['/pages/purchase-management/purchase-order-invoice-preview/'+row.uniqueName]">{{row.voucherNumber}}</a>
                    </td>
                    <td data-title="Vendor Name">
                        {{row.vendor?.name}}
                    </td>
                    <td data-title="Total Amt." class="text-right">
                        {{row.amountForAccount}}
                    </td>
                    <td data-title="Expected Delivery">
                        <span hidden>Delivery in 7 days</span>
                        <span>{{row.dueDate}}</span>
                    </td>
                    <td data-title="status" class="d-flex align-items-center">
                        <span class="d-flex">
                            {{row.status}}</span>
                        <div class="action-icon ml-15">
                            <a tooltip="Convert to bill">
                                <span class="icon-tick font-12"></span>
                            </a>
                            <a tooltip="Send Email">
                                <span class="icon-enevlop font-12"></span>
                            </a>
                            <a tooltip="Copy">
                                <span class="icon-copy-small font-14"></span>
                            </a>
                            <a tooltip="Delete">
                                <i class="icon-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            </tbody>
            <tbody *ngIf="!isLoading && !purchaseOrders.totalItems">
                <tr>
                    <td colspan="7" class="text-center empty_table">
                        <h1>No Record Found !!</h1>
                    </td>
                </tr>
            </tbody>
            <tbody *ngIf="isLoading">
                <tr>
                    <td colspan="8">
                        <div class="no-data mrT2 loader-main">
                            <div class="spinner2">
                                <div class="cube1"></div>
                                <div class="cube2"></div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <pagination *ngIf="purchaseOrders.totalPages > 0" class="pagination" [totalItems]="purchaseOrders.totalItems"
        [maxSize]="5" [boundaryLinks]="true" [rotate]="false" (pageChanged)="pageChanged($event)"></pagination>
</div>
<ng-template #template>
    <div class="purchase-order-bulk-update">
        <div class="modal-header">
            <h4 class="modal-title pull-left">Bulk Update</h4>
            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="form">
                <div class="d-flex flex-column">
                    <p class="mb-3">Choose a field from the dropdown and update with new information.</p>
                    <div class="d-flex justify-content-between mb-3 modal-form">
                        <sh-select class="mr-15"></sh-select>
                        <div class="select-date">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Select date">
                                <span class="input-group-addon">
                                    <span class="icon-calender"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <p class="mb-3">Note: All the selected Purchase Orders will be updated with new information and you
                        cannot undo this.</p>
                    <div class="btn-group">
                        <button class="btn btn-success">Update</button>
                        <button class="btn btn-cancel">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #purchaseAdvanceSearch>
    <purchase-advance-search [purchaseOrderPostRequest]="purchaseOrderPostRequest"
        (closeModelEvent)="advanceSearchCallback($event)"></purchase-advance-search>
</ng-template>
<ng-template #datepickerTemplate>
    <div class="datepicker-modal">
        <div class="modal-body">
            <app-datepicker-wrapper [inputStartDate]="selectedDateRange?.startDate"
                [inputEndDate]="selectedDateRange?.endDate" [alwaysShowCalendars]="true"
                [ranges]="datePickerOptions.ranges" [selectedRangeLabel]="selectedRangeLabel"
                [showCustomRangeLabel]="true" [showClearButton]="false" [showCancel]="true" [linkedCalendars]="true"
                [showDropdowns]="true" [locale]="{applyLabel: 'Done'}" (rangeClicked)="dateSelectedCallback($event)"
                (datesUpdated)="dateSelectedCallback($event)" [keepCalendarOpeningWithRange]="false"
                [showRangeLabelOnInput]="false" [dateFieldPosition]="dateFieldPosition"></app-datepicker-wrapper>
        </div>
    </div>
</ng-template>
<ng-template #sortTemplate let-column="column">
    <div class="icon-sort-asc" *ngIf="purchaseOrderGetRequest.sortBy !== column"
        (click)="sortPurchaseOrders('asc', column)"
        [ngClass]="{'activeTextColor': purchaseOrderGetRequest.sortBy === column && purchaseOrderGetRequest.sort === 'asc'}">
    </div>
    <div class="icon-sort-asc"
        *ngIf="purchaseOrderGetRequest.sortBy === column && purchaseOrderGetRequest.sort === 'asc'"
        (click)="sortPurchaseOrders('desc', column)"
        [ngClass]="{'activeTextColor': purchaseOrderGetRequest.sortBy === column && purchaseOrderGetRequest.sort === 'asc'}">
    </div>
    <div class="icon-sort-dsc"
        *ngIf="purchaseOrderGetRequest.sortBy === column && purchaseOrderGetRequest.sort === 'desc'"
        (click)="sortPurchaseOrders('asc', column)"
        [ngClass]="{'activeTextColor': purchaseOrderGetRequest.sortBy === column && purchaseOrderGetRequest.sort === 'desc'}">
    </div>
</ng-template>
