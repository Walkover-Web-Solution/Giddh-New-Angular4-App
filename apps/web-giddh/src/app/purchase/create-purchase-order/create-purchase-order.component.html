<ng-container
    appTranslate
    [file]="'purchase-order'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
    (translationComplete)="translationComplete($event)"
>
    <hamburger-menu *ngIf="!isUpdateMode" [pageHeading]="localeData?.new_po"></hamburger-menu>
    <hamburger-menu *ngIf="isUpdateMode" [pageHeading]="localeData?.edit_po"></hamburger-menu>
    <giddh-page-loader *ngIf="showLoader"></giddh-page-loader>

    <form
        #poForm="ngForm"
        novalidate
        autocomplete="off"
        [ngClass]="{
            'create-purchase-order-form': true,
            'customer-purchase-order': !purchaseOrder.voucherDetails.customerName,
            'for-multi-currency': isMulticurrencyAccount
        }"
        [ngStyle]="{ 'display': !showLoader ? 'block' : 'none' }"
    >
        <div class="clearfix" [keyboardShortcut]="'alt+c'" (onShortcutPress)="addAccountFromShortcut()">
            <div class="clearfix wrapper-customer-table pd-t2">
                <div class="customer-purchase-table">
                    <div class="inner-container">
                        <div class="inner-container">
                            <!-- region customer section -->
                            <div class="clearfix">
                                <div class="row mr-b1">
                                    <!-- region customer name -->
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                        <label
                                            >{{ commonLocaleData?.app_vendor_name
                                            }}<span class="red-text">*</span></label
                                        >
                                    </div>
                                    <!-- region vendor dropdown -->
                                    <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                                        <div class="clearfix d-flex flex-column">
                                            <div class="d-flex flex-column">
                                                <sales-sh-select
                                                    #vendorNameDropDown
                                                    name="vendor"
                                                    class="select-customer-field"
                                                    [options]="vendorAcList$ | async"
                                                    [(ngModel)]="purchaseOrder.account.uniqueName"
                                                    [customFilter]="customMoveGroupFilter"
                                                    (selected)="onSelectVendor($event)"
                                                    [placeholder]="localeData?.select_vendor"
                                                    [notFoundLink]="true"
                                                    [doNotReset]="true"
                                                    [isPaginationEnabled]="true"
                                                    (scrollEnd)="handleScrollEnd('vendor')"
                                                    (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'vendor')"
                                                    [notFoundMsg]="noResultsFoundLabel"
                                                    [enableDynamicSearch]="true"
                                                    [fixedValue]="purchaseOrder.account.name"
                                                    [forceClearReactive]="forceClear$ | async"
                                                    [isFilterEnabled]="true"
                                                    (noResultsClicked)="addNewAccount()"
                                                    [multiple]="false"
                                                    [ItemHeight]="67"
                                                    [notFoundLinkText]="localeData?.add_vendor"
                                                    (keyup)="resetVendor($event)"
                                                    (onClear)="resetVendor(null)"
                                                    [isOpen]="!isUpdateMode && !purchaseOrder.account.uniqueName"
                                                >
                                                    <ng-template #optionTemplate let-option="option">
                                                        <a
                                                            href="javascript:void(0)"
                                                            class="list-item flex-column border-none"
                                                        >
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item-unique">{{ option.value }}</div>
                                                        </a>
                                                    </ng-template>

                                                    <ng-template #notFoundLinkTemplate>
                                                        <a
                                                            href="javascript:void(0)"
                                                            class="
                                                                list-item
                                                                pd-l05 pd-r05
                                                                d-flex
                                                                justify-content-between
                                                                w-100
                                                                border-none
                                                            "
                                                            [keyboardShortcut]="'alt+c'"
                                                        >
                                                            <div class="item">{{ vendorNotFoundText }}</div>
                                                            <div class="item">{{ commonLocaleData?.app_alt_c }}</div>
                                                        </a>
                                                    </ng-template>
                                                </sales-sh-select>
                                                <!-- region Unregistered Business / vendor details -->
                                                <div
                                                    class="d-flex aqua-color"
                                                    *ngIf="purchaseOrder.voucherDetails.customerName"
                                                >
                                                    <span class="cp aqua-color" *ngIf="!isUpdateMode">
                                                        <a href="javascript:void(0)" (click)="getVendorDetails()">{{
                                                            localeData?.vendor_details
                                                        }}</a>
                                                    </span>
                                                </div>
                                                <!-- endregion -->
                                                <div *ngIf="purchaseOrders && purchaseOrders.length > 0">
                                                    <p>
                                                        <small>{{ localeData?.pending_po }}</small>
                                                    </p>
                                                    <p class="font-14">
                                                        <a
                                                            href="javascript:;"
                                                            (click)="
                                                                openPurchaseOrderPreviewPopup(
                                                                    purchaseOrderPreviewModal,
                                                                    order.uniqueName,
                                                                    order.accountUniqueName
                                                                )
                                                            "
                                                            *ngFor="let order of purchaseOrders; let i = index"
                                                            >{{ order.number
                                                            }}<span *ngIf="checkIfPipeSymbolRequired(i)"
                                                                >&nbsp;|&nbsp;</span
                                                            ></a
                                                        >
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- endregion -->
                                </div>
                                <div class="row mr-b1 delivery-from-field">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                        <label>{{ localeData?.deliver_from }}<span class="red-text">*</span></label>
                                    </div>
                                    <!-- region vendor dropdown -->
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 select-customer-name">
                                        <section class="form-inline">
                                            <div class="wrap-billing-address w-100 clearfix">
                                                <div class="row">
                                                    <!-- region billing address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group">
                                                            <div class="d-flex align-items-center pb-1">
                                                                <span class="pd-r15">{{
                                                                    localeData?.billing_address
                                                                }}</span>
                                                                <span>
                                                                    <div
                                                                        class="btn-group btn-block"
                                                                        dropdown
                                                                        #billingAddressDropDownWeb="bs-dropdown"
                                                                        [attachOutsideOnClick]="true"
                                                                        (clickOutside)="
                                                                            billingAddressDropDownWeb.hide()
                                                                        "
                                                                        *ngIf="accountAddressList?.length > 1"
                                                                    >
                                                                        <a
                                                                            dropdownToggle
                                                                            type="button"
                                                                            class="dropdown-toggle"
                                                                            >{{ localeData?.change }}</a
                                                                        >
                                                                        <ul
                                                                            *dropdownMenu
                                                                            class="
                                                                                dropdown-menu
                                                                                change-address-dropdown
                                                                                dropdown-menu-right
                                                                            "
                                                                            role="menu"
                                                                        >
                                                                            <li
                                                                                role="menuitem"
                                                                                *ngFor="
                                                                                    let address of accountAddressList
                                                                                "
                                                                            >
                                                                                <a
                                                                                    class="dropdown-item"
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            purchaseOrder.account
                                                                                                .billingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    {{ address.address }}
                                                                                    {{ address.state?.name }}
                                                                                    <span class="d-block"
                                                                                        >{{
                                                                                            address.gstNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.gstNumber
                                                                                                : ""
                                                                                        }}
                                                                                    </span>
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </span>
                                                            </div>
                                                            <div class="billing-address clearfix">
                                                                <textarea
                                                                    name="vendorBillingDetailsAddress"
                                                                    (keyup)="autoFillShippingDetails('vendor')"
                                                                    [(ngModel)]="
                                                                        purchaseOrder.account.billingDetails.address[0]
                                                                    "
                                                                    class="form-control"
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                    autofocus="off"
                                                                    aria-autocomplete="none"
                                                                ></textarea>

                                                                <div class="row">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <label class="sales-country-label">
                                                                            {{ vendorCountry }}
                                                                        </label>
                                                                    </div>

                                                                    <div class="col-sm-12 col-md-6" #vendorBillingState>
                                                                        <sales-sh-select
                                                                            [placeholder]="commonLocaleData?.app_state"
                                                                            class="select-border-bottom"
                                                                            (selected)="
                                                                                fillShippingBillingDetails(
                                                                                    $event,
                                                                                    true,
                                                                                    'vendor'
                                                                                );
                                                                                autoFillShippingDetails('vendor')
                                                                            "
                                                                            #vendorStatesBilling
                                                                            [showBottomBorderOnly]="true"
                                                                            [options]="statesSource"
                                                                            name="vendorBillingDetailsStateCode"
                                                                            [(ngModel)]="
                                                                                purchaseOrder.account.billingDetails
                                                                                    .state.code
                                                                            "
                                                                        >
                                                                        </sales-sh-select>
                                                                    </div>

                                                                    <div
                                                                        class="col-sm-12 col-md-6"
                                                                        *ngIf="
                                                                            shouldShowTrnGstField &&
                                                                            (showGSTINNo || showTRNNo)
                                                                        "
                                                                    >
                                                                        <input
                                                                            maxLength="15"
                                                                            autocomplete="None"
                                                                            type="text"
                                                                            name="vendorBillingDetailsTax"
                                                                            [(ngModel)]="
                                                                                purchaseOrder.account.billingDetails
                                                                                    .gstNumber
                                                                            "
                                                                            class="form-control input-custom"
                                                                            (blur)="autoFillShippingDetails('vendor')"
                                                                            (change)="
                                                                                getStateCode('billingDetails', 'vendor')
                                                                            "
                                                                            [placeholder]="
                                                                                showGSTINNo
                                                                                    ? commonLocaleData?.app_gstin
                                                                                    : commonLocaleData?.app_trn
                                                                            "
                                                                        />
                                                                    </div>
                                                                    <!-- static pin code  -->
                                                                    <div
                                                                        [ngClass]="{
                                                                            'col-sm-12 col-md-6':
                                                                                showGSTINNo || showTRNNo,
                                                                            'col-sm-12 col-md-12': !(
                                                                                showGSTINNo || showTRNNo
                                                                            )
                                                                        }"
                                                                    >
                                                                        <div class="form-group mr-b05">
                                                                            <input
                                                                                type="number"
                                                                                class="form-control input-custom"
                                                                                autocomplete="false"
                                                                                name="accountBillingPinCode"
                                                                                (blur)="
                                                                                    autoFillShippingDetails('vendor')
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_pin_code
                                                                                "
                                                                                [(ngModel)]="
                                                                                    purchaseOrder.account.billingDetails
                                                                                        .pincode
                                                                                "
                                                                                decimalDigitsDirective
                                                                                [preventDecimal]="true"
                                                                            />
                                                                        </div>
                                                                    </div>
                                                                    <!-- static pin code end-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->

                                                    <!-- region shipping address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group p-0 width-100">
                                                            <div class="d-flex align-items-center pb-1">
                                                                <span class="pd-r15">
                                                                    <input
                                                                        type="checkbox"
                                                                        autocomplete="None"
                                                                        name="autoFillVendorShipping"
                                                                        [(ngModel)]="autoFillVendorShipping"
                                                                        (change)="autoFillShippingDetails('vendor')"
                                                                    />
                                                                    {{ localeData?.shipping_billing_same }}
                                                                </span>
                                                                <span>
                                                                    <div
                                                                        class="btn-group btn-block"
                                                                        dropdown
                                                                        #shippingAddressDropDownWeb="bs-dropdown"
                                                                        [attachOutsideOnClick]="true"
                                                                        (clickOutside)="
                                                                            shippingAddressDropDownWeb.hide()
                                                                        "
                                                                        *ngIf="
                                                                            accountAddressList?.length > 1 &&
                                                                            !autoFillVendorShipping
                                                                        "
                                                                    >
                                                                        <a
                                                                            dropdownToggle
                                                                            type="button"
                                                                            class="dropdown-toggle"
                                                                            >{{ localeData?.change }}</a
                                                                        >
                                                                        <ul
                                                                            *dropdownMenu
                                                                            class="
                                                                                dropdown-menu
                                                                                change-address-dropdown
                                                                                dropdown-menu-right
                                                                            "
                                                                            role="menu"
                                                                        >
                                                                            <li
                                                                                role="menuitem"
                                                                                *ngFor="
                                                                                    let address of accountAddressList
                                                                                "
                                                                            >
                                                                                <a
                                                                                    class="dropdown-item"
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            purchaseOrder.account
                                                                                                .shippingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    {{ address.address }}
                                                                                    {{ address.state?.name }}
                                                                                    {{
                                                                                        address.gstNumber
                                                                                            ? (showGSTINNo
                                                                                                  ? commonLocaleData?.app_gstin +
                                                                                                    ": "
                                                                                                  : commonLocaleData?.app_trn +
                                                                                                    ": ") +
                                                                                              address.gstNumber
                                                                                            : ""
                                                                                    }}
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </span>
                                                            </div>
                                                            <div
                                                                [ngClass]="{
                                                                    'billing-address': true,
                                                                    'disabled': autoFillVendorShipping
                                                                }"
                                                            >
                                                                <textarea
                                                                    name="vendorShippingDetailsAddress"
                                                                    [(ngModel)]="
                                                                        purchaseOrder.account.shippingDetails.address[0]
                                                                    "
                                                                    class="form-control"
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                    autofocus="off"
                                                                    aria-autocomplete="none"
                                                                ></textarea>
                                                                <div class="clearfix">
                                                                    <div class="form-group row">
                                                                        <div class="col-sm-12 col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="sales-country-label">
                                                                                    {{ vendorCountry }}
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div
                                                                            class="
                                                                                col-sm-12 col-md-6
                                                                                select-border-bottom
                                                                            "
                                                                            #vendorShippingState
                                                                        >
                                                                            <sales-sh-select
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_state
                                                                                "
                                                                                [disabled]="autoFillVendorShipping"
                                                                                class="select-border-bottom"
                                                                                (selected)="
                                                                                    fillShippingBillingDetails(
                                                                                        $event,
                                                                                        false,
                                                                                        'vendor'
                                                                                    )
                                                                                "
                                                                                #vendorStatesShipping
                                                                                [showBottomBorderOnly]="true"
                                                                                [options]="statesSource"
                                                                                name="vendorShippingDetailsStateCode"
                                                                                [(ngModel)]="
                                                                                    purchaseOrder.account
                                                                                        .shippingDetails.state.code
                                                                                "
                                                                            >
                                                                            </sales-sh-select>
                                                                        </div>
                                                                        <div
                                                                            class="col-sm-12 col-md-6"
                                                                            *ngIf="
                                                                                shouldShowTrnGstField &&
                                                                                (showGSTINNo || showTRNNo)
                                                                            "
                                                                        >
                                                                            <input
                                                                                maxLength="15"
                                                                                autocomplete="None"
                                                                                type="text"
                                                                                name="vendorShippingDetailsTax"
                                                                                [(ngModel)]="
                                                                                    purchaseOrder.account
                                                                                        .shippingDetails.gstNumber
                                                                                "
                                                                                class="form-control input-custom"
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'shippingDetails',
                                                                                        'vendor'
                                                                                    )
                                                                                "
                                                                                [placeholder]="
                                                                                    showGSTINNo
                                                                                        ? commonLocaleData?.app_gstin
                                                                                        : commonLocaleData?.app_trn
                                                                                "
                                                                            />
                                                                        </div>
                                                                        <!-- static pin code  -->
                                                                        <div
                                                                            [ngClass]="{
                                                                                'col-sm-12 col-md-6':
                                                                                    showGSTINNo || showTRNNo,
                                                                                'col-sm-12 col-md-12': !(
                                                                                    showGSTINNo || showTRNNo
                                                                                )
                                                                            }"
                                                                        >
                                                                            <div class="form-group mr-b05">
                                                                                <input
                                                                                    type="number"
                                                                                    class="form-control input-custom"
                                                                                    autocomplete="false"
                                                                                    name="accountShippingPinCode"
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_pin_code
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        purchaseOrder.account
                                                                                            .shippingDetails.pincode
                                                                                    "
                                                                                    decimalDigitsDirective
                                                                                    [preventDecimal]="true"
                                                                                />
                                                                            </div>
                                                                        </div>
                                                                        <!-- static pin code end-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                    <!-- endregion -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="customer-purchase-table bg-white pd-b2 pd-t2">
                    <div class="inner-container">
                        <div class="row mr-b1" *ngIf="shouldShowWarehouse && warehouses && warehouses.length > 1">
                            <!-- region customer name -->
                            <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                <label>{{ commonLocaleData?.app_warehouse }}<span class="red-text">*</span></label>
                            </div>
                            <!-- region customer dropdown -->
                            <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                                <div class="clearfix d-flex flex-column">
                                    <div class="d-flex flex-column">
                                        <!-- region if not cashinvoice show customer dropdown -->
                                        <sh-select
                                            class="multi-select"
                                            name="warehouse"
                                            [placeholder]="localeData?.select_warehouse"
                                            [(ngModel)]="purchaseOrder.warehouse.uniqueName"
                                            [options]="warehouses"
                                            (selected)="onSelectWarehouse($event)"
                                        ></sh-select>
                                        <!-- endregion -->
                                    </div>
                                </div>
                            </div>
                            <!-- endregion -->
                        </div>
                        <div class="row mr-b1">
                            <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                <label>{{ localeData?.deliver_to }}<span class="red-text">*</span></label>
                            </div>
                            <!-- region customer dropdown -->
                            <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                                <section class="form-inline">
                                    <div class="wrap-billing-address w-100 clearfix">
                                        <div class="row">
                                            <!-- region billing address -->
                                            <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                <div class="form-group">
                                                    <div class="d-flex align-items-center pb-1">
                                                        <span class="pd-r15">{{ localeData?.billing_address }}</span>
                                                        <span>
                                                            <div
                                                                class="btn-group btn-block"
                                                                container="body"
                                                                dropdown
                                                                #companyBillingAddressDropDownWeb="bs-dropdown"
                                                                [attachOutsideOnClick]="true"
                                                                (clickOutside)="companyBillingAddressDropDownWeb.hide()"
                                                                *ngIf="companyAddressList?.length > 1"
                                                            >
                                                                <a
                                                                    dropdownToggle
                                                                    type="button"
                                                                    class="dropdown-toggle"
                                                                    >{{ localeData?.change }}</a
                                                                >
                                                                <ul
                                                                    *dropdownMenu
                                                                    class="
                                                                        dropdown-menu dropdown-menu-right
                                                                        change-address-dropdown
                                                                    "
                                                                    role="menu"
                                                                >
                                                                    <li
                                                                        role="menuitem"
                                                                        *ngFor="let address of companyAddressList"
                                                                    >
                                                                        <a
                                                                            class="dropdown-item"
                                                                            (click)="
                                                                                selectAddress(
                                                                                    purchaseOrder.company
                                                                                        .billingDetails,
                                                                                    address,
                                                                                    true
                                                                                )
                                                                            "
                                                                        >
                                                                            {{ address.address }}
                                                                            {{ address.state?.name }}
                                                                            {{
                                                                                address.taxNumber
                                                                                    ? (showGSTINNo
                                                                                          ? commonLocaleData?.app_gstin +
                                                                                            ": "
                                                                                          : commonLocaleData?.app_trn +
                                                                                            ": ") + address.taxNumber
                                                                                    : ""
                                                                            }}
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </span>
                                                    </div>
                                                    <div class="billing-address clearfix">
                                                        <textarea
                                                            name="companyBillingDetailsAddress"
                                                            (keyup)="autoFillShippingDetails('company')"
                                                            [(ngModel)]="
                                                                purchaseOrder.company.billingDetails.address[0]
                                                            "
                                                            class="form-control"
                                                            rows="3"
                                                            autocomplete="off"
                                                            autofocus="off"
                                                            aria-autocomplete="none"
                                                        ></textarea>
                                                        <div class="row">
                                                            <div class="col-sm-12 col-md-6">
                                                                <label class="sales-country-label">
                                                                    {{ companyCountryName }}
                                                                </label>
                                                            </div>
                                                            <div class="col-sm-12 col-md-6" #companyBillingState>
                                                                <sales-sh-select
                                                                    [placeholder]="commonLocaleData?.app_state"
                                                                    class="select-border-bottom"
                                                                    (selected)="
                                                                        fillShippingBillingDetails(
                                                                            $event,
                                                                            true,
                                                                            'company'
                                                                        );
                                                                        autoFillShippingDetails('company')
                                                                    "
                                                                    [showBottomBorderOnly]="true"
                                                                    [options]="companyStatesSource"
                                                                    name="companyBillingDetailsStateCode"
                                                                    [disabled]="
                                                                        purchaseOrder.company.billingDetails.state
                                                                            .code &&
                                                                        purchaseOrder.company.billingDetails
                                                                            .gstNumber &&
                                                                        purchaseOrder.company.billingDetails.gstNumber
                                                                            .length >= 2
                                                                            ? true
                                                                            : null
                                                                    "
                                                                    [fixedValue]="
                                                                        purchaseOrder.company.billingDetails.state.name
                                                                    "
                                                                    [(ngModel)]="
                                                                        purchaseOrder.company.billingDetails.state.code
                                                                    "
                                                                >
                                                                </sales-sh-select>
                                                            </div>
                                                            <div
                                                                class="col-sm-12 col-md-6"
                                                                *ngIf="
                                                                    shouldShowTrnGstField && (showGSTINNo || showTRNNo)
                                                                "
                                                            >
                                                                <input
                                                                    maxlength="15"
                                                                    autocomplete="None"
                                                                    type="text"
                                                                    name="companyBillingDetailsTax"
                                                                    [(ngModel)]="
                                                                        purchaseOrder.company.billingDetails.gstNumber
                                                                    "
                                                                    class="form-control input-custom"
                                                                    (blur)="autoFillShippingDetails('company')"
                                                                    (change)="getStateCode('billingDetails', 'company')"
                                                                    [placeholder]="
                                                                        showGSTINNo
                                                                            ? commonLocaleData?.app_gstin
                                                                            : commonLocaleData?.app_trn
                                                                    "
                                                                />
                                                            </div>
                                                            <!-- static pin code  -->
                                                            <div
                                                                [ngClass]="{
                                                                    'col-sm-12 col-md-6': showGSTINNo || showTRNNo,
                                                                    'col-sm-12 col-md-12': !(showGSTINNo || showTRNNo)
                                                                }"
                                                            >
                                                                <div class="form-group mr-b05">
                                                                    <input
                                                                        type="number"
                                                                        class="form-control input-custom"
                                                                        autocomplete="false"
                                                                        name="companyBillingPinCode"
                                                                        (blur)="autoFillShippingDetails('company')"
                                                                        [placeholder]="commonLocaleData?.app_pin_code"
                                                                        [(ngModel)]="
                                                                            purchaseOrder.company.billingDetails.pincode
                                                                        "
                                                                        decimalDigitsDirective
                                                                        [preventDecimal]="true"
                                                                    />
                                                                </div>
                                                            </div>
                                                            <!-- static pin code end-->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- endregion -->

                                            <!-- region shipping address -->
                                            <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                <div class="form-group p-0 width-100">
                                                    <div class="d-flex align-items-center pb-1">
                                                        <span class="pd-r15">
                                                            <input
                                                                type="checkbox"
                                                                autocomplete="None"
                                                                name="autoFillCompanyShipping"
                                                                [(ngModel)]="autoFillCompanyShipping"
                                                                (change)="autoFillShippingDetails('company')"
                                                            />
                                                            {{ localeData?.shipping_billing_same }}
                                                        </span>
                                                    </div>
                                                    <div
                                                        [ngClass]="{
                                                            'billing-address': true,
                                                            'disabled': autoFillCompanyShipping
                                                        }"
                                                    >
                                                        <textarea
                                                            name="companyShippingDetailsAddress"
                                                            [(ngModel)]="
                                                                purchaseOrder.company.shippingDetails.address[0]
                                                            "
                                                            class="form-control"
                                                            rows="3"
                                                            autocomplete="off"
                                                            autofocus="off"
                                                            aria-autocomplete="none"
                                                        ></textarea>
                                                        <div class="clearfix">
                                                            <div class="form-group row">
                                                                <div class="col-sm-12 col-md-6">
                                                                    <div class="form-group">
                                                                        <label class="sales-country-label">
                                                                            {{ companyCountryName }}
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-12 col-md-6" #companyShippingState>
                                                                    <sales-sh-select
                                                                        [placeholder]="commonLocaleData?.app_state"
                                                                        [disabled]="autoFillCompanyShipping"
                                                                        class="select-border-bottom disabled"
                                                                        (selected)="
                                                                            fillShippingBillingDetails(
                                                                                $event,
                                                                                false,
                                                                                'company'
                                                                            )
                                                                        "
                                                                        [showBottomBorderOnly]="true"
                                                                        [options]="companyStatesSource"
                                                                        name="companyShippingDetailsStateCode"
                                                                        [disabled]="
                                                                            purchaseOrder.company.shippingDetails.state
                                                                                .code &&
                                                                            purchaseOrder.company.shippingDetails
                                                                                .gstNumber &&
                                                                            purchaseOrder.company.shippingDetails
                                                                                .gstNumber.length >= 2
                                                                                ? true
                                                                                : null
                                                                        "
                                                                        [fixedValue]="
                                                                            purchaseOrder.company.shippingDetails.state
                                                                                .name
                                                                        "
                                                                        [(ngModel)]="
                                                                            purchaseOrder.company.shippingDetails.state
                                                                                .code
                                                                        "
                                                                    >
                                                                    </sales-sh-select>
                                                                </div>
                                                                <div
                                                                    class="col-sm-12 col-md-6"
                                                                    *ngIf="
                                                                        shouldShowTrnGstField &&
                                                                        (showGSTINNo || showTRNNo)
                                                                    "
                                                                >
                                                                    <input
                                                                        maxLength="15"
                                                                        autocomplete="None"
                                                                        type="text"
                                                                        name="companyShippingDetailsTax"
                                                                        [(ngModel)]="
                                                                            purchaseOrder.company.shippingDetails
                                                                                .gstNumber
                                                                        "
                                                                        class="form-control input-custom"
                                                                        (change)="
                                                                            getStateCode('shippingDetails', 'company')
                                                                        "
                                                                        [placeholder]="
                                                                            showGSTINNo
                                                                                ? commonLocaleData?.app_gstin
                                                                                : commonLocaleData?.app_trn
                                                                        "
                                                                    />
                                                                </div>
                                                                <!-- static pin code  -->
                                                                <div
                                                                    [ngClass]="{
                                                                        'col-sm-12 col-md-6': showGSTINNo || showTRNNo,
                                                                        'col-sm-12 col-md-12': !(
                                                                            showGSTINNo || showTRNNo
                                                                        )
                                                                    }"
                                                                >
                                                                    <div class="form-group mr-b05">
                                                                        <input
                                                                            type="number"
                                                                            class="form-control input-custom"
                                                                            autocomplete="false"
                                                                            name="companyShippingPinCode"
                                                                            [placeholder]="
                                                                                commonLocaleData?.app_pin_code
                                                                            "
                                                                            [(ngModel)]="
                                                                                purchaseOrder.company.shippingDetails
                                                                                    .pincode
                                                                            "
                                                                            decimalDigitsDirective
                                                                            [preventDecimal]="true"
                                                                        />
                                                                    </div>
                                                                </div>
                                                                <!-- static pin code end-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- endregion -->
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <!-- endregion -->
                        </div>
                        <div class="row mb-5 height-row">
                            <!-- region customer name -->
                            <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                <div>
                                    <label>{{ localeData?.order_no }}</label>
                                </div>
                            </div>
                            <!-- region customer dropdown -->
                            <div
                                class="
                                    select-customer-name
                                    order-expected-delivery
                                    d-flex
                                    col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12
                                "
                            >
                                <!-- region if not cashinvoice show customer dropdown -->

                                <div class="col-sm-12 col-md-12 col-lg-6 pl-0">
                                    <div>
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="purchaseOrderNumber"
                                            [(ngModel)]="purchaseOrder.number"
                                            [disabled]="
                                                !invoiceSettings?.purchaseBillSettings?.useCustomPONumber ||
                                                isUpdateMode
                                            "
                                            [placeholder]="localeData?.order_no_placeholder"
                                        />
                                    </div>
                                </div>
                                <!-- endregion -->
                                <div class="col-sm-6" *ngIf="!isMobileScreen">
                                    <div class="invoice-due-date">
                                        <div class="d-flex">
                                            <label>{{ localeData?.order_date }}<span class="red-text">*</span></label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                [placeholder]="localeData?.select_date"
                                                [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                name="purchaseOrderDate"
                                                [(ngModel)]="purchaseOrder.voucherDetails.voucherDate"
                                                bsDatepicker
                                                (ngModelChange)="onUpdateOrderDate()"
                                            />
                                        </div>
                                        <div class="d-flex">
                                            <label>{{ localeData?.expected_delivery }}</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                [placeholder]="localeData?.select_date"
                                                [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                name="purchaseDueDate"
                                                [(ngModel)]="purchaseOrder.voucherDetails.dueDate"
                                                bsDatepicker
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- endregion -->
                        </div>
                        <div class="row mt-1" *ngIf="isMobileScreen">
                            <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                <label>{{ localeData?.order_date }}</label>
                            </div>
                            <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                <div class="row">
                                    <div class="col-md-10">
                                        <input
                                            type="text"
                                            class="form-control"
                                            [placeholder]="localeData?.select_date"
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            name="purchaseOrderDate"
                                            [(ngModel)]="purchaseOrder.voucherDetails.voucherDate"
                                            bsDatepicker
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-1" *ngIf="isMobileScreen">
                            <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                <label>{{ localeData?.expected_delivery }}</label>
                            </div>
                            <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                <div class="row">
                                    <div class="col-md-10">
                                        <input
                                            type="text"
                                            class="form-control"
                                            [placeholder]="localeData?.select_date"
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            name="purchaseDueDate"
                                            [(ngModel)]="purchaseOrder.voucherDetails.dueDate"
                                            bsDatepicker
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <ng-container *ngIf="!purchaseOrder.account.uniqueName">
            <img src="assets/images/new/search-vendor.svg" class="img-responsive search-arrow-image" />
        </ng-container>
        <section
            *ngIf="!isMobileScreen"
            class="static-purchase-table create-purchase-order-table clearfix mb-2 bg-white container-fluid"
        >
            <div class="switch-currency" *ngIf="isMulticurrencyAccount && !showSwitchedCurr">
                <span class="left-currency">{{ commonLocaleData?.app_numbers?.one }} {{ customerCurrencyCode }}</span>
                <img
                    class="switch-icon"
                    src="assets/images/switch-icon.svg"
                    alt="switch-icon"
                    (click)="switchCurrencyImg(true)"
                />
                <span class="right-currency">
                    <span class="currency-digits" *ngIf="!showCurrencyValue">
                        <amount-field [amount]="originalExchangeRate"></amount-field>
                    </span>
                    <input
                        type="number"
                        name="exchangeRate"
                        [(ngModel)]="newExchangeRate"
                        *ngIf="showCurrencyValue"
                        class="form-control edit-currency"
                    />
                    {{ companyCurrency }}
                </span>

                <span class="edit-icon cp">
                    <img
                        src="assets/images/edit-pencilicon.svg"
                        class="edit-pencil"
                        *ngIf="!autoSaveIcon"
                        (click)="
                            showCurrencyValue = !showCurrencyValue;
                            autoSaveIcon = !autoSaveIcon;
                            newExchangeRate = originalExchangeRate
                        "
                    />
                    <img
                        src="assets/images/autosave.svg"
                        class="edit-pencil"
                        (click)="
                            exchangeRate = newExchangeRate;
                            originalExchangeRate = exchangeRate;
                            previousExchangeRate = exchangeRate;
                            autoSaveIcon = !autoSaveIcon;
                            showCurrencyValue = !showCurrencyValue;
                            updateStockEntries();
                            calculateGrandTotal()
                        "
                        *ngIf="autoSaveIcon"
                    />
                </span>
            </div>
            <div class="switch-currency" *ngIf="isMulticurrencyAccount && showSwitchedCurr">
                <span class="left-currency">{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrency }}</span>
                <img
                    class="switch-icon"
                    src="assets/images/switch-icon.svg"
                    alt="switch-icon"
                    (click)="switchCurrencyImg(false)"
                />
                <span class="right-currency">
                    <span class="currency-digits" *ngIf="!showCurrencyValue">
                        <amount-field [amount]="originalReverseExchangeRate"></amount-field>
                    </span>
                    <input
                        type="number"
                        name="exchangeRate"
                        [(ngModel)]="reverseExchangeRate"
                        *ngIf="showCurrencyValue"
                        class="form-control edit-currency"
                    />
                    {{ customerCurrencyCode }}
                </span>

                <span class="edit-icon cp">
                    <img
                        *ngIf="!autoSaveIcon"
                        src="assets/images/edit-pencilicon.svg"
                        class="edit-pencil"
                        (click)="saveCancelExcRate(false)"
                    />
                    <img
                        src="assets/images/autosave.svg"
                        class="edit-pencil"
                        (click)="saveCancelExcRate(true)"
                        *ngIf="autoSaveIcon"
                    />
                </span>
            </div>
            <table class="table table-custom-invoice basic">
                <thead>
                    <tr>
                        <th
                            *ngFor="let item of theadArrReadOnly"
                            [hidden]="!item.display"
                            class="thead-sales-invoice"
                            [ngClass]="item.label"
                        >
                            {{ item.label }}
                            <span *ngIf="item.label === 'Tax' && isRcmEntry"
                                >({{ commonLocaleData?.app_rcm }})<sup class="mandatory-asterisk">*</sup></span
                            >
                        </th>
                    </tr>
                </thead>
                <tbody [hidden]="showBulkLoader" (clickOutside)="handleOutsideClick()" [exclude]="'.entries-tr'">
                    <ng-container #itemsContainer></ng-container>
                </tbody>
                <tbody *ngIf="showBulkLoader">
                    <tr>
                        <td colspan="8">
                            <giddh-page-loader></giddh-page-loader>
                        </td>
                    </tr>
                </tbody>
                <ng-template #entry let-entry let-entryIdx="entryIdx" let-transaction="transaction">
                    <!-- <ng-container *ngFor="let transaction of entry.transactions;"> -->
                    <tr
                        (click)="setActiveIndex(entryIdx); $event.stopPropagation()"
                        *ngIf="activeIndex !== entryIdx"
                        class="entries-tr set-active"
                        [ngClass]="{ 'is-other-tax': entry.isOtherTaxApplicable && isMulticurrencyAccount }"
                    >
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="product-name">
                                <label *ngIf="!transaction.accountName" class="select-account-label">{{
                                    localeData?.select_account
                                }}</label>
                                {{ transaction.accountName }}
                                <span *ngIf="transaction.stockDetails?.uniqueName"
                                    >({{ transaction.stockDetails?.name }})</span
                                >
                            </div>
                            <div class="description">
                                {{ transaction.description }}
                            </div>
                            <p class="small text-muted sku-and-custom-fields" *ngIf="transaction.sku_and_customfields">
                                {{ transaction.sku_and_customfields }}
                            </p>
                            <div class="date-hsn-code">
                                <div>
                                    <div class="col-xs-12" *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                        <div class="hsn-code">
                                            <label
                                                >{{
                                                    transaction.showCodeType === "hsn"
                                                        ? commonLocaleData?.app_hsn
                                                        : commonLocaleData?.app_sac
                                                }}:</label
                                            >
                                            <span class="d-flex justify-content-end">
                                                {{
                                                    transaction.showCodeType === "hsn"
                                                        ? transaction.hsnNumber
                                                        : transaction.sacNumber
                                                }}
                                                <span class="edit-icon cp">
                                                    <img src="assets/images/edit-pencilicon.svg" />
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-right stock-unit">
                            <div class="wrap-td-data">{{ transaction.quantity }} {{ transaction.stockUnit }}</div>
                        </td>
                        <td class="text-right trans-rate item-rate">
                            <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                <div class="td-wrapper">
                                    <div>
                                        <div class="wrap-td-data">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="transaction.rate"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currency?.code
                                                            : false
                                                    "
                                                    [ratePrecision]="true"
                                                >
                                                </amount-field>
                                            </span>
                                            <br />
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="isMulticurrencyAccount" class="differ-currency">
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="
                                                transaction.rate * exchangeRate ? transaction.rate * exchangeRate : 0
                                            "
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                            [ratePrecision]="true"
                                        >
                                        </amount-field>
                                    </span>
                                </div>
                            </div>
                        </td>
                        <td class="text-right item-amount">
                            <div class="td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="transaction.amount"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                        <br />
                                    </div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                <span class="d-flex justify-content-end">
                                    <amount-field
                                        [amount]="transaction.convertedAmount || 0"
                                        [currencySymbol]="baseCurrencySymbol"
                                        [currencyCode]="companyCurrency"
                                    >
                                    </amount-field>
                                </span>
                            </div>
                        </td>
                        <td class="item-discount">
                            <div class="text-right td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="entry.discountSum"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                        <br />
                                    </div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                <span class="d-flex justify-content-end">
                                    <amount-field
                                        [amount]="entry.discountSum * exchangeRate"
                                        [currencySymbol]="baseCurrencySymbol"
                                        [currencyCode]="companyCurrency"
                                    >
                                    </amount-field>
                                </span>
                            </div>
                        </td>
                        <td
                            [class.error-box]="transaction.requiredTax"
                            class="text-right item-tax"
                            (focus)="transaction.requiredTax = false"
                        >
                            <div class="td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="entry.taxSum + entry.cessSum"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                        <br />
                                    </div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                <span class="d-flex justify-content-end">
                                    <amount-field
                                        [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                        [currencySymbol]="baseCurrencySymbol"
                                        [currencyCode]="companyCurrency"
                                    >
                                    </amount-field>
                                </span>
                            </div>
                        </td>
                        <td class="text-right item-tax delete-btn-absolute">
                            <div class="td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <span>
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="transaction.total"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </span>
                                        <span *ngIf="entry.isOtherTaxApplicable">
                                            {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="entry.otherTaxSum"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </span>
                                    </div>
                                    <br />
                                    <div
                                        class="tax-in-currency differ-currency"
                                        *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount"
                                    >
                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="entry.otherTaxSum * exchangeRate"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency"
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="transaction.convertedTotal"
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                        >
                                        </amount-field>
                                    </span>
                                </div>
                            </div>

                            <div
                                class="trash-icon-delete"
                                (click)="removeTransaction(entryIdx); $event.preventDefault(); $event.stopPropagation()"
                            >
                                <span class="cp">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </span>
                            </div>
                        </td>
                    </tr>

                    <!-- endregion -->

                    <!-- region dynamic entries-->
                    <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature)-->
                    <tr
                        *ngIf="activeIndex === entryIdx"
                        class="entries-tr default-active"
                        (click)="$event.stopPropagation()"
                    >
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="product-name">
                                <div class="ng-select-wrap">
                                    <sh-select
                                        [options]="salesAccounts$ | async"
                                        #selectAccount
                                        [(ngModel)]="transaction.fakeAccForSelect2"
                                        name="transaction.fakeAccForSelect2_{{ entryIdx }}"
                                        (selected)="onSelectSalesAccount($event, transaction, entry, false, entryIdx)"
                                        [placeholder]="localeData?.select_acc"
                                        [notFoundLink]="true"
                                        [isPaginationEnabled]="true"
                                        (scrollEnd)="handleScrollEnd('item')"
                                        (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'item')"
                                        (onHide)="noResultsFoundLabel = localeData?.search_acc"
                                        [notFoundMsg]="noResultsFoundLabel"
                                        [enableDynamicSearch]="true"
                                        [fixedValue]="
                                            transaction.stockDetails && transaction.stockDetails.name
                                                ? transaction.accountName + ' (' + transaction.stockDetails?.name + ')'
                                                : transaction.accountName
                                        "
                                        [forceClearReactive]="forceClear$ | async"
                                        [multiple]="false"
                                        (noResultsClicked)="onNoResultsClicked(entryIdx)"
                                        [ItemHeight]="67"
                                        (onClear)="onClearSalesAccount(transaction)"
                                        [useInBuiltFilterForFlattenAc]="true"
                                    >
                                        <ng-template #optionTemplate let-option="option">
                                            <ng-container *ngIf="!option.additional?.stock">
                                                <a href="javascript:void(0)" class="list-item flex-column">
                                                    <div class="item">{{ option.label }}</div>
                                                    <div class="item-unique">
                                                        {{ option.additional?.uniqueName }}
                                                    </div>
                                                </a>
                                            </ng-container>
                                            <ng-container *ngIf="option.additional?.stock">
                                                <a href="javascript:void(0)" class="list-item flex-column">
                                                    <div class="item">{{ option.label }}</div>
                                                    <div class="item-unique">
                                                        {{ option.additional?.uniqueName }}
                                                    </div>
                                                    <div class="item-stock">
                                                        {{ commonLocaleData?.app_stock }}:
                                                        {{ option.additional?.stock.uniqueName }}
                                                    </div>
                                                </a>
                                            </ng-container>
                                        </ng-template>
                                    </sh-select>
                                </div>
                            </div>

                            <div *ngIf="transaction.fakeAccForSelect2">
                                <div class="description mt-1">
                                    <textarea
                                        rows="3"
                                        type="text"
                                        [placeholder]="localeData?.add_description"
                                        name="transaction.description_{{ entryIdx }}"
                                        class="form-control"
                                        [(ngModel)]="transaction.description"
                                        [maxlength]="entryDescriptionLength"
                                        #description
                                    ></textarea>
                                    <p class="font-12">
                                        {{ commonLocaleData?.app_characters_left }}:
                                        {{ entryDescriptionLength - transaction.description?.length }}
                                    </p>
                                    <p
                                        class="small text-muted sku-and-custom-fields"
                                        *ngIf="transaction.sku_and_customfields"
                                    >
                                        {{ transaction.sku_and_customfields }}
                                    </p>
                                </div>

                                <!-- region entry date/ hsncode -->
                                <div class="date-hsn-code">
                                    <div>
                                        <div class="col-xs-12">
                                            <div class="wrap-hsn-box d-flex justify-content-end text-right">
                                                <div class="hsn-code" (click)="toggleHsnSacDropDown(transaction)">
                                                    <label
                                                        >{{
                                                            transaction.showCodeType === "hsn"
                                                                ? commonLocaleData?.app_hsn
                                                                : commonLocaleData?.app_sac
                                                        }}:</label
                                                    >
                                                    <span>
                                                        {{
                                                            inventorySettings?.manageInventory || !transaction.sacNumber
                                                                ? transaction.hsnNumber
                                                                : transaction.sacNumber
                                                        }}
                                                        <span
                                                            *ngIf="!transaction.hsnNumber && !transaction.sacNumber"
                                                            class="update-text"
                                                            >{{ commonLocaleData?.app_update }}
                                                        </span>
                                                        <span class="edit-icon cp">
                                                            <img src="assets/images/edit-pencilicon.svg" />
                                                        </span>
                                                    </span>
                                                </div>
                                                <div class="hsn-code-dropdown" *ngIf="hsnSacDropdownShow">
                                                    <div class="d-flex wrap-hsn-sac mb-2 mt-3">
                                                        <span>
                                                            <input
                                                                type="radio"
                                                                class="radio-custom radio-theme"
                                                                name="showCodeType{{ entryIdx }}"
                                                                id="hsnCodeType{{ entryIdx }}"
                                                                [(ngModel)]="transaction.showCodeType"
                                                                value="hsn"
                                                            />
                                                            <label
                                                                for="hsnCodeType{{ entryIdx }}"
                                                                class="radio-custom-label"
                                                                >{{ commonLocaleData?.app_hsn_code }}</label
                                                            >
                                                        </span>
                                                        <span>
                                                            <input
                                                                type="radio"
                                                                class="radio-custom radio-theme"
                                                                name="showCodeType{{ entryIdx }}"
                                                                id="sacCodeType{{ entryIdx }}"
                                                                [(ngModel)]="transaction.showCodeType"
                                                                value="sac"
                                                            />
                                                            <label
                                                                for="sacCodeType{{ entryIdx }}"
                                                                class="radio-custom-label"
                                                                >{{ commonLocaleData?.app_sac_code }}</label
                                                            >
                                                        </span>
                                                    </div>
                                                    <input
                                                        type="text"
                                                        maxLength="10"
                                                        decimalDigitsDirective
                                                        [placeholder]="localeData?.hsn_number"
                                                        name="transaction.hsnNumber_{{ entryIdx }}"
                                                        *ngIf="transaction.showCodeType === 'hsn'"
                                                        [(ngModel)]="transaction.hsnNumber"
                                                    />
                                                    <input
                                                        type="text"
                                                        maxLength="10"
                                                        decimalDigitsDirective
                                                        [placeholder]="localeData?.sac_number"
                                                        name="transaction.hsnNumber_{{ entryIdx }}"
                                                        *ngIf="transaction.showCodeType === 'sac'"
                                                        [(ngModel)]="transaction.sacNumber"
                                                    />

                                                    <div class="btn-group mt-2 pt-1 d-flex">
                                                        <button
                                                            class="btn btn-sm btn-success-green"
                                                            type="button"
                                                            (click)="hsnSacDropdownShow = !hsnSacDropdownShow"
                                                        >
                                                            {{ commonLocaleData?.app_save }}
                                                        </button>
                                                        <button
                                                            class="btn btn-sm btn-primary mr-0"
                                                            type="button"
                                                            (click)="hideHsnSacEditPopup(transaction)"
                                                        >
                                                            {{ commonLocaleData?.app_cancel }}
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- endregion -->
                            </div>
                        </td>

                        <td class="text-right stock-unit">
                            <input
                                type="text"
                                [disabled]="!transaction.isStockTxn"
                                (blur)="handleQuantityBlur(entry, transaction)"
                                [placeholder]="commonLocaleData?.app_quantity"
                                decimalDigitsDirective
                                name="transaction.quantity_{{ entryIdx }}"
                                class="form-control text-right"
                                [(ngModel)]="transaction.quantity"
                            />

                            <select
                                class="form-control"
                                [disabled]="!transaction.isStockTxn"
                                name="transaction.stockUnit_{{ entryIdx }}"
                                [(ngModel)]="transaction.stockUnit"
                                (ngModelChange)="onChangeUnit(transaction, $event); transaction.setAmount(entry)"
                            >
                                <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">
                                    {{ stock.text }}
                                </option>
                            </select>
                        </td>

                        <td class="text-right item-rate">
                            <div class="td-wrapper">
                                <div>
                                    <input
                                        type="text"
                                        [disabled]="!transaction.isStockTxn"
                                        (blur)="
                                            calculateStockEntryAmount(transaction);
                                            calculateWhenTrxAltered(entry, transaction)
                                        "
                                        [placeholder]="commonLocaleData?.app_rate"
                                        name="transaction.rate_{{ entryIdx }}"
                                        class="form-control transaction-rate text-right"
                                        [(ngModel)]="transaction.rate"
                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency"
                                        [mask]="inputMaskFormat"
                                        [customDecimalPlaces]="highPrecisionRate"
                                    />
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="
                                                transaction.rate * exchangeRate ? transaction.rate * exchangeRate : 0
                                            "
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                            [ratePrecision]="true"
                                        >
                                        </amount-field>
                                    </span>
                                </div>
                            </div>
                        </td>

                        <td class="text-right item-amount">
                            <div class="td-wrapper">
                                <div>
                                    <input
                                        type="text"
                                        (blur)="calculateWhenTrxAltered(entry, transaction, true)"
                                        (click)="transactionAmountClicked(transaction)"
                                        [placeholder]="commonLocaleData?.app_amount"
                                        name="transaction.amount_{{ entryIdx }}"
                                        class="form-control text-right"
                                        [(ngModel)]="transaction.amount"
                                        decimalDigitsDirective
                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency"
                                        [mask]="inputMaskFormat"
                                    />
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="transaction.convertedAmount || 0"
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                        >
                                        </amount-field>
                                    </span>
                                </div>
                            </div>
                        </td>

                        <td class="item-discount">
                            <div class="td-wrapper">
                                <div class="text-right flex-grow-1">
                                    <discount-control-component
                                        #discountComponent
                                        [discountMenu]="false"
                                        [discountAccountsDetails]="entry.discounts"
                                        [discountSum]="entry.discountSum"
                                        [showHeaderText]="false"
                                        (hideOtherPopups)="closeTaxControlPopup()"
                                        (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                        [maskInput]="inputMaskFormat"
                                        [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffixInput]="selectedSuffixForCurrency"
                                        [commonLocaleData]="commonLocaleData"
                                    >
                                    </discount-control-component>
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="entry.discountSum * exchangeRate"
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                        >
                                        </amount-field>
                                    </span>
                                </div>
                            </div>
                        </td>

                        <td class="position-relative dropdown-container item-tax">
                            <div class="td-wrapper">
                                <div class="text-right flex-grow-1">
                                    <tax-control
                                        [taxes]="companyTaxesList"
                                        [date]="purchaseOrder.voucherDetails.voucherDate"
                                        [taxRenderData]="entry.taxes"
                                        [totalForTax]="transaction.taxableValue"
                                        [applicableTaxes]="transaction.applicableTaxes"
                                        [exceptTaxTypes]="exceptTaxTypes"
                                        [allowedSelectionOfAType]="allowedSelectionOfAType"
                                        [showHeading]="false"
                                        [rootClass]="'sales-invoice-table'"
                                        (selectedTaxEvent)="transaction.applicableTaxes = $event"
                                        (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                        (hideOtherPopups)="closeDiscountPopup()"
                                        [maskInput]="inputMaskFormat"
                                        [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffixInput]="selectedSuffixForCurrency"
                                    >
                                    </tax-control>
                                </div>

                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                        >
                                        </amount-field>
                                    </span>
                                </div>
                            </div>
                        </td>

                        <td class="text-right item-total delete-btn-absolute">
                            <div class="td-wrapper">
                                <div class="flex-grow-1">
                                    <input
                                        type="text"
                                        name="transaction.total_{{ entryIdx }}"
                                        class="form-control text-right"
                                        [(ngModel)]="transaction.total"
                                        decimalDigitsDirective
                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency"
                                        [mask]="inputMaskFormat"
                                        (blur)="calculateTransactionValueInclusively(entry, transaction)"
                                    />

                                    <div *ngIf="isTcsTdsApplicable" class="wrap-other-tax">
                                        <input
                                            type="checkbox"
                                            class="other-taxes-checkbox"
                                            [(ngModel)]="entry.isOtherTaxApplicable"
                                            *ngIf="!entry.isOtherTaxApplicable"
                                            (click)="tcsTdsIndex = entryIdx"
                                            name="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                            id="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                            (ngModelChange)="
                                                toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)
                                            "
                                        />
                                        <label
                                            for="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                            *ngIf="!entry.isOtherTaxApplicable"
                                            class="other-tax-label"
                                            >{{ localeData?.other_tax }}</label
                                        >
                                    </div>
                                    <div *ngIf="entry.isOtherTaxApplicable" class="mr-t1">
                                        <span>
                                            <div class="d-flex align-items-center">
                                                <span class="mr-r05">
                                                    <a
                                                        href="javascript:;"
                                                        (click)="toggleOtherTaxesAsidePane(true, entryIdx)"
                                                    >
                                                        <img src="assets/images/edit-pencilicon.svg" />
                                                    </a>
                                                </span>
                                                <input
                                                    class="text-right form-control other-taxes-input"
                                                    disabled="disabled"
                                                    [(ngModel)]="entry.otherTaxSum"
                                                    [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency"
                                                    [mask]="inputMaskFormat"
                                                    name="entry.otherTaxesSum_{{ entryIdx }}"
                                                />
                                            </div>

                                            <p>
                                                {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                            </p>
                                        </span>
                                    </div>
                                </div>
                                <div
                                    *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount"
                                    class="tax-in-currency differ-currency"
                                >
                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="entry.otherTaxSum * exchangeRate"
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                        >
                                        </amount-field>
                                    </span>
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                    <span class="d-flex justify-content-end">
                                        <amount-field
                                            [amount]="transaction.convertedTotal"
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency"
                                        >
                                        </amount-field>
                                    </span>
                                </div>

                                <ng-container *ngTemplateOutlet="otherTaxesModal; context: { $implicit: entry }">
                                </ng-container>
                            </div>

                            <div
                                class="trash-icon-delete"
                                (click)="removeTransaction(entryIdx); $event.preventDefault(); $event.stopPropagation()"
                            >
                                <span class="cp">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </span>
                            </div>
                        </td>
                    </tr>
                    <!-- endregion -->
                    <!-- </ng-container> -->
                </ng-template>
                <!-- region add bulk items -->
                <div class="p-1 aqua-color add-line-bulk-item">
                    <a href="javascript:void 0" (click)="addBlankRow(null)">{{ localeData?.add_new_line }}</a>
                    <span class="font-14"> | </span>
                    <a (click)="bulkItemsModal.show()" href="javascript:void(0)">{{ localeData?.add_bulk_entries }}</a>
                </div>
                <!-- endregion -->
                <tfoot>
                    <tr>
                        <td colspan="4">
                            <!-- region other details-->
                            <div>
                                <div class="collapse-pane clearfix">
                                    <div
                                        class="collapse-pane-heading"
                                        (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed"
                                    >
                                        <div class="ico-box-wrap">
                                            <div class="ico-box">
                                                <span
                                                    aria-hidden="true"
                                                    [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                                ></span>
                                            </div>
                                        </div>
                                        <div class="ico-head">{{ commonLocaleData?.app_other_details }}</div>
                                    </div>
                                    <div [collapse]="isOthrDtlCollapsed" class="clearfix max-width-600 pd-l3 m-0">
                                        <div class="row">
                                            <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                <giddh-datepicker
                                                    #shippingDate="ngModel"
                                                    [placeholder]="localeData?.ship_date"
                                                    name="shippingDate"
                                                    [(ngModel)]="purchaseOrder.templateDetails.other.shippingDate"
                                                    [class.invalid-inp]="
                                                        shippingDate.errors &&
                                                        (shippingDate.dirty || shippingDate.touched)
                                                    "
                                                    [showToggleIcon]="false"
                                                >
                                                </giddh-datepicker>
                                                <p
                                                    class="text-danger"
                                                    *ngIf="
                                                        shippingDate.errors &&
                                                        (shippingDate.dirty || shippingDate.touched)
                                                    "
                                                >
                                                    {{ localeData?.invalid_date }}
                                                </p>
                                            </div>
                                            <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                <input
                                                    type="text"
                                                    name="shippedVia"
                                                    [(ngModel)]="purchaseOrder.templateDetails.other.shippedVia"
                                                    class="form-control"
                                                    [placeholder]="localeData?.ship_via"
                                                />
                                            </div>
                                            <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                <input
                                                    type="text"
                                                    name="trackingNumber"
                                                    [(ngModel)]="purchaseOrder.templateDetails.other.trackingNumber"
                                                    class="form-control"
                                                    [placeholder]="localeData?.tracking_number"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- endregion -->
                            <!-- region note/messages -->
                            <div class="pt-1 pl-0 max-width-600">
                                <label class="mr-b1">{{ commonLocaleData?.app_note }}</label>
                                <textarea
                                    class="form-control"
                                    name="message2"
                                    [(ngModel)]="purchaseOrder.templateDetails.other.message2"
                                ></textarea>
                            </div>
                            <!-- endregion -->
                        </td>
                        <!-- region total section -->
                        <td colspan="4">
                            <section class="table-section form-group">
                                <div class="table-row">
                                    <div class="table-cell">{{ commonLocaleData?.app_total_amount }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="purchaseOrder.voucherDetails.subTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row">
                                    <div class="table-cell">{{ commonLocaleData?.app_discount }}</div>

                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="purchaseOrder.voucherDetails.totalDiscount * -1"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row">
                                    <div class="table-cell">{{ commonLocaleData?.app_taxable_value }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="purchaseOrder.voucherDetails.totalTaxableValue"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="!excludeTax">
                                    <div class="table-cell">{{ commonLocaleData?.app_tax }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="purchaseOrder.voucherDetails.gstTaxesTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="!excludeTax">
                                    <div class="table-cell">{{ commonLocaleData?.app_cess }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="purchaseOrder.voucherDetails.cessTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>
                                <div class="table-row" *ngIf="calculatedRoundOff > 0 || calculatedRoundOff < 0">
                                    <div class="table-cell">
                                        <strong>{{ commonLocaleData?.app_round_off }}</strong>
                                    </div>

                                    <div class="table-cell figure-cell">
                                        <strong>
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="calculatedRoundOff"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </strong>
                                    </div>
                                </div>

                                <div class="table-row">
                                    <div class="table-cell bigger-dollar">
                                        <strong
                                            >{{ commonLocaleData?.app_total }}
                                            <span *ngIf="isMulticurrencyAccount">
                                                {{ purchaseOrder.accountDetails.currencySymbol }}
                                            </span>
                                        </strong>
                                    </div>

                                    <div class="table-cell figure-cell">
                                        <strong>
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="purchaseOrder.voucherDetails.grandTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </strong>
                                    </div>
                                </div>
                                <!-- multicurrency feature (editable grand total make it functional) -->
                                <div class="table-row" *ngIf="isMulticurrencyAccount">
                                    <div class="table-cell bigger-dollar">
                                        <strong
                                            >{{ commonLocaleData?.app_total }} <span>{{ baseCurrencySymbol }}</span>
                                        </strong>
                                    </div>

                                    <div class="table-cell figure-cell">
                                        <input
                                            #grandTotalInr
                                            type="text"
                                            class="form-control"
                                            name="grandTotalMulDum"
                                            [prefix]="baseCurrencySymbol"
                                            [suffix]="selectedSuffixForCurrency"
                                            [mask]="inputMaskFormat"
                                            [(ngModel)]="grandTotalMulDum"
                                            (blur)="updateExchangeRate(grandTotalInr.value)"
                                        />
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tcsTotal > 0">
                                    <div class="table-cell">{{ commonLocaleData?.app_tcs }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="purchaseOrder.voucherDetails.tcsTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tdsTotal > 0">
                                    <div class="table-cell">{{ commonLocaleData?.app_tds }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="purchaseOrder.voucherDetails.tdsTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? purchaseOrder.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>
                            </section>
                        </td>
                        <!-- endregion -->
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </section>
        <!-- region mobile view -->
        <div class="show-in-mobile" *ngIf="isMobileScreen">
            <div class="card-invoice-table-wrapper" *ngFor="let entry of purchaseOrder.entries; let entryIdx = index">
                <ng-container *ngFor="let transaction of entry.transactions">
                    <div class="card-invoice-table" [hidden]="activeIndex === entryIdx">
                        <div class="row">
                            <div class="col-12">
                                <div class="single-card-row">
                                    <div class="product-name">
                                        <label class="card-label">{{ localeData?.product_service_description }}</label>
                                        <label *ngIf="!transaction.accountName" class="select-account-label">{{
                                            localeData?.select_account
                                        }}</label>
                                        <p>{{ transaction.accountName }}</p>
                                        <span *ngIf="transaction.stockDetails?.uniqueName"
                                            >({{ transaction.stockDetails?.name }})</span
                                        >
                                    </div>

                                    <p class="description">
                                        {{ transaction.description }}
                                    </p>
                                    <p
                                        class="small text-muted sku-custom-fields"
                                        *ngIf="transaction.sku_and_customfields"
                                    >
                                        {{ transaction.sku_and_customfields }}
                                    </p>

                                    <div class="date-hsn-code pr-0">
                                        <div class="row">
                                            <div class="col-12" *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                                <div class="hsn-code text-right">
                                                    <label
                                                        >{{
                                                            transaction.showCodeType === "hsn"
                                                                ? commonLocaleData?.app_hsn
                                                                : commonLocaleData?.app_sac
                                                        }}:
                                                        {{
                                                            transaction.showCodeType === "hsn"
                                                                ? transaction.hsnNumber
                                                                : transaction.sacNumber
                                                        }}</label
                                                    >
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="qty-unit">
                                        <label class="card-label">{{ commonLocaleData?.app_quantity_unit }}</label>
                                        <p>{{ transaction.quantity }} {{ transaction.stockUnit }}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-rate">
                                        <label class="card-label">{{ commonLocaleData?.app_rate }}</label>
                                        <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                            <p>
                                                <span>
                                                    <amount-field
                                                        [amount]="transaction.rate"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? purchaseOrder.accountDetails.currencySymbol
                                                                : false
                                                        "
                                                        [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? purchaseOrder.accountDetails?.currency?.code
                                                                : false
                                                        "
                                                        [ratePrecision]="true"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </p>
                                            <div *ngIf="isMulticurrencyAccount" class="differ-currency">
                                                <span>
                                                    <amount-field
                                                        [amount]="
                                                            transaction.rate * exchangeRate
                                                                ? transaction.rate * exchangeRate
                                                                : 0
                                                        "
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                        [ratePrecision]="true"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-amount">
                                        <label class="card-label">{{ commonLocaleData?.app_amount }}</label>
                                        <p>
                                            <span>
                                                <amount-field
                                                    [amount]="transaction.amount"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </p>

                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="transaction.amount * exchangeRate || 0"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-discount">
                                        <label class="card-label">{{ commonLocaleData?.app_discount }}</label>
                                        <p>
                                            <span>
                                                <amount-field
                                                    [amount]="entry.discountSum"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </p>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="entry.discountSum * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-tax">
                                        <label class="card-label">{{ commonLocaleData?.app_tax }}</label>
                                        <p>
                                            <span>
                                                <amount-field
                                                    [amount]="entry.taxSum"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </p>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-total">
                                        <label class="card-label">{{ commonLocaleData?.app_total }}</label>
                                        <p>
                                            <span>
                                                <amount-field
                                                    [amount]="transaction.total"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? purchaseOrder.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </p>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="transaction.convertedTotal"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="edit-card" (click)="setActiveIndex(entryIdx); $event.stopPropagation()">
                            <img src="assets/images/edit-pencilicon.svg" />
                        </div>
                        <div
                            class="del-card"
                            (click)="removeTransaction(entryIdx); $event.preventDefault(); $event.stopPropagation()"
                        >
                            <i class="icon-trash" aria-hidden="true"></i>
                        </div>
                    </div>
                    <!-- endregion -->

                    <!-- region dynamic entry -->
                    <div class="card-invoice-table edit-card-invoice-table" [hidden]="activeIndex !== entryIdx">
                        <div class="row">
                            <div class="col-12">
                                <div class="single-card-row">
                                    <div class="product-name">
                                        <label class="card-label">{{ localeData?.product_service_description }}</label>
                                        <div class="product-name">
                                            <div class="ng-select-wrap">
                                                <sh-select
                                                    [options]="salesAccounts$ | async"
                                                    [(ngModel)]="transaction.fakeAccForSelect2"
                                                    #selectAccount
                                                    name="transaction.fakeAccForSelect2_{{ entryIdx }}"
                                                    (selected)="
                                                        onSelectSalesAccount(
                                                            $event,
                                                            transaction,
                                                            entry,
                                                            false,
                                                            entryIdx
                                                        )
                                                    "
                                                    [placeholder]="localeData?.select_acc"
                                                    [notFoundLink]="true"
                                                    [forceClearReactive]="forceClear$ | async"
                                                    [multiple]="false"
                                                    [ItemHeight]="67"
                                                    (onClear)="onClearSalesAccount(transaction)"
                                                    [useInBuiltFilterForFlattenAc]="true"
                                                >
                                                    <ng-template #optionTemplate let-option="option">
                                                        <ng-container *ngIf="!option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item flex-column">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item-unique">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                            </a>
                                                        </ng-container>
                                                        <ng-container *ngIf="option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item flex-column">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item-unique">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                                <div class="item-stock">
                                                                    {{ commonLocaleData?.app_stock }}:
                                                                    {{ option.additional?.stock.uniqueName }}
                                                                </div>
                                                            </a>
                                                        </ng-container>
                                                    </ng-template>
                                                </sh-select>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="description mt-1">
                                                <textarea
                                                    rows="3"
                                                    type="text"
                                                    [placeholder]="localeData?.add_description"
                                                    #description
                                                    name="transaction.description_{{ entryIdx }}"
                                                    class="form-control"
                                                    [(ngModel)]="transaction.description"
                                                    [maxlength]="entryDescriptionLength"
                                                ></textarea>
                                                <p class="font-12">
                                                    {{ commonLocaleData?.app_characters_left }}:
                                                    {{ entryDescriptionLength - transaction.description?.length }}
                                                </p>
                                                <p
                                                    class="small text-muted sku-and-custom-fields"
                                                    *ngIf="transaction.sku_and_customfields"
                                                >
                                                    {{ transaction.sku_and_customfields }}
                                                </p>
                                            </div>

                                            <!-- region entry date/ hsncode -->
                                            <div class="date-hsn-code">
                                                <div class="row">
                                                    <div class="col-xs-12 pl-0">
                                                        <div class="wrap-hsn-box">
                                                            <div
                                                                class="hsn-code text-right"
                                                                (click)="toggleHsnSacDropDown(transaction)"
                                                            >
                                                                <label
                                                                    >{{
                                                                        transaction.showCodeType === "hsn"
                                                                            ? commonLocaleData?.app_hsn
                                                                            : commonLocaleData?.app_sac
                                                                    }}:</label
                                                                >
                                                                <span>
                                                                    {{
                                                                        inventorySettings?.manageInventory ||
                                                                        !transaction.sacNumber
                                                                            ? transaction.hsnNumber
                                                                            : transaction.sacNumber
                                                                    }}
                                                                    <span
                                                                        *ngIf="
                                                                            !transaction.hsnNumber &&
                                                                            !transaction.sacNumber
                                                                        "
                                                                        class="update-text"
                                                                        >{{ commonLocaleData?.app_update }}
                                                                    </span>
                                                                    <span class="edit-icon cp">
                                                                        <img src="assets/images/edit-pencilicon.svg" />
                                                                    </span>
                                                                </span>
                                                            </div>
                                                            <div class="hsn-code-dropdown" *ngIf="hsnSacDropdownShow">
                                                                <div class="d-flex wrap-hsn-sac mb-2 mt-3">
                                                                    <span>
                                                                        <input
                                                                            type="radio"
                                                                            class="radio-custom radio-theme"
                                                                            name="showCodeType{{ entryIdx }}"
                                                                            id="hsnCodeType{{ entryIdx }}"
                                                                            [(ngModel)]="transaction.showCodeType"
                                                                            value="hsn"
                                                                        />
                                                                        <label
                                                                            for="hsnCodeType{{ entryIdx }}"
                                                                            class="radio-custom-label"
                                                                            >{{ commonLocaleData?.app_hsn_code }}</label
                                                                        >
                                                                    </span>
                                                                    <span>
                                                                        <input
                                                                            type="radio"
                                                                            class="radio-custom radio-theme"
                                                                            name="showCodeType{{ entryIdx }}"
                                                                            id="sacCodeType{{ entryIdx }}"
                                                                            [(ngModel)]="transaction.showCodeType"
                                                                            value="sac"
                                                                        />
                                                                        <label
                                                                            for="sacCodeType{{ entryIdx }}"
                                                                            class="radio-custom-label"
                                                                            >{{ commonLocaleData?.app_sac_code }}</label
                                                                        >
                                                                    </span>
                                                                </div>
                                                                <input
                                                                    type="text"
                                                                    maxLength="10"
                                                                    decimalDigitsDirective
                                                                    [placeholder]="localeData?.hsn_number"
                                                                    name="transaction.hsnNumber_{{ entryIdx }}"
                                                                    *ngIf="transaction.showCodeType === 'hsn'"
                                                                    [(ngModel)]="transaction.hsnNumber"
                                                                />
                                                                <input
                                                                    type="text"
                                                                    maxLength="10"
                                                                    decimalDigitsDirective
                                                                    [placeholder]="localeData?.sac_number"
                                                                    name="transaction.hsnNumber_{{ entryIdx }}"
                                                                    *ngIf="transaction.showCodeType === 'sac'"
                                                                    [(ngModel)]="transaction.sacNumber"
                                                                />
                                                                <div class="d-flex wrap-hsn-sac mb-2 mt-3">
                                                                    <button
                                                                        class="btn btn-sm btn-success-green"
                                                                        type="button"
                                                                        (click)="
                                                                            hsnSacDropdownShow = !hsnSacDropdownShow
                                                                        "
                                                                    >
                                                                        {{ commonLocaleData?.app_save }}
                                                                    </button>
                                                                    <button
                                                                        class="btn btn-sm btn-primary mr-0"
                                                                        type="button"
                                                                        (click)="hideHsnSacEditPopup(transaction)"
                                                                    >
                                                                        {{ commonLocaleData?.app_cancel }}
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- endregion -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row quantity-unit-width-100">
                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="qty-unit">
                                        <div class="row">
                                            <div class="col-6 pr-0">
                                                <label class="card-label text-right">{{ localeData?.qty }}</label>
                                                <input
                                                    type="text"
                                                    [disabled]="!transaction.isStockTxn"
                                                    (blur)="handleQuantityBlur(entry, transaction)"
                                                    [placeholder]="commonLocaleData?.app_quantity"
                                                    decimalDigitsDirective
                                                    name="transaction.quantity_{{ entryIdx }}"
                                                    class="form-control text-right"
                                                    [(ngModel)]="transaction.quantity"
                                                />
                                            </div>
                                            <div class="col-6">
                                                <label class="card-label text-right">{{
                                                    commonLocaleData?.app_unit
                                                }}</label>
                                                <select
                                                    class="form-control"
                                                    [disabled]="!transaction.isStockTxn"
                                                    name="transaction.stockUnit_{{ entryIdx }}"
                                                    [(ngModel)]="transaction.stockUnit"
                                                    (ngModelChange)="
                                                        onChangeUnit(transaction, $event); transaction.setAmount(entry)
                                                    "
                                                >
                                                    <option
                                                        *ngFor="let stock of transaction.stockList"
                                                        [ngValue]="stock.id"
                                                    >
                                                        {{ stock.text }}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-rate">
                                        <label class="card-label text-right">{{ commonLocaleData?.app_rate }}</label>
                                        <div>
                                            <input
                                                type="text"
                                                [disabled]="!transaction.isStockTxn"
                                                (blur)="
                                                    calculateStockEntryAmount(transaction);
                                                    calculateWhenTrxAltered(entry, transaction)
                                                "
                                                [placeholder]="commonLocaleData?.app_rate"
                                                name="transaction.rate_{{ entryIdx }}"
                                                class="form-control transaction-rate text-right"
                                                [(ngModel)]="transaction.rate"
                                                [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                [suffix]="selectedSuffixForCurrency"
                                                [mask]="inputMaskFormat"
                                                [customDecimalPlaces]="highPrecisionRate"
                                            />
                                        </div>
                                        <!-- please add condition for show and hide -->
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="
                                                        transaction.rate * exchangeRate
                                                            ? transaction.rate * exchangeRate
                                                            : 0
                                                    "
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                    [ratePrecision]="true"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-amount">
                                        <label class="card-label text-right">{{ commonLocaleData?.app_amount }}</label>
                                        <div>
                                            <input
                                                type="tel"
                                                (blur)="calculateWhenTrxAltered(entry, transaction, true)"
                                                (click)="transactionAmountClicked(transaction)"
                                                [placeholder]="commonLocaleData?.app_amount"
                                                name="transaction.amount_{{ entryIdx }}"
                                                class="form-control text-right"
                                                [(ngModel)]="transaction.amount"
                                                decimalDigitsDirective
                                                [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                [suffix]="selectedSuffixForCurrency"
                                                [mask]="inputMaskFormat"
                                            />
                                        </div>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="transaction.amount * exchangeRate || 0"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-discount">
                                        <label class="card-label text-right">{{
                                            commonLocaleData?.app_discount
                                        }}</label>
                                        <div class="text-right">
                                            <discount-control-component
                                                #discountComponent
                                                [discountMenu]="false"
                                                [discountAccountsDetails]="entry.discounts"
                                                [discountSum]="entry.discountSum"
                                                [showHeaderText]="false"
                                                (hideOtherPopups)="closeTaxControlPopup()"
                                                (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                                [maskInput]="inputMaskFormat"
                                                [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                                [suffixInput]="selectedSuffixForCurrency"
                                            >
                                                [commonLocaleData]="commonLocaleData"
                                            </discount-control-component>
                                        </div>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="entry.discountSum * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-tax">
                                        <label class="card-label text-right">{{ commonLocaleData?.app_tax }}</label>

                                        <div class="text-right">
                                            <tax-control
                                                [taxes]="companyTaxesList"
                                                [date]="purchaseOrder.voucherDetails.voucherDate"
                                                [taxRenderData]="entry.taxes"
                                                [totalForTax]="transaction.taxableValue"
                                                [applicableTaxes]="transaction.applicableTaxes"
                                                [exceptTaxTypes]="exceptTaxTypes"
                                                [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                [showHeading]="false"
                                                [rootClass]="'sales-invoice-table'"
                                                (selectedTaxEvent)="transaction.applicableTaxes = $event"
                                                (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                                (hideOtherPopups)="closeDiscountPopup()"
                                                [maskInput]="inputMaskFormat"
                                                [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                                [suffixInput]="selectedSuffixForCurrency"
                                            >
                                            </tax-control>
                                        </div>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="single-card-row">
                                    <div class="card-total">
                                        <label class="card-label text-right">{{ commonLocaleData?.app_total }}</label>
                                        <div>
                                            <input
                                                type="tel"
                                                name="transaction.total_{{ entryIdx }}"
                                                class="form-control text-right"
                                                (blur)="calculateTransactionValueInclusively(entry, transaction)"
                                                [(ngModel)]="transaction.total"
                                                decimalDigitsDirective
                                                [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                [suffix]="selectedSuffixForCurrency"
                                                [mask]="inputMaskFormat"
                                            />
                                            <div class="wrap-other-tax" *ngIf="isTcsTdsApplicable">
                                                <input
                                                    type="checkbox"
                                                    class="other-taxes-checkbox"
                                                    [(ngModel)]="entry.isOtherTaxApplicable"
                                                    *ngIf="!entry.isOtherTaxApplicable"
                                                    (click)="tcsTdsIndex = entryIdx"
                                                    name="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                    id="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                    (ngModelChange)="
                                                        toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)
                                                    "
                                                />
                                                <label
                                                    for="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                    *ngIf="!entry.isOtherTaxApplicable"
                                                    class="other-tax-label"
                                                    >{{ localeData?.other_tax }}</label
                                                >
                                            </div>
                                            <div class="mt-1 other-taxes" *ngIf="entry.isOtherTaxApplicable">
                                                <span>
                                                    <div class="d-flex align-items-center">
                                                        <span class="mr-r05">
                                                            <a
                                                                href="javascript:;"
                                                                (click)="toggleOtherTaxesAsidePane(true, entryIdx)"
                                                            >
                                                                <img src="assets/images/edit-pencilicon.svg" />
                                                            </a>
                                                        </span>

                                                        <input
                                                            class="text-right form-control other-taxes-input"
                                                            disabled="disabled"
                                                            [(ngModel)]="entry.otherTaxSum"
                                                            [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                            [suffix]="selectedSuffixForCurrency"
                                                            [mask]="inputMaskFormat"
                                                            name="entry.otherTaxesSum_{{ entryIdx }}"
                                                        />
                                                    </div>

                                                    <p class="applicable-tax">
                                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                    </p>
                                                </span>
                                            </div>
                                        </div>
                                        <div
                                            class="tax-in-currency text-right"
                                            *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount"
                                        >
                                            <span>
                                                <amount-field
                                                    [amount]="entry.otherTaxSum * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>
                                                <amount-field
                                                    [amount]="transaction.convertedTotal"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>

                                        <ng-container
                                            *ngTemplateOutlet="otherTaxesModal; context: { $implicit: entry }"
                                        >
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="save-card-data pointer" (click)="handleOutsideClick()">
                            <i class="icon-save" aria-hidden="true"></i>
                        </div>
                        <div
                            class="del-card pointer"
                            (click)="removeTransaction(entryIdx); $event.preventDefault(); $event.stopPropagation()"
                        >
                            <i class="icon-trash" aria-hidden="true"></i>
                        </div>
                    </div>
                    <!-- endregion -->
                </ng-container>
            </div>
            <div class="add-btn" (click)="addBlankRow(null)">
                <button class="btn btn-sm btn-success">{{ commonLocaleData?.app_add_more }}</button>
            </div>

            <div class="other-detail-card">
                <div>
                    <div class="collapse-pane clearfix">
                        <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                            <div class="ico-box-wrap">
                                <div class="ico-box">
                                    <span
                                        [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                        aria-hidden="true"
                                    ></span>
                                </div>
                            </div>
                            <div class="ico-head">{{ commonLocaleData?.app_other_details }}</div>
                        </div>

                        <div class="clearfix max-width-600 m-0" [collapse]="isOthrDtlCollapsed">
                            <div class="row">
                                <div class="form-group col-xs-4">
                                    <giddh-datepicker
                                        #shippingDate="ngModel"
                                        [placeholder]="localeData?.ship_date"
                                        name="shippingDate"
                                        [(ngModel)]="purchaseOrder.templateDetails.other.shippingDate"
                                        [class.invalid-inp]="
                                            shippingDate.errors && (shippingDate.dirty || shippingDate.touched)
                                        "
                                        [showToggleIcon]="false"
                                    >
                                    </giddh-datepicker>
                                    <p
                                        class="text-danger"
                                        *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)"
                                    >
                                        {{ localeData?.invalid_date }}
                                    </p>
                                </div>

                                <div class="form-group col-xs-4">
                                    <input
                                        type="text"
                                        name="shippedVia"
                                        [(ngModel)]="purchaseOrder.templateDetails.other.shippedVia"
                                        class="form-control"
                                        [placeholder]="localeData?.ship_via"
                                    />
                                </div>

                                <div class="form-group col-xs-4">
                                    <input
                                        type="text"
                                        name="trackingNumber"
                                        [(ngModel)]="purchaseOrder.templateDetails.other.trackingNumber"
                                        class="form-control"
                                        [placeholder]="localeData?.tracking_number"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pd-t1 pl-0 max-width-600">
                        <label class="mr-b1">{{ localeData?.message }}</label>
                        <textarea
                            class="form-control"
                            name="message2"
                            [(ngModel)]="purchaseOrder.templateDetails.other.message2"
                        ></textarea>
                    </div>
                </div>
            </div>

            <div class="total-amount-description">
                <section class="table-section form-group">
                    <div class="table-row">
                        <div class="table-cell">{{ commonLocaleData?.app_total_amount }}</div>
                        <div class="table-cell figure-cell">
                            <span class="d-flex justify-content-end">
                                <amount-field
                                    [amount]="purchaseOrder.voucherDetails.subTotal"
                                    [currencySymbol]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false
                                    "
                                    [currencyCode]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails?.currency?.code : false
                                    "
                                >
                                </amount-field>
                            </span>
                        </div>
                    </div>

                    <div class="table-row">
                        <div class="table-cell">{{ commonLocaleData?.app_discount }}</div>

                        <div class="table-cell figure-cell">
                            <span class="d-flex justify-content-end">
                                <amount-field
                                    [amount]="purchaseOrder.voucherDetails.totalDiscount * -1"
                                    [currencySymbol]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false
                                    "
                                    [currencyCode]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails?.currency?.code : false
                                    "
                                >
                                </amount-field>
                            </span>
                        </div>
                    </div>

                    <div class="table-row">
                        <div class="table-cell">{{ commonLocaleData?.app_taxable_value }}</div>
                        <div class="table-cell figure-cell">
                            <span class="d-flex justify-content-end">
                                <amount-field
                                    [amount]="purchaseOrder.voucherDetails.totalTaxableValue"
                                    [currencySymbol]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false
                                    "
                                    [currencyCode]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails?.currency?.code : false
                                    "
                                >
                                </amount-field>
                            </span>
                        </div>
                    </div>

                    <div class="table-row">
                        <div class="table-cell">{{ commonLocaleData?.app_tax }}</div>
                        <div class="table-cell figure-cell">
                            <span class="d-flex justify-content-end">
                                <amount-field
                                    [amount]="purchaseOrder.voucherDetails.gstTaxesTotal"
                                    [currencySymbol]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false
                                    "
                                    [currencyCode]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails?.currency?.code : false
                                    "
                                >
                                </amount-field>
                            </span>
                        </div>
                    </div>

                    <div class="table-row">
                        <div class="table-cell">{{ commonLocaleData?.app_cess }}</div>
                        <div class="table-cell figure-cell">
                            <span class="d-flex justify-content-end">
                                <amount-field
                                    [amount]="purchaseOrder.voucherDetails.cessTotal"
                                    [currencySymbol]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false
                                    "
                                    [currencyCode]="
                                        isMulticurrencyAccount ? purchaseOrder.accountDetails?.currency?.code : false
                                    "
                                >
                                </amount-field>
                            </span>
                        </div>
                    </div>
                    <div class="table-row">
                        <div class="table-cell">
                            <strong>{{ commonLocaleData?.app_round_off }}</strong>
                        </div>

                        <div class="table-cell figure-cell">
                            <strong>
                                <span class="d-flex justify-content-end">
                                    <amount-field
                                        [amount]="calculatedRoundOff"
                                        [currencySymbol]="
                                            isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false
                                        "
                                        [currencyCode]="
                                            isMulticurrencyAccount
                                                ? purchaseOrder.accountDetails?.currency?.code
                                                : false
                                        "
                                    >
                                    </amount-field>
                                </span>
                            </strong>
                        </div>
                    </div>
                    <div class="table-row">
                        <div class="table-cell">
                            <strong
                                >{{ commonLocaleData?.app_total }}
                                <span *ngIf="isMulticurrencyAccount">{{
                                    purchaseOrder.accountDetails.currencySymbol
                                }}</span>
                            </strong>
                        </div>

                        <div class="table-cell figure-cell">
                            <strong>
                                <span class="d-flex justify-content-end">
                                    <amount-field
                                        [amount]="purchaseOrder.voucherDetails.grandTotal"
                                        [currencySymbol]="
                                            isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false
                                        "
                                        [currencyCode]="
                                            isMulticurrencyAccount
                                                ? purchaseOrder.accountDetails?.currency?.code
                                                : false
                                        "
                                    >
                                    </amount-field>
                                </span>
                            </strong>
                        </div>
                    </div>
                    <div class="table-row" *ngIf="isMulticurrencyAccount">
                        <div class="table-cell bigger-dollar">
                            <strong
                                >{{ commonLocaleData?.app_total }}
                                <span>
                                    {{ baseCurrencySymbol }}
                                </span>
                            </strong>
                        </div>

                        <div class="table-cell figure-cell">
                            <input
                                #grandTotalInr
                                type="text"
                                class="form-control"
                                name="grandTotalMulDum"
                                [prefix]="baseCurrencySymbol"
                                [suffix]="selectedSuffixForCurrency"
                                [mask]="inputMaskFormat"
                                [(ngModel)]="grandTotalMulDum"
                                (blur)="updateExchangeRate(grandTotalInr.value)"
                            />
                        </div>
                    </div>

                    <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tcsTotal > 0">
                        <div class="table-cell">{{ commonLocaleData?.app_tcs }}</div>
                        <div class="table-cell figure-cell">
                            <span class="d-flex justify-content-end">
                                <amount-field
                                    [amount]="purchaseOrder.voucherDetails.tcsTotal"
                                    [currencySymbol]="false"
                                    [currencyCode]="false"
                                >
                                </amount-field>
                            </span>
                        </div>
                    </div>

                    <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tdsTotal > 0">
                        <div class="table-cell">{{ commonLocaleData?.app_tds }}</div>
                        <div class="table-cell figure-cell">
                            <span class="d-flex justify-content-end">
                                <amount-field
                                    [amount]="purchaseOrder.voucherDetails.tdsTotal"
                                    [currencySymbol]="false"
                                    [currencyCode]="false"
                                >
                                </amount-field>
                            </span>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <!-- endregion -->
    </form>

    <section class="clearfix mr-b5" *ngIf="!showLoader">
        <section id="actionPane" class="text-center mr-b2">
            <div class="col-xs-12">
                <!-- region generate mode -->
                <div class="pull-right pr update-mode" *ngIf="!isUpdateMode">
                    <button type="button" class="btn btn-danger d-inline-block v-align-middle" (click)="resetForm()">
                        {{ commonLocaleData?.app_clear }}
                    </button>

                    <!-- region purchase invoice -->
                    <span class="d-inline-block v-align-middle">
                        <button
                            type="button"
                            class="btn btn-default"
                            [disabled]="isFormSaveInProgress"
                            (click)="savePurchaseOrder('create')"
                        >
                            {{ commonLocaleData?.app_save }}
                        </button>
                    </span>
                    <!-- endregion -->
                </div>
                <!-- endregion -->

                <!-- region update mode -->
                <div class="pull-right pr" *ngIf="isUpdateMode">
                    <button type="button" class="btn btn-danger d-inline-block v-align-middle" (click)="cancelUpdate()">
                        {{ commonLocaleData?.app_cancel }}
                    </button>
                    <button
                        type="button"
                        class="btn btn-default"
                        [disabled]="isFormSaveInProgress"
                        (click)="savePurchaseOrder('update')"
                    >
                        {{ commonLocaleData?.app_update }}
                    </button>
                </div>
                <!-- endregion -->
            </div>
        </section>
    </section>

    <!-- endregion -->
    <div
        class="aside-overlay"
        *ngIf="
            accountAsideMenuState === 'in' ||
            asideMenuStateForProductService === 'in' ||
            asideMenuStateForOtherTaxes === 'in'
        "
        (click)="closeAsideMenuStateForOtherTaxes()"
    ></div>
    <generic-aside-menu-account
        [class]="accountAsideMenuState"
        [@slideInOut]="accountAsideMenuState"
        (closeAsideEvent)="toggleAccountAsidePane($event)"
        [selectedGrpUniqueName]="selectedGroupUniqueNameForAddEditAccountModal"
        [keyboardShortcut]="{ 'esc': accountAsideMenuState === 'in' }"
        *ngIf="accountAsideMenuState === 'in'"
        [selectedAccountUniqueName]="selectedVendorForDetails"
        (onShortcutPress)="toggleAccountAsidePane()"
        (addEvent)="addNewSidebarAccount($event)"
        (updateEvent)="updateSidebarAccount($event)"
    >
    </generic-aside-menu-account>

    <aside-menu-product-service
        *ngIf="asideMenuStateForProductService === 'in'"
        [class]="asideMenuStateForProductService"
        [selectedVoucherType]="'purchase'"
        [@slideInOut]="asideMenuStateForProductService"
        (closeAsideEvent)="onNoResultsClicked()"
    >
    </aside-menu-product-service>

    <!-- region bulk items -->
    <div
        bsModal
        #bulkItemsModal="bs-modal"
        tabindex="-1"
        class="modal fade"
        role="dialog"
        [config]="{ animated: true, keyboard: false, backdrop: false, ignoreBackdropClick: true }"
    >
        <ng-container *ngIf="bulkItemsModal?.isShown">
            <proforma-add-bulk-items-component
                [invoiceType]="invoiceType"
                (saveItemsEvent)="addBulkStockItems($event)"
                (closeEvent)="bulkItemsModal.hide()"
            ></proforma-add-bulk-items-component>
        </ng-container>
    </div>
    <!-- endregion -->
    <ng-template let-entry #otherTaxesModal>
        <div id="top0">
            <app-aside-menu-other-taxes
                *ngIf="asideMenuStateForOtherTaxes === 'in'"
                [class]="asideMenuStateForOtherTaxes"
                [taxes]="companyTaxesList"
                [otherTaxesModal]="entry.otherTaxModal"
                [commonLocaleData]="commonLocaleData"
                [@slideInOut]="asideMenuStateForOtherTaxes"
                (closeModal)="toggleOtherTaxesAsidePane(true, null)"
                (applyTaxes)="
                    calculateOtherTaxes($event, entry);
                    toggleOtherTaxesAsidePane(true, null);
                    calculateAffectedThingsFromOtherTaxChanges()
                "
            >
            </app-aside-menu-other-taxes>
        </div>
    </ng-template>
    <ng-template #purchaseOrderPreviewModal>
        <purchase-order-preview-modal
            [purchaseOrderUniqueName]="purchaseOrderPreviewUniqueName"
            [purchaseOrderAccountUniqueName]="purchaseOrderPreviewAccountUniqueName"
            [purchaseOrderCompanyUniqueName]="selectedCompany?.uniqueName"
            (closeModelEvent)="closePurchaseOrderPreviewPopup($event)"
        ></purchase-order-preview-modal>
    </ng-template>
</ng-container>
