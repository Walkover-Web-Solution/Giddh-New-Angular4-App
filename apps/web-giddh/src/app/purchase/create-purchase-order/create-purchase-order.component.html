<hamburger-menu [pageHeading]="'New Purchase Order'"></hamburger-menu>
<div class="no-data mr-t2 loader-main" *ngIf="showLoader">
    <div class="spinner2">
        <div class="cube1"></div>
        <div class="cube2"></div>
    </div>
</div>
<form #poForm="ngForm" novalidate autocomplete="off"
    [ngClass]="{'create-purchase-order-form': true, 'customer-purchase-order' : !purchaseOrder.voucherDetails.customerName, 'for-multi-currency' : isMulticurrencyAccount  } "
    [ngStyle]="{'display': !showLoader ? 'block' : 'none'}">
    <div class="clearfix" [keyboardShortcut]="'alt+c'" (onShortcutPress)="addAccountFromShortcut()">
        <div class="clearfix wrapper-customer-table pd-t2">
            <div class="customer-purchase-table">
                <div class="inner-container">
                    <div class="inner-container">
                        <!-- region customer section -->
                        <div class="clearfix">
                            <div class="row mr-b1">
                                <!-- region customer name -->
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Vendor Name<span class="red-text">*</span></label>
                                </div>
                                <!-- region vendor dropdown -->
                                <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                                    <div class="clearfix d-flex flex-column">
                                        <div class="d-flex flex-column">
                                            <sales-sh-select #vendorNameDropDown name="vendor" class="select-customer-field"
                                                [options]="vendorAcList$ | async"
                                                [(ngModel)]="purchaseOrder.account.uniqueName"
                                                [customFilter]="customMoveGroupFilter"
                                                (selected)="onSelectVendor($event);" [placeholder]="'Select Vendor'"
                                                [notFoundLink]="true" [doNotReset]="true"
                                                [isPaginationEnabled]="true" (scrollEnd)="handleScrollEnd('vendor')"
                                                (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'vendor')"
                                                [notFoundMsg]="noResultsFoundLabel" [enableDynamicSearch]="true"
                                                [fixedValue]="purchaseOrder.account.name"
                                                [forceClearReactive]="forceClear$ | async" [isFilterEnabled]="true"
                                                (noResultsClicked)="addNewAccount()" [multiple]="false"
                                                [ItemHeight]="67" [notFoundLinkText]="'Add Vendor'"
                                                (keyup)="resetVendor($event)" (onClear)="resetVendor(null)" [isOpen]="!isUpdateMode && !purchaseOrder.account.uniqueName">

                                                <ng-template #optionTemplate let-option="option">
                                                    <a href="javascript:void(0)" class="list-item flex-column border-none">
                                                        <div class="item">{{ option.label }}</div>
                                                        <div class="item-unique">{{ option.value }}</div>
                                                    </a>
                                                </ng-template>

                                                <ng-template #notFoundLinkTemplate>
                                                    <a href="javascript:void(0)" class="list-item pd-l05 pd-r05 d-flex justify-content-between w-100 border-none"
                                                        [keyboardShortcut]="'alt+c'">
                                                        <div class="item">{{ vendorNotFoundText }}</div>
                                                        <div class="item">Alt+C</div>
                                                    </a>
                                                </ng-template>

                                            </sales-sh-select>
                                            <!-- region Unregistered Business / vendor details -->
                                            <div class="d-flex aqua-color"
                                                *ngIf="purchaseOrder.voucherDetails.customerName">
                                                <span class="cp aqua-color"
                                                    *ngIf="!isUpdateMode">
                                                    <a href="javascript:void(0)" (click)="getVendorDetails()">Vendor
                                                        Details</a>
                                                </span>
                                            </div>
                                            <!-- endregion -->
                                            <div *ngIf="purchaseOrders && purchaseOrders.length > 0">
                                                <p><small>Pending Purchase order of selected vendor</small></p>
                                                <p class="font-14"><a href="javascript:;" (click)="openPurchaseOrderPreviewPopup(purchaseOrderPreviewModal, order.uniqueName, order.accountUniqueName)" *ngFor="let order of purchaseOrders; let i = index;">{{order.number}}<span *ngIf="checkIfPipeSymbolRequired(i)">&nbsp;|&nbsp;</span></a></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- endregion -->
                            </div>
                            <div class="row mr-b1 delivery-from-field">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Deliver From<span class="red-text">*</span></label>
                                </div>
                                <!-- region vendor dropdown -->
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 select-customer-name">
                                    <section class="form-inline">

                                        <div class="wrap-billing-address w-100 clearfix">

                                            <div class="row">
                                                <!-- region billing address -->
                                                <div class="col-sm-12 col-xl-6 col-md-10 bill-add">

                                                    <div class="form-group">
                                                        <div class="d-flex align-items-center pb-1">
                                                            <span class="pd-r15">Billing Address</span>
                                                            <span>
                                                                <div class="btn-group btn-block" dropdown #billingAddressDropDownWeb="bs-dropdown" [attachOutsideOnClick]="true" (clickOutside)="billingAddressDropDownWeb.hide()" *ngIf="accountAddressList?.length > 1">
                                                                    <a dropdownToggle type="button" class="dropdown-toggle">Change</a>
                                                                    <ul *dropdownMenu class="dropdown-menu change-address-dropdown dropdown-menu-right" role="menu">
                                                                        <li role="menuitem" *ngFor="let address of accountAddressList">
                                                                            <a class="dropdown-item" (click)="selectAddress(purchaseOrder.account.billingDetails, address)">
                                                                                {{address.address}} {{address.state?.name}}
                                                                                <span class="d-block">{{ address.gstNumber ? (showGSTINNo ? 'GSTIN: ' : 'TRN: ') + address.gstNumber : "" }}
                                                                                </span>
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </span>
                                                        </div>
                                                            <div class="billing-address clearfix">
                                                                <textarea name="vendorBillingDetailsAddress"
                                                                    (keyup)="autoFillShippingDetails('vendor')"
                                                                    [(ngModel)]="purchaseOrder.account.billingDetails.address[0]"
                                                                    class="form-control" rows="3" autocomplete="off"
                                                                    autofocus="off" aria-autocomplete="none"></textarea>

                                                                <div class="row">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <label class="sales-country-label">
                                                                            {{vendorCountry}}
                                                                        </label>
                                                                    </div>

                                                                    <div class="col-sm-12 col-md-6" #vendorBillingState>
                                                                        <sales-sh-select [placeholder]="'State'"
                                                                            class="select-border-bottom"
                                                                            (selected)="fillShippingBillingDetails($event, true, 'vendor'); autoFillShippingDetails('vendor')"
                                                                            #vendorStatesBilling [showBottomBorderOnly]="true"
                                                                            [options]="statesSource"
                                                                            name="vendorBillingDetailsStateCode"
                                                                            [(ngModel)]="purchaseOrder.account.billingDetails.state.code">
                                                                        </sales-sh-select>
                                                                    </div>

                                                                    <div class="col-sm-12"
                                                                        *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                        <input maxLength="15" autocomplete="None"
                                                                            type="text" name="vendorBillingDetailsTax"
                                                                            [(ngModel)]="purchaseOrder.account.billingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            (blur)="autoFillShippingDetails('vendor')"
                                                                            (change)="getStateCode('billingDetails', 'vendor')"
                                                                            placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                                    </div>
                                                                </div>

                                                            </div>
                                                    </div>

                                                </div>
                                                <!-- endregion -->

                                                <!-- region shipping address -->
                                                <div class="col-sm-12 col-xl-6 col-md-10 bill-add">

                                                    <div class="form-group p-0 width-100">
                                                        <div class="d-flex align-items-center pb-1">
                                                            <span class="pd-r15">
                                                            <input type="checkbox" autocomplete="None"
                                                                name="autoFillVendorShipping"
                                                                [(ngModel)]="autoFillVendorShipping"
                                                                (change)="autoFillShippingDetails('vendor')"> Shipping
                                                            Address
                                                            Same as Billing Address
                                                            </span>
                                                            <span>
                                                                <div class="btn-group btn-block" dropdown #shippingAddressDropDownWeb="bs-dropdown" [attachOutsideOnClick]="true" (clickOutside)="shippingAddressDropDownWeb.hide()" *ngIf="accountAddressList?.length > 1 && !autoFillVendorShipping">
                                                                    <a dropdownToggle type="button" class="dropdown-toggle">Change</a>
                                                                    <ul *dropdownMenu class="dropdown-menu change-address-dropdown dropdown-menu-right" role="menu">
                                                                        <li role="menuitem" *ngFor="let address of accountAddressList">
                                                                            <a class="dropdown-item" (click)="selectAddress(purchaseOrder.account.shippingDetails, address)">
                                                                                {{address.address}} {{address.state?.name}} {{ address.gstNumber ? (showGSTINNo ? 'GSTIN: ' : 'TRN: ') + address.gstNumber : "" }}
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </span>
                                                        </div>
                                                        <div
                                                            [ngClass]="{'billing-address': true, 'disabled': autoFillVendorShipping}">
                                                            <textarea name="vendorShippingDetailsAddress"
                                                                [(ngModel)]="purchaseOrder.account.shippingDetails.address[0]"
                                                                class="form-control" rows="3" autocomplete="off"
                                                                autofocus="off" aria-autocomplete="none"></textarea>
                                                            <div class="clearfix">
                                                                <div class="form-group row">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <div class="form-group">
                                                                            <label class="sales-country-label">
                                                                                {{vendorCountry}}
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-12 col-md-6 select-border-bottom"
                                                                        #vendorShippingState>
                                                                        <sales-sh-select [placeholder]="'State'"
                                                                            [disabled]="autoFillVendorShipping"
                                                                            class="select-border-bottom"
                                                                            (selected)="fillShippingBillingDetails($event, false, 'vendor');"
                                                                            #vendorStatesShipping
                                                                            [showBottomBorderOnly]="true"
                                                                            [options]="statesSource"
                                                                            name="vendorShippingDetailsStateCode"
                                                                            [(ngModel)]="purchaseOrder.account.shippingDetails.state.code">
                                                                        </sales-sh-select>
                                                                    </div>
                                                                    <div class="col-sm-12"
                                                                        *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                        <input maxLength="15" autocomplete="None"
                                                                            type="text" name="vendorShippingDetailsTax"
                                                                            [(ngModel)]="purchaseOrder.account.shippingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            (change)="getStateCode('shippingDetails', 'vendor')"
                                                                            placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- endregion -->
                                            </div>
                                        </div>
                                    </section>
                                </div>
                                <!-- endregion -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="customer-purchase-table bg-white pd-b2 pd-t2">
                <div class="inner-container">
                    <div class="row mr-b1" *ngIf="shouldShowWarehouse && warehouses && warehouses.length > 1">
                        <!-- region customer name -->
                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                            <label>Warehouse<span class="red-text">*</span></label>
                        </div>
                        <!-- region customer dropdown -->
                        <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                            <div class="clearfix d-flex flex-column">
                                <div class="d-flex flex-column">
                                    <!-- region if not cashinvoice show customer dropdown -->
                                    <sh-select class="multi-select" name="warehouse" [placeholder]="'Select Warehouse'"
                                        [(ngModel)]="purchaseOrder.warehouse.uniqueName" [options]="warehouses"
                                        (selected)="onSelectWarehouse($event)"></sh-select>
                                    <!-- endregion -->
                                </div>
                            </div>
                        </div>
                        <!-- endregion -->
                    </div>
                    <div class="row mr-b1">
                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                            <label>Deliver To<span class="red-text">*</span></label>
                        </div>
                        <!-- region customer dropdown -->
                        <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                            <section class="form-inline">

                                <div class="wrap-billing-address w-100 clearfix">

                                    <div class="row">
                                        <!-- region billing address -->
                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">

                                            <div class="form-group">
                                               <div class="d-flex align-items-center pb-1">
                                                    <span class="pd-r15">Billing Address</span>
                                                    <span>
                                                    <div class="btn-group btn-block" container="body" dropdown #companyBillingAddressDropDownWeb="bs-dropdown" [attachOutsideOnClick]="true" (clickOutside)="companyBillingAddressDropDownWeb.hide()" *ngIf="companyAddressList?.length > 1">
                                                        <a dropdownToggle type="button" class="dropdown-toggle">Change</a>
                                                        <ul *dropdownMenu class="dropdown-menu dropdown-menu-right change-address-dropdown" role="menu">
                                                            <li role="menuitem" *ngFor="let address of companyAddressList">
                                                                <a class="dropdown-item" (click)="selectAddress(purchaseOrder.company.billingDetails, address, true)">
                                                                    {{address.address}} {{address.state?.name}} {{ address.taxNumber ? (showGSTINNo ? 'GSTIN: ' : 'TRN: ') + address.taxNumber : "" }}
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </span>
                                            </div>
                                                <div class="billing-address clearfix">
                                                    <textarea name="companyBillingDetailsAddress"
                                                        (keyup)="autoFillShippingDetails('company')"
                                                        [(ngModel)]="purchaseOrder.company.billingDetails.address[0]"
                                                        class="form-control" rows="3" autocomplete="off" autofocus="off"
                                                        aria-autocomplete="none"></textarea>
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-6">
                                                            <label class="sales-country-label">
                                                                {{companyCountryName}}
                                                            </label>
                                                        </div>
                                                        <div class="col-sm-12 col-md-6" #companyBillingState>
                                                            <sales-sh-select [placeholder]="'State'"
                                                                class="select-border-bottom"
                                                                (selected)="fillShippingBillingDetails($event, true, 'company'); autoFillShippingDetails('company')"
                                                                [showBottomBorderOnly]="true"
                                                                [options]="companyStatesSource"
                                                                name="companyBillingDetailsStateCode"
                                                                [disabled]="(purchaseOrder.company.billingDetails.state.code && purchaseOrder.company.billingDetails.gstNumber && purchaseOrder.company.billingDetails.gstNumber.length >= 2) ? true : null"
                                                                [(ngModel)]="purchaseOrder.company.billingDetails.state.code">
                                                            </sales-sh-select>
                                                        </div>
                                                        <div class="col-sm-12"
                                                            *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                            <input maxlength="15" autocomplete="None" type="text"
                                                                name="companyBillingDetailsTax"
                                                                [(ngModel)]="purchaseOrder.company.billingDetails.gstNumber"
                                                                class="form-control input-custom"
                                                                (blur)="autoFillShippingDetails('company')"
                                                                (change)="getStateCode('billingDetails', 'company')"
                                                                placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <!-- endregion -->

                                        <!-- region shipping address -->
                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">

                                            <div class="form-group p-0 width-100">
                                                <div class="d-flex align-items-center pb-1">
                                                    <span class="pd-r15">
                                                        <input type="checkbox" autocomplete="None"
                                                            name="autoFillCompanyShipping"
                                                            [(ngModel)]="autoFillCompanyShipping"
                                                            (change)="autoFillShippingDetails('company')"> Shipping Address
                                                        Same as Billing Address
                                                    </span>
                                                </div>
                                                <div
                                                    [ngClass]="{'billing-address': true, 'disabled': autoFillCompanyShipping}">
                                                    <textarea name="companyShippingDetailsAddress"
                                                        [(ngModel)]="purchaseOrder.company.shippingDetails.address[0]"
                                                        class="form-control" rows="3" autocomplete="off" autofocus="off"
                                                        aria-autocomplete="none"></textarea>
                                                    <div class="clearfix">
                                                        <div class="form-group row">
                                                            <div class="col-sm-12 col-md-6">
                                                                <div class="form-group">
                                                                    <label class="sales-country-label">
                                                                        {{companyCountryName}}
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-12 col-md-6" #companyShippingState>
                                                                <sales-sh-select [placeholder]="'State'"
                                                                    [disabled]="autoFillCompanyShipping"
                                                                    class="select-border-bottom disabled"
                                                                    (selected)="fillShippingBillingDetails($event, false, 'company');"
                                                                    [showBottomBorderOnly]="true"
                                                                    [options]="companyStatesSource"
                                                                    name="companyShippingDetailsStateCode"
                                                                    [disabled]="(purchaseOrder.company.shippingDetails.state.code && purchaseOrder.company.shippingDetails.gstNumber && purchaseOrder.company.shippingDetails.gstNumber.length >= 2) ? true : null"
                                                                    [(ngModel)]="purchaseOrder.company.shippingDetails.state.code">
                                                                </sales-sh-select>
                                                            </div>
                                                            <div class="col-sm-12"
                                                                *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                <input maxLength="15" autocomplete="None" type="text"
                                                                    name="companyShippingDetailsTax"
                                                                    [(ngModel)]="purchaseOrder.company.shippingDetails.gstNumber"
                                                                    class="form-control input-custom"
                                                                    (change)="getStateCode('shippingDetails', 'company')"
                                                                    placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- endregion -->
                                    </div>
                                </div>
                            </section>
                        </div>
                        <!-- endregion -->
                    </div>
                    <div class="row mb-5 height-row">
                        <!-- region customer name -->
                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                            <div>
                                <label>Order #</label>
                            </div>
                        </div>
                        <!-- region customer dropdown -->
                        <div class="select-customer-name order-expected-delivery d-flex col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                            <!-- region if not cashinvoice show customer dropdown -->

                            <div class="col-sm-12 col-md-12 col-lg-6 pl-0">
                                <div>
                                <input type="text" class="form-control" name="purchaseOrderNumber"
                                    [(ngModel)]="purchaseOrder.number" [disabled]="!invoiceSettings?.purchaseBillSettings?.useCustomPONumber || isUpdateMode" placeholder="Enter Order #" />
                                </div>
                            </div>
                            <!-- endregion -->
                            <div class="col-sm-6" *ngIf="!isMobileScreen">
                                <div class="invoice-due-date">
                                <div class="d-flex">
                                    <label>Order Date<span class="red-text">*</span></label>
                                    <input type="text" class="form-control" placeholder="Select Date" [bsConfig]="{ dateInputFormat: giddhDateFormat }" name="purchaseOrderDate" [(ngModel)]="purchaseOrder.voucherDetails.voucherDate" bsDatepicker (ngModelChange)="onUpdateOrderDate()">
                                </div>
                                <div class="d-flex">
                                    <label>Expected Delivery</label>
                                    <input type="text" class="form-control" placeholder="Select Date" [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                        name="purchaseDueDate" [(ngModel)]="purchaseOrder.voucherDetails.dueDate" bsDatepicker (ngModelChange)="onUpdateOrderDate()">
                                </div>
                            </div>
                        </div>
                        </div>
                        <!-- endregion -->
                    </div>
                    <div class="row mt-1" *ngIf="isMobileScreen">
                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                            <label>Order Date</label>
                        </div>
                        <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                            <div class="row">
                            <div class="col-md-10">
                                <input type="text" class="form-control" placeholder="Select Date" [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                    name="purchaseOrderDate" [(ngModel)]="purchaseOrder.voucherDetails.voucherDate" bsDatepicker>
                            </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-1" *ngIf="isMobileScreen">
                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                            <label>Expected Delivery</label>
                        </div>
                        <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                            <div class="row">
                            <div class="col-md-10">
                                <input type="text" class="form-control" placeholder="Select Date" [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                    name="purchaseDueDate" [(ngModel)]="purchaseOrder.voucherDetails.dueDate" bsDatepicker>
                            </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="row mt-1">
                        <div class="col-sm-2" *ngIf="!isMobileScreen">
                            <label></label>
                        </div>
                        <div class="col-sm-7">
                            <input id="reverse-charge" name="rcmEntry" class="checkbox-custom" type="checkbox"
                                [ngModel]="isRcmEntry" (click)="toggleRcmCheckbox($event)">
                            <label #rcmPopup="bs-popover" [popover]="rcmTemplate" container="body" placement="bottom left"
                                containerClass="purchase-invoice-rcm" for="reverse-charge"
                                class="checkbox-custom-label">
                                Is this transaction applicable for reverse charge?
                            </label>
                        </div>
                    </div>
                    <ng-template #rcmTemplate>
                        <confirmation-modal [configuration]="rcmConfiguration"
                            (buttonClicked)="handleRcmChange($event)"></confirmation-modal>
                    </ng-template> -->
                </div>
            </div>
        </div>
    </div>
    <ng-container *ngIf="!purchaseOrder.account.uniqueName">
        <img src="assets/images/new/search-vendor.svg" class="img-responsive search-arrow-image" />
    </ng-container>
    <section *ngIf="!isMobileScreen"
        class="static-purchase-table create-purchase-order-table clearfix mb-2 bg-white container-fluid">
        <table class="table table-custom-invoice  basic">
            <thead>
                <tr>
                    <th *ngFor="let item of theadArrReadOnly;" [hidden]="!item.display"
                        class="thead-sales-invoice" [ngClass]="item.label">
                        {{item.label}} <span *ngIf="item.label === 'Tax' && isRcmEntry">(RCM)<sup class="mandatory-asterisk">*</sup></span>
                    </th>
                </tr>
            </thead>
            <tbody [hidden]="showBulkLoader" (clickOutside)="handleOutsideClick()" [exclude]="'.entries-tr'">
                <ng-container #itemsContainer></ng-container>
            </tbody>
            <tbody *ngIf="showBulkLoader">
                <tr>
                    <td colspan="8">
                        <div class="col-12 no-data mr-t2 loader-main">
                            <div class="spinner2">
                                <div class="cube1"></div>
                                <div class="cube2"></div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
            <ng-template #entry let-entry let-entryIdx="entryIdx" let-transaction="transaction">
                <!-- <ng-container *ngFor="let transaction of entry.transactions;"> -->
                    <tr (click)="setActiveIndex(entryIdx);$event.stopPropagation()" *ngIf="activeIndex !== entryIdx"
                        class="entries-tr set-active"
                        [ngClass]="{'is-other-tax' : entry.isOtherTaxApplicable && isMulticurrencyAccount}">
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="product-name">
                                <label *ngIf="!transaction.accountName" class="select-account-label">Click to
                                    Select
                                    Account</label> {{transaction.accountName}}
                                <span
                                    *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}})</span>
                            </div>
                            <div class="description">
                                {{transaction.description}}
                            </div>
                            <p class="small text-muted sku-and-custom-fields" *ngIf="transaction.sku_and_customfields">
                                {{transaction.sku_and_customfields}}</p>
                            <div class="date-hsn-code">
                                <div>
                                    <div class="col-xs-12" *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                        <div class="hsn-code">
                                            <label>HSN/SAC:</label>
                                            <span class="d-flex justify-content-end">
                                                {{(inventorySettings?.manageInventory || !transaction.sacNumberExists) ? transaction.hsnNumber : transaction.sacNumber}}
                                                <span class="edit-icon cp">
                                                    <img src="assets/images/edit-pencilicon.svg">
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-right stock-unit">
                            <div class="wrap-td-data">
                                {{transaction.quantity}} {{transaction.stockUnit}}
                            </div>
                        </td>
                        <td class="text-right tra-rate item-rate">
                            <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                <div class="td-wrapper">
                                    <div>
                                        <div class="wrap-td-data">
                                            <!-- <span
                                                *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                                {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                                {{transaction.rate | giddhCurrency: ratePrecision:true}} -->
                                                <span class="d-flex justify-content-end">
                                                    <amount-field [amount]="transaction.rate"
                                                        [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                        [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currency?.code : false" [ratePrecision]="true">
                                                    </amount-field>
                                                </span>
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="isMulticurrencyAccount && isMultiCurrencySupported" class="differ-currency">
                                    <!-- <span>{{baseCurrencySymbol}}</span>
                                    <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span> -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0)"
                                            [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency" [ratePrecision]="true">
                                        </amount-field>
                                    </span>

                                </div>
                            </div>
                        </td>
                        <td class="text-right item-amount">
                            <div class="td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <!-- <span
                                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                            {{transaction.amount | giddhCurrency}} -->
                                            <span class="d-flex justify-content-end">
                                                <amount-field [amount]="transaction.amount"
                                                    [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currency?.code : false">
                                                </amount-field>
                                            </span>
                                    </div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                <!-- <span>{{baseCurrencySymbol}}</span>
                                <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span> -->

                                <span class="d-flex justify-content-end">
                                    <amount-field [amount]="(transaction.amount * exchangeRate || 0)"
                                        [currencySymbol]="baseCurrencySymbol"
                                        [currencyCode]="companyCurrency">
                                    </amount-field>
                                </span>
                            </div>
                        </td>
                        <td class="item-discount">
                            <div class=" text-right td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <!-- <span
                                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>{{ entry.discountSum | giddhCurrency}} -->
                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="entry.discountSum"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currency?.code : false">
                                            </amount-field>
                                        </span>

                                    </div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                <!-- <span>{{baseCurrencySymbol}}</span>
                                <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span> -->

                                <span class="d-flex justify-content-end">
                                    <amount-field [amount]="entry.discountSum * exchangeRate"
                                        [currencySymbol]="baseCurrencySymbol"
                                        [currencyCode]="companyCurrency">
                                    </amount-field>
                                </span>

                            </div>
                        </td>
                        <td [class.error-box]="transaction.requiredTax" class="text-right item-tax"
                            (focus)="transaction.requiredTax = false;">
                            <div class="td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <!-- <span
                                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>{{(entry.taxSum + entry.cessSum) | giddhCurrency}} -->
                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="entry.taxSum + entry.cessSum"
                                            [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currency?.code: false">
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                <!-- <span>{{baseCurrencySymbol}}</span>
                                <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span> -->

                                <span class="d-flex justify-content-end">
                                    <amount-field [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                        [currencySymbol]="baseCurrencySymbol"
                                        [currencyCode]="companyCurrency">
                                    </amount-field>
                                </span>
                            </div>
                        </td>
                        <td class="text-right item-tax delete-btn-absolute">
                            <div class="td-wrapper">
                                <div>
                                    <div class="wrap-td-data">
                                        <span>
                                            <!-- <span
                                                *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                                {{purchaseOrder.accountDetails.currencySymbol}}
                                            </span>{{transaction.total | giddhCurrency}} -->
                                            <span class="d-flex justify-content-end">
                                                <amount-field [amount]="transaction.total"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currency?.code:false">
                                                </amount-field>
                                            </span>
                                        </span>
                                        <br>
                                        <span *ngIf="entry.isOtherTaxApplicable">
                                            {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                            <!-- <span
                                                *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                                {{purchaseOrder.accountDetails.currencySymbol}}
                                            </span>{{ entry.otherTaxSum }} -->
                                            <span class="d-flex justify-content-end">
                                                <amount-field [amount]="entry.otherTaxSum"
                                                    [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currency?.code: false">
                                                </amount-field>
                                            </span>
                                        </span>
                                    </div>
                                    <div class="tax-in-currency"
                                        *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && isMultiCurrencySupported">
                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span> -->

                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="entry.otherTaxSum * exchangeRate"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>
                                </div>

                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                    <!-- <span>{{baseCurrencySymbol}}</span>
                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span> -->
                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="transaction.total * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency">
                                        </amount-field>
                                    </span>

                                </div>
                            </div>

                            <div class="trash-icon-delete" (click)="removeTransaction(entryIdx);$event.preventDefault();$event.stopPropagation()">
                                <span class="cp">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </span>
                            </div>
                        </td>
                    </tr>

                    <!-- endregion -->

                    <!-- region dynamic entries-->
                    <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature)-->
                    <tr *ngIf="activeIndex === entryIdx" class="entries-tr default-active"
                        (click)="$event.stopPropagation();">
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="product-name">
                                <div class="ng-select-wrap">
                                    <sh-select [options]="salesAccounts$ | async" #selectAccount
                                        [(ngModel)]="transaction.fakeAccForSelect2"
                                        name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                        (selected)="onSelectSalesAccount($event, transaction, entry, false, entryIdx)"
                                        [placeholder]="'Select A/c'" [notFoundLink]="true"
                                        [isPaginationEnabled]="true" (scrollEnd)="handleScrollEnd('item')"
                                        (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'item')"
                                        (onHide)="noResultsFoundLabel = 'Type to search a/c'"
                                        [notFoundMsg]="noResultsFoundLabel" [enableDynamicSearch]="true"
                                        [fixedValue]="(transaction.stockDetails && transaction.stockDetails.name) ? transaction.accountName+' ('+transaction.stockDetails?.name+')' : transaction.accountName"
                                        [forceClearReactive]="forceClear$ | async"
                                        [multiple]="false"
                                        (noResultsClicked)="onNoResultsClicked(entryIdx)"
                                        [ItemHeight]="67" (onClear)="onClearSalesAccount(transaction)"
                                        [useInBuiltFilterForFlattenAc]="true">

                                        <ng-template #optionTemplate let-option="option">
                                            <ng-container *ngIf="!option.additional?.stock">
                                                <a href="javascript:void(0)" class="list-item flex-column">
                                                    <div class="item">{{ option.label }}</div>
                                                    <div class="item-unique">
                                                        {{ option.additional?.uniqueName }}</div>
                                                </a>
                                            </ng-container>
                                            <ng-container *ngIf="option.additional?.stock">
                                                <a href="javascript:void(0)" class="list-item flex-column">
                                                    <div class="item">{{ option.label }}</div>
                                                    <div class="item-unique">
                                                        {{ option.additional?.uniqueName }}</div>
                                                    <div class="item-stock">Stock:
                                                        {{ option.additional?.stock.uniqueName }}</div>
                                                </a>
                                            </ng-container>
                                        </ng-template>
                                    </sh-select>
                                </div>
                            </div>

                            <div *ngIf="transaction.fakeAccForSelect2">
                                <div class="description mt-1">
                                    <textarea type="text" placeholder="Add Description"
                                        name="transaction.description_{{entryIdx}}" class="form-control"
                                        [(ngModel)]="transaction.description" #description></textarea>
                                    <p class="small text-muted sku-and-custom-fields"
                                        *ngIf="transaction.sku_and_customfields">
                                        {{transaction.sku_and_customfields}}</p>
                                </div>

                                <!-- region entry date/ hsncode -->
                                <div class="date-hsn-code">
                                    <div>
                                        <div class="col-xs-12">
                                            <div class="wrap-hsn-box">
                                                <div class="hsn-code"
                                                    (click)="toggleHsnSacDropDown(transaction)">
                                                    <label>HSN/SAC:</label>
                                                    <span>
                                                        {{(inventorySettings?.manageInventory || !transaction.sacNumber) ? transaction.hsnNumber : transaction.sacNumber }}
                                                        <span *ngIf="!transaction.hsnNumber && !transaction.sacNumber"
                                                            class="update-text">Update
                                                        </span>
                                                        <span class="edit-icon cp">
                                                            <img src="assets/images/edit-pencilicon.svg">
                                                        </span>
                                                    </span>
                                                </div>

                                                <div class="hsn-code-dropdown" *ngIf="hsnSacDropdownShow">
                                                    <label>HSN/SAC</label>
                                                    <input type="text" maxLength="10" placeholder="HSN/SAC Number"
                                                        name="transaction.hsnNumber_{{entryIdx}}"
                                                        *ngIf="(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                        [(ngModel)]="transaction.hsnNumber" />
                                                    <input type="text" maxLength="10" placeholder="HSN/SAC Number"
                                                        name="transaction.hsnNumber_{{entryIdx}}"
                                                        *ngIf="!(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                        [(ngModel)]="transaction.sacNumber" />
                                                    <a>
                                                    </a>
                                                    <div class="btn-group m-t-10">
                                                        <button class="btn btn-sm btn-success" type="button"
                                                            (click)="hsnSacDropdownShow=!hsnSacDropdownShow">Save
                                                        </button>
                                                        <button class="btn btn-sm btn-primary" type="button"
                                                            (click)="hideHsnSacEditPopup(transaction)">
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!-- endregion -->
                            </div>
                        </td>

                        <td class="text-right stock-unit">
                            <input type="text" [disabled]="!transaction.isStockTxn"
                                (blur)="handleQuantityBlur(entry, transaction);" placeholder="Quantity"
                                decimalDigitsDirective name="transaction.quantity_{{entryIdx}}"
                                class="form-control text-right" [(ngModel)]="transaction.quantity" />

                            <select class="form-control" [disabled]="!transaction.isStockTxn"
                                name="transaction.stockUnit_{{entryIdx}}" [(ngModel)]="transaction.stockUnit"
                                (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">
                                    {{stock.text}}
                                </option>
                            </select>
                        </td>

                        <td class="text-right item-rate">
                            <div class="td-wrapper">
                                <div>
                                    <input type="text" [disabled]="!transaction.isStockTxn"
                                        (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                        placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                        class="form-control transaction-rate text-right" [(ngModel)]="transaction.rate"
                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                        [customDecimalPlaces]="highPrecisionRate" />
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                    <!-- <span>{{baseCurrencySymbol}}</span>
                                    <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span> -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0)" [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency" [ratePrecision]="true">
                                        </amount-field>
                                    </span>

                                </div>
                            </div>
                        </td>

                        <td class="text-right item-amount">
                            <div class="td-wrapper">
                                <div>
                                    <input type="text" (blur)="calculateWhenTrxAltered(entry, transaction, true)"
                                        (click)="transactionAmountClicked(transaction)" placeholder="Amount"
                                        name="transaction.amount_{{entryIdx}}" class="form-control text-right"
                                        [(ngModel)]="transaction.amount" decimalDigitsDirective
                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                    <!-- <span>{{baseCurrencySymbol}}</span>
                                    <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span> -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="(transaction.amount * exchangeRate || 0)"
                                            [currencySymbol]="baseCurrencySymbol" [currencyCode]="companyCurrency">
                                        </amount-field>
                                    </span>

                                </div>
                            </div>
                        </td>

                        <td class="item-discount">
                            <div class="td-wrapper">
                                <div class="text-right">
                                    <discount-control-component #discountComponent [discountMenu]="false"
                                        [discountAccountsDetails]="entry.discounts" [discountSum]="entry.discountSum"
                                        [showHeaderText]="false" (hideOtherPopups)="closeTaxControlPopup()"
                                        (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                        [maskInput]="inputMaskFormat"
                                        [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffixInput]="selectedSuffixForCurrency">
                                    </discount-control-component>
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                    <!-- <span>{{baseCurrencySymbol}}</span>
                                    <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span> -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="entry.discountSum * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency">
                                        </amount-field>
                                    </span>

                                </div>
                            </div>
                        </td>

                        <td class="position-relative dropdown-container item-tax">
                            <div class="td-wrapper">
                                <div class="text-right">
                                    <tax-control [taxes]="companyTaxesList" [date]="purchaseOrder.voucherDetails.voucherDate"
                                        [taxRenderData]="entry.taxes" [totalForTax]="transaction.taxableValue"
                                        [applicableTaxes]="transaction.applicableTaxes"
                                        [exceptTaxTypes]="exceptTaxTypes"
                                        [allowedSelectionOfAType]="allowedSelectionOfAType" [showHeading]="false"
                                        [rootClass]="'sales-invoice-table'" (selectedTaxEvent)="transaction.applicableTaxes = $event"
                                        (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                        (hideOtherPopups)="closeDiscountPopup()" [maskInput]="inputMaskFormat"
                                        [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffixInput]="selectedSuffixForCurrency">
                                    </tax-control>
                                </div>

                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                    <!-- <span>{{baseCurrencySymbol}}</span>
                                    <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span> -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="(entry.taxSum + entry.cessSum) * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency">
                                        </amount-field>
                                    </span>

                                </div>
                            </div>
                        </td>

                        <td class="text-right item-total delete-btn-absolute">
                            <div class="td-wrapper">

                                <div>
                                    <input type="text" name="transaction.total_{{entryIdx}}"
                                        class="form-control text-right" [(ngModel)]="transaction.total"
                                        decimalDigitsDirective [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                        (blur)="calculateTransactionValueInclusively(entry, transaction)" />

                                    <div *ngIf="isTcsTdsApplicable" class="wrap-other-tax">
                                        <input type="checkbox" class="other-taxes-checkbox"
                                            [(ngModel)]="entry.isOtherTaxApplicable" *ngIf="!entry.isOtherTaxApplicable"
                                            (click)="tcsTdsIndex = entryIdx"
                                            name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                            id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                            (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                        <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                            *ngIf="!entry.isOtherTaxApplicable" class="other-tax-label">Other Tax?</label>
                                    </div>
                                    <div *ngIf="entry.isOtherTaxApplicable" class="mr-t1">

                                        <span>

                                            <div>
                                                <span class="mr-5">
                                                    <a href="javascript: void 0"
                                                        (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                        <img src="assets/images/edit-pencilicon.svg">
                                                    </a>
                                                </span>
                                                <input class="text-right form-control other-taxes-input"
                                                    disabled="disabled" [(ngModel)]="entry.otherTaxSum"
                                                    [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                    name="entry.otherTaxesSum_{{entryIdx}}" />
                                            </div>

                                            <p>
                                                {{ entry.otherTaxModal?.appliedOtherTax?.name}}</p>
                                        </span>

                                    </div>
                                </div>
                                <div *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && isMultiCurrencySupported"
                                    class="tax-in-currency">
                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                    <!-- <span>{{baseCurrencySymbol}}</span> :
                                    <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span> -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="entry.otherTaxSum * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency">
                                        </amount-field>
                                    </span>

                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                    <!-- <span>{{baseCurrencySymbol}}</span>
                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span> -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="transaction.total * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency">
                                        </amount-field>
                                    </span>

                                </div>


                                <ng-container *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                </ng-container>

                            </div>

                            <div class="trash-icon-delete" (click)="removeTransaction(entryIdx);$event.preventDefault();$event.stopPropagation()">
                                <span class="cp">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </span>
                            </div>
                        </td>
                    </tr>
                    <!-- endregion -->
                <!-- </ng-container> -->
            </ng-template>
            <!-- region add bulk items -->
            <div class="p-1 aqua-color add-line-bulk-item">
                <a href="javascript:void 0" (click)="addBlankRow(null)">+ Add New Line</a>
                <span class="font-14"> | </span>
                <a (click)="bulkItemsModal.show()" href="javascript:void(0)">+ Add
                    Bulk
                    Entries</a>
            </div>
            <!-- endregion -->
            <tfoot>
                <tr>
                    <td colspan="4">
                        <!-- region other details-->
                        <div>
                            <div class="collapse-pane clearfix">

                                <div class="collapse-pane-heading"
                                (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                                    <div class="ico-box-wrap">
                                        <div class="ico-box">
                                            <span aria-hidden="true" [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"></span>
                                        </div>
                                    </div>
                                    <div class="ico-head">Other Details</div>
                                </div>
                                <div [collapse]="isOthrDtlCollapsed" class="clearfix max-width-600 pd-l3 m-0">
                                    <div class="row">
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                <giddh-datepicker #shippingDate="ngModel" placeholder="Ship Date" name="shippingDate"
                                                    [(ngModel)]="purchaseOrder.templateDetails.other.shippingDate" [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                </giddh-datepicker>
                                            <p class="text-danger"
                                                *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                Invalid Date
                                            </p>
                                        </div>
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <input type="text" name="shippedVia"
                                                [(ngModel)]="purchaseOrder.templateDetails.other.shippedVia"
                                                class="form-control" [placeholder]="'Ship Via'" />
                                        </div>
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <input type="text" name="trackingNumber"
                                                [(ngModel)]="purchaseOrder.templateDetails.other.trackingNumber"
                                                class="form-control" [placeholder]="'Tracking No.'" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- endregion -->
                        <!-- region note/messages -->
                        <div class="pt-1 pl-0 max-width-600">
                            <label class="mr-b1">Note</label>
                            <textarea class="form-control" name="message2"
                                [(ngModel)]="purchaseOrder.templateDetails.other.message2"></textarea>
                        </div>
                        <!-- endregion -->
                    </td>
                    <!-- region total section -->
                    <td colspan="4">
                        <section class="table-section form-group">
                            <div class="table-row">
                                <div class="table-cell">Total Amount</div>
                                <div class="table-cell figure-cell">
                                    <!-- <span
                                        *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                        {{purchaseOrder.voucherDetails.subTotal | giddhCurrency}} -->

                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="purchaseOrder.voucherDetails.subTotal"
                                            [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol :false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                            </amount-field>
                                        </span>
                                </div>
                            </div>

                            <div class="table-row">
                                <div class="table-cell">Discount</div>

                                <div class="table-cell figure-cell">
                                    <!-- <span
                                        *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                        {{purchaseOrder.voucherDetails.totalDiscount * -1 | giddhCurrency}} -->

                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="purchaseOrder.voucherDetails.totalDiscount * -1"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code : false">
                                            </amount-field>
                                        </span>
                                </div>
                            </div>

                            <div class="table-row">
                                <div class="table-cell">Taxable Value</div>
                                <div class="table-cell figure-cell">
                                    <!-- <span
                                        *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                        {{purchaseOrder.voucherDetails.totalTaxableValue | giddhCurrency}} -->

                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="purchaseOrder.voucherDetails.totalTaxableValue"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol :false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                            </amount-field>
                                        </span>

                                </div>
                            </div>

                            <div class="table-row" *ngIf="!excludeTax">
                                <div class="table-cell">Tax</div>
                                <div class="table-cell figure-cell">
                                    <!-- <span
                                        *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.gstTaxesTotal | giddhCurrency}} -->

                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="purchaseOrder.voucherDetails.gstTaxesTotal"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol :false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                            </amount-field>
                                        </span>

                                </div>
                            </div>

                            <div class="table-row" *ngIf="!excludeTax">
                                <div class="table-cell">CESS</div>
                                <div class="table-cell figure-cell">
                                    <!-- <span
                                        *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.cessTotal | giddhCurrency}} -->

                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="purchaseOrder.voucherDetails.cessTotal"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol :false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                            </amount-field>
                                        </span>
                                </div>
                            </div>
                            <div class="table-row"
                                *ngIf="(calculatedRoundOff > 0 || calculatedRoundOff < 0)">

                                <div class="table-cell">
                                    <strong>Round Off</strong>
                                </div>

                                <div class="table-cell figure-cell">
                                    <strong>
                                        <!-- <span
                                            *ngIf="isMulticurrencyAccount">{{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>
                                        {{calculatedRoundOff | giddhCurrency}} -->
                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="calculatedRoundOff"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported ) ? purchaseOrder.accountDetails?.currency?.code : false">
                                            </amount-field>
                                        </span>
                                    </strong>

                                </div>

                            </div>

                            <div class="table-row">

                                <div class="table-cell bigger-dollar">
                                    <strong>Total
                                        <span
                                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>
                                        </strong>
                                </div>

                                <div class="table-cell figure-cell">
                                    <strong>
                                        <!-- <span
                                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                            {{purchaseOrder.voucherDetails.grandTotal | giddhCurrency}} -->

                                            <span class="d-flex justify-content-end">
                                                <amount-field [amount]="purchaseOrder.voucherDetails.grandTotal"
                                                    [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol :false"
                                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code : false">
                                                </amount-field>

                                            </span>
                                    </strong>
                                </div>

                            </div>
                            <!-- multicurrency feature (editable grand total make it functional) -->
                            <div class="table-row" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                <div class="table-cell bigger-dollar">
                                    <strong>Total <span>{{baseCurrencySymbol}}</span>
                                    </strong>
                                </div>

                                <div class="table-cell figure-cell">
                                    <input #grandTotalInr type="text" class="form-control" name="grandTotalMulDum"
                                        [prefix]="baseCurrencySymbol" [suffix]="selectedSuffixForCurrency"
                                        [mask]="inputMaskFormat" [(ngModel)]="grandTotalMulDum"
                                        (blur)="updateExchangeRate(grandTotalInr.value)">
                                </div>
                            </div>

                            <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tcsTotal > 0">
                                <div class="table-cell">TCS</div>
                                <div class="table-cell figure-cell">
                                    <!-- <span
                                        *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}
                                    </span>
                                    {{purchaseOrder.voucherDetails.tcsTotal | giddhCurrency}} -->

                                    <span class="d-flex justify-content-end">
                                        <amount-field [amount]="purchaseOrder.voucherDetails.tcsTotal"
                                            [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol :false"
                                            [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code:false">
                                        </amount-field>
                                    </span>

                                </div>
                            </div>

                            <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tdsTotal > 0">
                                <div class="table-cell">TDS</div>
                                <div class="table-cell figure-cell">
                                    <!-- <span
                                        *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.tdsTotal | giddhCurrency}} -->

                                        <span class="d-flex justify-content-end">
                                            <amount-field [amount]="purchaseOrder.voucherDetails.tdsTotal "
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code : false">
                                            </amount-field>
                                        </span>
                                </div>
                            </div>
                        </section>
                    </td>
                    <!-- endregion -->
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </section>
    <!-- region mobile view -->
    <div class="show-in-mobile" *ngIf="isMobileScreen">
        <div class="card-invoice-table-wrapper"
            *ngFor="let entry of purchaseOrder.entries; let entryIdx = index;">
            <ng-container *ngFor="let transaction of entry.transactions;">
                <div class="card-invoice-table" [hidden]="activeIndex === entryIdx">
                    <div class="row">
                        <div class="col-12">
                            <div class="single-card-row">
                                <div class="product-name">
                                    <label class="card-label">Product/Service Description</label>
                                    <label *ngIf="!transaction.accountName" class="select-account-label">Click
                                        to Select
                                        Account</label>
                                    <p>{{transaction.accountName}}</p>
                                    <span
                                        *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}})</span>
                                </div>

                                <p class="description">
                                    {{transaction.description}}
                                </p>
                                <p class="small text-muted sku-custom-fields" *ngIf="transaction.sku_and_customfields">
                                    {{transaction.sku_and_customfields}}</p>

                                <div class="date-hsn-code pr-0">
                                    <div class="row">
                                        <div class="col-12"
                                            *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                            <div class="hsn-code text-right">
                                                <label>HSN/SAC:
                                                    {{(inventorySettings?.manageInventory || !transaction.sacNumberExists) ? transaction.hsnNumber : transaction.sacNumber}}</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="single-card-row">
                                <div class="qty-unit">
                                    <label class="card-label">Qty/Unit</label>
                                    <p>{{transaction.quantity}} {{transaction.stockUnit}}</p>
                                </div>
                            </div>

                        </div>

                        <div class="col-6">
                            <div class="single-card-row">
                                <div class="card-rate">
                                    <label class="card-label">Rate</label>
                                    <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                         <p>
                                            <!-- <span *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                                {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                            {{transaction.rate | giddhCurrency: ratePrecision:true}} -->

                                            <span>
                                                <amount-field [amount]="transaction.rate"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false" [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code : false" [ratePrecision]="true">
                                                </amount-field>
                                            </span>

                                        </p>
                                        <div *ngIf="isMulticurrencyAccount && isMultiCurrencySupported"
                                            class="differ-currency">
                                            <!-- <span>{{baseCurrencySymbol}}</span>
                                            <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span> -->

                                            <span>
                                                <amount-field [amount]="((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0)"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency" [ratePrecision]="true">
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="single-card-row">
                                <div class="card-amount">
                                    <label class="card-label">Amount</label>
                                     <p>
                                        <!-- <span
                                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>{{transaction.amount | giddhCurrency}} -->

                                    <span>
                                        <amount-field [amount]="transaction.amount"
                                            [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                            [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code : false">
                                        </amount-field>
                                    </span>

                                    </p>

                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="(transaction.amount * exchangeRate || 0)"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="single-card-row">
                                <div class="card-discount">
                                    <label class="card-label">Discount</label>
                                    <p>
                                        <!-- <span *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>{{ entry.discountSum }} -->

                                            <span>
                                                <amount-field [amount]="entry.discountSum" [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code:false">
                                                </amount-field>
                                            </span>
                                    </p>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="entry.discountSum * exchangeRate"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="single-card-row">
                                <div class="card-tax">
                                    <label class="card-label">Tax</label>
                                    <p>
                                        <!-- <span *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                            {{entry.taxSum}} % -->

                                            <span>
                                                <amount-field [amount]="entry.taxSum" [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code : false">
                                                </amount-field>
                                            </span>
                                    </p>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="single-card-row">
                                <div class="card-total">
                                    <label class="card-label">Total</label>
                                    <p>
                                        <!-- <span *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>{{transaction.total | giddhCurrency}} -->

                                        <span>
                                            <amount-field [amount]="transaction.total"
                                                [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                            </amount-field>
                                        </span>

                                    </p>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{transaction.total * exchangeRate | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="transaction.total * exchangeRate"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="edit-card" (click)="setActiveIndex(entryIdx);$event.stopPropagation()">
                        <img src="assets/images/edit-pencilicon.svg">
                    </div>
                    <div class="del-card" (click)="removeTransaction(entryIdx);$event.preventDefault();$event.stopPropagation()">
                        <i class="icon-trash" aria-hidden="true"></i>
                    </div>
                </div>
                <!-- endregion -->

                <!-- region dynamic entry -->
                <div class="card-invoice-table edit-card-invoice-table" [hidden]="activeIndex !== entryIdx">
                    <div class="row">
                        <div class="col-12">
                            <div class="single-card-row">
                                <div class="product-name">
                                    <label class="card-label">Product/Service Description</label>
                                    <div class="product-name">
                                        <div class="ng-select-wrap">
                                            <sh-select [options]="salesAccounts$ | async"
                                                [(ngModel)]="transaction.fakeAccForSelect2"
                                                name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                                (selected)="onSelectSalesAccount($event,transaction, entry, false, entryIdx)"
                                                [placeholder]="'Select A/cc'" [notFoundLink]="true"
                                                [forceClearReactive]="forceClear$ | async"
                                                [multiple]="false"
                                                [ItemHeight]="67" (onClear)="onClearSalesAccount(transaction)"
                                                [useInBuiltFilterForFlattenAc]="true">

                                                <ng-template #optionTemplate let-option="option">
                                                    <ng-container *ngIf="!option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item flex-column">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item-unique">
                                                                {{ option.additional?.uniqueName }}</div>
                                                        </a>
                                                    </ng-container>
                                                    <ng-container *ngIf="option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item flex-column">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item-unique">
                                                                {{ option.additional?.uniqueName }}</div>
                                                            <div class="item-stock">Stock:
                                                                {{ option.additional?.stock.uniqueName }}
                                                            </div>
                                                        </a>
                                                    </ng-container>
                                                </ng-template>
                                            </sh-select>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="description mt-1">
                                            <textarea type="text" placeholder="Add Description"
                                                name="transaction.description_{{entryIdx}}" class="form-control"
                                                [(ngModel)]="transaction.description"></textarea>
                                            <p class="small text-muted sku-custom-fields"
                                                *ngIf="transaction.sku_and_customfields">
                                                {{transaction.sku_and_customfields}}</p>
                                        </div>

                                        <!-- region entry date/ hsncode -->
                                        <div class="date-hsn-code">
                                            <div class="row">
                                                <div class="col-xs-12 pl-0">
                                                    <div class="wrap-hsn-box">
                                                        <div class="hsn-code text-right"  (click)="toggleHsnSacDropDown(transaction)">
                                                            <label>HSN/SAC:</label>
                                                            <span>
                                                                {{(inventorySettings?.manageInventory || !transaction.sacNumber) ? transaction.hsnNumber : transaction.sacNumber }}
                                                                <span
                                                                    *ngIf="!transaction.hsnNumber && !transaction.sacNumber"
                                                                    class="update-text">Update
                                                                </span>
                                                                <span class="edit-icon cp">
                                                                    <img src="assets/images/edit-pencilicon.svg">
                                                                </span>
                                                            </span>
                                                        </div>
                                                        <div class="hsn-code-dropdown" *ngIf="hsnSacDropdownShow">
                                                            <label>HSN/SAC</label>
                                                            <input type="text" maxLength="10"
                                                                placeholder="HSN/SAC Number"
                                                                name="transaction.hsnNumber_{{entryIdx}}"
                                                                *ngIf="(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                [(ngModel)]="transaction.hsnNumber" />
                                                            <input type="text" maxLength="10"
                                                                placeholder="HSN/SAC Number"
                                                                name="transaction.hsnNumber_{{entryIdx}}"
                                                                *ngIf="!(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                [(ngModel)]="transaction.sacNumber" />
                                                            <a>
                                                            </a>
                                                            <div class="btn-group m-t-10">
                                                                <button class="btn btn-sm btn-success" type="button"
                                                                    (click)="hsnSacDropdownShow=!hsnSacDropdownShow">
                                                                    Save
                                                                </button>
                                                                <button class="btn btn-sm btn-primary" type="button"
                                                                    (click)="hideHsnSacEditPopup(transaction)">
                                                                    Cancel
                                                                </button>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <!-- endregion -->
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row quantity-unit-width-100">
                        <div class="col-6">

                            <div class="single-card-row">
                                <div class="qty-unit">

                                    <div class="row">

                                        <div class="col-6 pr-0">
                                            <label class="card-label text-right">Qty</label>
                                            <input type="text" [disabled]="!transaction.isStockTxn"
                                                (blur)="handleQuantityBlur(entry, transaction);" placeholder="Quantity"
                                                decimalDigitsDirective name="transaction.quantity_{{entryIdx}}"
                                                class="form-control text-right" [(ngModel)]="transaction.quantity" />
                                        </div>
                                        <div class="col-6">
                                            <label class="card-label text-right">Unit</label>
                                            <select class="form-control" [disabled]="!transaction.isStockTxn"
                                                name="transaction.stockUnit_{{entryIdx}}"
                                                [(ngModel)]="transaction.stockUnit"
                                                (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                                <option *ngFor="let stock of transaction.stockList"
                                                    [ngValue]="stock.id">
                                                    {{stock.text}}
                                                </option>
                                            </select>

                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>

                        <div class="col-6">

                            <div class="single-card-row">

                                <div class="card-rate">
                                    <label class="card-label text-right">Rate</label>
                                    <div>
                                        <input type="text" [disabled]="!transaction.isStockTxn"
                                            (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                            placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                            class="form-control transaction-rate text-right"
                                            [(ngModel)]="transaction.rate"
                                            [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                            [customDecimalPlaces]="highPrecisionRate" />
                                    </div>
                                    <!-- please add condition for show and hide -->
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span> -->

                                        <span>
                                            <amount-field [amount]="((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0)" [currencySymbol]="baseCurrencySymbol"
                                            [currencyCode]="companyCurrency" [ratePrecision]="true">
                                            </amount-field>
                                        </span>

                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                    <div class="row">

                        <div class="col-6">

                            <div class="single-card-row">

                                <div class="card-amount">

                                    <label class="card-label text-right">Amount</label>
                                    <div>
                                        <input type="tel" (blur)="calculateWhenTrxAltered(entry, transaction, true)"
                                            (click)="transactionAmountClicked(transaction)" placeholder="Amount"
                                            name="transaction.amount_{{entryIdx}}" class="form-control text-right"
                                            [(ngModel)]="transaction.amount" decimalDigitsDirective
                                            [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="(transaction.amount * exchangeRate || 0)"
                                                [currencySymbol]="baseCurrencySymbol" [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="col-6">

                            <div class="single-card-row">

                                <div class="card-discount">
                                    <label class="card-label text-right">Discount</label>
                                    <div class="text-right">

                                        <discount-control-component #discountComponent [discountMenu]="false"
                                            [discountAccountsDetails]="entry.discounts"
                                            [discountSum]="entry.discountSum" [showHeaderText]="false"
                                            (hideOtherPopups)="closeTaxControlPopup()"
                                            (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                            [maskInput]="inputMaskFormat"
                                            [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffixInput]="selectedSuffixForCurrency">
                                        </discount-control-component>

                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="entry.discountSum * exchangeRate " [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="row">

                        <div class="col-6">

                            <div class="single-card-row">
                                <div class="card-tax">
                                    <label class="card-label text-right">Tax</label>

                                    <div class="text-right">
                                        <tax-control [taxes]="companyTaxesList" [date]="purchaseOrder.voucherDetails.voucherDate"
                                            [taxRenderData]="entry.taxes" [totalForTax]="transaction.taxableValue"
                                            [applicableTaxes]="transaction.applicableTaxes"
                                            [exceptTaxTypes]="exceptTaxTypes"
                                            [allowedSelectionOfAType]="allowedSelectionOfAType" [showHeading]="false"
                                            [rootClass]="'sales-invoice-table'" (selectedTaxEvent)="transaction.applicableTaxes = $event"
                                            (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                            (hideOtherPopups)="closeDiscountPopup()" [maskInput]="inputMaskFormat"
                                            [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffixInput]="selectedSuffixForCurrency">
                                        </tax-control>
                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="(entry.taxSum + entry.cessSum) * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="single-card-row">
                                <div class="card-total">
                                    <label class="card-label text-right">Total</label>
                                    <div>
                                        <input type="tel" name="transaction.total_{{entryIdx}}"
                                            class="form-control text-right"
                                            (blur)="calculateTransactionValueInclusively(entry, transaction)"
                                            [(ngModel)]="transaction.total" decimalDigitsDirective
                                            [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                        <div class="wrap-other-tax" *ngIf="isTcsTdsApplicable">
                                            <input type="checkbox" class="other-taxes-checkbox"
                                                [(ngModel)]="entry.isOtherTaxApplicable"
                                                *ngIf="!entry.isOtherTaxApplicable"
                                                (click)="tcsTdsIndex = entryIdx"
                                                name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                            <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                *ngIf="!entry.isOtherTaxApplicable" class="other-tax-label">Other
                                                Tax?</label>
                                        </div>
                                        <div class="mt-1 other-taxes" *ngIf="entry.isOtherTaxApplicable">

                                            <span>

                                                <div class="d-flex align-items-center">
                                                    <span class="mr-r05">
                                                        <a href="javascript:;"
                                                            (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                            <img src="assets/images/edit-pencilicon.svg">
                                                        </a>
                                                    </span>

                                                    <input class="text-right form-control other-taxes-input"
                                                        disabled="disabled" [(ngModel)]="entry.otherTaxSum"
                                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                        name="entry.otherTaxesSum_{{entryIdx}}" />
                                                </div>

                                                <p class="applicable-tax">
                                                    {{ entry.otherTaxModal?.appliedOtherTax?.name}}
                                                </p>
                                            </span>

                                        </div>
                                    </div>
                                    <div class="tax-in-currency text-right"
                                        *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                        <span>{{baseCurrencySymbol}}</span> :
                                        <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="entry.otherTaxSum * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                                        <!-- <span>{{baseCurrencySymbol}}</span>
                                        <span>{{transaction.total * exchangeRate | giddhCurrency}}</span> -->

                                        <span>
                                            <amount-field [amount]="transaction.total * exchangeRate" [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency">
                                            </amount-field>
                                        </span>

                                    </div>

                                    <ng-container *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="save-card-data pointer" (click)="handleOutsideClick()">
                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                    </div>
                    <div class="del-card pointer" (click)="removeTransaction(entryIdx);$event.preventDefault();$event.stopPropagation()">
                        <i class="icon-trash" aria-hidden="true"></i>
                    </div>

                </div>
                <!-- endregion -->
            </ng-container>

        </div>
        <div class="add-btn" (click)="addBlankRow(null)">
            <button class="btn btn-sm btn-success">Add More</button>
        </div>

        <div class="other-detail-card">
            <div>
                <div class="collapse-pane clearfix">
                    <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                        <div class="ico-box-wrap">
                            <div class="ico-box">
                                <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                    aria-hidden="true"></span>
                            </div>
                        </div>
                        <div class="ico-head">Other Details</div>
                    </div>

                    <div class="clearfix max-width-600  m-0" [collapse]="isOthrDtlCollapsed">

                        <div class="row">

                            <div class="form-group col-xs-4">
                                <giddh-datepicker #shippingDate="ngModel" placeholder="Ship Date" name="shippingDate" [(ngModel)]="purchaseOrder.templateDetails.other.shippingDate" [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty ||shippingDate.touched)">
                                </giddh-datepicker>
                                <p class="text-danger"
                                    *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                    Invalid Date</p>
                            </div>

                            <div class="form-group col-xs-4">
                                <input type="text" name="shippedVia"
                                    [(ngModel)]="purchaseOrder.templateDetails.other.shippedVia" class="form-control"
                                    [placeholder]="'Ship Via'" />
                            </div>

                            <div class="form-group col-xs-4">
                                <input type="text" name="trackingNumber"
                                    [(ngModel)]="purchaseOrder.templateDetails.other.trackingNumber"
                                    class="form-control"
                                    [placeholder]="'Tracking No.'" />
                            </div>
                        </div>
                    </div>

                </div>

                <div class="pd-t1 pl-0 max-width-600">
                    <label class="mr-b1">Message</label>
                    <textarea class="form-control" name="message2"
                        [(ngModel)]="purchaseOrder.templateDetails.other.message2"></textarea>
                </div>

            </div>
        </div>

        <div class="total-amount-description">

            <section class="table-section form-group">

                <div class="table-row">
                    <div class="table-cell">Total Amount</div>
                    <div class="table-cell figure-cell">
                        <!-- <span
                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}
                        </span>{{purchaseOrder.voucherDetails.subTotal | giddhCurrency}}  -->

                        <span class="d-flex justify-content-end">
                            <amount-field [amount]="purchaseOrder.voucherDetails.subTotal"
                                 [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                            </amount-field>
                        </span>

                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">Discount</div>

                    <div class="table-cell figure-cell">
                        <!-- <span
                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>
                            {{purchaseOrder.voucherDetails.totalDiscount * -1 | giddhCurrency}} -->

                            <span class="d-flex justify-content-end">
                                <amount-field [amount]="purchaseOrder.voucherDetails.totalDiscount * -1"
                                    [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code : false">
                                </amount-field>
                            </span>

                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">Taxable Value</div>
                    <div class="table-cell figure-cell">
                        <!-- <span
                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.totalTaxableValue | giddhCurrency}} -->

                            <span class="d-flex justify-content-end">
                                <amount-field [amount]="purchaseOrder.voucherDetails.totalTaxableValue"
                                    [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                </amount-field>
                            </span>
                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">Tax</div>
                    <div class="table-cell figure-cell">
                        <!-- <span
                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.gstTaxesTotal | giddhCurrency}} -->

                            <span class="d-flex justify-content-end">
                                <amount-field [amount]="purchaseOrder.voucherDetails.gstTaxesTotal"
                                    [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                </amount-field>
                            </span>

                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">CESS</div>
                    <div class="table-cell figure-cell">
                        <!-- <span
                            *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.cessTotal | giddhCurrency}} -->

                            <span class="d-flex justify-content-end">
                                <amount-field [amount]="purchaseOrder.voucherDetails.cessTotal"
                                    [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                    [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                </amount-field>
                            </span>

                    </div>
                </div>
                <div class="table-row">

                    <div class="table-cell">
                        <strong>Round Off</strong>
                    </div>

                    <div class="table-cell figure-cell">
                        <strong>
                            <!-- <span
                                *ngIf="isMulticurrencyAccount">{{purchaseOrder.accountDetails.currencySymbol}}</span>
                            {{calculatedRoundOff | giddhCurrency}} -->

                            <span class="d-flex justify-content-end">
                                <amount-field [amount]="calculatedRoundOff"
                                    [currencySymbol]="isMulticurrencyAccount ? purchaseOrder.accountDetails.currencySymbol : false"
                                    [currencyCode]="isMulticurrencyAccount ? purchaseOrder.accountDetails?.currency?.code : false">
                                </amount-field>
                            </span>

                        </strong>
                    </div>

                </div>
                <div class="table-row">
                    <div class="table-cell">
                        <strong>Total
                            <span
                                *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>

                        </strong>
                    </div>

                    <div class="table-cell figure-cell">
                        <strong>
                            <!-- <span
                                *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">{{purchaseOrder.accountDetails.currencySymbol}}</span>
                                {{purchaseOrder.voucherDetails.grandTotal | giddhCurrency}} -->

                                <span class="d-flex justify-content-end">
                                    <amount-field [amount]="purchaseOrder.voucherDetails.grandTotal"
                                        [currencySymbol]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails.currencySymbol : false"
                                        [currencyCode]="(isMulticurrencyAccount && isMultiCurrencySupported) ? purchaseOrder.accountDetails?.currency?.code: false">
                                    </amount-field>
                                </span>
                        </strong>
                    </div>
                </div>
                <div class="table-row" *ngIf="isMulticurrencyAccount && isMultiCurrencySupported">
                    <div class="table-cell bigger-dollar">
                        <strong>Total <span>
                                {{baseCurrencySymbol}}
                            </span>
                        </strong>
                    </div>

                    <div class="table-cell figure-cell">
                        <input #grandTotalInr type="text" class="form-control" name="grandTotalMulDum"
                            [prefix]="baseCurrencySymbol" [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                            [(ngModel)]="grandTotalMulDum" (blur)="updateExchangeRate(grandTotalInr.value)">

                    </div>
                </div>

                <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tcsTotal > 0">
                    <div class="table-cell">TCS</div>
                    <div class="table-cell figure-cell">
                        <!-- {{purchaseOrder.voucherDetails.tcsTotal | giddhCurrency}} -->

                        <span class="d-flex justify-content-end">
                            <amount-field [amount]="purchaseOrder.voucherDetails.tcsTotal"
                                [currencySymbol]="false"
                                [currencyCode]="false">
                            </amount-field>
                        </span>

                    </div>
                </div>

                <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tdsTotal > 0">
                    <div class="table-cell">TDS</div>
                    <div class="table-cell figure-cell">
                        <!-- {{purchaseOrder.voucherDetails.tdsTotal | giddhCurrency}} -->
                        <span class="d-flex justify-content-end">
                            <amount-field [amount]="purchaseOrder.voucherDetails.tdsTotal" [currencySymbol]="false" [currencyCode]="false">
                            </amount-field>
                        </span>
                    </div>
                </div>
            </section>

        </div>
    </div>
    <!-- endregion -->
</form>


<section class="clearfix" *ngIf="!showLoader">

    <section id="actionPane" class="text-center">

        <div class="col-xs-12">

            <!-- region generate mode -->
            <div class="pull-right pr update-mode" *ngIf="!isUpdateMode">
                <button type="button" class="btn btn-danger d-inline-block v-align-middle" (click)="resetForm()">Clear</button>

                <!-- region purchase invoice -->
                <span class="d-inline-block v-align-middle">
                    <button type="button" class="btn btn-default" (click)="savePurchaseOrder('create')">Save</button>
                </span>
                <!-- endregion -->

            </div>
            <!-- endregion -->

            <!-- region update mode -->
            <div class="pull-right pr" *ngIf="isUpdateMode">
                <button type="button" class="btn btn-danger d-inline-block v-align-middle" (click)="cancelUpdate()">Cancel</button>
                <button type="button" class="btn btn-default" (click)="savePurchaseOrder('update')">Update</button>
            </div>
            <!-- endregion -->

        </div>
    </section>
</section>

<!-- endregion -->
<div class="aside-overlay"
    *ngIf="accountAsideMenuState === 'in' || asideMenuStateForProductService === 'in' || asideMenuStateForOtherTaxes === 'in'"
    (click)="closeAsideMenuStateForOtherTaxes()">
</div>
<generic-aside-menu-account [class]="accountAsideMenuState" [@slideInOut]="accountAsideMenuState"
    (closeAsideEvent)="toggleAccountAsidePane($event)"
    [selectedGrpUniqueName]="selectedGroupUniqueNameForAddEditAccountModal"
    [keyboardShortcut]="{'esc':accountAsideMenuState ==='in'}" *ngIf="accountAsideMenuState === 'in'"
    [selectedAccountUniqueName]="selectedVendorForDetails" (onShortcutPress)="toggleAccountAsidePane()"
    (addEvent)="addNewSidebarAccount($event)" (updateEvent)="updateSidebarAccount($event)"></generic-aside-menu-account>

<aside-menu-product-service *ngIf="asideMenuStateForProductService === 'in'" [class]="asideMenuStateForProductService"
    [selectedVoucherType]="'purchase'" [@slideInOut]="asideMenuStateForProductService"
    (closeAsideEvent)="onNoResultsClicked()"></aside-menu-product-service>

<!-- region bulk items -->
<div bsModal #bulkItemsModal="bs-modal" tabindex="-1" class="modal fade" role="dialog"
    [config]="{ animated: true,keyboard: false,backdrop: false,ignoreBackdropClick: true }">
    <ng-container *ngIf="bulkItemsModal?.isShown">
        <proforma-add-bulk-items-component [invoiceType]="invoiceType" (saveItemsEvent)="addBulkStockItems($event)"
            (closeEvent)="bulkItemsModal.hide()"></proforma-add-bulk-items-component>
    </ng-container>
</div>
<!-- endregion -->
<ng-template let-entry #otherTaxesModal>
    <div id="top0">
        <app-aside-menu-other-taxes *ngIf="asideMenuStateForOtherTaxes === 'in'" [class]="asideMenuStateForOtherTaxes"
            [taxes]="companyTaxesList" [otherTaxesModal]="entry.otherTaxModal"
            [@slideInOut]="asideMenuStateForOtherTaxes" (closeModal)="toggleOtherTaxesAsidePane(true, null)"
            (applyTaxes)="calculateOtherTaxes($event, entry);toggleOtherTaxesAsidePane(true, null);calculateAffectedThingsFromOtherTaxChanges();">
        </app-aside-menu-other-taxes>
    </div>
</ng-template>
<ng-template #purchaseOrderPreviewModal>
    <purchase-order-preview-modal [purchaseOrderUniqueName]="purchaseOrderPreviewUniqueName" [purchaseOrderAccountUniqueName]="purchaseOrderPreviewAccountUniqueName" [purchaseOrderCompanyUniqueName]="selectedCompany?.uniqueName" (closeModelEvent)="closePurchaseOrderPreviewPopup($event)"></purchase-order-preview-modal>
</ng-template>
