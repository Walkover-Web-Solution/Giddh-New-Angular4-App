<div class="no-data mrT2 loader-main" *ngIf="showLoader">
    <div class="spinner2">
        <div class="cube1"></div>
        <div class="cube2"></div>
    </div>
</div>
<form #invoiceForm="ngForm" novalidate autocomplete="off"
    [ngClass]="{'create-purchase-order-form': true, 'customerInvoiceForm' : !purchaseOrder.voucherDetails.customerName, 'forMultiCurrency' : isMulticurrencyAccount  } "
    *ngIf="!showLoader">
    <div class="clearfix" [keyboardShortcut]="'alt+c'" (onShortcutPress)="addAccountFromShortcut()">
        <div class="clearfix wrapper-customer-table  pdT2">
            <div class="customer-purchase-table">
                <div class="inner-container">
                    <div class="inner-container">
                        <div class="total-purchase-amount">
                            <div class="text-right">
                                <p class="pr-1">
                                    <span class="balance-due">Total Amount</span>
                                    <span class="total-amount-order" *ngIf="isMulticurrencyAccount">{{purchaseOrder.accountDetails.currencySymbol}}
                                        <strong>{{purchaseOrder.voucherDetails.grandTotal | giddhCurrency}}</strong></span>
                                    <span class="total-amount-order" *ngIf='isMulticurrencyAccount'>
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{purchaseOrder.voucherDetails.grandTotal * exchangeRate | giddhCurrency}}</span>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <!-- region customer section -->
                        <div class="clearfix">
                            <div class="row mb-1">
                                <!-- region customer name -->
                                <div class="col-sm-2">
                                    <label>Vendor Name<span class="red-text">*</span></label>
                                </div>
                                <!-- region customer dropdown -->
                                <div class="col-sm-7 select-customer-name">
                                    <div class="clearfix d-flex flex-column">
                                        <div class="d-flex flex-column">
                                            <sales-sh-select style="width:62.7%; float: left;" name="vendor"
                                                [options]="customerAcList$ | async"
                                                [(ngModel)]="purchaseOrder.account.uniqueName"
                                                [customFilter]="customMoveGroupFilter"
                                                (selected)="onSelectVendor($event);" [placeholder]="'Select Vendor'"
                                                [notFoundLink]="true" [doNotReset]="true"
                                                [fixedValue]="purchaseOrder.account.name"
                                                [forceClearReactive]="forceClear$ | async" [isFilterEnabled]="true"
                                                (noResultsClicked)="addNewAccount()" [multiple]="false"
                                                [ItemHeight]="67" [notFoundLinkText]="'Add Vendor'"
                                                (keyup)="resetVendor($event)" (onClear)="resetVendor(null)"
                                                [disabled]="isUpdateMode">

                                                <ng-template #optionTemplate let-option="option">
                                                    <a href="javascript:void(0)" class="list-item"
                                                        style="border-bottom: 1px solid #ccc;">
                                                        <div class="item">{{ option.label }}</div>
                                                        <div class="item_unq">{{ option.value }}</div>
                                                    </a>
                                                </ng-template>

                                                <ng-template #notFoundLinkTemplate>
                                                    <a href="javascript:void(0)" class="list-item pl-05 pr-05"
                                                        [keyboardShortcut]="'alt+c'"
                                                        style="width:100%; display: flex;justify-content: space-between;">
                                                        <div class="item">{{ vendorNotFoundText }}</div>
                                                        <div class="item">Alt+C</div>
                                                    </a>
                                                </ng-template>

                                            </sales-sh-select>
                                            <!-- endregion -->
                                            <div hidden>
                                                <p><small>Pending Purchase order of selected vendor</small></p>
                                                <p class="font-14"><a href="javascript(void)">PO84709832 |</a>
                                                    <a href="javascript(void)"> PO02948023 |</a>

                                                </p>
                                            </div>
                                            <!-- region Unregistered Business / customer details -->
                                            <div class="d-flex aqua-color"
                                                *ngIf="purchaseOrder.voucherDetails.customerName">
                                                <ng-container
                                                    *ngTemplateOutlet="gstTreatmentModal;context:{ $implicit: showGstTreatmentModal}">
                                                </ng-container>

                                                <span style="margin-right: 5px" class="cp aqua-color"
                                                    *ngIf="!isUpdateMode">
                                                    <a href="javascript:void(0)" (click)="getCustomerDetails()">Vendor
                                                        Details</a>
                                                </span>
                                            </div>
                                            <!-- endregion -->
                                        </div>
                                    </div>
                                </div>
                                <!-- endregion -->
                            </div>
                            <div class="row mb-1 delivery-from-field">
                                <div class="col-sm-2">
                                    <label>Deliver From<span class="red-text">*</span></label>
                                </div>
                                <!-- region customer dropdown -->
                                <div class="col-sm-9 select-customer-name">
                                    <section class="form-inline">

                                        <div class="wrap-billing-address clearfix">

                                            <div class="row">
                                                <!-- region billing address -->
                                                <div class="col-sm-6 bill-add">

                                                    <div class="form-group">
                                                        <label>Billing Address</label>

                                                        <div class="billing-address clearfix">
                                                            <textarea name="vendorBillingDetailsAddress"
                                                                (keyup)="autoFillShippingDetails('vendor')"
                                                                [(ngModel)]="purchaseOrder.account.billingDetails.address[0]"
                                                                class="form-control" rows="3" autocomplete="off"
                                                                autofocus="off" aria-autocomplete="none"></textarea>

                                                            <div>
                                                                <div class="col-sm-6 pd ">
                                                                    <label class="sales-country-label">
                                                                        {{vendorCountry}}
                                                                    </label>
                                                                </div>

                                                                <div class="col-sm-6 pd" #vendorBillingState>
                                                                    <sales-sh-select [placeholder]="'State'"
                                                                        class="select-border-bottom"
                                                                        (selected)="fillShippingBillingDetails($event, true, 'vendor'); autoFillShippingDetails('vendor')"
                                                                        #statesBilling [showBottomBorderOnly]="true"
                                                                        [options]="statesSource"
                                                                        name="vendorBillingDetailsStateCode"
                                                                        [(ngModel)]="purchaseOrder.account.billingDetails.state.code">
                                                                    </sales-sh-select>
                                                                </div>

                                                                <div class="col-sm-12 pd"
                                                                    *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                    <input maxLength="15" autocomplete="None"
                                                                        type="text" name="vendorBillingDetailsTax"
                                                                        [(ngModel)]="purchaseOrder.account.billingDetails.gstNumber"
                                                                        class="form-control input-custom"
                                                                        (change)="getStateCode('billingDetails', vendorBillingState)"
                                                                        placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>

                                                </div>
                                                <!-- endregion -->

                                                <!-- region shipping address -->
                                                <div class="col-sm-6 bill-add">

                                                    <div class="form-group p0 width100">
                                                        <label>
                                                            <input type="checkbox" autocomplete="None"
                                                                name="autoFillVendorShipping"
                                                                [(ngModel)]="autoFillVendorShipping"
                                                                (change)="autoFillShippingDetails('vendor')"> Shipping
                                                            Address
                                                            Same as Billing Address
                                                        </label>

                                                        <div
                                                            [ngClass]="{'billing-address': true, 'disabled': autoFillVendorShipping}">
                                                            <textarea name="vendorShippingDetailsAddress"
                                                                [(ngModel)]="purchaseOrder.account.shippingDetails.address[0]"
                                                                class="form-control" rows="3" autocomplete="off"
                                                                autofocus="off" aria-autocomplete="none"></textarea>
                                                            <div class="clearfix">
                                                                <div class="form-group">
                                                                    <div class="col-sm-6 pd ">
                                                                        <div class="form-group">
                                                                            <label class="sales-country-label">
                                                                                {{vendorCountry}}
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6 pd select-border-bottom"
                                                                        #vendorShippingState>
                                                                        <sales-sh-select [placeholder]="'State'"
                                                                            class="select-border-bottom"
                                                                            (selected)="fillShippingBillingDetails($event, false, 'vendor');"
                                                                            #statesShipping
                                                                            [showBottomBorderOnly]="true"
                                                                            [options]="statesSource"
                                                                            name="vendorShippingDetailsStateCode"
                                                                            [(ngModel)]="purchaseOrder.account.shippingDetails.state.code">
                                                                        </sales-sh-select>
                                                                    </div>
                                                                    <div class="col-sm-12 pd"
                                                                        *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                        <input maxLength="15" autocomplete="None"
                                                                            type="text" name="vendorShippingDetailsTax"
                                                                            [(ngModel)]="purchaseOrder.account.shippingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            (change)="getStateCode('shippingDetails', vendorShippingState)"
                                                                            placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- endregion -->
                                            </div>
                                        </div>
                                    </section>
                                </div>
                                <!-- endregion -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="customer-purchase-table bg-white pdB2 pdT2">
                <div class="inner-container">
                    <div class="row mb-1" *ngIf="shouldShowWarehouse">
                        <!-- region customer name -->
                        <div class="col-sm-2">
                            <label>Warehouse<span class="red-text">*</span></label>
                        </div>
                        <!-- region customer dropdown -->
                        <div class="col-sm-7 select-customer-name">
                            <div class="clearfix d-flex flex-column">
                                <div class="d-flex flex-column">
                                    <!-- region if not cashinvoice show customer dropdown -->
                                    <sh-select class="multi-select" name="warehouse" [placeholder]="'Select Warehouse'"
                                        [(ngModel)]="purchaseOrder.warehouse.uniqueName" [options]="warehouses"
                                        (selected)="onSelectWarehouse($event)"></sh-select>
                                    <!-- endregion -->
                                </div>
                            </div>
                        </div>
                        <!-- endregion -->
                    </div>
                    <div class="row mb-1">
                        <div class="col-sm-2">
                            <label>Deliver To<span class="red-text">*</span></label>
                        </div>
                        <!-- region customer dropdown -->
                        <div class="col-sm-9 select-customer-name">
                            <section class="form-inline">

                                <div class="wrap-billing-address clearfix">

                                    <div class="row">
                                        <!-- region billing address -->
                                        <div class="col-sm-6 bill-add">

                                            <div class="form-group">
                                                <label>Billing Address</label>

                                                <div class="billing-address clearfix">
                                                    <textarea name="companyBillingDetailsAddress"
                                                        (keyup)="autoFillShippingDetails('company')"
                                                        [(ngModel)]="purchaseOrder.company.billingDetails.address[0]"
                                                        class="form-control" rows="3" autocomplete="off" autofocus="off"
                                                        aria-autocomplete="none"></textarea>
                                                    <div>
                                                        <div class="col-sm-6 pd ">
                                                            <label class="sales-country-label">
                                                                {{companyCountryName}}
                                                            </label>
                                                        </div>
                                                        <div class="col-sm-6 pd" #companyBillingState>
                                                            <sales-sh-select [placeholder]="'State'"
                                                                class="select-border-bottom"
                                                                (selected)="fillShippingBillingDetails($event, true, 'company'); autoFillShippingDetails('company')"
                                                                [showBottomBorderOnly]="true"
                                                                [options]="companyStatesSource"
                                                                name="companyBillingDetailsStateCode"
                                                                [(ngModel)]="purchaseOrder.company.billingDetails.state.code">
                                                            </sales-sh-select>
                                                        </div>
                                                        <div class="col-sm-12 pd"
                                                            *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                            <input maxlength="15" autocomplete="None" type="text"
                                                                name="companyBillingDetailsTax"
                                                                [(ngModel)]="purchaseOrder.company.billingDetails.gstNumber"
                                                                class="form-control input-custom"
                                                                (change)="getStateCode('billingDetails', companyBillingState)"
                                                                placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <!-- endregion -->

                                        <!-- region shipping address -->
                                        <div class="col-sm-6 bill-add">

                                            <div class="form-group p0 width100">
                                                <label>
                                                    <input type="checkbox" autocomplete="None"
                                                        name="autoFillCompanyShipping"
                                                        [(ngModel)]="autoFillCompanyShipping"
                                                        (change)="autoFillShippingDetails('company')"> Shipping Address
                                                    Same as Billing Address
                                                </label>
                                                <div
                                                    [ngClass]="{'billing-address': true, 'disabled': autoFillCompanyShipping}">
                                                    <textarea name="companyShippingDetailsAddress"
                                                        [(ngModel)]="purchaseOrder.company.shippingDetails.address[0]"
                                                        class="form-control" rows="3" autocomplete="off" autofocus="off"
                                                        aria-autocomplete="none"></textarea>
                                                    <div class="clearfix">
                                                        <div class="form-group">
                                                            <div class="col-sm-6 pd ">
                                                                <div class="form-group">
                                                                    <label class="sales-country-label">
                                                                        {{companyCountryName}}
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-6 pd select-border-bottom"
                                                                #companyShippingState>
                                                                <sales-sh-select [placeholder]="'State'"
                                                                    class="select-border-bottom"
                                                                    (selected)="fillShippingBillingDetails($event, false, 'company');"
                                                                    [showBottomBorderOnly]="true"
                                                                    [options]="companyStatesSource"
                                                                    name="companyShippingDetailsStateCode"
                                                                    [(ngModel)]="purchaseOrder.company.shippingDetails.state.code">
                                                                </sales-sh-select>
                                                            </div>
                                                            <div class="col-sm-12 pd"
                                                                *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                <input maxLength="15" autocomplete="None" type="text"
                                                                    name="companyShippingDetailsTax"
                                                                    [(ngModel)]="purchaseOrder.company.shippingDetails.gstNumber"
                                                                    class="form-control input-custom"
                                                                    (change)="getStateCode('shippingDetails', companyShippingState)"
                                                                    placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- endregion -->
                                    </div>
                                </div>
                            </section>
                        </div>
                        <!-- endregion -->
                    </div>
                    <div class="row mb-1">
                        <!-- region customer name -->
                        <div class="col-sm-2">
                            <label>Order Date<span class="red-text">*</span></label>
                        </div>
                        <!-- region customer dropdown -->
                        <div class="col-sm-7 select-customer-name">
                            <input type="text" class="form-control" placeholder="Select Date" name="purchaseOrderDate"
                                [(ngModel)]="purchaseOrder.voucherDetails.voucherDate" bsDatepicker>
                        </div>
                        <!-- endregion -->
                    </div>

                    <div class="row mb-1">
                        <!-- region customer name -->
                        <div class="col-sm-2">
                            <label>Order #</label>
                        </div>
                        <!-- region customer dropdown -->
                        <div class="col-sm-9 select-customer-name order-expected-delivery d-flex">
                            <!-- region if not cashinvoice show customer dropdown -->
                            <div class="col-sm-6 pl-0">
                                <input type="text" class="form-control" name="purchaseOrderNumber"
                                    [(ngModel)]="purchaseOrder.number">
                            </div>
                            <!-- endregion -->
                            <div class="col-sm-6 invoice-due-date">
                                <div class="d-flex">
                                    <label>Expected Delivery</label>
                                    <input type="text" class="form-control" placeholder="Select Date"
                                        name="purchaseDueDate" [(ngModel)]="purchaseOrder.dueDate" bsDatepicker>
                                </div>
                            </div>
                        </div>
                        <!-- endregion -->
                    </div>
                    <div class="row mTB1">
                        <div class="col-sm-2" *ngIf="!isMobileView">
                            <label></label>
                        </div>
                        <div class="col-sm-7">
                            <input id="reverse-charge" name="rcmEntry" class="checkbox-custom" type="checkbox"
                                [ngModel]="isRcmEntry" (click)="toggleRcmCheckbox($event)">
                            <label #rcmPopup="bs-popover" [popover]="rcmTemplate" container="body" placement="bottom"
                                containerClass="purchase-invoice-rcm" for="reverse-charge"
                                class="checkbox-custom-label">
                                Is this transaction applicable for reverse charge?
                            </label>
                        </div>
                    </div>
                    <ng-template #rcmTemplate>
                        <confirmation-modal [configuration]="rcmConfiguration"
                            (buttonClicked)="handleRcmChange($event)"></confirmation-modal>
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
    <ng-container *ngIf="!purchaseOrder.account.uniqueName">
        <img src="assets/images/new/search_customer.svg" class="img-responsive search-arrow-image" />
    </ng-container>
    <section *ngIf="!isMobileScreen"
        class="static-purchase-table create-purchase-order-table clearfix mb-2 bg-white container-fluid">
        <table class="table table-custom-invoice  basic">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Product/Service Description</th>
                    <th>Qty/Unit</th>
                    <th>Rate</th>
                    <th>Amount</th>
                    <th>Discount</th>
                    <th>Tax</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody
                *ngFor="let entry of purchaseOrder.entries; let entryIdx = index; let first = first; let last = last;"
                (clickOutside)="handleOutsideClick()" [exclude]="'.entriesTr'">
                <ng-container *ngFor="let transaction of entry.transactions;">
                    <tr (click)="setActiveIndx(entryIdx);$event.stopPropagation()" [hidden]="activeIndx === entryIdx"
                        class="entriesTr set-active"
                        [ngClass]="{'isOtherTax' : entry.isOtherTaxApplicable && isMulticurrencyAccount}">
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="productName">
                                <label *ngIf="!transaction.accountName" class="selectAccountLabel">Click to
                                    Select
                                    Account</label> {{transaction.accountName}}
                                <span
                                    *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}})</span>
                            </div>
                            <!-- <div class="skuNumber">
                                <label>SKU:</label>Number
                            </div> -->
                            <div class="discription">
                                {{transaction.description}}
                            </div>
                            <p class="small text-muted sku_and_customfields" *ngIf="transaction.sku_and_customfields">
                                {{transaction.sku_and_customfields}}</p>
                            <div class="dateHsnCode">
                                <div class="row">
                                    <div class="col-xs-6 pdR0" *ngIf="entry.entryDate">
                                        <div class="entryDate">
                                            <label>Entry Date: </label>
                                            {{entry.entryDate | date: 'dd-MM-yyyy'}}
                                            <span class="edit-icon cp" *ngIf="!isUpdateMode">
                                                <img src="assets/images/edit-pencilicon.svg">
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-xs-6 pdL0" *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                        <div class="hsnCode text-right">
                                            <label>HSN/SAC:</label>
                                            <span>
                                                {{(inventorySettings?.manageInventory || !transaction.sacNumberExists) ? transaction.hsnNumber : transaction.sacNumber}}
                                                <span class="edit-icon cp">
                                                    <img src="assets/images/edit-pencilicon.svg">
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-right stockUnit">
                            <div class="wrap-td-data">
                                {{transaction.quantity}} {{transaction.stockUnit}}
                            </div>
                        </td>
                        <td class="text-right tra-rate item-rate " style="height:1px;">
                            <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                <div class="td-Wrapper">
                                    <div style="flex: 1;">
                                        <div class="wrap-td-data"> <span
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                            {{transaction.rate | giddhCurrency: ratePrecision:true}}
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="isMulticurrencyAccount && !isPurchaseInvoice" class="differ-currency">
                                    <span>{{baseCurrencySymbol}}</span>
                                    <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>
                                </div>
                            </div>
                        </td>
                        <td class="text-right  item-amount" style="height:1px;">
                            <div class="td-Wrapper">
                                <div style="flex: 1;">
                                    <div class="wrap-td-data">
                                        <span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{transaction.amount | giddhCurrency}}
                                    </div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                <span>{{baseCurrencySymbol}}</span>
                                <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                            </div>
                        </td>
                        <td class="item-discount" style="height:1px;">
                            <div class=" text-right td-Wrapper">
                                <div style="flex: 1;">
                                    <div class="wrap-td-data"> <span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>{{ entry.discountSum | giddhCurrency}}</div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                <span>{{baseCurrencySymbol}}</span>
                                <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                            </div>
                        </td>
                        <td [class.error-box]="transaction.requiredTax" class="text-right item-tax" style="height:1px;"
                            (focus)="transaction.requiredTax = false;">
                            <div class="td-Wrapper">
                                <div style="flex:1;">
                                    <div class="wrap-td-data"><span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>{{(entry.taxSum + entry.cessSum) | giddhCurrency}}</div>
                                </div>
                            </div>
                            <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                <span>{{baseCurrencySymbol}}</span>
                                <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                            </div>
                        </td>
                        <td class="text-right item-tax delete-btn-absolute" style="height:1px;">
                            <div class="td-Wrapper">
                                <div style="flex:1;">
                                    <div class="wrap-td-data">
                                        <span><span
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}
                                            </span>{{transaction.total | giddhCurrency}}</span>
                                        <br>
                                        <span *ngIf="entry.isOtherTaxApplicable">
                                            {{ entry.otherTaxModal?.appliedOtherTax?.name }} : <span
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}
                                            </span>{{ entry.otherTaxSum }}
                                        </span>
                                    </div>
                                    <div class="texIncurrency"
                                        *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && !isPurchaseInvoice">
                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                    </div>
                                </div>

                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                    <span>{{baseCurrencySymbol}}</span>
                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                </div>
                            </div>

                            <div class="trash-icon-delete" (click)="removeTransaction(entryIdx)">
                                <span class="cp">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </span>
                            </div>
                        </td>
                    </tr>

                    <!-- endregion -->

                    <!-- region dynamic entries-->
                    <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature)-->
                    <tr [hidden]="activeIndx !== entryIdx" class="entriesTr defaultActive"
                        (click)="$event.stopPropagation();">
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="productName">
                                <div class="ng-select-wrap">
                                    <sh-select [options]="salesAccounts$ | async" #selectAccount
                                        [(ngModel)]="transaction.fakeAccForSelect2"
                                        name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                        (selected)="onSelectSalesAccount($event,transaction, entry)"
                                        [placeholder]="'Select A/c'" [notFoundLink]="true"
                                        [fixedValue]="(transaction.stockDetails && transaction.stockDetails.name) ? transaction.accountName+' ('+transaction.stockDetails?.name+')' : transaction.accountName"
                                        [forceClearReactive]="forceClear$ | async"
                                        (noResultsClicked)="onNoResultsClicked(entryIdx)" [multiple]="false"
                                        [ItemHeight]="67" (onClear)="onClearSalesAccount(transaction)"
                                        [useInBuiltFilterForFlattenAc]="true">

                                        <ng-template #optionTemplate let-option="option">
                                            <ng-container *ngIf="!option.additional?.stock">
                                                <a href="javascript:void(0)" class="list-item"
                                                    style="border-bottom: 1px solid #ccc;">
                                                    <div class="item">{{ option.label }}</div>
                                                    <div class="item_unq">
                                                        {{ option.additional?.uniqueName }}</div>
                                                </a>
                                            </ng-container>
                                            <ng-container *ngIf="option.additional?.stock">
                                                <a href="javascript:void(0)" class="list-item"
                                                    style="border-bottom: 1px solid #ccc;">
                                                    <div class="item">{{ option.label }}</div>
                                                    <div class="item_unq">
                                                        {{ option.additional?.uniqueName }}</div>
                                                    <div class="item_stock">Stock:
                                                        {{ option.additional?.stock.uniqueName }}</div>
                                                </a>
                                            </ng-container>
                                        </ng-template>
                                    </sh-select>
                                </div>
                            </div>

                            <div *ngIf="transaction.fakeAccForSelect2">
                                <!-- <div class="skuNumber">
                                    <label>SKU:</label>Number
                                </div> -->

                                <div class="discription">
                                    <textarea type="text" placeholder="Add Description"
                                        name="transaction.description_{{entryIdx}}" class="form-control"
                                        [(ngModel)]="transaction.description" #description></textarea>
                                    <p class="small text-muted sku_and_customfields"
                                        *ngIf="transaction.sku_and_customfields">
                                        {{transaction.sku_and_customfields}}</p>
                                </div>

                                <!-- region entry date/ hsncode -->
                                <div class="dateHsnCode">
                                    <div class="row">
                                        <div class="col-xs-6 pdR0">
                                            <div class="entryDate">
                                                <label>Entry Date: </label>
                                                <span *ngIf="!isUpdateMode">
                                                    <input type="text" [placeholder]="giddhDateFormat" bsDatepicker
                                                        name="transaction.date_{{entryIdx}}"
                                                        id="transaction.date_{{entryIdx}}"
                                                        class="form-control text-left" [(ngModel)]="entry.entryDate"
                                                        [disabled]="isUpdateMode" (onShown)="hsnDropdownShow = false;"
                                                        [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                        #dp="bsDatepicker" />
                                                    <span class="edit-icon cp" (click)="dp.toggle()"
                                                        [attr.aria-expanded]="dp.isOpen">
                                                        <img src="assets/images/edit-pencilicon.svg">
                                                    </span>
                                                </span>

                                                <span *ngIf="isUpdateMode">
                                                    {{ entry.entryDate | date: 'dd-MM-yyyy'}}
                                                </span>

                                            </div>
                                        </div>

                                        <div class="col-xs-6 pdL0">
                                            <div class="wrap-hsnBox">
                                                <div class="hsnCode text-right"
                                                    (click)="toggleHsnSacDropDown(transaction)">
                                                    <label>HSN/SAC:</label>
                                                    <span>
                                                        {{(inventorySettings?.manageInventory || !transaction.sacNumber) ? transaction.hsnNumber : transaction.sacNumber }}
                                                        <span *ngIf="!transaction.hsnNumber && !transaction.sacNumber"
                                                            class="updateText">Update
                                                        </span>
                                                        <span class="edit-icon cp">
                                                            <img src="assets/images/edit-pencilicon.svg">
                                                        </span>
                                                    </span>
                                                </div>

                                                <div class="hsnCodeDropdown" *ngIf="hsnDropdownShow">
                                                    <label>HSN/SAC</label>
                                                    <input type="text" maxLength="10" placeholder="HSN/SAC Number"
                                                        name="transaction.hsnNumber_{{entryIdx}}"
                                                        *ngIf="(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                        [(ngModel)]="transaction.hsnNumber" />
                                                    <input type="text" maxLength="10" placeholder="HSN/SAC Number"
                                                        name="transaction.hsnNumber_{{entryIdx}}"
                                                        *ngIf="!(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                        [(ngModel)]="transaction.sacNumber" />
                                                    <a>
                                                    </a>
                                                    <div class="btngroup m-t-10">
                                                        <button class="btn btn-sm btn-success" type="button"
                                                            (click)="hsnDropdownShow=!hsnDropdownShow">Save
                                                        </button>
                                                        <button class="btn btn-sm btn-primary" type="button"
                                                            (click)="hideHsnSacEditPopup(transaction)">
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!-- endregion -->
                            </div>
                        </td>

                        <td class="text-right stockUnit">
                            <input type="text" [disabled]="!transaction.isStockTxn"
                                (blur)="handleQuantityBlur(entry, transaction);" placeholder="Quantity"
                                decimalDigitsDirective name="transaction.quantity_{{entryIdx}}"
                                class="form-control text-right" [(ngModel)]="transaction.quantity" />

                            <select class="form-control" [disabled]="!transaction.isStockTxn"
                                name="transaction.stockUnit_{{entryIdx}}" [(ngModel)]="transaction.stockUnit"
                                (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">
                                    {{stock.text}}
                                </option>
                            </select>
                        </td>

                        <td class="text-right item-rate" style="height: 1px;">
                            <div class="td-Wrapper">
                                <div style="flex: 1;">
                                    <input type="text" [disabled]="!transaction.isStockTxn"
                                        (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                        placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                        class="form-control transaction-rate text-right" [(ngModel)]="transaction.rate"
                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                        [customDecimalPlaces]="ratePrecision" />
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                    <span>{{baseCurrencySymbol}}</span>
                                    <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>
                                </div>
                            </div>
                        </td>

                        <td class="text-right item-amount" style="height:1px;">
                            <div class="td-Wrapper">
                                <div style="flex: 1;">
                                    <input type="text" (blur)="calculateWhenTrxAltered(entry, transaction)"
                                        (click)="transactionAmountClicked(transaction)" placeholder="Amount"
                                        name="transaction.amount_{{entryIdx}}" class="form-control text-right"
                                        [(ngModel)]="transaction.amount" decimalDigitsDirective
                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                    <span>{{baseCurrencySymbol}}</span>
                                    <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                                </div>
                            </div>
                        </td>

                        <td class="item-discount" style="height:1px;">
                            <div class="td-Wrapper">
                                <div class="text-right" style="flex:1;">
                                    <discount-control-component #discountComponent [discountMenu]="false"
                                        [discountAccountsDetails]="entry.discounts" [discountSum]="entry.discountSum"
                                        [showHeaderText]="false" (hideOtherPopups)="closeTaxControlPopup()"
                                        (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                        [maskInput]="inputMaskFormat"
                                        [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffixInput]="selectedSuffixForCurrency">
                                    </discount-control-component>
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                    <span>{{baseCurrencySymbol}}</span>
                                    <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                </div>
                            </div>
                        </td>

                        <td class="pos-rel dropdown-container item-tax" style="height:1px;">
                            <div class="td-Wrapper">
                                <div class="text-right" style="flex:1;">
                                    <tax-control [taxes]="companyTaxesList" [date]="entry.entryDate"
                                        [taxRenderData]="entry.taxes" [totalForTax]="transaction.taxableValue"
                                        [applicableTaxes]="transaction.applicableTaxes"
                                        [exceptTaxTypes]="exceptTaxTypes"
                                        [allowedSelectionOfAType]="allowedSelectionOfAType" [showHeading]="false"
                                        [rootClass]="'salseInvoicetable'"
                                        (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                        (hideOtherPopups)="closeDiscountPopup()" [maskInput]="inputMaskFormat"
                                        [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffixInput]="selectedSuffixForCurrency">
                                    </tax-control>
                                </div>

                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                    <span>{{baseCurrencySymbol}}</span>
                                    <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                </div>
                            </div>
                        </td>

                        <td class="text-right item-total delete-btn-absolute">
                            <div class="td-Wrapper">

                                <div style="flex:1;">
                                    <input type="text" name="transaction.total_{{entryIdx}}"
                                        class="form-control text-right" [(ngModel)]="transaction.total"
                                        decimalDigitsDirective [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                        (blur)="calculateTransactionValueInclusively(entry, transaction)" />

                                    <div *ngIf="isTcsTdsApplicable" class="wrap-otherTax">
                                        <input type="checkbox" class="other-taxes-checkobx"
                                            [(ngModel)]="entry.isOtherTaxApplicable" *ngIf="!entry.isOtherTaxApplicable"
                                            name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                            id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                            (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                        <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                            *ngIf="!entry.isOtherTaxApplicable" class="otherTaxLable"
                                            style="font-size:13px;vertical-align: middle">Other Tax?</label>
                                    </div>
                                    <div *ngIf="entry.isOtherTaxApplicable" class="mrT1">

                                        <span>

                                            <div style="display: flex;align-items: center">
                                                <span style="margin-right: 5px">
                                                    <a href="javascript: void 0"
                                                        (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                        <img src="assets/images/edit-pencilicon.svg">
                                                    </a>
                                                </span>
                                                <input class="text-right form-control other-taxes-input"
                                                    disabled="disabled" [(ngModel)]="entry.otherTaxSum"
                                                    [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                    name="entry.otherTaxesSum_{{entryIdx}}" />
                                            </div>

                                            <p
                                                style="margin-top: 5px; font-size: 12px; text-transform: capitalize; margin-bottom: 20px;">
                                                {{ entry.otherTaxModal?.appliedOtherTax?.name}}</p>
                                        </span>

                                    </div>
                                </div>
                                <div *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && !isPurchaseInvoice"
                                    class="texIncurrency" style="color:#999;">
                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                    <span>{{baseCurrencySymbol}}</span> :
                                    <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                </div>
                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                    <span>{{baseCurrencySymbol}}</span>
                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                </div>


                                <ng-container *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                </ng-container>

                            </div>

                            <div class="trash-icon-delete" (click)="removeTransaction(entryIdx)">
                                <span class="cp">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </span>
                            </div>
                        </td>
                    </tr>
                    <!-- endregion -->
                </ng-container>
            </tbody>
            <!-- region add bulk items -->
            <div class="p-4 aqua-color add-line-bulk-item" style="width: max-content;">
                <a href="javascript:void 0" (click)="addBlankRow(null)">+ Add New Line</a>
                <span style="font-size:14px; color: #c5c5c5;"> | </span>
                <a (click)="showBulkItemModal = true; bulkItemsModal.show()" href="javascript:void(0)">+ Add
                    Bulk
                    Entries</a>
            </div>
            <!-- endregion -->
            <tfoot>
                <tr>
                    <td colspan="4">
                        <!-- region other details-->
                        <div>
                            <div class="collapse-pane clearfix">

                                <div class="collapse-pane-heading"
                                (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                                    <div class="ico-box-wrap">
                                        <div class="ico-box">
                                            <span aria-hidden="true" [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"></span>
                                        </div>
                                    </div>
                                    <div class="ico-head">Other Details</div>
                                </div>
                                <div [collapse]="isOthrDtlCollapsed" class="clearfix max-600 pdL3 mr0">
                                    <div class="row">
                                        <div class="form-group col-xs-4" [ngClass]="{'mb-3': isInvalidfield}">
                                            <input type="text" #shippingDate="ngModel" [placeholder]="'Ship Date'"
                                                bsDatepicker name="shippingDate"
                                                [(ngModel)]="purchaseOrder.templateDetails.other.shippingDate"
                                                class="form-control" [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)" />
                                            <p class="text-danger"
                                                *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                Invalid Date
                                            </p>
                                        </div>
                                        <div class="form-group col-xs-4" [ngClass]="{'mb-3': isInvalidfield}">
                                            <input type="text" name="shippedVia"
                                                [(ngModel)]="purchaseOrder.templateDetails.other.shippedVia"
                                                class="form-control" [placeholder]="'Ship Via'" />
                                        </div>
                                        <div class="form-group col-xs-4" [ngClass]="{'mb-3': isInvalidfield}">
                                            <input type="text" name="trackingNumber"
                                                [(ngModel)]="purchaseOrder.templateDetails.other.trackingNumber"
                                                class="form-control" [placeholder]="'Tracking No.'" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- endregion -->
                        <!-- region note/messages -->
                        <div class="pt-1 pl-0 max-600">
                            <label class="mrB1">Note</label>
                            <textarea style="height:120px !important" class="form-control" name="message2"
                                [(ngModel)]="purchaseOrder.templateDetails.other.message2"></textarea>
                        </div>
                        <!-- endregion -->
                    </td>
                    <!-- region total section -->
                    <td colspan="4">
                        <section class="table-section form-group">
                            <div class="table-row">
                                <div class="table-cell">Total Amount</div>
                                <div class="table-cell figure-cell">
                                    <span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.subTotal | giddhCurrency}}
                                </div>
                            </div>

                            <div class="table-row">
                                <div class="table-cell">Discount</div>
                                <div class="table-cell figure-cell">
                                    <span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>
                                    {{purchaseOrder.voucherDetails.totalDiscount * -1 | giddhCurrency}}
                                </div>
                            </div>

                            <div class="table-row">
                                <div class="table-cell">Taxable Value</div>
                                <div class="table-cell figure-cell">
                                    <span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.totalTaxableValue | giddhCurrency}}
                                </div>
                            </div>

                            <div class="table-row" *ngIf="!excludeTax">
                                <div class="table-cell">Tax</div>
                                <div class="table-cell figure-cell">
                                    <span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.gstTaxesTotal | giddhCurrency}}
                                </div>
                            </div>

                            <div class="table-row" *ngIf="!excludeTax">
                                <div class="table-cell">CESS</div>
                                <div class="table-cell figure-cell"><span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.cessTotal | giddhCurrency}}
                                </div>
                            </div>
                            <div class="table-row"
                                *ngIf="!isPurchaseInvoice && (calculatedRoundOff > 0 || calculatedRoundOff < 0)">

                                <div class="table-cell">
                                    <strong>Round Off</strong>
                                </div>

                                <div class="table-cell figure-cell">
                                    <strong> <span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>
                                        {{calculatedRoundOff | giddhCurrency}}</strong>
                                </div>

                            </div>

                            <div class="table-row ">

                                <div class="table-cell biggerDollar">
                                    <strong>Total <span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span></strong>
                                </div>

                                <div class="table-cell figure-cell">
                                    <strong><span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.grandTotal | giddhCurrency}}
                                    </strong>
                                </div>

                            </div>
                            <!-- multicurrency feature (editable grand total make it functional) -->
                            <div class="table-row" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                <div class="table-cell biggerDollar">
                                    <strong>Total <span>{{baseCurrencySymbol}}</span>
                                    </strong>
                                </div>

                                <div class="table-cell figure-cell">
                                    <input #grandTotalInr type="text" class="form-control" name="grandTotalMulDum"
                                        [prefix]="baseCurrencySymbol" [suffix]="selectedSuffixForCurrency"
                                        [mask]="inputMaskFormat" [(ngModel)]="grandTotalMulDum"
                                        (blur)="updateExchangeRate(grandTotalInr.value)">
                                </div>
                            </div>

                            <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tcsTotal > 0">
                                <div class="table-cell">TCS</div>
                                <div class="table-cell figure-cell"><span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>
                                    {{purchaseOrder.voucherDetails.tcsTotal | giddhCurrency}}</div>
                            </div>

                            <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tdsTotal > 0">
                                <div class="table-cell">TDS</div>
                                <div class="table-cell figure-cell"><span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.tdsTotal | giddhCurrency}}
                                </div>
                            </div>
                        </section>
                    </td>
                    <!-- endregion -->
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </section>
    <!-- region mobile view -->
    <div class="show-in-mobile" *ngIf="isMobileScreen">
        <div class="card-invoice-table-wrapper"
            *ngFor="let entry of purchaseOrder.entries; let entryIdx = index; let first = first; let last = last">
            <ng-container *ngFor="let transaction of entry.transactions;">
                <div class="card-invoice-table" [hidden]="activeIndx === entryIdx">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="single-card-row">
                                <div class="product-name">
                                    <label class="card-label">Product/Service Description</label>
                                    <label *ngIf="!transaction.accountName" class="selectAccountLabel">Click
                                        to Select
                                        Account</label>
                                    <p>{{transaction.accountName}}</p>
                                    <span
                                        *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}}
                                        )</span>
                                </div>

                                <p class="description">
                                    {{transaction.description}}
                                </p>
                                <p class="small text-muted sku-custom-fields" *ngIf="transaction.sku_and_customfields">
                                    {{transaction.sku_and_customfields}}</p>

                                <div class="date-hsn-code pdR0">
                                    <div class="row">

                                        <div class="col-xs-6" *ngIf="entry.entryDate">
                                            <div class="entry-date">
                                                <label>Entry Date: {{entry.entryDate | date: 'dd-MM-yyyy'}}
                                                </label>
                                            </div>
                                        </div>

                                        <div class="col-xs-6 pdL0"
                                            *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                            <div class="hsn-code text-right">
                                                <label>HSN/SAC:
                                                    {{(inventorySettings?.manageInventory || !transaction.sacNumberExists) ? transaction.hsnNumber : transaction.sacNumber}}</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-6">
                            <div class="single-card-row">
                                <div class="qty-unit">
                                    <label class="card-label">Qty/Unit</label>
                                    <p>{{transaction.quantity}} {{transaction.stockUnit}}</p>
                                </div>
                            </div>

                        </div>

                        <div class="col-xs-6">
                            <div class="single-card-row">
                                <div class="card-rate">
                                    <label class="card-label">Rate</label>
                                    <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                        <p> <span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                {{purchaseOrder.accountDetails.currencySymbol}}</span>
                                            {{transaction.rate | giddhCurrency: ratePrecision:true}}
                                        </p>
                                        <div *ngIf="isMulticurrencyAccount && !isPurchaseInvoice"
                                            class="differ-currency">
                                            <span>{{baseCurrencySymbol}}</span>
                                            <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-6">
                            <div class="single-card-row">
                                <div class="card-amount">
                                    <label class="card-label">Amount</label>
                                    <p> <span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}
                                        </span>{{transaction.amount | giddhCurrency}}</p>

                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-6">
                            <div class="single-card-row">
                                <div class="card-discount">
                                    <label class="card-label">Discount</label>
                                    <p> <span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>{{ entry.discountSum }}
                                    </p>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-6">
                            <div class="single-card-row">
                                <div class="card-tax">
                                    <label class="card-label">Tax</label>
                                    <p><span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>{{entry.taxSum}}
                                        %
                                    </p>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-6">
                            <div class="single-card-row">
                                <div class="card-total">
                                    <label class="card-label">Total</label>
                                    <p><span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                            {{purchaseOrder.accountDetails.currencySymbol}}</span>{{transaction.total | giddhCurrency}}
                                    </p>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="edit-card" (click)="setActiveIndx(entryIdx);$event.stopPropagation()">
                        <img src="assets/images/edit-pencilicon.svg">
                    </div>
                    <div class="del-card" (click)="removeTransaction(entryIdx)">
                        <i class="icon-trash" aria-hidden="true"></i>
                    </div>
                </div>
                <!-- endregion -->

                <!-- region dynamic entry -->
                <div class="card-invoice-table edit-card-invoice-table" [hidden]="activeIndx !== entryIdx">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="single-card-row">
                                <div class="product-name">
                                    <label class="card-label">Product/Service Description</label>
                                    <div class="product-name">
                                        <div class="ng-select-wrap">
                                            <sh-select [options]="salesAccounts$ | async"
                                                [(ngModel)]="transaction.fakeAccForSelect2"
                                                name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                                (selected)="onSelectSalesAccount($event,transaction, entry)"
                                                [placeholder]="'Select A/cc'" [notFoundLink]="true"
                                                [forceClearReactive]="forceClear$ | async"
                                                (noResultsClicked)="onNoResultsClicked(entryIdx)" [multiple]="false"
                                                [ItemHeight]="67" (onClear)="onClearSalesAccount(transaction)"
                                                [useInBuiltFilterForFlattenAc]="true">

                                                <ng-template #optionTemplate let-option="option">
                                                    <ng-container *ngIf="!option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item"
                                                            style="border-bottom: 1px solid #ccc;">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item_unq">
                                                                {{ option.additional?.uniqueName }}</div>
                                                        </a>
                                                    </ng-container>
                                                    <ng-container *ngIf="option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item"
                                                            style="border-bottom: 1px solid #ccc;">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item_unq">
                                                                {{ option.additional?.uniqueName }}</div>
                                                            <div class="item_stock">Stock:
                                                                {{ option.additional?.stock.uniqueName }}
                                                            </div>
                                                        </a>
                                                    </ng-container>
                                                </ng-template>
                                            </sh-select>
                                        </div>
                                    </div>
                                    <!-- *ngIf="transaction.fakeAccForSelect2" for below -->
                                    <div>
                                        <!-- <div class="sku-number">
                                            <label>SKU:</label>Number
                                        </div> -->

                                        <div class="description">
                                            <textarea type="text" placeholder="Add Description"
                                                name="transaction.description_{{entryIdx}}" class="form-control"
                                                [(ngModel)]="transaction.description"></textarea>
                                            <p class="small text-muted sku-custom-fields"
                                                *ngIf="transaction.sku_and_customfields">
                                                {{transaction.sku_and_customfields}}</p>
                                        </div>

                                        <!-- region entry date/ hsncode -->
                                        <div class="date-hsn-code">

                                            <div class="row">
                                                <div class="col-xs-6 pdR0">
                                                    <div class="entry-date">
                                                        <label>Entry Date: </label>

                                                        <span *ngIf="!isUpdateMode">
                                                            <input type="text" [placeholder]="giddhDateFormat"
                                                                bsDatepicker name="transaction.date_{{entryIdx}}"
                                                                id="transaction.date_{{entryIdx}}"
                                                                class="form-control text-left"
                                                                [(ngModel)]="entry.entryDate" [disabled]="isUpdateMode"
                                                                (onShown)="hsnDropdownShow = false"
                                                                [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                                #dp="bsDatepicker" />
                                                            <span class="edit-icon cp" (click)="dp.toggle()"
                                                                [attr.aria-expanded]="dp.isOpen">
                                                                <img src="assets/images/edit-pencilicon.svg">
                                                            </span>
                                                        </span>
                                                        <span *ngIf="isUpdateMode">
                                                            {{ entry.entryDate | date: 'dd-MM-yyyy'}}
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="col-xs-6 pdL0">
                                                    <div class="wrap-hsn-box"
                                                        (click)="toggleHsnSacDropDown(transaction)">
                                                        <div class="hsn-code text-right">
                                                            <label>HSN/SAC:</label>
                                                            <span>
                                                                {{(inventorySettings?.manageInventory || !transaction.sacNumber) ? transaction.hsnNumber : transaction.sacNumber }}
                                                                <span
                                                                    *ngIf="!transaction.hsnNumber && !transaction.sacNumber"
                                                                    class="update-text">Update
                                                                </span>
                                                                <span class="edit-icon cp">
                                                                    <img src="assets/images/edit-pencilicon.svg">
                                                                </span>
                                                            </span>
                                                        </div>
                                                        <div class="hsn-code-dropdown" *ngIf="hsnDropdownShow">
                                                            <label>HSN/SAC</label>
                                                            <input type="text" maxLength="10"
                                                                placeholder="HSN/SAC Number"
                                                                name="transaction.hsnNumber_{{entryIdx}}"
                                                                *ngIf="(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                [(ngModel)]="transaction.hsnNumber" />
                                                            <input type="text" maxLength="10"
                                                                placeholder="HSN/SAC Number"
                                                                name="transaction.hsnNumber_{{entryIdx}}"
                                                                *ngIf="!(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                [(ngModel)]="transaction.sacNumber" />
                                                            <a>
                                                            </a>
                                                            <div class="btngroup m-t-10">
                                                                <button class="btn btn-sm btn-success" type="button"
                                                                    (click)="hsnDropdownShow=!hsnDropdownShow">
                                                                    Save
                                                                </button>
                                                                <button class="btn btn-sm btn-primary" type="button"
                                                                    (click)="hideHsnSacEditPopup(transaction)">
                                                                    Cancel
                                                                </button>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <!-- endregion -->
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row quantity-unit-width-100">
                        <div class="col-xs-6">

                            <div class="single-card-row">
                                <div class="qty-unit">

                                    <div class="row">

                                        <div class="col-xs-6 pr-0">
                                            <label class="card-label text-right">Qty</label>
                                            <input type="text" [disabled]="!transaction.isStockTxn"
                                                (blur)="handleQuantityBlur(entry, transaction);" placeholder="Quantity"
                                                decimalDigitsDirective name="transaction.quantity_{{entryIdx}}"
                                                class="form-control text-right" [(ngModel)]="transaction.quantity" />
                                        </div>
                                        <div class="col-xs-6">
                                            <label class="card-label text-right">Unit</label>
                                            <select class="form-control" [disabled]="!transaction.isStockTxn"
                                                name="transaction.stockUnit_{{entryIdx}}"
                                                [(ngModel)]="transaction.stockUnit"
                                                (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                                <option *ngFor="let stock of transaction.stockList"
                                                    [ngValue]="stock.id">
                                                    {{stock.text}}
                                                </option>
                                            </select>

                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>

                        <div class="col-xs-6">

                            <div class="single-card-row">

                                <div class="card-rate">
                                    <label class="card-label text-right">Rate</label>
                                    <div style="flex: 1;">
                                        <input type="text" [disabled]="!transaction.isStockTxn"
                                            (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                            placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                            class="form-control transaction-rate text-right"
                                            [(ngModel)]="transaction.rate"
                                            [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                            [customDecimalPlaces]="ratePrecision" />
                                    </div>
                                    <!-- please add condition for show and hide -->
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                    <div class="row">

                        <div class="col-xs-6">

                            <div class="single-card-row">

                                <div class="card-amount">

                                    <label class="card-label text-right">Amount</label>
                                    <div style="flex: 1;">
                                        <input type="tel" (blur)="calculateWhenTrxAltered(entry, transaction)"
                                            (click)="transactionAmountClicked(transaction)" placeholder="Amount"
                                            name="transaction.amount_{{entryIdx}}" class="form-control text-right"
                                            [(ngModel)]="transaction.amount" decimalDigitsDirective
                                            [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="col-xs-6">

                            <div class="single-card-row">

                                <div class="card-discount">
                                    <label class="card-label text-right">Discount</label>
                                    <div class="text-right">

                                        <discount-control-component #discountComponent [discountMenu]="false"
                                            [discountAccountsDetails]="entry.discounts"
                                            [discountSum]="entry.discountSum" [showHeaderText]="false"
                                            (hideOtherPopups)="closeTaxControlPopup()"
                                            (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                            [maskInput]="inputMaskFormat"
                                            [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffixInput]="selectedSuffixForCurrency">
                                        </discount-control-component>

                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="row">

                        <div class="col-xs-6">

                            <div class="single-card-row">
                                <div class="card-tax">
                                    <label class="card-label text-right">Tax</label>

                                    <div class="text-right">
                                        <tax-control [taxes]="companyTaxesList" [date]="entry.entryDate"
                                            [taxRenderData]="entry.taxes" [totalForTax]="transaction.taxableValue"
                                            [applicableTaxes]="transaction.applicableTaxes"
                                            [exceptTaxTypes]="exceptTaxTypes"
                                            [allowedSelectionOfAType]="allowedSelectionOfAType" [showHeading]="false"
                                            [rootClass]="'salseInvoicetable'"
                                            (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                            (hideOtherPopups)="closeDiscountPopup()" [maskInput]="inputMaskFormat"
                                            [prefixInput]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffixInput]="selectedSuffixForCurrency">
                                        </tax-control>
                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="col-xs-6">
                            <div class="single-card-row">
                                <div class="card-total">
                                    <label class="card-label text-right">Total</label>
                                    <div>
                                        <input type="tel" name="transaction.total_{{entryIdx}}"
                                            class="form-control text-right"
                                            (blur)="calculateTransactionValueInclusively(entry, transaction)"
                                            [(ngModel)]="transaction.total" decimalDigitsDirective
                                            [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                            [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                        <div class="wrap-other-tax" *ngIf="isTcsTdsApplicable">
                                            <input type="checkbox" class="other-taxes-checkobx"
                                                [(ngModel)]="entry.isOtherTaxApplicable"
                                                *ngIf="!entry.isOtherTaxApplicable"
                                                name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                            <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                *ngIf="!entry.isOtherTaxApplicable" class="otherTaxLable"
                                                style="font-size:13px;vertical-align: middle">Other
                                                Tax?</label>
                                        </div>
                                        <div class="mt-1 other-taxes" *ngIf="entry.isOtherTaxApplicable">

                                            <span>

                                                <div class="d-flex align-items-center">
                                                    <span class="mr-05">
                                                        <a href="javascript:;"
                                                            (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                            <img src="assets/images/edit-pencilicon.svg">
                                                        </a>
                                                    </span>

                                                    <input class="text-right form-control other-taxes-input"
                                                        disabled="disabled" [(ngModel)]="entry.otherTaxSum"
                                                        [prefix]="purchaseOrder.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                        name="entry.otherTaxesSum_{{entryIdx}}" />
                                                </div>

                                                <p class="applicable-tax">
                                                    {{ entry.otherTaxModal?.appliedOtherTax?.name}}
                                                </p>
                                            </span>

                                        </div>
                                    </div>
                                    <div class="tax-in-currency text-right"
                                        *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && !isPurchaseInvoice">
                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                        <span>{{baseCurrencySymbol}}</span> :
                                        <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                    </div>
                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                        <span>{{baseCurrencySymbol}}</span>
                                        <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                    </div>

                                    <ng-container *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="save-card-data pointer">
                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                    </div>
                    <div class="del-card pointer" (click)="removeTransaction(entryIdx)">
                        <i class="icon-trash" aria-hidden="true"></i>
                    </div>

                </div>
                <!-- endregion -->
            </ng-container>

        </div>
        <div class="add-btn" (click)="addBlankRow(null)">
            <button class="btn btn-sm btn-success">Add More</button>
        </div>

        <div class="other-detail-card">
            <div>
                <div class="collapse-pane clearfix">
                    <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                        <div class="ico-box-wrap">
                            <div class="ico-box">
                                <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                    aria-hidden="true"></span>
                            </div>
                        </div>
                        <div class="ico-head">Other Details</div>
                    </div>

                    <div class="clearfix max-600  mr0" [collapse]="isOthrDtlCollapsed">

                        <div class="row">

                            <div class="form-group col-xs-4">
                                <input type="text" #shippingDate="ngModel"
                                    [placeholder]="templatePlaceholder?.shippedDateLabel" bsDatepicker
                                    name="shippingDate" [(ngModel)]="purchaseOrder.templateDetails.other.shippingDate"
                                    class="form-control" [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                    [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)" />
                                <p class="text-danger"
                                    *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                    Invalid Date</p>
                            </div>

                            <div class="form-group col-xs-4">
                                <input type="text" name="shippedVia"
                                    [(ngModel)]="purchaseOrder.templateDetails.other.shippedVia" class="form-control"
                                    [placeholder]="templatePlaceholder?.shippedViaLabel || 'Ship Via'" />
                            </div>

                            <div class="form-group col-xs-4">
                                <input type="text" name="trackingNumber"
                                    [(ngModel)]="purchaseOrder.templateDetails.other.trackingNumber"
                                    class="form-control"
                                    [placeholder]="templatePlaceholder?.trackingNumber || 'Tracking No.'" />
                            </div>
                        </div>
                    </div>

                </div>

                <div class="pdT1 pl0 max-600">
                    <label class="mrB1">Message</label>
                    <textarea style="height:120px" class="form-control" name="message2"
                        [(ngModel)]="purchaseOrder.templateDetails.other.message2"></textarea>
                </div>

            </div>
        </div>

        <div class="total-amount-description">

            <section class="table-section form-group">

                <div class="table-row">
                    <div class="table-cell">Total Amount</div>
                    <div class="table-cell figure-cell">
                        <span
                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.subTotal | giddhCurrency}}
                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">Discount</div>
                    <div class="table-cell figure-cell">
                        <span
                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.totalDiscount * -1 | giddhCurrency}}
                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">Taxable Value</div>
                    <div class="table-cell figure-cell">
                        <span
                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.totalTaxableValue | giddhCurrency}}
                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">Tax</div>
                    <div class="table-cell figure-cell">
                        <span
                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.gstTaxesTotal | giddhCurrency}}
                    </div>
                </div>

                <div class="table-row">
                    <div class="table-cell">CESS</div>
                    <div class="table-cell figure-cell">
                        <span
                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.cessTotal | giddhCurrency}}
                    </div>
                </div>
                <div class="table-row">

                    <div class="table-cell">
                        <strong>Round Off</strong>
                    </div>

                    <div class="table-cell figure-cell">
                        <strong>
                            <span
                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>
                            {{calculatedRoundOff | giddhCurrency}}
                        </strong>
                    </div>

                </div>
                <div class="table-row">
                    <div class="table-cell">
                        <strong>Total
                            <span
                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>

                        </strong>
                    </div>

                    <div class="table-cell figure-cell">
                        <strong>
                            <span
                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{purchaseOrder.accountDetails.currencySymbol}}</span>{{purchaseOrder.voucherDetails.grandTotal | giddhCurrency}}
                        </strong>
                    </div>
                </div>
                <div class="table-row">
                    <div class="table-cell bigger-dollar">
                        <strong>Total <span>
                                {{baseCurrencySymbol}}
                            </span>
                        </strong>
                    </div>

                    <div class="table-cell figure-cell">
                        <input #grandTotalInr type="text" class="form-control" name="grandTotalMulDum"
                            [prefix]="baseCurrencySymbol" [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                            [(ngModel)]="grandTotalMulDum" (blur)="updateExchangeRate(grandTotalInr.value)">

                    </div>
                </div>

                <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tcsTotal > 0">
                    <div class="table-cell">TCS</div>
                    <div class="table-cell figure-cell">
                        {{purchaseOrder.voucherDetails.tcsTotal | giddhCurrency}}

                    </div>
                </div>

                <div class="table-row" *ngIf="purchaseOrder.voucherDetails.tdsTotal > 0">
                    <div class="table-cell">TDS</div>
                    <div class="table-cell figure-cell">
                        {{purchaseOrder.voucherDetails.tdsTotal | giddhCurrency}}
                    </div>
                </div>
            </section>

        </div>
    </div>
    <!-- endregion -->
</form>


<section class="clearfix" *ngIf="!showLoader">

    <section id="actionPane" class="text-center">

        <div class="col-xs-12">

            <!-- region generate mode -->
            <div class="pull-right pr update-mode">
                <button type="button" class="btn btn-danger d-inline-block v-align-middle">Clear</button>

                <!-- region purchase invoice -->
                <span class="d-inline-block v-align-middle">
                    <button type="button" class="btn btn-default" (click)="onSubmitForm()">Save</button>
                </span>
                <!-- endregion -->

                <!-- region non purchase -->
                <span class="d-inline-block v-align-middle" hidden>
                    <div class="btn-group" dropdown [dropup]="true">
                        <button type="button"
                            class="btn btn-default generate-invoice">Generate<span>Cash</span></button>
                        <button id="button-split" type="button" dropdownToggle
                            class="btn btn-default dropdown-toggle dropdown-toggle-split"
                            aria-controls="dropdown-split">
                            <span class="caret"></span>
                            <span class="sr-only">Split button!</span>
                        </button>

                        <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu"
                            aria-labelledby="button-basic">

                            <li role="menuitem">
                                <a class="dropdown-item cp">Create & Send</a>
                            </li>

                            <li role="menuitem">
                                <a class="dropdown-item cp">Create& Print</a>
                            </li>

                            <li role="menuitem">
                                <a class="dropdown-item cp">Generate & Recurring</a>
                            </li>
                        </ul>
                    </div>
                </span>
                <!-- endregion -->

                <!-- region proforma/estimates -->
                <span class="d-inline-block v-align-middle" hidden>

                    <div class="btn-group" dropdown [dropup]="true">

                        <button type="button" class="btn btn-default">Create </button>

                        <button id="button-split2" type="button" dropdownToggle
                            class="btn btn-default dropdown-toggle dropdown-toggle-split"
                            aria-controls="dropdown-split">
                            <span class="caret"></span>
                            <span class="sr-only">Split button!</span>
                        </button>

                        <ul id="dropdown-basic2" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu"
                            aria-labelledby="button-basic">
                            <li role="menuitem">
                                <a class="dropdown-item cp">Create & Send</a>
                            </li>

                            <li role="menuitem">
                                <a class="dropdown-item cp">Create & Print</a>
                            </li>
                        </ul>
                    </div>
                </span>
                <!-- endregion -->

            </div>
            <!-- endregion -->

            <!-- region update mode -->
            <div class="pull-right pr" *ngIf="isUpdateMode">

                <button type="button" class="btn btn-danger d-inline-block v-align-middle"
                    (click)="cancelUpdate()">Cancel</button>

                <button type="button" class="btn btn-default">Update</button>
            </div>
            <!-- endregion -->

        </div>
    </section>
</section>

<!-- endregion -->
<div class="aside-overlay"
    *ngIf="accountAsideMenuState === 'in' || asideMenuStateForProductService === 'in' || asideMenuStateForRecurringEntry === 'in' || asideMenuStateForOtherTaxes === 'in'">
</div>
<generic-aside-menu-account [class]="accountAsideMenuState" [@slideInOut]="accountAsideMenuState"
    (closeAsideEvent)="toggleAccountAsidePane($event)"
    [selectedGrpUniqueName]="selectedGroupUniqueNameForAddEditAccountModal"
    [keyboardShortcut]="{'esc':accountAsideMenuState ==='in'}" *ngIf="accountAsideMenuState === 'in'"
    [selectedAccountUniqueName]="selectedVendorForDetails" (onShortcutPress)="toggleAccountAsidePane()"
    (addEvent)="addNewSidebarAccount($event)" (updateEvent)="updateSidebarAccount($event)"></generic-aside-menu-account>

<!-- region bulk items -->
<div bsModal #bulkItemsModal="bs-modal" tabindex="-1" class="modal fade" role="dialog"
    [config]="{ animated: true,keyboard: false,backdrop: false,ignoreBackdropClick: true }">
    <ng-container *ngIf="showBulkItemModal">
        <proforma-add-bulk-items-component [data]="salesAccounts$ | async" (saveItemsEvent)="addBulkStockItems($event)"
            (closeEvent)="bulkItemsModal.hide()"></proforma-add-bulk-items-component>
    </ng-container>
</div>
<!-- endregion -->