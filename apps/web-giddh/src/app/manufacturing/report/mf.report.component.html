<section id="manufacture" class="clearfix">
    <!-- page Title -->
    <hamburger-menu *ngIf="!isInventoryPage" [pageHeading]="'Mfg. Journal Register'"></hamburger-menu>
    <div class="clearfix">
        <div class="mr-t15 justify-content-between pr-3" [ngClass]="{'d-flex' : currentCompanyBranches?.length > 2}">
            <div *ngIf="currentCompanyBranches?.length > 2" class="form-group col-lg-2 col-md-6 linked-entities">
                <label class="d-block pb-1">Entity</label>
                <sh-select [options]="currentCompanyBranches" [(ngModel)]="currentBranch.uniqueName" class="branch-dropdown"
                    name="entityDropdown" [showClear]="false" [ItemHeight]="33" width="100%" (selected)="handleBranchChange($event)"
                    [isFilterEnabled]="true" placeholder="Select Entity" [fixedValue]="currentBranch?.alias">
                    <ng-template #optionTemplate let-option="option">
                        <ng-container>
                            <a href="javascript:void(0)" class="list-item d-flex">
                                <span class="entity-icon">
                                    <i class="icon-branch-icon pull-right" *ngIf="option.parentBranch" tooltip="Branch"></i>
                                    <i class="icon-branch-icon pull-right" *ngIf="!option.parentBranch && !option.isCompany"
                                        tooltip="HO Branch"></i>
                                    <i class="icon-company-profile pull-right" *ngIf="option.isCompany" tooltip="Company"></i>
                                </span>
                                <span class="entity-details">
                                    <div class="item giddh-limit single-line-clamp">{{ option.label || '-' }}</div>
                                    <div class="item-unique giddh-limit single-line-clamp">
                                        {{ option.name || '-' }}
                                    </div>
                                </span>
                            </a>
                        </ng-container>
                    </ng-template>
                </sh-select>
            </div>
            <div>
                <label class="d-none" [ngClass]="{'d-block' : currentCompanyBranches?.length > 2}" >&nbsp;</label>
                <button *ngIf="!isCompany" class="btn isActive pull-right mr-0 mobile-none" (click)="goToCreateNewPage()" type="button">Create
                Manufacture</button>
            </div>
        </div>
    </div>
    <!-- form -->
    <div class="col-12 col-sm-12">
        <div class="mf-stock-search-request-form clearfix">
            <form #mfStockSearchRequestForm="ngForm" class="mt-0 col-12 pl-0 pr-0 mr-t15 mr-b05 manufacturing-form" (submit)="getReports()"
                autocomplete="off">
                <div class="row">
                    <div class="form-group col-xl-2 col-lg-2 col-md-6">
                        <label class="d-block">Final Product</label>
                        <sh-select placeholder="--Select Product--" name="product" #productList="ngModel" required
                            [(ngModel)]="mfStockSearchRequest.product" [options]="stockListDropDown"
                            [ItemHeight]="33" (selected)="setActiveStockGroup($event)"></sh-select>
                    </div>
                    <div class="form-group col-xl-2 col-lg-3 col-md-6 col-12 datepicker-flex">
                        <label class="d-block">From - To</label>
                        <div class="custom-datepicker" (click)="showGiddhDatepicker($event)">
                            <i class="icon-calender calendar-addon"></i>
                            <input type="text" name="selectedDateRange" [value]="(selectedDateRangeUi) ? selectedDateRangeUi : ''" class="giddh-datepicker date-range-picker" />
                        </div>
                    </div>

                    <div class="form-group col-xl-2 col-lg-2 col-md-6 col-xs-6">
                            <label class="d-block">Search By</label>
                            <sh-select placeholder="--Select--" name="searchBy"
                                [(ngModel)]="mfStockSearchRequest.searchBy" [options]="filtersForSearchBy"
                                [ItemHeight]="33"></sh-select>
                    </div>
                    <div class="form-group col-xl-2 col-lg-2 col-md-6 col-xs-6">
                        <label class="d-block">Operation</label>
                        <sh-select placeholder="--Select--" name="searchOperation"
                            [(ngModel)]="mfStockSearchRequest.searchOperation" [options]="filtersForSearchOperation"
                            [ItemHeight]="33"></sh-select>
                    </div>
                    <div class="form-group col-xl-2 col-lg-2 col-md-6 col-xs-6">
                        <label class="d-block">Value</label>
                        <input type="text" decimalDigitsDirective [DecimalPlaces]="4" class="form-control"
                            placeholder="Value" name="searchValue" [(ngModel)]="mfStockSearchRequest.searchValue" />
                    </div>
                    <div class="form-group col-xl-1 col-lg-1 col-md-6">
                        <label class="d-block d-none-xs">&nbsp;</label>
                        <!-- [disabled]="mfStockSearchRequestForm.invalid" -->
                        <button class="btn btn-success" type="submit">Go</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- search form end -->
    <section *ngIf="(isReportLoading$ | async)" class="clearfix mr-t100 col-md-12">
        <p class="lead text-center mr-t4">Loading...</p>
    </section>
    <div class="no-data mr-t100 col-12 col-sm-12"
        *ngIf="!(isReportLoading$ | async) && reportData && reportData.results.length === 0">
        <h1>No entries found within given criteria.</h1>
        <h1>Do search with some other dates</h1>
    </div>
    <section *ngIf="!(isReportLoading$ | async) && reportData && reportData.results.length > 0">
        <div class="" id="mfReportTbl">
            <div class="col-12 col-sm-12">
                <table class="table basic table-bordered giddh-table on-mobile-view manufacture-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Voucher Number</th>
                            <th>Final Product</th>
                            <th>Raw Products</th>
                            <th>Product Inwards</th>
                            <th>Quantity Outwards</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of reportData.results" (dblclick)="editMFItem(item)" class="cp">
                            <td data-title="Date">{{item.date}}</td>
                            <td data-title="Voucher Number">{{item.voucherNumber}}</td>
                            <td data-title="Final Product">{{item.stockName}}</td>
                            <td data-title="Raw Products">{{item.manufacturingQuantity}} {{item.manufacturingUnit}}</td>
                            <td data-title="Product Inwards">
                                <span *ngFor="let row of item.linkedStocks">
                                    {{row.stockName}}
                                </span>
                            </td>
                            <td data-title="Quantity Outwards">
                                <span *ngFor="let row of item.linkedStocks">
                                    {{row.manufacturingQuantity}} {{row.manufacturingUnit}}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div *ngIf="reportData?.totalPages > 1" class="pagination-wrapper">
                    <div class="text-center">
                        <pagination [totalItems]="reportData.totalItems" [(ngModel)]="reportData.page" [maxSize]="5"
                            class="pagination-sm" [boundaryLinks]="true" [itemsPerPage]="20" [rotate]="false"
                            (pageChanged)="pageChanged($event)"></pagination>
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>
<ng-template #datepickerTemplate>
    <div class="datepicker-modal">
        <div class="modal-body">
            <app-datepicker-wrapper [inputStartDate]="selectedDateRange?.startDate" [inputEndDate]="selectedDateRange?.endDate" [alwaysShowCalendars]="true" [ranges]="datePickerOption" [selectedRangeLabel]="selectedRangeLabel" [showCustomRangeLabel]="true"
                                    [showClearButton]="false" [showCancel]="true" [linkedCalendars]="true" [showDropdowns]="true" [locale]="{applyLabel: 'Done'}" (rangeClicked)="dateSelectedCallback($event)" (datesUpdated)="dateSelectedCallback($event)" [keepCalendarOpeningWithRange]="false"
                                    [showRangeLabelOnInput]="false" [dateFieldPosition]="dateFieldPosition"></app-datepicker-wrapper>
        </div>
    </div>
</ng-template>
