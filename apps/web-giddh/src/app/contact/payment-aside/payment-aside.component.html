<div class="modal-header">
    <h4 class="modal-title pull-left">Payment</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="closePaymentModel(false)">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
<div class="modal-body">
    <div class="clearfix">
        <form #adjustAdvancePaymentForm="ngForm" autocomplete="off">
            <div class="row d-flex align-items-center payment-top-form">
                <div class="col-sm-12">
                    <div class="d-flex mr-b1">
                        <div class="form-group mr-r15 select-bank">
                            <label>Select Bank<span class="red-text">*</span></label>
                            <div class="relative">
                                <img *ngIf="(isGetAllIntegratedBankInProgress$ | async)" class="dropdown-loader" src="assets/images/loader.gif" alt="">
                                <sh-select [options]="selectIntegratedBankList" [disabled]="isPayClicked" #selectBankEle [multiple]="false" [ItemHeight]="33" [fixedValue]="selectedBankName" [isFilterEnabled]="true" class="text-left" [(ngModel)]="selectedBankUniqueName" name="selectedBankUniqueName"
                                    required [isRequired]="true" placeholder="Select Bank" (click)="setBankName($event, selectBankEle);" (selected)="selectBank($event);" [multiple]="false">
                                    <ng-template #optionTemplate let-option="option">
                                        <a href="javascript:void(0)" class="list-item">
                                            <div class="item">{{option?.label}}</div>
                                            <div class="item-unique">
                                                <p class="font-12 text-gray mb-0">A/c No.: {{option?.additional?.accountNo}}
                                                </p>
                                            </div>
                                            <div class="item-unique">
                                                <p class="font-12 text-gray mb-0">Clo Bal: {{option?.additional?.effectiveBal | giddhCurrency}} dr.
                                                </p>
                                            </div>
                                        </a>
                                    </ng-template>
                                </sh-select>
                            </div>
                            <!-- <sh-select *ngIf="selectIntegratedBankList.length === 1" [options]="selectIntegratedBankList" [(ngModel)]="selectedBankUrn" class="text-left" name="urn" required placeholder="'Select Bank'" (ngModelChange)="selectBank($event);" [multiple]="false">
                                <ng-template #optionTemplate let-option="option">
                                    <a href="javascript:void(0)" class="list-item">
                                        <div class="item">{{option?.label}}</div>
                                        <div class="item-unique">
                                            <p class="font-12 text-gray mb-0">Clo Bal: {{option?.additional?.effectiveBal | giddhCurrency}} dr.
                                            </p>
                                        </div>
                                    </a>
                                </ng-template>
                            </sh-select> -->
                            <p *ngIf="totalAvailableBalance"><small class="text-gray">Bal {{totalAvailableBalance | giddhCurrency}} dr.</small></p>
                        </div>
                        <div class="form-group mr-r15">
                            <label>Total Amount<span class="red-text">*</span></label>
                            <input type="text" class="form-control" decimalDigitsDirective disabled [mask]="inputMaskFormat" [(ngModel)]="totalSelectedAccountAmount" name="amount">
                        </div>
                        <div class="form-group mr-r15" *ngIf="isPayClicked">
                            <label class="relative d-flex">Enter OTP<span class="red-text">*</span>
                                <p class="resend-btn" *ngIf="!timerOn"><a href="javascript:void(0);"
                                        (click)="reSendOTP()" class="btn-link">Resend</a></p>
                                <!-- make timer dynamic -->
                                <p class="resend-btn timer-count" *ngIf="timerOn"><a
                                        href="javascript:void(0);" class="btn-link">{{timerCountDown$ | async}}</a></p>
                            </label>
                            <input type="text" class="form-control" placeholder="Enter OTP" required name="receivedOtp" (keypress)="allowOnlyNumbers($event)" [(ngModel)]="receivedOtp">
                        </div>
                        <div class="form-group mr-r15">
                            <label class="d-flex"> &nbsp; </label>
                            <button type="button" *ngIf="!isPayClicked" class="btn btn-success" [disabled]="!isBankSelectedForBulkPayment || !isValidData" [ladda]="isRequestInProcess" (click)="payClicked()">Pay</button>

                            <button *ngIf="isPayClicked" class="btn btn-success" [disabled]="!isBankSelectedForBulkPayment || !isValidData || !receivedOtp" [ladda]="isRequestInProcess" (click)="confirmOTP()">Confirm</button>
                            <button type="button" *ngIf="isPayClicked" class="btn btn-primary" (click)="clickedCancelOtp();">Cancel OTP</button>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3" *ngIf="otpReceiverNameMessage">
                    <p class="otp-success-msg text-right"> <span class="mr-1 d-inline-block">
                        <img src="{{imgPath}}checked-success.svg">
                        </span>{{otpReceiverNameMessage}}</p>
                </div>

            </div>
            <div class="selected-bank-details">
                <!-- loop should in below div -->
                <ng-container *ngFor="let item of selectedAccForBulkPayment;let entryIdx = index; let first = first; let last = last">
                    <div class="mb-2">
                        <div class="account-holder-name">
                            <p>{{item.name}}</p>
                            <p class="text-gray due-amount hidden-xs">
                                Total Due:{{item.totalDueAmount | giddhCurrency}}
                                <span class="red-text cursor-pointer" *ngIf="selectedAccForBulkPayment.length > 1" (click)="removeSelectedAccount(item); removeTransactionsDetailsForm(entryIdx)"><i
                                        class="icon-trash mr-r05"></i>Remove</span>
                            </p>
                        </div>
                        <div class="bank-details-wrapper">
                            <div class="readonly-bank-details">
                                <div class="label-value-data">
                                    <label>Bank Name</label>
                                    <label>{{item?.accountBankDetails?.bankName}}</label>
                                    <!-- <input class="form-control" [value]="item?.accountBankDetails?.bankName" name="bankName{{entryIdx}}" [(ngModel)]="item.accountBankDetails.bankName" type="text" disabled /> -->
                                </div>
                                <div class="label-value-data d-flex">
                                    <div class="mr-1">
                                        <!-- <label>Account Number</label> -->
                                        <label *ngIf="item.country.code ==='IN' ">Account #:</label>
                                        <label *ngIf="item.country.code !=='IN' ">IBAN</label>
                                        <label>{{item?.accountBankDetails?.bankAccountNo}}</label>
                                        <!-- <input class="form-control" [value]="item?.accountBankDetails?.bankAccountNo" name="bankAccountNo{{entryIdx}}" [(ngModel)]="item.accountBankDetails.bankAccountNo" type="text" disabled> -->
                                    </div>
                                    <div *ngIf="item.country.code !=='IN' ">
                                        <label>SWIFT Code/BIC</label>
                                        <label>{{item?.accountBankDetails?.swiftCode}}</label>
                                        <!-- <input class="form-control" [value]="item?.accountBankDetails?.swiftCode" name="swiftCode{{entryIdx}}" [(ngModel)]="item.accountBankDetails.swiftCode" type="text" disabled> -->
                                    </div>
                                    <div *ngIf="item.country.code ==='IN' ">
                                        <label>IFSC Code:</label>
                                        <label>{{item?.accountBankDetails?.ifsc}}</label>
                                        <!-- <input class="form-control" [value]="item?.accountBankDetails?.ifsc" name="ifsc{{entryIdx}}" [(ngModel)]="item.accountBankDetails.ifsc" type="text" disabled> -->
                                    </div>

                                </div>
                            </div>
                            <div class="amount-remark-section">
                                <div class="d-flex flex-column flex-md-row">
                                    <div class="form-group pd-r15">
                                        <label>Amount<span class="text-danger">*</span></label>
                                        <input class="form-control" name="closingBalanceAmount{{entryIdx}}" maxLength="12" decimalDigitsDirective (blur)="getTotalAmount();preventZero(item.closingBalanceAmount, entryIdx)" [mask]="inputMaskFormat" [(ngModel)]="item.closingBalanceAmount" type="text"
                                            [required]="!isPayClicked" [disabled]="isPayClicked">

                                    </div>
                                    <div class="form-group remark-block">
                                        <label>Remark<span class="text-danger">*</span></label>
                                        <textarea rows="1" name="remark{{entryIdx}}" id="{{entryIdx}}" (blur)="getTotalAmount();" [(ngModel)]="item.remarks" autocomplete="off" required type="text" class="form-control" [disabled]="isPayClicked" placeholder="Remark"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>


                <!-- <div class="creditors-detail">
            <p>{{accountDetails?.name}}</p>
            <div class="contact-details">
                <p class="contactNo">
                    {{accountDetails?.mobileNo}}
                </p>
                <p>{{accountDetails?.uniqueName}}</p>
                <p>{{accountDetails?.addresses[0]?.gstNumber}}</p>
                <div class="row mr-b1">
                    <div class="col-sm-6 col-xs-12" *ngIf="countryCode ==='AE'">
                        <label>Beneficiary Name</label>
                        <input class="form-control" [value]="accountDetails?.accountBankDetails[0]?.beneficiaryName" type="text" disabled />
                    </div>
                    <div class="col-sm-6 col-xs-12" [ngClass]="{'mr-t1': countryCode ==='AE'}">
                        <label>Bank Name</label>
                        <input class="form-control" [value]="accountDetails?.accountBankDetails[0]?.bankName" type="text" disabled />
                    </div>
                    <div class="col-sm-6 col-xs-12" *ngIf="countryCode ==='AE'">
                        <div class="form-group">
                            <label>Branch Name</label>
                            <input class="form-control" [value]="accountDetails?.accountBankDetails[0]?.branchName" type="text" disabled>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xs-12" [ngClass]="{'mr-t1': countryCode ==='AE'}">
                        <div class="form-group">
                            <label *ngIf="countryCode ==='IN' ">Account Number</label>
                            <label *ngIf="countryCode !=='IN' ">IBAN</label>
                            <input class="form-control" [value]="accountDetails?.accountBankDetails[0]?.bankAccountNo" type="text" disabled>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xs-12" *ngIf="countryCode ==='AE'">
                        <div class="form-group">
                            <label>SWIFT Code/BIC</label>
                            <input class="form-control" [value]="accountDetails?.accountBankDetails[0]?.swiftCode" type="text" disabled>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xs-12" *ngIf="countryCode ==='IN'">
                        <div class="form-group">
                            <label>IFSC Code</label>
                            <input class="form-control" [value]="accountDetails?.accountBankDetails[0]?.ifsc" type="text" disabled>
                        </div>
                    </div>
                </div>
                <div class="row mr-b1">
                    <div class="col-sm-6 col-xs-12">
                        <div class="form-group">
                            <label>Bank Name</label>
                            <input class="form-control" [value]="accountDetails?.accountBankDetails[0]?.bankName" type="text" disabled>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->

                <!-- <div>
            <div>
                <div class="account-details">
                    <div class="selectMode">
                        <form #paymentForm="ngForm" autocomplete="off">
                            <div class="row mr-b2">
                                <div class="col-sm-6 col-xs-12">contact-detail
                                    <div class="form-group custom-select position-relative">
                                        <label>Select Mode<span class="text-danger">*</span></label>
                                        <div dropdown>
                                            <select class="form-control" [disabled]="OTPsent" [(ngModel)]="mode" name="mode" id="mode">
                                                <option *ngFor="let account of registeredAccounts"
                                                    [ngValue]="account">
                                                    {{account.bank}}
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3 col-xs-12">
                                    <div class="form-group">
                                        <label>Amount<span class="text-danger">*</span></label>
                                        <input class="form-control" name="amount" [(ngModel)]="amount" type="number">
                                    </div>
                                </div>
                            </div>
                            <div class="row mr-b2">
                                <div class="form-group">
                                    <div class="col-sm-9 col-xs-12">
                                        <label>Remark<span class="text-danger">*</span></label>
                                        <textarea rows="5" autocomplete="off" type="text" class="form-control" placeholder="Remark" [(ngModel)]="remarks" name="remarks"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row mr-b1" *ngIf="OTPsent">
                                <div class="col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <label>Enter OTP</label>
                                        <input class="form-control" name="OTP" [(ngModel)]="OTP" type="number" maxlength="4">
                                    </div>
                                </div>

                                <div class="col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <label> </label>
                                        <div style="margin-top: 15px; cursor: pointer"><a (click)="reSendOTP()">Resend
                                                OTP</a></div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <button *ngIf="!OTPsent" class="btn btn-success" [disabled]="!mode || amount===0 || remarks === ''" (click)="sendOTP()">Send
                                        OTP</button>
                                    <button *ngIf="OTPsent" class="btn btn-success" [disabled]="!mode || amount===0 || remarks === ''" (click)="confirmOTP()">Confirm</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div> -->
            </div>
        </form>
    </div>

    <ng-template #successTemplate>
        <div class="modal-header">
            <h4 class="modal-title pull-left">Payment Status</h4>
            <button type="button" class="close pull-right" aria-label="Close" (click)="successModalRef.hide()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="payment-img">
                <img src="{{imgPath}}payment-succes.svg">
            </div>
            <h4>Payment proceed</h4>
            <p>Status of all payments will be mailed shortly.</p>
            <button class="btn btn-success" (click)="successModalRef.hide()">Done</button>
        </div>
    </ng-template>
    <!-- <button id="close" (click)="closeAsidePane($event)"><i class="icon-cross"></i></button>
  -->

    <!-- (click)="successModalRef.hide()" -->
