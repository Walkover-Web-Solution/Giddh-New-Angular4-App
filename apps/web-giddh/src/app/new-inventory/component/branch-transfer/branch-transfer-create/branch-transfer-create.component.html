<ng-container
    appTranslate
    [file]="'inventory/stock'"
    (commonLocaleData)="commonLocaleData = $event"
    (localeData)="localeData = $event"
    ><section id="branch-transfer-create">
        <div class="branch-transfer-header">
            <h2>{{ branchTransferMode === "receipt-note" ? "Receipt Note" : "Delivery Challan" }}</h2>
        </div>
        <div class="branch-transfer-body">
            <div class="branch-transfer-body-radio-btns" *ngIf="!editBranchTransferUniqueName">
                <mat-radio-group name="products_sender" [(ngModel)]="transferType">
                    <mat-radio-button color="primary" value="products" (click)="changeTransferType()"
                        >Multiple Products</mat-radio-button
                    >
                    <mat-radio-button
                        color="primary"
                        value="senders"
                        (click)="changeTransferType()"
                        *ngIf="branchTransferMode === 'receipt-note'"
                        >Multiple Senders</mat-radio-button
                    >
                    <mat-radio-button
                        (click)="changeTransferType()"
                        color="primary"
                        value="senders"
                        *ngIf="branchTransferMode === 'delivery-challan'"
                        >Multiple Receivers</mat-radio-button
                    >
                </mat-radio-group>
            </div>

            <div class="branch-transfer-body-multiple-wrapper">
                <form
                    autocomplete="off"
                    novalidate
                    name="branchTransferCreateEditForm"
                    [formGroup]="branchTransferCreateEditForm"
                >
                    <div class="row clearfix primary-form-wrapper row-gap">
                        <div class="col-lg-8 px-0">
                            <div class="row">
                                <div class="col-lg-6 mr-b15">
                                    <div class="direct-mat-datepicker">
                                        <giddh-datepicker
                                            (dateSelected)="selectDate($event, 'dateOfSupply')"
                                            [readonly]="!editBranchTransferUniqueName"
                                            [disabled]="editBranchTransferUniqueName ? 'disabled' : null"
                                            formControlName="dateOfSupply"
                                            name="date"
                                            [cssClass]="'w-100'"
                                            [showToggleIcon]="false"
                                            [appearance]="'outline'"
                                            [placeholder]="
                                                branchTransferMode === 'receipt-note'
                                                    ? 'Date of Receipt'
                                                    : 'Date of Supply'
                                            "
                                        >
                                        </giddh-datepicker>
                                    </div>
                                </div>
                            </div>
                            <div class="row row-gap">
                                <div class="col-lg-6">
                                    <div *ngIf="transferType === 'senders'">
                                        <div *ngIf="branchTransferMode === 'delivery-challan'">
                                            <dropdown-field
                                                (createOption)="onProductNoResultsClicked(0)"
                                                [showCreateNew]="true"
                                                [name]="'productName'"
                                                [placeholder]="'Product\'s Name'"
                                                [options]="stockList"
                                                [appearance]="'outline'"
                                                (selectedOption)="
                                                    selectProduct(
                                                        $event,
                                                        branchTransferCreateEditForm.get('products.0')?.value
                                                    )
                                                "
                                                [allowValueReset]="true"
                                            >
                                            </dropdown-field>
                                        </div>
                                        <div *ngIf="branchTransferMode === 'receipt-note'">
                                            <dropdown-field
                                                (createOption)="onProductNoResultsClicked(0)"
                                                [showCreateNew]="true"
                                                [name]="'productName'"
                                                [placeholder]="'Product\'s Name'"
                                                [options]="stockList"
                                                [appearance]="'outline'"
                                                (selectedOption)="
                                                    selectProduct(
                                                        $event,
                                                        branchTransferCreateEditForm.get('products.0')?.value
                                                    );
                                                    focusDestinationWarehouse()
                                                "
                                                [allowValueReset]="true"
                                            >
                                            </dropdown-field>
                                        </div>
                                        <div class="mr-b15 mr-t15">
                                            <input-field
                                                [type]="'text'"
                                                [name]="'skuCode'"
                                                [label]="'SKU Code'"
                                                [appearance]="'outline'"
                                            >
                                            </input-field>
                                        </div>
                                    </div>
                                    <div *ngIf="transferType === 'products'">
                                        <div *ngIf="branchTransferMode === 'delivery-challan'">
                                            <input-field
                                                *ngIf="(isBranch || isCompanyWithSingleBranch) && !isUpdateMode"
                                                [name]="'sourceName'"
                                                formControlName="myCurrentCompany"
                                                [placeholder]=""
                                                [type]="'text'"
                                                [readonly]="isBranch || isCompanyWithSingleBranch"
                                            >
                                            </input-field>
                                            <dropdown-field
                                                *ngIf="isUpdateMode"
                                                [name]="'senderName'"
                                                [placeholder]="'Sender\'s Name'"
                                                [options]="branches"
                                                (selectedOption)="
                                                    selectSenderName($event, 0); focusSourceWarehouse($event)
                                                "
                                                [readonly]="isUpdateMode"
                                            >
                                            </dropdown-field>
                                            <i
                                                *ngIf="
                                                    destinationWarehouses[
                                                        branchTransferCreateEditForm.get('sources.0.uniqueName')?.value
                                                    ]?.length !==
                                                    allWarehouses[
                                                        branchTransferCreateEditForm.get('sources.0.uniqueName')?.value
                                                    ]?.length
                                                "
                                                class="icon-info"
                                                matTooltip="{{ branchTransferInfoText }}"
                                            >
                                            </i>
                                        </div>
                                        <div *ngIf="branchTransferMode === 'receipt-note'">
                                            <dropdown-field
                                                #defaultSource
                                                [name]="'senderName'"
                                                [placeholder]="'Sender\'s Name'"
                                                [options]="branches"
                                                (selectedOption)="
                                                    selectSenderName($event, 0); focusSourceWarehouse($event)
                                                "
                                                [readonly]="isUpdateMode"
                                            >
                                            </dropdown-field>
                                            <i
                                                *ngIf="
                                                    destinationWarehouses[
                                                        branchTransferCreateEditForm.get('sources.0.uniqueName')?.value
                                                    ]?.length !==
                                                    allWarehouses[
                                                        branchTransferCreateEditForm.get('sources.0.uniqueName')?.value
                                                    ]?.length
                                                "
                                                class="icon-info"
                                                matTooltip="{{ branchTransferInfoText }}"
                                            >
                                            </i>
                                        </div>
                                        <div *ngIf="editBranchTransferUniqueName" class="mr-b15 mr-t15">
                                            <input-field
                                                [name]="'name'"
                                                [label]="'Sender\'s Warehouse'"
                                                [placeholder]=""
                                                [type]="'text'"
                                            >
                                            </input-field>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-space-between align-items-center mr-b15">
                                        <div class="mr-b1" *ngIf="transferType === 'senders'">
                                            <mat-radio-group name="sender_HsnSac" class="d-flex font-14">
                                                <mat-radio-button color="primary" value="HSN"
                                                    >HSN Code</mat-radio-button
                                                >
                                                <mat-radio-button color="primary" value="SAC"
                                                    >SAC Code</mat-radio-button
                                                >
                                            </mat-radio-group>
                                        </div>
                                        <div
                                            class="w-100 ml-3"
                                            *ngIf="transferType === 'senders'"
                                            [ngStyle]="{ 'visibility': senderHsnSacStatus ? 'visible' : 'hidden' }"
                                        >
                                            <input-field
                                                [type]="'number'"
                                                [name]="''"
                                                [placeholder]="senderHsnSacStatus + ' Code'"
                                                [appearance]="'outline'"
                                            >
                                            </input-field>
                                        </div>
                                    </div>
                                    <div *ngIf="transferType === 'products'" formArrayName="sources">
                                        <div [formGroupName]="0">
                                            <div class="mr-b15">
                                                <dropdown-field
                                                    [name]="'senderWarehouse'"
                                                    [placeholder]="'Sender\'s Warehouse'"
                                                    (selectedOption)="selectSenderWarehouse($event, 0)"
                                                    [options]="
                                                        senderWarehouses[
                                                            branchTransferCreateEditForm.get('sources.0.uniqueName')
                                                                ?.value
                                                        ]
                                                    "
                                                    [defaultValue]="
                                                        branchTransferCreateEditForm.get(
                                                            'sources.0.warehouse.uniqueName'
                                                        ).value
                                                    "
                                                    [allowValueReset]="true"
                                                    (onClear)="resetWarehouse('sources', 0)"
                                                >
                                                </dropdown-field>
                                            </div>
                                            <div formGroupName="warehouse">
                                                <div
                                                    class="mr-b15"
                                                    *ngIf="
                                                        branchTransferCreateEditForm.get(
                                                            'sources.0.warehouse.taxNumber'
                                                        )?.value &&
                                                        branchTransferCreateEditForm.get(
                                                            'sources.0.warehouse.uniqueName'
                                                        )?.value &&
                                                        formFields &&
                                                        formFields['taxName']
                                                    "
                                                >
                                                    <input-field
                                                        [name]="'gstin'"
                                                        [placeholder]="getEnterTaxText()"
                                                        [type]="'text'"
                                                        formControlName="taxNumber"
                                                        [label]="'Sender\'s ' + formFields['taxName']?.label + '*'"
                                                        [maxlength]="15"
                                                        (change)="checkTaxNumberValidation()"
                                                        [readonly]="
                                                            branchTransferCreateEditForm.get(
                                                                'sources.0.warehouse.uniqueName'
                                                            )?.value
                                                        "
                                                    >
                                                    </input-field>
                                                </div>
                                                <div class="mr-b15">
                                                    <mat-form-field appearance="outline" class="w-100">
                                                        <mat-label>Sender's Address</mat-label>
                                                        <textarea
                                                            matInput
                                                            rows="3"
                                                            class="form-control"
                                                            rows="3"
                                                            name="sourceAddress"
                                                            formControlName="address"
                                                            [readonly]="
                                                                branchTransferCreateEditForm.get(
                                                                    'sources.0.warehouse.uniqueName'
                                                                )?.value
                                                            "
                                                        ></textarea>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div *ngIf="branchTransferMode === 'receipt-note'">
                                        <input-field
                                            *ngIf="(isBranch || isCompanyWithSingleBranch) && !isUpdateMode"
                                            [name]="'myCurrentCompany'"
                                            formControlName="myCurrentCompany"
                                            [type]="'text'"
                                            [placeholder]="'Receiver\'s Name'"
                                            [readonly]="isBranch || isCompanyWithSingleBranch"
                                        >
                                        </input-field>
                                    </div>
                                    <div formArrayName="destinations">
                                        <div [formGroupName]="0">
                                            <div *ngIf="branchTransferMode === 'delivery-challan'">
                                                <div class="mr-b15">
                                                    <dropdown-field
                                                        [name]="'receiverName'"
                                                        [placeholder]="'Receiver\'s Name'"
                                                        [options]="branches"
                                                        (selectedOption)="selectRecieverName($event)"
                                                        [readonly]="isUpdateMode"
                                                    >
                                                    </dropdown-field>
                                                    <i
                                                        *ngIf="
                                                            destinationWarehouses[
                                                                branchTransferCreateEditForm.get(
                                                                    'destinations.0.uniqueName'
                                                                )?.value
                                                            ]?.length !==
                                                            allWarehouses[
                                                                branchTransferCreateEditForm.get(
                                                                    'destinations.0.uniqueName'
                                                                )?.value
                                                            ]?.length
                                                        "
                                                        class="icon-info"
                                                        matTooltip="{{ branchTransferInfoText }}"
                                                    >
                                                    </i>
                                                </div>
                                            </div>
                                            <div *ngIf="branchTransferMode === 'receipt-note'">
                                                <div class="mr-b15">
                                                    <dropdown-field
                                                        *ngIf="isUpdateMode"
                                                        [name]="'receiverName'"
                                                        [placeholder]="'Receiver\'s Name'"
                                                        [options]="branches"
                                                        (selectedOption)="selectRecieverName($event)"
                                                        [readonly]="isUpdateMode"
                                                    >
                                                    </dropdown-field>
                                                    <i
                                                        *ngIf="
                                                            destinationWarehouses[
                                                                branchTransferCreateEditForm.get(
                                                                    'destinations.0.uniqueName'
                                                                )?.value
                                                            ]?.length !==
                                                            allWarehouses[
                                                                branchTransferCreateEditForm.get(
                                                                    'destinations.0.uniqueName'
                                                                )?.value
                                                            ]?.length
                                                        "
                                                        class="icon-info"
                                                        matTooltip="{{ branchTransferInfoText }}"
                                                    >
                                                    </i>
                                                </div>
                                            </div>
                                            <div class="mr-b15">
                                                <dropdown-field
                                                    #destinationWarehouse
                                                    [name]="'receiverWarehouse'"
                                                    [placeholder]="'Receiver\'s Warehouse'"
                                                    [options]="
                                                        destinationWarehouses[
                                                            branchTransferCreateEditForm.get(
                                                                'destinations.0.uniqueName'
                                                            )?.value
                                                        ]
                                                    "
                                                    (selectedOption)="selectReceiverWarehouse($event)"
                                                    [allowValueReset]="true"
                                                    (onClear)="resetWarehouse('destinations', 0)"
                                                >
                                                </dropdown-field>
                                            </div>
                                            <div formGroupName="warehouse">
                                                <div
                                                    class="mr-b15"
                                                    *ngIf="
                                                        branchTransferCreateEditForm.get(
                                                            'destinations.0.warehouse.taxNumber'
                                                        )?.value &&
                                                        branchTransferCreateEditForm.get(
                                                            'destinations.0.warehouse.uniqueName'
                                                        )?.value
                                                    "
                                                >
                                                    <input-field
                                                        [name]="'gstin'"
                                                        [placeholder]="getEnterTaxText()"
                                                        [type]="'text'"
                                                        formControlName="taxNumber"
                                                        [label]="'Receiver\'s ' + formFields['taxName']?.label + '*'"
                                                        [maxlength]="15"
                                                        (change)="checkTaxNumberValidation()"
                                                        [readonly]="
                                                            branchTransferCreateEditForm.get(
                                                                'destinations.0.warehouse.uniqueName'
                                                            )?.value
                                                        "
                                                    >
                                                    </input-field>
                                                </div>
                                                <div class="mr-b15">
                                                    <mat-form-field appearance="outline" class="w-100">
                                                        <mat-label>Receiver's Address</mat-label>
                                                        <textarea
                                                            matInput
                                                            rows="3"
                                                            class="form-control"
                                                            rows="3"
                                                            name="sourceAddress"
                                                            formControlName="address"
                                                            [readonly]="
                                                                branchTransferCreateEditForm.get(
                                                                    'destinations.0.warehouse.uniqueName'
                                                                )?.value
                                                            "
                                                        ></textarea>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="total-amount text-right">
                                <p>Total Amount</p>
                                <h3>{{ activeCompany?.baseCurrencySymbol }} {{ overallTotal | giddhCurrency }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-1">
                        <div class="col-xl-8 col-lg-10 col-sm-12 mb-2">
                            <table id="table-receipt">
                                <thead *ngIf="transferType === 'products'">
                                    <tr>
                                        <th>#</th>
                                        <th>Product Description</th>
                                        <th>Qty/Unit</th>
                                        <th>Rate</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <thead *ngIf="transferType !== 'products'">
                                    <tr>
                                        <th>#</th>
                                        <th *ngIf="branchTransferMode === 'deliverynote'">Receiver’s Details</th>
                                        <th *ngIf="branchTransferMode === 'receiptnote'">Sender’s Details</th>
                                        <th>Qty/Unit</th>
                                        <th>Rate</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="transferType !== 'products' && branchTransferMode === 'receipt-note'">
                                    <tr
                                        *ngFor="
                                            let source of branchTransferCreateEditForm.get('sources')['controls'];
                                            let i = index;
                                            let f = first;
                                            let l = last
                                        "
                                        (click)="setActiveRow(i); $event.stopPropagation()"
                                        (clickOutside)="hideActiveRow()"
                                    >
                                        <td class="id">
                                            <div>
                                                <div>{{ i + 1 }}</div>
                                            </div>
                                        </td>
                                        <td class="name">
                                            <span formArrayName="sources" class="w-100">
                                                <span [formGroupName]="i">
                                                    <span formGroupName="warehouse" class="w-100">
                                                        <div
                                                            *ngIf="activeRow === i"
                                                            class="position-relative mb-3 w-100"
                                                        >
                                                            <select-field
                                                                [cssClass]="'form-control mat-field-border pb-0'"
                                                                [name]="'senderName{{i}}'"
                                                                [placeholder]="'Sender\'s Name'"
                                                                [options]="branches"
                                                                (selectedOption)="
                                                                    selectSenderName($event, i);
                                                                    focusSourceWarehouse($event)
                                                                "
                                                                [defautlValue]="source.get('uniqueName').value"
                                                            >
                                                            </select-field>
                                                            <select-field
                                                                [cssClass]="'form-control mat-field-border pb-0'"
                                                                name="sourceWarehouse{{ i }}"
                                                                [placeholder]="'Sender\'s Warehouse'"
                                                                (selectedOption)="selectSenderWarehouse($event, i)"
                                                                [options]="
                                                                    senderWarehouses[source.get('uniqueName').value]
                                                                "
                                                                [defaultValue]="
                                                                    source.get('warehouse.uniqueName').label
                                                                "
                                                                *ngIf="source.get('uniqueName').value"
                                                                [allowValueReset]="true"
                                                                (onClear)="resetWarehouse('sources', i)"
                                                            >
                                                            </select-field>
                                                            <text-field
                                                                *ngIf="
                                                                    formFields &&
                                                                    formFields['taxName'] &&
                                                                    source.get('warehouse.uniqueName').value &&
                                                                    source.get('warehouse.taxNumber').value
                                                                "
                                                                name="sourceWarehouseTaxnumber{{ i }}"
                                                                [placeholder]="getEnterTaxText()"
                                                                [type]="'text'"
                                                                [label]="
                                                                    'Sender\'s ' + formFields['taxName']?.label + '*'
                                                                "
                                                                [maxlength]="15"
                                                                (change)="checkTaxNumberValidation()"
                                                                [readonly]="source.get('warehouse.uniqueName').value"
                                                                formControlName="taxNumber"
                                                            >
                                                            </text-field>

                                                            <div class="position-relative pb-3">
                                                                <div class="py-3">
                                                                    <textarea
                                                                        matInput
                                                                        rows="3"
                                                                        class="form-control"
                                                                        rows="3"
                                                                        name="sourceWarehouseAddress{{ i }}"
                                                                        formControlName="address"
                                                                        [readonly]="
                                                                            source.get('warehouse.uniqueName').value
                                                                        "
                                                                        *ngIf="source.get('warehouse.uniqueName').value"
                                                                    ></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div *ngIf="activeRow !== i">
                                                            <div *ngIf="source.get('name').value">
                                                                {{ source.get("name").value }}
                                                            </div>
                                                            <div *ngIf="source.get('warehouse.name').value">
                                                                {{ source.get("warehouse.name").value }}
                                                            </div>
                                                            <div *ngIf="source.get('warehouse.taxNumber').value">
                                                                {{ source.get("warehouse.taxNumber").value }}
                                                            </div>
                                                            <div *ngIf="source.get('warehouse.address').value">
                                                                {{ source.get("warehouse.address").value }}
                                                            </div>
                                                            <div
                                                                *ngIf="
                                                                    !source.get('name').value &&
                                                                    !source.get('warehouse.name').value &&
                                                                    !source.get('warehouse.taxNumber').value &&
                                                                    !source.get('warehouse.address').value
                                                                "
                                                                class="placeholder-for-table"
                                                            >
                                                                Enter sender's details
                                                            </div>
                                                        </div>
                                                    </span>
                                                </span>
                                            </span>
                                        </td>

                                        <td class="qtyUnit">
                                            <span formArrayName="sources" class="w-100">
                                                <span [formGroupName]="i">
                                                    <span formGroupName="warehouse" class="w-100">
                                                        <span formGroupName="stockDetails" class="w-100">
                                                            <div *ngIf="activeRow === i" class="w-100">
                                                                <text-field
                                                                    [cssClass]="'form-control mat-field-border'"
                                                                    [type]="'number'"
                                                                    name="sourceQty{{ i }}"
                                                                    [placeholder]="'Enter Qty/Unit'"
                                                                    [allowDecimalDigitsOnly]="true"
                                                                    (change)="
                                                                        calculateRowTotal(source.get('warehouse').value)
                                                                    "
                                                                    formControlName="quantity"
                                                                >
                                                                </text-field>
                                                            </div>
                                                            <div *ngIf="activeRow !== i">
                                                                <div class="text-right">
                                                                    {{
                                                                        source.get("warehouse.stockDetails.quantity")
                                                                            .value
                                                                    }}
                                                                </div>
                                                            </div>
                                                        </span></span
                                                    >
                                                </span>
                                            </span>
                                        </td>

                                        <td class="rate">
                                            <span formArrayName="sources" class="w-100">
                                                <span [formGroupName]="i">
                                                    <span formGroupName="warehouse" class="w-100">
                                                        <span formGroupName="stockDetails" class="w-100">
                                                            <div>
                                                                <div *ngIf="activeRow !== i">
                                                                    <div class="text-right">
                                                                        {{ activeCompany?.baseCurrencySymbol }}
                                                                        {{
                                                                            source.get("warehouse.stockDetails.rate")
                                                                                .value | giddhCurrency
                                                                        }}
                                                                    </div>
                                                                </div>
                                                                <div *ngIf="activeRow === i" class="w-100">
                                                                    <text-field
                                                                        [cssClass]="
                                                                            'form-control mat-field-border  text-right'
                                                                        "
                                                                        [type]="'text'"
                                                                        name="sourceRate{{ i }}"
                                                                        [placeholder]="'Enter Rate'"
                                                                        formControlName="rate"
                                                                        [allowDecimalDigitsOnly]="true"
                                                                        [customDecimalPlaces]="2"
                                                                        (change)="
                                                                            calculateRowTotal(
                                                                                source.get('warehouse').value
                                                                            )
                                                                        "
                                                                        [prefix]="activeCompany?.baseCurrencySymbol"
                                                                        [mask]="inputMaskFormat"
                                                                        [useMask]="true"
                                                                    >
                                                                    </text-field>
                                                                </div>
                                                            </div> </span
                                                    ></span>
                                                </span>
                                            </span>
                                        </td>

                                        <td class="amount">
                                            <span formArrayName="sources" class="w-100">
                                                <span [formGroupName]="i">
                                                    <span formGroupName="warehouse" class="w-100">
                                                        <span formGroupName="stockDetails" class="w-100">
                                                            <div *ngIf="activeRow !== i">
                                                                <div class="text-right">
                                                                    {{ activeCompany?.baseCurrencySymbol }}
                                                                    {{
                                                                        source.get("warehouse.stockDetails.rate").amount
                                                                            | giddhCurrency
                                                                    }}
                                                                </div>
                                                            </div>
                                                            <div *ngIf="activeRow === i" class="w-100">
                                                                <text-field
                                                                    [cssClass]="
                                                                        'form-control mat-field-border  text-right'
                                                                    "
                                                                    [type]="'text'"
                                                                    name="sourceAmount{{ i }}"
                                                                    [placeholder]="'Enter Amount'"
                                                                    formControlName="amount"
                                                                    [allowDecimalDigitsOnly]="true"
                                                                    [customDecimalPlaces]="2"
                                                                    [prefix]="activeCompany?.baseCurrencySymbol"
                                                                    [mask]="inputMaskFormat"
                                                                    [useMask]="true"
                                                                    [readonly]="true"
                                                                >
                                                                </text-field>
                                                            </div>
                                                            <span class="position-relative">
                                                                <span
                                                                    class="delete-btn-position d-flex"
                                                                    *ngIf="
                                                                        branchTransferCreateEditForm.get('sources')
                                                                            .value.length > 1
                                                                    "
                                                                >
                                                                    <span class="delete-icon"
                                                                        ><i
                                                                            class="fa fa-trash"
                                                                            (click)="removeSenderDetailsForm(i)"
                                                                        ></i
                                                                    ></span>
                                                                    <i
                                                                        *ngIf="
                                                                            senderWarehouses[
                                                                                source.get('uniqueName').value
                                                                            ]?.length !==
                                                                            allWarehouses[
                                                                                source.get('uniqueName').value
                                                                            ]?.length
                                                                        "
                                                                        matTooltip="{{ branchTransferInfoText }}"
                                                                        matTooltipPosition="above"
                                                                        class="icon-info"
                                                                    ></i>
                                                                </span>
                                                            </span>
                                                        </span>
                                                    </span>
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>

                                <tbody *ngIf="transferType === 'products'">
                                    <tr
                                        *ngFor="
                                            let product of branchTransferCreateEditForm.get('products')['controls'];
                                            let i = index
                                        "
                                        (click)="setActiveRow(i); $event.stopPropagation()"
                                        (clickOutside)="hideActiveRow()"
                                    >
                                        <td class="id">
                                            <div>
                                                <div>{{ i + 1 }}</div>
                                            </div>
                                        </td>

                                        <td class="name">
                                            <span formArrayName="products" class="w-100">
                                                <span [formGroupName]="i">
                                                    <div *ngIf="activeRow === i" class="position-relative mb-3 w-100">
                                                        <select-field
                                                            (createOption)="onProductNoResultsClicked(0)"
                                                            [showCreateNew]="true"
                                                            name="productName{{ i }}"
                                                            [placeholder]="'Product\'s Name'"
                                                            [options]="stockList"
                                                            [appearance]="'outline'"
                                                            (selectedOption)="selectProduct($event, product)"
                                                            [allowValueReset]="true"
                                                            [defautlValue]="product.get('uniqueName').value"
                                                            [cssClass]="'form-control mat-field-border pb-0'"
                                                        >
                                                        </select-field>
                                                        {{ product.get("uniqueName").value }}
                                                        <div
                                                            class="show-sku-code-position"
                                                            *ngIf="activeRow === i && product.get('uniqueName').value"
                                                            mat-button
                                                            [matMenuTriggerFor]="sku_Menu"
                                                            #skuMenuTrigger="matMenuTrigger"
                                                        >
                                                            <label>SKU Code: </label>
                                                            <span
                                                                >{{ product.get("skuNumber").value }}
                                                                <span class="edit-icon cp">
                                                                    <img src="assets/images/edit-pencilicon.svg" />
                                                                </span>
                                                            </span>
                                                        </div>

                                                        <mat-menu #sku_Menu="matMenu" xPosition="before">
                                                            <div
                                                                class="show-code-menu"
                                                                (click)="$event.stopPropagation()"
                                                            >
                                                                <div>
                                                                    <text-field
                                                                        type="text"
                                                                        [cssClass]="'form-control mat-field-border'"
                                                                        [type]="'text'"
                                                                        name="productSkuCode{{ i }}"
                                                                        [placeholder]="'SKU Code'"
                                                                        maxlength="50"
                                                                        formControlName="skuCode"
                                                                    >
                                                                    </text-field>
                                                                </div>
                                                                <div class="d-flex mt-3 column-gap1">
                                                                    <button
                                                                        mat-stroked-button
                                                                        color="primary"
                                                                        class="w-100"
                                                                        (click)="saveSkuNumberPopup(product)"
                                                                    >
                                                                        Save
                                                                    </button>
                                                                    <button
                                                                        mat-stroked-button
                                                                        class="w-100"
                                                                        (click)="closeShowCodeMenu()"
                                                                    >
                                                                        Cancel
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </mat-menu>

                                                        <div class="position-relative pb-3">
                                                            <div class="py-3">
                                                                <textarea
                                                                    matInput
                                                                    rows="3"
                                                                    maxlength="100"
                                                                    class="form-control"
                                                                    rows="3"
                                                                    name="productDescription{{ i }}"
                                                                    formControlName="description"
                                                                    *ngIf="product.get('uniqueName')?.value"
                                                                ></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div *ngIf="activeRow !== i">
                                                        <div *ngIf="product.get('name').value">
                                                            {{ product.get("name").value }}
                                                        </div>
                                                        <div *ngIf="product.get('skuCode').value">
                                                            SKU Code: {{ product.get("skuCode").value }}
                                                        </div>
                                                        <div *ngIf="product.get('showCodeType').value === 'hsn'">
                                                            HSN Code: {{ product.get("hsnNumber").value }}
                                                        </div>
                                                        <div *ngIf="product.get('showCodeType').value === 'sac'">
                                                            SAC Code: {{ product.get("sacNumber").value }}
                                                        </div>
                                                        <div *ngIf="product.get('description').value">
                                                            {{ product.get("description").value }}
                                                        </div>
                                                        <div
                                                            *ngIf="
                                                                !product.get('name').value &&
                                                                !product.get('description').value &&
                                                                !(
                                                                    product.get('hsnNumber').value ||
                                                                    product.get('sacNumber').value
                                                                ) &&
                                                                !product.get('skuCode').value
                                                            "
                                                            class="placeholder-for-table"
                                                        >
                                                            Enter product details
                                                        </div>
                                                    </div>
                                                </span>
                                            </span>
                                        </td>

                                        <td class="qtyUnit">
                                            <span formArrayName="products" class="w-100">
                                                <span [formGroupName]="i">
                                                    <span formGroupName="stockDetails" class="w-100">
                                                        <div *ngIf="activeRow === i" class="w-100">
                                                            <text-field
                                                                [cssClass]="'form-control mat-field-border'"
                                                                [type]="'number'"
                                                                name="productQty{{ i }}"
                                                                [placeholder]="'Enter Qty/Unit'"
                                                                [allowDecimalDigitsOnly]="true"
                                                                (change)="calculateRowTotal(product)"
                                                                formControlName="quantity"
                                                            >
                                                            </text-field>
                                                        </div>
                                                        <div *ngIf="activeRow !== i">
                                                            <div class="text-right">
                                                                {{ product.get("stockDetails.quantity")?.value }}
                                                            </div>
                                                        </div>
                                                    </span>
                                                </span>
                                            </span>
                                        </td>

                                        <td class="rate">
                                            <span formArrayName="products" class="w-100">
                                                <span [formGroupName]="i">
                                                    <span formGroupName="stockDetails" class="w-100">
                                                        <div>
                                                            <div *ngIf="activeRow === i" class="w-100">
                                                                <text-field
                                                                    [cssClass]="
                                                                        'form-control mat-field-border  text-right'
                                                                    "
                                                                    [type]="'text'"
                                                                    name="productRate{{ i }}"
                                                                    [placeholder]="'Enter Rate'"
                                                                    formControlName="rate"
                                                                    [allowDecimalDigitsOnly]="true"
                                                                    [customDecimalPlaces]="2"
                                                                    (change)="calculateRowTotal(product)"
                                                                    [prefix]="activeCompany?.baseCurrencySymbol"
                                                                    [mask]="inputMaskFormat"
                                                                    [useMask]="true"
                                                                >
                                                                </text-field>
                                                            </div>
                                                            <div *ngIf="activeRow !== i">
                                                                <div class="text-right">
                                                                    {{ activeCompany?.baseCurrencySymbol }}
                                                                    {{
                                                                        product.get("stockDetails.rate")?.value
                                                                            | giddhCurrency
                                                                    }}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </span>
                                                </span>
                                            </span>
                                        </td>

                                        <td class="amount">
                                            <span formArrayName="products" class="w-100">
                                                <span [formGroupName]="i">
                                                    <span formGroupName="stockDetails" class="w-100">
                                                        <div *ngIf="activeRow === i" class="w-100">
                                                            <text-field
                                                                [cssClass]="'form-control mat-field-border  text-right'"
                                                                [type]="'text'"
                                                                name="productAmount{{ i }}"
                                                                [placeholder]="'Enter Amount'"
                                                                formControlName="amount"
                                                                [allowDecimalDigitsOnly]="true"
                                                                [customDecimalPlaces]="2"
                                                                [prefix]="activeCompany?.baseCurrencySymbol"
                                                                [mask]="inputMaskFormat"
                                                                [useMask]="true"
                                                                [readonly]="true"
                                                            >
                                                            </text-field>
                                                        </div>
                                                        <div *ngIf="activeRow !== i">
                                                            <div class="text-right">
                                                                {{ activeCompany?.baseCurrencySymbol }}
                                                                {{
                                                                    product.get("stockDetails.amount")?.value
                                                                        | giddhCurrency
                                                                }}
                                                            </div>
                                                        </div>
                                                        <span class="position-relative">
                                                            <span
                                                                class="delete-btn-position d-flex"
                                                                *ngIf="
                                                                    branchTransferCreateEditForm.get('products').value
                                                                        .length > 1
                                                                "
                                                            >
                                                                <span class="delete-icon"
                                                                    ><i
                                                                        class="fa fa-trash"
                                                                        (click)="removeProductDetailsForm(i)"
                                                                    ></i
                                                                ></span>
                                                            </span>
                                                        </span>
                                                    </span>
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>

                                <tfoot>
                                    <tr>
                                        <td colspan="4" class="pl-0">
                                            <div class="add-new-line mr-t1">
                                                <!-- <a
                                                class="multiple-receivers color-primary"
                                                (click)="addReceiver()"
                                                *ngIf="
                                                    transferType !== 'products' && branchTransferMode === 'deliverynote'
                                                "
                                            >
                                                + Add Multiple Receivers</a
                                            > -->
                                                <a class="multiple-receivers color-primary" (click)="addSender()">
                                                    + Add Multiple Senders</a
                                                >

                                                <!-- <a
                                                class="multiple-receivers color-primary"
                                                (click)="addBlankProductsForm()"
                                                *ngIf="transferType === 'products'"
                                            >
                                                <i class="icon-plus"></i> Add Multiple Products</a
                                            > -->
                                            </div>
                                        </td>
                                        <td>
                                            <div class="row text-right">
                                                <div class="col px-0"><strong>Total</strong></div>
                                                <div class="col px-0">
                                                    {{ activeCompany?.baseCurrencySymbol }}
                                                    {{ overallTotal | giddhCurrency }}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-8 col-lg-10 col-sm-12">
                            <div>
                                <h3 class="mr-b1">Transportation Details</h3>
                                <div class="row row-gap" formGroupName="transporterDetails">
                                    <div class="col-sm-6 pl-0 mr-b15">
                                        <div class="direct-mat-datepicker">
                                            <giddh-datepicker
                                                (dateSelected)="selectDate($event, 'dispatchedDate')"
                                                [minDate]="tempDateParams.dateOfSupply"
                                                formControlName="dispatchedDate"
                                                name="date"
                                                [cssClass]="'w-100'"
                                                [showToggleIcon]="false"
                                                [appearance]="'outline'"
                                                [placeholder]="'Dispatched Date'"
                                            >
                                            </giddh-datepicker>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 pr-0 mr-b15">
                                        <dropdown-field
                                            (createOption)="toggleTransporterModel()"
                                            [showCreateNew]="true"
                                            [name]="''"
                                            [placeholder]="'Transport Company'"
                                            [options]="transporterDropdown"
                                            [appearance]="'outline'"
                                            (onClear)="onClearTransportNameId($event)"
                                            (selectedOption)="onSelectTransportCompany($event)"
                                            [allowValueReset]="true"
                                        >
                                        </dropdown-field>
                                    </div>
                                    <div class="col-sm-6 pl-0 mr-b15">
                                        <dropdown-field
                                            [name]="''"
                                            [placeholder]="'Transport Mode'"
                                            [options]="transporterMode"
                                            [appearance]="'outline'"
                                            (onClear)="onClearTransportNameId($event)"
                                            (selectedOption)="onSelectTransportMode($event)"
                                            [allowValueReset]="true"
                                        >
                                        </dropdown-field>
                                    </div>
                                    <div class="col-sm-6 pr-0 mr-b15">
                                        <input-field
                                            [type]="'text'"
                                            [name]="''"
                                            [placeholder]="'Vehicle Number'"
                                            [appearance]="'outline'"
                                            formControlName="vehicleNumber"
                                        >
                                        </input-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-8 col-lg-10 col-sm-12 mb-4">
                            <div>
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Note</mat-label>
                                    <textarea
                                        matInput
                                        rows="3"
                                        placeholder="Write Note Here . . . "
                                        formControlName="note"
                                    ></textarea>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <div class="row position-bottom">
                        <div class="action-btn-wrapper text-right w-100 d-flex column-gap1">
                            <button mat-stroked-button class="mr-3" mat-dialog-close>Cancel</button>
                            <button
                                *ngIf="isBranch || isCompanyWithSingleBranch"
                                type="button"
                                class="btn btn-success-text d-inline-block v-align-middle {{
                                    branchTransferCreateEditForm.invalid
                                }}-{{ isValidSourceTaxNumber }}-{{ isValidDestinationTaxNumber }}"
                                (click)="submit()"
                            >
                                {{ editBranchTransferUniqueName ? "Update" : "Create" }}
                                <!-- [disabled]="
                                    branchTransferCreateEditForm.invalid ||
                                    !isValidSourceTaxNumber ||
                                    !isValidDestinationTaxNumber ||
                                    isLoading
                                " -->
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>
</ng-container>
