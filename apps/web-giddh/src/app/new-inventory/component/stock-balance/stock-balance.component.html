<div class="stock-balance-wrapper">
    <div class="stock-balance-top-bar">
        <div class="stock-balance-top-bar-left-side">
            <button mat-flat-button class="new-stock-btn" [routerLink]="'/pages/new-inventory/stock/product/create'">
                <img src="{{ imgPath }}add-icon-white.svg" alt="add-icon-white" /> New Stock
            </button>
            <div class="warehouse-select-bar">
                <mat-form-field class="search-warehouse-bar" appearance="outline">
                    <mat-select
                        #select
                        placeholder="Warehouses"
                        [formControl]="warehouse"
                        multiple
                        [value]=""
                        class="select-warehouse-bar"
                        [(value)]="selectedWarehouse"
                    >
                        <!-- <div class="select-all">
                            <mat-checkbox
                                [(ngModel)]="allSelected"
                                name="allSelected"
                                (ngModelChange)="toggleAllSelection()"
                                [color]="'primary'"
                                >Select All</mat-checkbox
                            >
                        </div> -->
                        <mat-option
                            (click)="optionClick(warehouse.uniqueName)"
                            *ngFor="let warehouse of warehouses"
                            [value]="warehouse.uniqueName"
                        >
                            {{ warehouse.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="stock-balance-top-bar-right-side">
                <!-- <button mat-flat-button class="export-btn">
                <img src="{{ imgPath }}download-blue.svg" alt="" /> Export
            </button> -->
                <button mat-flat-button [matMenuTriggerFor]="menu" class="filter-btn">
                    <img src="{{ imgPath }}filter.svg" alt="filter-button" />
                    <mat-menu #menu="matMenu">
                        <button mat-menu-item>
                            <mat-checkbox
                                color="primary"
                                (click)="showUniqueName = !showUniqueName; $event.stopPropagation()"
                                >Unique Name
                            </mat-checkbox>
                        </button>
                        <button mat-menu-item (click)="showGroupName = !showGroupName; $event.stopPropagation()">
                            <mat-checkbox color="primary">Stock Group</mat-checkbox>
                        </button>
                    </mat-menu>
                </button>
            </div>
        </div>
    </div>
    <div class="searching-stocks" style="float: left; width: 100%">
        <div class="custom-material-search-bar stock-searchbar" style="float: left; width: 23%">
            <img src="{{ imgPath }}search-new.svg" class="search-icon" />
            <mat-form-field appearance="outline">
                <input matInput placeholder="Stocks" #productName [formControl]="productUniqueNameInput" />
            </mat-form-field>
        </div>
        <div class="group-list-head group-searchbar" style="width: 19%; margin-left: 20px; float: left">
            <img src="{{ imgPath }}search-new.svg" class="search-icon" />
            <select-field
                [cssClass]="'form-control'"
                class=""
                [name]="'stockGroup'"
                [placeholder]="'Group'"
                [options]="stockGroups"
                (selectedOption)="selectFieldType($event)"
                [defaultValue]="stockGroupName"
            >
            </select-field>
        </div>
        <div class="wrapper-warehouse">
            <div class="warehouse-list warehouse-odd">
                <ng-container *ngFor="let warehouse of warehouses">
                    <div class="warehouse-list-head" *ngIf="selectedWarehouse?.indexOf(warehouse?.uniqueName) > -1">
                        <p class="warehouse-list-head-num">{{ warehouse?.name }}</p>
                        <div class="warehouse-list-head-options">
                            <div class="d-flex">
                                <div class="flex-fill">Opening Bal</div>
                                <div class="icon-pointer">
                                    <!-- default -->
                                    <div
                                        class="icon-sort-asc text-right"
                                        *ngIf="GroupStockReportRequest.sortBy !== 'OPENING_STOCK_VALUE'"
                                        (click)="sortButtonClicked('asc', 'OPENING_STOCK_VALUE')"
                                        [ngClass]="{
                                            'active-text-color':
                                                GroupStockReportRequest.sortBy === 'OPENING_STOCK_VALUE' &&
                                                GroupStockReportRequest.sort === 'asc'
                                        }"
                                    ></div>
                                    <!-- after sort click -->
                                    <div
                                        class="icon-sort-asc text-right"
                                        *ngIf="
                                            GroupStockReportRequest.sortBy === 'OPENING_STOCK_VALUE' &&
                                            GroupStockReportRequest.sort === 'desc'
                                        "
                                        (click)="sortButtonClicked('asc', 'OPENING_STOCK_VALUE')"
                                        [ngClass]="{
                                            'active-text-color':
                                                GroupStockReportRequest.sortBy === 'OPENING_STOCK_VALUE' &&
                                                GroupStockReportRequest.sort === 'desc'
                                        }"
                                    ></div>
                                    <div
                                        class="icon-sort-asc text-right"
                                        *ngIf="
                                            GroupStockReportRequest.sortBy === 'OPENING_STOCK_VALUE' &&
                                            GroupStockReportRequest.sort === 'asc'
                                        "
                                        (click)="sortButtonClicked('desc', 'OPENING_STOCK_VALUE')"
                                        [ngClass]="{
                                            'active-text-color':
                                                GroupStockReportRequest.sortBy === 'OPENING_STOCK_VALUE' &&
                                                GroupStockReportRequest.sort === 'asc'
                                        }"
                                    ></div>
                                </div>
                            </div>
                            <div class="d-flex">
                                <div class="flex-fill">Quantity</div>
                                <div class="icon-pointer">
                                    <div
                                        class="icon-sort-asc text-right"
                                        *ngIf="GroupStockReportRequest.sortBy !== 'OPENING_STOCK_QTY'"
                                        (click)="sortButtonClicked('asc', 'OPENING_STOCK_QTY')"
                                        [ngClass]="{
                                            'active-text-color':
                                                GroupStockReportRequest.sortBy === 'OPENING_STOCK_QTY' &&
                                                GroupStockReportRequest.sort === 'asc'
                                        }"
                                    ></div>

                                    <div
                                        class="icon-sort-asc text-right"
                                        *ngIf="
                                            GroupStockReportRequest.sortBy === 'OPENING_STOCK_QTY' &&
                                            GroupStockReportRequest.sort === 'desc'
                                        "
                                        (click)="sortButtonClicked('asc', 'OPENING_STOCK_QTY')"
                                        [ngClass]="{
                                            'active-text-color':
                                                GroupStockReportRequest.sortBy === 'OPENING_STOCK_QTY' &&
                                                GroupStockReportRequest.sort === 'desc'
                                        }"
                                    ></div>
                                    <div
                                        class="icon-sort-asc text-right"
                                        *ngIf="
                                            GroupStockReportRequest.sortBy === 'OPENING_STOCK_QTY' &&
                                            GroupStockReportRequest.sort === 'asc'
                                        "
                                        (click)="sortButtonClicked('desc', 'OPENING_STOCK_QTY')"
                                        [ngClass]="{
                                            'active-text-color':
                                                GroupStockReportRequest.sortBy === 'OPENING_STOCK_QTY' &&
                                                GroupStockReportRequest.sort === 'asc'
                                        }"
                                    ></div>
                                </div>
                            </div>

                            <div class="d-flex">
                                <div class="flex-fill">Unit</div>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
        <div
            class="stock-table mat-elevation-z8"
            *ngFor="let stock of stocksList"
            (click)="stock.display = !stock.display"
        >
            <div class="grid-list-div list-grid stock-list-unexpanded">
                <div class="grid-title-left" (click)="getStockVarients(stock?.stockUniqueName)">
                    <p class="inner-name mat-table-sticky">{{ stock?.stockName }}</p>
                    <p class="stock-details" style="word-spacing: 39px">
                        <span class="ob" style="color: mediumblue">O/B </span>
                        <span class="stock-ob">{{ stock?.openingBalance?.amount }} </span>
                        <span class="stock-ob"
                            >{{ stock?.openingBalance?.quantity }} {{ stock?.openingBalance?.stockUnit }}</span
                        >
                    </p>
                </div>

                <div class="grid-title-list list-grid-title" *ngIf="showUniqueName">
                    <span>{{ stock?.stockUniqueName }}</span>
                </div>
                <div class="grid-title-list list-grid-title" *ngIf="showGroupName">
                    <span>{{ stockGroupName }}</span>
                </div>
            </div>
            <div *ngIf="stock.display">
                <div class="grid-list-div list-grid" *ngFor="let variant of stock?.variants">
                    <div class="grid-title-left" style="background-color: gray">
                        <p class="inner-name mat-table-sticky">{{ variant?.name }}</p>
                    </div>
                    <div class="grid-title-list list-grid-title" style="background-color: gray" *ngIf="showUniqueName">
                        <span>{{ variant?.uniqueName }}</span>
                    </div>
                    <div class="grid-title-list list-grid-title" style="background-color: gray" *ngIf="showGroupName">
                        <span>{{ stockGroupName }}</span>
                    </div>
                    <ng-container *ngFor="let warehouseVariant of variant?.warehouseBalance; let i = index">
                        <div
                            class="grid-title-list list-grid-title"
                            *ngIf="selectedWarehouse?.indexOf(warehouseVariant?.warehouse?.uniqueName) > -1"
                            (click)="setActiveRow(i); $event.stopPropagation()"
                            (clickOutside)="hideActiveRow()"
                        >
                            <div class="stock-list-expanded-content" *ngIf="activeRow !== i">
                                <p class="stock-list-box-heading proper-spacing-list">
                                    <span class="opening-bal-value bg-color-hover">{{
                                        warehouseVariant?.openingAmount
                                    }}</span>
                                    <span class="quantity-value bg-color-hover">{{
                                        warehouseVariant?.openingQuantity
                                    }}</span>
                                    <span class="unit-value bg-color-hover">{{
                                        warehouseVariant?.stockUnit?.code
                                    }}</span>
                                </p>
                            </div>
                            <div *ngIf="activeRow === i">
                                <p class="" style="float: left; width: 38%">
                                    <input matInput class="opening-bal-input" placeholder="Opening Bal" type="text" />
                                    <input matInput class="quantity-input" placeholder="Qty" type="text" />
                                    <!-- stockForm.stockUnitCode = $event?.value; -->
                                    <select-field
                                        [cssClass]="'form-control'"
                                        class="unit-dropdown"
                                        [name]="'stockUnitCode'"
                                        [placeholder]="'Unit'"
                                        [options]="stockUnits"
                                        (selectedOption)="stockUnitName = $event.label"
                                        [defaultValue]="stockUnitName"
                                    >
                                    </select-field>
                                </p>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
            <div class="warehouse-list-wrapper">
                <div class="warehouse-list warehouse-even" *ngFor="let warehouse of stock?.warehouses">
                    <ng-container *ngIf="selectedWarehouse?.indexOf(warehouse?.uniqueName) > -1">
                        <div class="stock-list-body" (click)="stock.display = !stock.display">
                            <div class="stock-list-box">
                                <div class="stock-list-unexpanded">
                                    <p class="stock-list-box-heading proper-spacing-list">
                                        <span class="opening-bal-value bg-color-hover">{{
                                            warehouse?.openingBalance?.amount
                                        }}</span>
                                        <span class="quantity-value bg-color-hover">{{
                                            warehouse?.openingBalance?.quantity
                                        }}</span>
                                        <span class="unit-value bg-color-hover">{{
                                            warehouse?.openingBalance?.stockUnit
                                        }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
</div>
