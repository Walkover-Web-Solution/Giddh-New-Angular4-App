<ng-container
    appTranslate
    [file]="'inventory/manufacturing'"
    (commonLocaleData)="commonLocaleData = $event"
    (localeData)="localeData = $event"
>
    <div class="pd-l15 pt-3">
        <div *ngIf="newVariants?.length" class="save-recipe">{{ localeData?.save_variants }}</div>
    </div>
    <section class="create-recipe">
        <div class="recipe-wrapper">
            <!-- <div class="row">
                <div class="col-3 mt-2">
                    <div>
                        <dropdown-field
                            class="width-280"
                            [name]="''"
                            [placeholder]="'Select Stock'"
                            [options]="stock"
                            [defaultValue]=""
                        >
                        </dropdown-field>
                    </div>
                </div>
            </div> -->
            <ng-container *ngFor="let recipe of recipeObject.manufacturingDetails; let i = index">
                <div class="row py-4 manufacturing-border" *ngIf="recipe.isEdit">
                    <div class="col-3">
                        <div class="row">
                            <div class="form-fields w-100">
                                <div class="d-flex flex-column flex-wrap w-100 row-gap">
                                    <h1 class="section-head pb-2">{{ localeData?.finished_stock }}</h1>
                                    <div *ngIf="stock?.variants?.length > 1">
                                        <dropdown-field
                                            class="width-280"
                                            [name]="'variant_' + i"
                                            [scrollableElementId]="'variant_' + i"
                                            [placeholder]="localeData?.select_output_variant"
                                            [options]="variantsList"
                                            [defaultValue]="recipe.variant?.name"
                                            (selectedOption)="
                                                recipe.variant.name = $event.label;
                                                recipe.variant.uniqueName = $event.value;
                                                checkIfVariantIsAlreadyUsed(recipe, $event, i)
                                            "
                                        >
                                        </dropdown-field>
                                    </div>
                                    <div>
                                        <input-field
                                            class="width-280"
                                            [type]="'number'"
                                            [name]="'quantity_' + i"
                                            [placeholder]="localeData?.enter_output_quantity"
                                            [(ngModel)]="recipe.manufacturingQuantity"
                                        ></input-field>
                                    </div>
                                    <div>
                                        <dropdown-field
                                            [name]="'unit_' + i"
                                            [scrollableElementId]="'unit_' + i"
                                            [placeholder]="localeData?.select_output_stock_unit"
                                            [options]="recipe.units"
                                            [defaultValue]="recipe.manufacturingUnitCode"
                                            (selectedOption)="
                                                recipe.manufacturingUnitCode = $event.label;
                                                recipe.manufacturingUnitUniqueName = $event.value
                                            "
                                        >
                                        </dropdown-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-1 d-flex justify-content-center">
                        <span class="less-than-text"> <i class="icon-left"></i></span>
                    </div>
                    <div class="col-8 pr-0">
                        <div class="row">
                            <div class="consumption-details-wrapper w-100">
                                <h1 class="section-head">{{ localeData?.raw_stock }}</h1>
                                <div class="mt-2">
                                    <table class="table-raw-stock">
                                        <thead>
                                            <tr>
                                                <th>{{ commonLocaleData?.app_name }}</th>
                                                <th>{{ commonLocaleData?.app_variant }}</th>
                                                <th>{{ commonLocaleData?.app_quantity }}</th>
                                                <th>{{ commonLocaleData?.app_unit }}</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let linkedStock of recipe.linkedStocks; let j = index">
                                                <td>
                                                    <div>
                                                        <select-field
                                                            [cssClass]="'form-control mat-field-border'"
                                                            [name]="'stock_' + i + '_' + j"
                                                            [scrollableElementId]="'stock_' + i + '_' + j"
                                                            [placeholder]="commonLocaleData?.app_select_stock"
                                                            [options]="linkedStock.stocks"
                                                            (selectedOption)="
                                                                linkedStock.stockName = $event.label;
                                                                linkedStock.stockUniqueName = $event.value;
                                                                getStockVariants(linkedStock, $event);
                                                                getStockUnits(
                                                                    linkedStock,
                                                                    $event.additional?.stockUnitUniqueName,
                                                                    false
                                                                )
                                                            "
                                                            [defaultValue]="linkedStock.stockName"
                                                            [enableDynamicSearch]="true"
                                                            [isPaginationEnabled]="true"
                                                            (dynamicSearchedQuery)="getStocks(linkedStock, 1, $event)"
                                                            (scrollEnd)="stockScrollEnd(linkedStock)"
                                                            [allowValueReset]="true"
                                                            (onClear)="
                                                                linkedStock.stockName = '';
                                                                linkedStock.stockUniqueName = ''
                                                            "
                                                        >
                                                        </select-field>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <select-field
                                                            [cssClass]="'form-control mat-field-border'"
                                                            [name]="'variant_' + i + '_' + j"
                                                            [scrollableElementId]="'variant' + i + '_' + j"
                                                            [placeholder]="commonLocaleData?.app_select_variant"
                                                            [options]="linkedStock.variants"
                                                            [defaultValue]="linkedStock.variant?.name"
                                                            (selectedOption)="
                                                                linkedStock.variant.name = $event.label;
                                                                linkedStock.variant.uniqueName = $event.value
                                                            "
                                                        >
                                                        </select-field>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <text-field
                                                            [cssClass]="'form-control mat-field-border'"
                                                            class="text-right"
                                                            [type]="'number'"
                                                            [name]="'quantity_' + i + '_' + j"
                                                            [placeholder]="localeData?.enter_quantity"
                                                            [(ngModel)]="linkedStock.quantity"
                                                        ></text-field>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <select-field
                                                            [cssClass]="'form-control mat-field-border'"
                                                            [name]="'unit_' + i + '_' + j"
                                                            [scrollableElementId]="'unit_' + i + '_' + j"
                                                            [placeholder]="localeData?.select_stock_unit"
                                                            [options]="linkedStock.units"
                                                            [defaultValue]="linkedStock.stockUnitCode"
                                                            (selectedOption)="
                                                                linkedStock.stockUnitCode = $event.label;
                                                                linkedStock.stockUnitUniqueName = $event.value
                                                            "
                                                        >
                                                        </select-field>
                                                    </div>
                                                </td>
                                                <td>
                                                    <a
                                                        href="javascript:void(0);"
                                                        class="
                                                            d-flex
                                                            justify-content-between
                                                            align-item-center
                                                            table-row-delete
                                                        "
                                                        *ngIf="recipe.linkedStocks?.length > 1"
                                                        (click)="removeLinkedStock(i, j)"
                                                    >
                                                        <i class="icon-trash"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div>
                                        <a href="javascript:void(0);" (click)="addNewLinkedStockInRecipe(recipe)">
                                            {{ localeData?.add_stock }}
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 mr-t15" *ngIf="recipe.isEdit">
                        <button mat-stroked-button class="mb-2" (click)="recipe.isEdit = false">
                            {{ commonLocaleData?.app_done }}
                        </button>
                    </div>
                </div>
                <div class="manufacturing-border view-mode" *ngIf="!recipe.isEdit">
                    <div class="row pb-4 max-width-950 align-items-baseline position-relative">
                        <div class="col-3">
                            <div class="row">
                                <div class="form-fields w-100">
                                    <div class="d-flex flex-column flex-wrap w-100">
                                        <h1 class="section-head p-0" *ngIf="i === 0">
                                            {{ localeData?.finished_stock }}
                                        </h1>
                                        <div class="variant-view fix-arrow">
                                            <p>{{ recipe?.variant?.name }}</p>
                                        </div>
                                        <div class="d-flex">
                                            <p class="mr-3">
                                                {{ recipe?.manufacturingQuantity }} ({{
                                                    recipe?.manufacturingUnitCode
                                                }})
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-1 d-flex justify-content-center"></div>
                        <div class="col-8 pr-0">
                            <div class="row">
                                <div class="consumption-details-wrapper w-100">
                                    <h1 class="section-head" *ngIf="i === 0">{{ localeData?.raw_stock }}</h1>
                                    <div class="d-flex align-items-baseline">
                                        <table class="table-filled view-mode-table table-raw-stock">
                                            <tbody>
                                                <tr *ngFor="let linkedStock of recipe.linkedStocks; let j = index">
                                                    <td>
                                                        <div>
                                                            <p>{{ linkedStock.stockName }}</p>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div>
                                                            <p>{{ linkedStock.variant?.name }}</p>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div>
                                                            <p>
                                                                {{ linkedStock.quantity }} ({{
                                                                    linkedStock.stockUnitCode
                                                                }})
                                                            </p>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="d-flex">
                                            <a
                                                href="javascript:void(0);"
                                                class="icon-remove"
                                                (click)="recipe.isEdit = true"
                                                [matTooltip]="commonLocaleData?.app_edit"
                                                matTooltipPosition="left"
                                            >
                                                <i class="icon-edit-pencil"></i>
                                            </a>
                                            <a
                                                href="javascript:void(0);"
                                                class="icon-remove"
                                                [matTooltip]="commonLocaleData?.app_delete"
                                                matTooltipPosition="left"
                                                (click)="removeRecipe(i)"
                                            >
                                                <i class="icon-trash"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
            <div class="row mt-2 add-recipe" *ngIf="recipeObject.manufacturingDetails?.length < variantsList?.length">
                <button mat-button class="mb-2 ml-2" (click)="addNewRecipe()">
                    <span>+</span> {{ localeData?.add_recipe }}
                </button>
            </div>
        </div>
    </section>

    <!-- view-mode -->
    <!-- <section class="create-recipe">
        <div class="recipe-wrapper">
            <div class="row">
                <div class="col-3 pb-3">
                    <div>
                        <p>Stock</p>
                    </div>
                </div>
            </div>
            
        </div>
    </section> -->
</ng-container>
