<ng-container
    appTranslate
    [file]="'inventory/unit'"
    (commonLocaleData)="commonLocaleData = $event"
    (localeData)="localeData = $event"
>
    <giddh-page-loader *ngIf="isLoading"></giddh-page-loader>
    <ng-container *ngIf="!isLoading">
        <form autocomplete="off" novalidate name="unitForm" [formGroup]="unitForm">
            <div class="row mr-b15">
                <div class="col-xl-5 col-lg-5 col-sm-5">
                    <dropdown-field
                        [label]="commonLocaleData?.app_name"
                        [placeholder]="localeData?.select_unit"
                        [name]="'unitName'"
                        [options]="unitList"
                        (selectedOption)="selectUnit($event)"
                        [defaultValue]="unitForm.get('name')?.value"
                        [showError]="!isValidForm && !unitForm?.get('name')?.value"
                        [allowCustomDropdownValue]="true"
                        [noResultsFoundMessage]="localeData?.create_unit"
                    >
                    </dropdown-field>
                </div>
                <div class="col-xl-7 col-lg-7 col-sm-7">
                    <input-field
                        [name]="'code'"
                        [type]="'text'"
                        [label]="localeData?.code"
                        [placeholder]="localeData?.enter_code"
                        formControlName="code"
                        [showError]="!isValidForm && !unitForm?.get('code')?.value"
                    >
                    </input-field>
                </div>
            </div>
            <div class="unit-quantity" formArrayName="mappings">
                <div
                    class="row mr-b15 align-items-center"
                    *ngFor="let mapping of unitForm?.get('mappings')['controls']; let i = index"
                    [formGroupName]="i"
                >
                    <div class="col-xl-5 col-lg-5 col-md-5 col-sm-6 unit-equal">
                        <dropdown-field
                            [name]="'xcode' + i"
                            [label]="localeData?.parent_unit"
                            [placeholder]="localeData?.select_parent_unit"
                            [options]="unitList"
                            (selectedOption)="
                                mapping?.get('stockUnitX')?.get('name').patchValue($event.label);
                                mapping?.get('stockUnitX')?.get('code').patchValue($event.value)
                            "
                            [defaultValue]="mapping?.get('stockUnitX')?.get('name')?.value"
                            [showError]="!isValidFormMappings && !mapping?.get('stockUnitX')?.get('code')?.value"
                        >
                        </dropdown-field>
                        <span class="equal-sign">=</span>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-2 pr-0 unit-responsive">
                        <input-field
                            [cssClass]="'text-right'"
                            [name]="'quantity' + i"
                            [type]="'text'"
                            [label]="commonLocaleData?.app_quantity"
                            [placeholder]="localeData?.enter_quantity"
                            formControlName="quantity"
                            [allowDigitsOnly]="true"
                            [showError]="!isValidFormMappings && !mapping?.get('quantity')?.value"
                        >
                        </input-field>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 pl-2">
                        <dropdown-field
                            [name]="'ycode' + i"
                            [label]="localeData?.parent_unit"
                            [placeholder]="localeData?.select_parent_unit"
                            [options]="unitList"
                            (selectedOption)="
                                mapping?.get('stockUnitY')?.get('name').patchValue($event.label);
                                mapping?.get('stockUnitY')?.get('code').patchValue($event.value)
                            "
                            [defaultValue]="mapping?.get('stockUnitY')?.get('name')?.value"
                            [showError]="!isValidFormMappings && !mapping?.get('stockUnitY')?.get('code')?.value"
                        >
                        </dropdown-field>
                    </div>
                    <div class="col-xl-1 col-lg-1 col-md-2 col-sm-12 pl-0">
                        <div class="inc-dec">
                            <div class="plus-minus">
                                <button
                                    class="btn mr-0"
                                    *ngIf="unitForm?.get('mappings')['controls']?.length > 1"
                                    (click)="removeMappedUnit(i)"
                                >
                                    <i class="icon-trash delete"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <button class="btn mr-0 add-new" (click)="addNewMappedUnit()">
                            {{ localeData?.add_new }}
                        </button>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-sm-4">
                    <button mat-stroked-button color="primary" type="button" (click)="saveUnit()">
                        {{ commonLocaleData?.app_save }}
                    </button>
                </div>
                <div class="col-lg-8">
                    <div class="pull-right">
                        <button
                            mat-stroked-button
                            type="button"
                            class="btn-sm"
                            (click)="resetForm()"
                            *ngIf="!unitDetails?.uniqueName"
                        >
                            {{ commonLocaleData?.app_clear }}
                        </button>
                        <button
                            mat-stroked-button
                            type="button"
                            class="btn-sm"
                            (click)="closeAsideEvent.emit(false)"
                            *ngIf="unitDetails?.uniqueName"
                        >
                            {{ commonLocaleData?.app_close }}
                        </button>
                        <button
                            mat-stroked-button
                            color="warn"
                            type="button"
                            class="btn-sm mr-0"
                            (click)="deleteUnit()"
                            *ngIf="unitDetails?.uniqueName"
                        >
                            {{ commonLocaleData?.app_delete }}
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </ng-container>
</ng-container>
