<ng-container
    appTranslate
    [file]="'inventory/adjustment'"
    (commonLocaleData)="commonLocaleData = $event"
    (localeData)="localeData = $event"
>
    <div class="relative">
        <hamburger-menu [pageHeading]="'Adjust inventory'"></hamburger-menu>
    </div>
    <div class="container-fluid mr-t15 adjust-inventory-list-page">
        <div class="d-flex justify-content-between adjust-inventory-header">
            <div class="custom-datepicker" (click)="showGiddhDatepicker($event)">
                <input
                    type="text"
                    id="select-date"
                    name="selectedDateRange"
                    [value]="selectedDateRangeUi ? selectedDateRangeUi : ''"
                    class="giddh-datepicker date-range-picker"
                />
            </div>
            <button id="add-adjustment-btn" mat-stroked-button color="primary" class="mr-0" (click)="addInventory()">
                + Add Adjustment
            </button>
        </div>
        <div *ngIf="adjustmentInventoryInProgress$ | async">
            <giddh-page-loader></giddh-page-loader>
        </div>
        <div class="custom-field-list mr-t15">
            <section *ngIf="showData && !(adjustmentInventoryInProgress$ | async)" class="mt-4">
                <form
                    class="table-responsive"
                    name="adjustInventoryListForm"
                    [formGroup]="adjustInventoryListForm"
                    novalidate=""
                    autocomplete="off"
                >
                    <table
                        matSort
                        mat-table
                        (matSortChange)="sortChange($event)"
                        [matSortActive]="adjustInventoryListRequest?.sortBy"
                        [matSortDirection]="adjustInventoryListRequest?.sort"
                        [dataSource]="dataSource"
                        class="giddh-table w-100"
                    >
                        <!-- Reference No. Column -->
                        <ng-container matColumnDef="referenceNo">
                            <th
                                width="12%"
                                mat-header-cell
                                *matHeaderCellDef
                                #searchReferenceNoContainer
                                class="td-search-box"
                                (clickOutside)="handleClickOutside($event, searchReferenceNoContainer, 'referenceNo')"
                            >
                                <ng-container
                                    *ngTemplateOutlet="
                                        searchTemplate;
                                        context: {
                                            $implicit: referenceNo,
                                            fieldName: 'referenceNo',
                                            title: 'Reference No.'
                                        }
                                    "
                                ></ng-container>
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.refNo }}
                            </td>
                        </ng-container>

                        <!-- Name Column -->
                        <ng-container matColumnDef="name">
                            <th
                                width="20%"
                                mat-header-cell
                                *matHeaderCellDef
                                #searchNameContainer
                                class="td-search-box"
                                (clickOutside)="handleClickOutside($event, searchNameContainer, 'name')"
                            >
                                <ng-container
                                    *ngTemplateOutlet="
                                        searchTemplate;
                                        context: {
                                            $implicit: name,
                                            fieldName: 'name',
                                            title: 'Stock Name'
                                        }
                                    "
                                ></ng-container>
                            </th>
                            <td mat-cell *matCellDef="let element">{{ element.adjustedProduct?.name }}</td>
                        </ng-container>

                        <!-- Reason Column -->
                        <ng-container matColumnDef="reason">
                            <th
                                width="20%"
                                mat-header-cell
                                *matHeaderCellDef
                                #searchReasonContainer
                                class="td-search-box"
                                (clickOutside)="handleClickOutside($event, searchReasonContainer, 'reason')"
                            >
                                <ng-container
                                    *ngTemplateOutlet="
                                        searchTemplate;
                                        context: {
                                            $implicit: reason,
                                            fieldName: 'reason',
                                            title: 'Reason'
                                        }
                                    "
                                ></ng-container>
                            </th>
                            <td mat-cell *matCellDef="let element">{{ element.reason?.name }}</td>
                        </ng-container>

                        <!-- Status Column -->
                        <ng-container matColumnDef="status">
                            <th
                                width="20%"
                                mat-header-cell
                                *matHeaderCellDef
                                #searchStatusContainer
                                class="td-search-box"
                                (clickOutside)="handleClickOutside($event, searchStatusContainer, 'status')"
                            >
                                <ng-container
                                    *ngTemplateOutlet="
                                        searchTemplate;
                                        context: {
                                            $implicit: status,
                                            fieldName: 'status',
                                            title: 'Request Status'
                                        }
                                    "
                                ></ng-container>
                            </th>
                            <td mat-cell *matCellDef="let element">{{ element?.status }}</td>
                        </ng-container>

                        <!-- Adjusted By Column -->
                        <ng-container matColumnDef="ADJUSTED_BY">
                            <th
                                width="20%"
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                                class="td-search-box"
                            >Adjusted By</th>
                            <td mat-cell *matCellDef="let element">{{ element.adjustedBy?.name }}</td>
                        </ng-container>

                           <!-- Adjustment Method Column -->
                        <ng-container matColumnDef="TYPE">
                            <th width="10%" mat-header-cell *matHeaderCellDef [matMenuTriggerFor]="inventoryTypeMenu">
                                Type
                                <i
                                    class="fa fa-ellipsis-v ml-1 text-light-2 mt-1 cursor-pointer"
                                    aria-hidden="true"
                                ></i>
                                       <mat-menu #inventoryTypeMenu="matMenu" xPosition="before">
                                <button
                                    class="no-box-shadow"
                                    mat-menu-item
                                    (click)="selectedInventoryType('STOCK')"
                                >
                                Stock
                                </button>
                                <button
                                    class="no-box-shadow"
                                    mat-menu-item
                                   (click)="selectedInventoryType('STOCK_GROUP')"
                                >
                                Group
                                </button>
                            </mat-menu>
                            </th>
                            <td mat-cell *matCellDef="let element">{{ element?.entity }}</td>
                        </ng-container>

                        <!-- Type Column -->
                        <ng-container matColumnDef="TYPE">
                            <th width="10%" mat-header-cell *matHeaderCellDef [matMenuTriggerFor]="inventoryTypeMenu">
                                Type
                                <i
                                    class="fa fa-ellipsis-v ml-1 text-light-2 mt-1 cursor-pointer"
                                    aria-hidden="true"
                                ></i>
                                       <mat-menu #inventoryTypeMenu="matMenu" xPosition="before">
                                <button
                                    class="no-box-shadow"
                                    mat-menu-item
                                    (click)="selectedInventoryType('STOCK')"
                                >
                                Stock
                                </button>
                                <button
                                    class="no-box-shadow"
                                    mat-menu-item
                                   (click)="selectedInventoryType('STOCK_GROUP')"
                                >
                                Group
                                </button>
                            </mat-menu>
                            </th>
                            <td mat-cell *matCellDef="let element">{{ element?.entity }}</td>
                        </ng-container>

                        <!-- Date Column -->
                        <ng-container matColumnDef="DATE">
                            <th class="date-column-width" width="18%" mat-header-cell *matHeaderCellDef mat-sort-header>
                                Date
                            </th>
                            <td class="date-column-width" mat-cell *matCellDef="let element">{{ element.date }}</td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                    </table>
                </form>
            </section>
            <div class="no-data" *ngIf="!dataSource?.filteredData?.length && !(adjustmentInventoryInProgress$ | async)">
                <h1>{{ commonLocaleData?.app_no_data_found }}</h1>
            </div>
            <div
                class="pagination-wrapper justify-content-end"
                *ngIf="showData && !(adjustmentInventoryInProgress$ | async)"
            >
                <!-- adjustInventoryListRequest.totalItems > 20 -->
                <mat-paginator
                    (page)="handlePageChange($event)"
                    [length]="adjustInventoryListRequest.totalItems"
                    [pageSize]="adjustInventoryListRequest.count"
                    [showFirstLastButtons]="true"
                    [pageSizeOptions]="pageSizeOptions"
                    [hidePageSize]="false"
                    [pageIndex]="pageIndex"
                    class="mt-15"
                >
                </mat-paginator>
            </div>
        </div>
    </div>
</ng-container>

<ng-template #searchTemplate let-show let-title="title" let-fieldName="fieldName" let-formControl="formControl">
    <div [hidden]="show">
        <i class="icon-search" (click)="toggleSearch(fieldName)"></i>
        <span> {{ title }}</span>
    </div>
    <div class="input-container" [hidden]="!show">
        <text-field
            [type]="'text'"
            [placeholder]="getSearchFieldText(title)"
            [cssClass]="'form-control search-table mat-field-border'"
            [autoFocus]="show"
        ></text-field>
    </div>
</ng-template>

<!-- Datepicker template -->
<ng-template #datepickerTemplate>
    <div class="datepicker-modal">
        <div class="modal-body">
            <app-datepicker-wrapper
                [inputStartDate]="selectedDateRange?.startDate"
                [inputEndDate]="selectedDateRange?.endDate"
                [alwaysShowCalendars]="true"
                [ranges]="datePickerOption"
                [selectedRangeLabel]="selectedRangeLabel"
                [showCustomRangeLabel]="true"
                [showClearButton]="false"
                [showCancel]="true"
                [linkedCalendars]="true"
                [showDropdowns]="true"
                (rangeClicked)="dateSelectedCallback($event)"
                (datesUpdated)="dateSelectedCallback($event)"
                [keepCalendarOpeningWithRange]="false"
                [showRangeLabelOnInput]="false"
                [dateFieldPosition]="dateFieldPosition"
            ></app-datepicker-wrapper>
        </div>
    </div>
</ng-template>
