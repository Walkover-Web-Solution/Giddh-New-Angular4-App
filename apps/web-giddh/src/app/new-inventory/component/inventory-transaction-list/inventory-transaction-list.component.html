<!--new inventory header-->
<div class="inventory-filter-bar">
    <div class="custom-datepicker-wrapper">
        <div class="custom-datepicker" (click)="showGiddhDatepicker($event)">
            <i class="icon-calender calendar-addon"></i>
            <input
                type="text"
                name="selectedDateRange"
                [value]="selectedDateRangeUi ? selectedDateRangeUi : ''"
                class="giddh-datepicker date-range-picker"
            />
        </div>
    </div>
    <div class="pl-1" *ngIf="isCompany">
        <mat-select
            name="selectedBranch"
            [multiple]="true"
            [(ngModel)]="selectedBranch"
            class="stock-mat-salect"
            [placeholder]="'Select Branch'"
        >
            <mat-option class="balance-options">
                <ngx-mat-select-search
                    [noEntriesFoundLabel]="'No Result Found'"
                    [formControl]="branchesDropdown"
                    [placeholderLabel]="'Select Branch'"
                >
                    <i class="icon-cross" ngxMatSelectSearchClear></i>
                </ngx-mat-select-search>
            </mat-option>

            <mat-option
                class="balance-options"
                *ngFor="let branch of branches"
                (click)="getBranches()"
                [value]="branch?.uniqueName"
            >
                {{ branch?.alias ?? "-" }}
            </mat-option>
        </mat-select>
    </div>
    <div class="pl-1">
        <mat-select
            name="selectedWarehouse"
            [multiple]="true"
            [(ngModel)]="selectedWarehouse"
            class="stock-mat-salect"
            [placeholder]="'Select Warehouse'"
        >
            <mat-option class="balance-options">
                <ngx-mat-select-search
                    [noEntriesFoundLabel]="commonLocaleData?.app_no_result_found"
                    [formControl]="warehousesDropdown"
                    [placeholderLabel]="'Select Warehouse'"
                >
                    <i class="icon-cross" ngxMatSelectSearchClear></i>
                </ngx-mat-select-search>
            </mat-option>
            <mat-option
                class="balance-options"
                *ngFor="let warehouse of warehouses"
                [value]="warehouse?.uniqueName"
                (click)="getWarehouses()"
            >
                {{ warehouse?.name ?? "-" }}
            </mat-option>
        </mat-select>
    </div>
    <!-- <div class="clear-filter d-flex" *ngIf="isFilterCorrect">
        <button
            mat-raised-button
            class="create-btn-inventory btn-sky-blue ml-3 mr-0"
            color="primary"
            (click)="resetFilter()"
        >
            <span class="icon-cross"></span> Clear
        </button>
    </div> -->
</div>

<div class="inventory-filter-bar">
    <div class="search-control">
        <i class="icon-search search-icon"></i>
        <mat-form-field floatLabel="never" class="select-multiple-chiplist-inventory">
            <mat-chip-list #matChipList>
                <mat-chip
                    *ngFor="let chip of filtersChipList; let indx = index"
                    [selectable]="true"
                    [removable]="true"
                    (removed)="removeOption(chip, indx)"
                >
                    {{ chip?.name }}
                    <i class="icon-cross" matChipRemove></i>
                </mat-chip>
                <input
                    type="text"
                    matInput
                    [formControl]="searchingFilters"
                    [placeholder]="'Searching  Stock Group , Multiple  Stocks, Multiple Variants'"
                    [matAutocomplete]="auto"
                    [matChipInputFor]="matChipList"
                    #trigger="matAutocompleteTrigger"
                    [name]="'stocks'"
                    #selectField
                    autocomplete="off"
                    matAutocompletePosition="auto"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                />
            </mat-chip-list>
            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectOption($event); selectField.value = ''">
                <mat-option *ngFor="let option of fieldFilteredOptions" [value]="option">
                    {{ option?.name }} ( {{ option?.type }} )
                </mat-option>
            </mat-autocomplete>
        </mat-form-field>
        <div class="menu-btn-control">
            <button mat-button (click)="openModal()" class="advance-filter-button">
                <i class="icon-advance-filter mr-2"></i>
                Advance Filter
            </button>
            <button mat-button [matMenuTriggerFor]="customise" aria-label="Customise" class="customise-filter-button">
                <i class="icon-options mr-2"> </i>
                Customise
            </button>
            <mat-menu #customise="matMenu">
                <button
                    mat-menu-item
                    (click)="$event?.stopPropagation()"
                    (keydown.enter)="
                        $event?.stopPropagation();
                        selectAllCheckbox.checked = !selectAllCheckbox?.checked;
                        selectAllColumns(selectAllCheckbox?.checked)
                    "
                >
                    <mat-checkbox
                        #selectAllCheckbox
                        color="primary"
                        name="selectAll"
                        (change)="selectAllColumns($event?.checked)"
                        [checked]="displayedColumns?.length === CUSTOMISE_COLUMNS?.length"
                        [indeterminate]="
                            displayedColumns?.length < CUSTOMISE_COLUMNS?.length && displayedColumns?.length > 0
                        "
                    >
                        Select All
                    </mat-checkbox>
                </button>
                <ng-container *ngFor="let item of CUSTOMISE_COLUMNS">
                    <button
                        mat-menu-item
                        (click)="$event?.stopPropagation()"
                        (keydown.enter)="$event?.stopPropagation(); item.checked = !item?.checked; saveColumns()"
                    >
                        <mat-checkbox
                            color="primary"
                            name="{{ item?.value }}"
                            (ngModelChange)="saveColumns()"
                            [(ngModel)]="item.checked"
                            (click)="$event?.stopPropagation()"
                        >
                            {{ item?.label }}</mat-checkbox
                        >
                    </button>
                </ng-container>
            </mat-menu>
        </div>
    </div>
    <!-- <div class="d-flex transactional-filter-section">
            <button
            mat-mini-fab
            class="transactional-wise-common-btn d-flex align-items-center justify-content-center mr-l1"  [matMenuTriggerFor]="importExport" aria-label="Customise"
        >
            <span class="icon-download-circle strong"></span>
        </button>
        <mat-menu #importExport="matMenu">
            <div class="menu-selector">
                <button mat-menu-item>
                    <span>CSV</span>
                </button>
                <button mat-menu-item>
                    <span>XLS</span>
                </button>
            </div>
        </mat-menu>
    </div> -->
</div>
<div class="inventory-transaction-list">
    <div class="p-3">
        <div class="row">
            <div class="col-12">
                <div class="top-content">
                    <!-- {{ stockTransactionReportBalance | json }} -->
                    <div class="d-flex w-100 justify-content-between overflow-x-auto">
                        <div class="total-details-box mr-r05 count-box">
                            <h5>
                                Transaction Count
                                <div class="mt-2">
                                    <span class="d-inline-flex number-total"
                                        >{{ stockReportRequest?.totalItems ?? "-" }}
                                    </span>
                                </div>
                            </h5>
                        </div>
                        <div class="total-details-box mr-r05 border-none opening-box">
                            <h5>
                                Profit/Loss
                                <div class="mt-2">
                                    <span
                                        class="d-inline-flex number-total w-100"
                                        [matTooltip]="stockTransactionReportBalance?.profit"
                                    >
                                        {{
                                            stockTransactionReportBalance?.profit
                                                ? (stockTransactionReportBalance?.profit | giddhCurrency)
                                                : "-"
                                        }}
                                    </span>
                                    <span class="d-inline-flex mt-1"> ({{ fromDate + "-" + toDate }}) </span>
                                </div>
                            </h5>
                        </div>
                        <div class="total-details-box mr-r05 border-none sales-purchase">
                            <h5>
                                Opening
                                <div class="mt-2">
                                    <span
                                        class="d-inline-flex number-total w-100"
                                        [matTooltip]="stockTransactionReportBalance?.opening?.amount"
                                    >
                                        {{
                                            stockTransactionReportBalance?.opening?.amount
                                                ? (stockTransactionReportBalance?.opening?.amount | giddhCurrency)
                                                : "-"
                                        }}
                                    </span>
                                    <span class="d-inline-flex mt-1">
                                        (
                                        {{
                                            stockTransactionReportBalance?.opening?.quantity
                                                ? (stockTransactionReportBalance?.opening?.quantity | giddhCurrency)
                                                : "-"
                                        }})
                                    </span>
                                </div>
                            </h5>
                        </div>
                        <div class="total-details-box mr-r05 border-none payment-receipt">
                            <h5>
                                Inward
                                <div class="mt-2">
                                    <span
                                        class="d-inline-flex number-total w-100"
                                        [matTooltip]="stockTransactionReportBalance?.inwards?.amount"
                                    >
                                        {{
                                            stockTransactionReportBalance?.inwards?.amount
                                                ? (stockTransactionReportBalance?.inwards?.amount | giddhCurrency)
                                                : "-"
                                        }}
                                    </span>
                                    <span class="d-inline-flex mt-1">
                                        (
                                        {{
                                            stockTransactionReportBalance?.inwards?.quantity
                                                ? (stockTransactionReportBalance?.inwards?.quantity | giddhCurrency)
                                                : "-"
                                        }})
                                    </span>
                                </div>
                            </h5>
                        </div>
                        <div class="total-details-box mr-r05 border-none due-box">
                            <h5>
                                Outward
                                <div class="mt-2">
                                    <span
                                        class="d-inline-flex number-total w-100"
                                        [matTooltip]="stockTransactionReportBalance?.outwards?.amount"
                                    >
                                        {{
                                            stockTransactionReportBalance?.outwards?.amount
                                                ? (stockTransactionReportBalance?.outwards?.amount | giddhCurrency)
                                                : "-"
                                        }}
                                    </span>
                                    <span class="d-inline-flex mt-1">
                                        (
                                        {{
                                            stockTransactionReportBalance?.outwards?.quantity
                                                ? (stockTransactionReportBalance?.outwards?.quantity | giddhCurrency)
                                                : "-"
                                        }})
                                    </span>
                                </div>
                            </h5>
                        </div>
                        <div class="total-details-box border-none closing-box">
                            <h5>
                                Closing
                                <div class="mt-2">
                                    <span
                                        class="d-inline-flex number-total w-100"
                                        [matTooltip]="stockTransactionReportBalance?.closing?.amount"
                                    >
                                        {{
                                            stockTransactionReportBalance?.closing?.amount
                                                ? (stockTransactionReportBalance?.closing?.amount | giddhCurrency)
                                                : "-"
                                        }}
                                    </span>
                                    <span class="d-inline-flex mt-1">
                                        (
                                        {{
                                            stockTransactionReportBalance?.closing?.quantity
                                                ? (stockTransactionReportBalance?.closing?.quantity | giddhCurrency)
                                                : "-"
                                        }})
                                    </span>
                                </div>
                            </h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 horizontal-padding">
            <div class="table-responsive table-content">
                <table
                    mat-table
                    [dataSource]="dataSource"
                    matSort
                    (matSortChange)="sortChange($event)"
                    [matSortActive]="stockReportRequest?.sortBy"
                    [matSortDirection]="stockReportRequest?.sort"
                    class="table giddh-table on-mobile-view"
                >
                    <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
                        <td data-title="Date" mat-cell *matCellDef="let element">
                            {{ element?.entryDate ?? "-" }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="voucherType">
                        <th width="8%" mat-header-cell *matHeaderCellDef [matMenuTriggerFor]="voucherTypes">
                            Voucher Type
                            <i
                                class="fa fa-ellipsis-v pull-right text-light-2 mt-1 cursor-pointer"
                                aria-hidden="true"
                            ></i>
                            <mat-menu #voucherTypes="matMenu">
                                <ng-container *ngFor="let item of VOUCHER_TYPES; let idx = index">
                                    <button
                                        mat-menu-item
                                        (click)="$event?.stopPropagation()"
                                        (keydown.enter)="
                                            $event?.stopPropagation();
                                            item.checked = !item?.checked;
                                            filterByCheck(item?.value)
                                        "
                                    >
                                        <mat-checkbox
                                            color="primary"
                                            name="{{ item?.value }}"
                                            (ngModelChange)="filterByCheck(item?.value)"
                                            [(ngModel)]="item.checked"
                                            (click)="$event?.stopPropagation()"
                                        >
                                            {{ item?.label }}</mat-checkbox
                                        >
                                    </button>
                                </ng-container>
                            </mat-menu>
                        </th>
                        <td date-title="Voucher Type" mat-cell *matCellDef="let element">
                            {{ element?.voucherType }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="accountName">
                        <th
                            class="td-search-box"
                            width="15%"
                            mat-header-cell
                            #searchCustomerContainer
                            *matHeaderCellDef
                            (clickOutside)="handleClickOutside($event, searchCustomerContainer, 'name')"
                        >
                            <ng-container
                                *ngTemplateOutlet="
                                    searchTemplate;
                                    context: {
                                        $implicit: showAccountSearch,
                                        fieldName: 'name',
                                        formControl: accountNameSearching,
                                        title: 'Account Name'
                                    }
                                "
                            ></ng-container>
                        </th>
                        <td data-title="Account Name" class="text-right" mat-cell *matCellDef="let element">
                            {{ element?.account?.name ?? "-" }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="stockName">
                        <th class="text-right" mat-header-cell *matHeaderCellDef mat-sort-header>Stock Name</th>
                        <td data-title="Stock Name" class="text-right" mat-cell *matCellDef="let element">
                            {{ element?.stockNameUniqueName?.name ?? "-" }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="variantName">
                        <th class="text-right" mat-header-cell *matHeaderCellDef mat-sort-header>Variant Name</th>
                        <td data-title="Variant Name" class="text-right" mat-cell *matCellDef="let element">
                            {{ element?.variant?.name ?? "-" }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="inwards">
                        <th class="text-right" mat-header-cell *matHeaderCellDef mat-sort-header>Inwards</th>
                        <td
                            data-title="Inwards"
                            class="text-right"
                            mat-cell
                            *matCellDef="let element"
                            [matTooltip]="element?.inwardBalance"
                        >
                            {{ element?.inwardBalance ? (element?.inwardBalance | giddhCurrency) : "-" }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="outwards">
                        <th class="text-right" mat-header-cell *matHeaderCellDef mat-sort-header>Outwards</th>
                        <td
                            data-title="Outwards"
                            class="text-right"
                            mat-cell
                            *matCellDef="let element"
                            [matTooltip]="element?.outwardBalance"
                        >
                            {{ element?.outwardBalance ? (element?.outwardBalance | giddhCurrency) : "-" }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="rate">
                        <th class="text-right" mat-header-cell *matHeaderCellDef mat-sort-header>Rate</th>
                        <td
                            data-title="Rate"
                            class="text-right"
                            mat-cell
                            *matCellDef="let element"
                            [matTooltip]="element?.rate"
                        >
                            {{ element?.rate ? (element?.rate | giddhCurrency) : "-" }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="value">
                        <th class="text-right" mat-header-cell *matHeaderCellDef mat-sort-header>Value</th>
                        <td
                            data-title="Value"
                            class="text-right"
                            mat-cell
                            *matCellDef="let element"
                            [matTooltip]="element?.amount"
                        >
                            {{ element?.amount ? (element?.amount | giddhCurrency) : "-" }}
                        </td>
                    </ng-container>
                    <!-- <ng-container matColumnDef="qty">
                        <th class="text-right" mat-header-cell *matHeaderCellDef>qty</th>
                        <td data-title="Qty" class="text-right" mat-cell *matCellDef="let element">
                            {{ element.qty }}
                        </td>
                    </ng-container> -->
                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                    <tr class="mat-row" *matNoDataRow>
                        <td
                            class="mat-cell p-5"
                            style="border-bottom: 0px"
                            [attr.colspan]="displayedColumns?.length ? displayedColumns?.length : 9"
                        >
                            <div class="no-data" *ngIf="isLoading">
                                <giddh-page-loader></giddh-page-loader>
                            </div>
                            <div class="no-data" *ngIf="!isLoading">
                                <h1>No Data Found</h1>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="pagination-wrapper">
                <pagination
                    *ngIf="
                        stockReportRequest?.totalItems > stockReportRequest?.count &&
                        !isLoading &&
                        displayedColumns?.length
                    "
                    [totalItems]="stockReportRequest?.totalItems"
                    [(ngModel)]="stockReportRequest.page"
                    [maxSize]="5"
                    class="pagination-sm"
                    [boundaryLinks]="true"
                    [itemsPerPage]="stockReportRequest?.count"
                    [rotate]="false"
                    (pageChanged)="pageChanged($event)"
                    [firstText]="commonLocaleData?.app_first"
                    [previousText]="commonLocaleData?.app_previous"
                    [nextText]="commonLocaleData?.app_next"
                    [lastText]="commonLocaleData?.app_last"
                ></pagination>
            </div>
        </div>
    </div>
</div>
<ng-template #datepickerTemplate>
    <div class="datepicker-modal">
        <div class="modal-body">
            <app-datepicker-wrapper
                [inputStartDate]="selectedDateRange?.startDate"
                [inputEndDate]="selectedDateRange?.endDate"
                [alwaysShowCalendars]="true"
                [ranges]="datePickerOptions"
                [selectedRangeLabel]="selectedRangeLabel"
                [showCustomRangeLabel]="true"
                [showClearButton]="false"
                [showCancel]="true"
                [linkedCalendars]="true"
                [showDropdowns]="true"
                [locale]="{ applyLabel: commonLocaleData?.app_done }"
                (rangeClicked)="dateSelectedCallback($event)"
                (datesUpdated)="dateSelectedCallback($event)"
                [keepCalendarOpeningWithRange]="false"
                [showRangeLabelOnInput]="false"
                [dateFieldPosition]="dateFieldPosition"
            ></app-datepicker-wrapper>
        </div>
    </div>
</ng-template>
<ng-template
    #searchTemplate
    let-show
    let-title="title"
    let-placeholder="placeholder"
    let-fieldName="fieldName"
    let-formControl="formControl"
>
    <div class="align-items-center d-flex" [hidden]="show">
        <span>{{ title }}</span>
        <button mat-icon-button (click)="toggleSearch(fieldName)">
            <span class="icon-search"></span>
        </button>
    </div>
    <div [hidden]="!show">
        <text-field
            [type]="'text'"
            [placeholder]="getSearchFieldText(fieldName)"
            [cssClass]="'form-control search-table mat-field-border'"
            [formControl]="formControl"
            [autoFocus]="show"
        ></text-field>
    </div>
</ng-template>
