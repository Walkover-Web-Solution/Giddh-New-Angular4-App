<ng-container
    appTranslate
    [file]="'receipt'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
>
    <mat-card class="receipt-card">
        <mat-card-content>
            <form autocomplete="off" novalidate class="receipt-form" #receiptForm="ngForm">
                <div class="clearfix">
                    <div
                        class="clearfix pd-t15"
                        [ngClass]="{ 'wrapper-receipt-fields': !receiptFormData.account.uniqueName }"
                    >
                        <div class="inner-container">
                            <div
                                class="clearfix"
                                [keyboardShortcut]="'alt+c'"
                                (onShortcutPress)="addAccountFromShortcut()"
                            >
                                <div class="row">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>Customer Name <span class="red-text">*</span></label>
                                    </div>
                                    <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9 select-customer-name">
                                        <div class="clearfix d-flex flex-column">
                                            <div class="d-flex">
                                                <sales-sh-select
                                                    class="float-left sales-select width-627"
                                                    name="customerUniqueName"
                                                    #customerNameDropDown
                                                    [options]="customerAccounts$ | async"
                                                    [(ngModel)]="receiptFormData.account.uniqueName"
                                                    [customFilter]="customMoveGroupFilter"
                                                    (noOptionsFound)="noResultsForCustomer($event)"
                                                    [isPaginationEnabled]="true"
                                                    (scrollEnd)="handleScrollEnd('customer')"
                                                    (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'customer')"
                                                    [notFoundMsg]="noResultsFoundLabel"
                                                    [enableDynamicSearch]="true"
                                                    (onHide)="resetPreviousSearchResults(true, 'customer')"
                                                    (selected)="onSelectCustomer($event)"
                                                    placeholder="Select"
                                                    [notFoundLink]="true"
                                                    [doNotReset]="true"
                                                    [forceClearReactive]="forceClear$ | async"
                                                    [isFilterEnabled]="true"
                                                    (noResultsClicked)="addNewAccount()"
                                                    [multiple]="false"
                                                    [ItemHeight]="67"
                                                    [notFoundLinkText]="'Add Customer'"
                                                    (keyup)="resetCustomerName($event)"
                                                    (onClear)="resetCustomerName(null)"
                                                    [isOpen]="allowFocus"
                                                >
                                                    <ng-template #optionTemplate let-option="option">
                                                        <a href="javascript:void(0)" class="list-item flex-column">
                                                            <div class="item">{{ option?.label }}</div>
                                                            <div class="item-unique">{{ option.value }}</div>
                                                        </a>
                                                    </ng-template>
                                                    <ng-template #notFoundLinkTemplate>
                                                        <a
                                                            href="javascript:void(0)"
                                                            class="
                                                                list-item
                                                                pd-l05 pd-r05
                                                                border-none
                                                                d-flex
                                                                justify-content-between
                                                                w-100
                                                            "
                                                            [keyboardShortcut]="'alt+c'"
                                                        >
                                                            <div class="item">Add Customer</div>
                                                            <div class="item">
                                                                {{ commonLocaleData?.app_alt_c }}
                                                            </div>
                                                        </a>
                                                    </ng-template>
                                                </sales-sh-select>
                                            </div>
                                            <div class="d-flex aqua-color" *ngIf="receiptFormData?.account.uniqueName">
                                                <span class="cp aqua-color mr-r05">
                                                    <a href="javascript:void(0)" (click)="getCustomerDetails()"
                                                        >Customer Details</a
                                                    >
                                                </span>
                                            </div>
                                        </div>
                                        <ng-container *ngIf="!receiptFormData.account.uniqueName">
                                            <img
                                                src="{{ imgPath }}new/search_customer.svg"
                                                class="img-responsive search-arrow-image"
                                            />
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-xl-9 offset-lg-3 col-lg-8 col-md-9 offset-xl-2 offset-md-3">
                                    <ng-container>
                                        <section
                                            [ngClass]="{ 'billing-address-wrap': !receiptFormData.account.uniqueName }"
                                        >
                                            <div class="wrap-billing-address clearfix w-100">
                                                <div class="row">
                                                    <!-- region billing address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group">
                                                            <div class="d-flex align-items-center">
                                                                <span class="pb-0 pd-r15">Billing address</span>
                                                                <span>
                                                                    <div
                                                                        class="
                                                                            btn-group btn-block
                                                                            change-address-dropdown
                                                                        "
                                                                        *ngIf="accountAddressList?.length > 1"
                                                                    >
                                                                        <a
                                                                            mat-button
                                                                            [matMenuTriggerFor]="billingAddressMenu"
                                                                            class="dropdown-toggle"
                                                                            [style.height.px]="29"
                                                                        >
                                                                            Change</a
                                                                        >
                                                                        <mat-menu #billingAddressMenu="matMenu">
                                                                            <button
                                                                                mat-menu-item
                                                                                *ngFor="
                                                                                    let address of accountAddressList
                                                                                "
                                                                            >
                                                                                <a
                                                                                    class="dropdown-item"
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            receiptFormData.account
                                                                                                .billingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    {{ address.address }}
                                                                                    {{ address.state?.name }}
                                                                                    <span class="d-block">
                                                                                        {{
                                                                                            address.gstNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.gstNumber
                                                                                                : ""
                                                                                        }}
                                                                                    </span>
                                                                                </a>
                                                                            </button>
                                                                        </mat-menu>
                                                                    </div>
                                                                </span>
                                                            </div>
                                                            <div class="billing-address clearfix">
                                                                <textarea
                                                                    matInput
                                                                    name="billingDetails.address"
                                                                    class="form-control"
                                                                    (keyup)="autoFillShippingDetails()"
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                    [(ngModel)]="
                                                                        receiptFormData.account.billingDetails
                                                                            .address[0]
                                                                    "
                                                                    autofocus="off"
                                                                    aria-autocomplete="none"
                                                                    #customerBillingAddress
                                                                ></textarea>

                                                                <div class="row">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <label class="sales-country-label">
                                                                            {{ customerCountryName }}
                                                                        </label>
                                                                    </div>

                                                                    <div class="col-sm-12 col-md-6" #billingState>
                                                                        <sales-sh-select
                                                                            [placeholder]="commonLocaleData?.app_state"
                                                                            class="square pd-b01"
                                                                            (selected)="
                                                                                fillShippingBillingDetails(
                                                                                    $event,
                                                                                    true
                                                                                );
                                                                                autoFillShippingDetails()
                                                                            "
                                                                            #statesBilling
                                                                            [showBottomBorderOnly]="true"
                                                                            [forceClearReactive]="
                                                                                billingShippingForceClearReactive$
                                                                                    | async
                                                                            "
                                                                            [options]="statesSource"
                                                                            name="billingDetails.stateCode"
                                                                            [(ngModel)]="
                                                                                receiptFormData.account.billingDetails
                                                                                    .state.code
                                                                            "
                                                                        >
                                                                        </sales-sh-select>
                                                                    </div>

                                                                    <div
                                                                        class="col-sm-6 col-md-6"
                                                                        *ngIf="shouldShowTrnGstField"
                                                                    >
                                                                        <text-field
                                                                            [maxlength]="15"
                                                                            autocomplete="None"
                                                                            name="billingDetails.gstNumber"
                                                                            [cssClass]="'form-control input-custom'"
                                                                            *ngIf="showGSTINNo"
                                                                            [(ngModel)]="
                                                                                receiptFormData.account.billingDetails
                                                                                    .gstNumber
                                                                            "
                                                                            (change)="
                                                                                getStateCode(
                                                                                    'billingDetails',
                                                                                    statesBilling
                                                                                );
                                                                                autoFillShippingDetails()
                                                                            "
                                                                            [placeholder]="commonLocaleData?.app_gstin"
                                                                        ></text-field>
                                                                        <text-field
                                                                            [maxlength]="15"
                                                                            autocomplete="None"
                                                                            type="text"
                                                                            name="billingDetails.gstNumber"
                                                                            [cssClass]="'form-control input-custom'"
                                                                            *ngIf="showTRNNo"
                                                                            [(ngModel)]="
                                                                                receiptFormData.account.billingDetails
                                                                                    .gstNumber
                                                                            "
                                                                            (change)="
                                                                                getStateCode(
                                                                                    'billingDetails',
                                                                                    statesBilling
                                                                                );
                                                                                autoFillShippingDetails()
                                                                            "
                                                                            [placeholder]="commonLocaleData?.app_trn"
                                                                        ></text-field>
                                                                    </div>
                                                                    <!-- static pin code  -->
                                                                    <div
                                                                        [ngClass]="{
                                                                            'col-sm-6 col-md-6':
                                                                                showGSTINNo || showTRNNo,
                                                                            'col-sm-12 col-md-12': !(
                                                                                showGSTINNo || showTRNNo
                                                                            )
                                                                        }"
                                                                    >
                                                                        <div class="form-group mr-b05">
                                                                            <text-field
                                                                                [type]="'number'"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                autocomplete="false"
                                                                                name="billingPinCode"
                                                                                (blur)="autoFillShippingDetails()"
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_pin_code
                                                                                "
                                                                                [(ngModel)]="
                                                                                    receiptFormData.account
                                                                                        .billingDetails.pincode
                                                                                "
                                                                                decimalDigitsDirective
                                                                                [preventDecimal]="true"
                                                                            ></text-field>
                                                                        </div>
                                                                    </div>
                                                                    <!-- static pin code end-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->

                                                    <!-- region shipping address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group p-0 width-100">
                                                            <div class="d-flex align-items-center pb-1">
                                                                <span class="pb-0 pd-r15">
                                                                    <mat-checkbox
                                                                        color="primary"
                                                                        (change)="autoFillShippingDetails()"
                                                                        name="autoFillShipping"
                                                                        [(ngModel)]="autoFillShipping"
                                                                        >Shipping Address Same as Billing
                                                                        Address</mat-checkbox
                                                                    >
                                                                </span>
                                                                <span>
                                                                    <div
                                                                        class="
                                                                            btn-group btn-block
                                                                            change-address-dropdown
                                                                        "
                                                                        *ngIf="
                                                                            accountAddressList?.length > 1 &&
                                                                            !autoFillShipping
                                                                        "
                                                                    >
                                                                        <a
                                                                            mat-button
                                                                            [matMenuTriggerFor]="shippingAddressMenu"
                                                                            type="button"
                                                                            class="dropdown-toggle"
                                                                            [style.height.px]="24"
                                                                        >
                                                                            Change</a
                                                                        >
                                                                        <mat-menu #shippingAddressMenu="matMenu">
                                                                            <button
                                                                                mat-menu-item
                                                                                *ngFor="
                                                                                    let address of accountAddressList
                                                                                "
                                                                            >
                                                                                <a
                                                                                    class="dropdown-item"
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            receiptFormData.account
                                                                                                .shippingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    {{ address.address }}
                                                                                    {{ address.state?.name }}

                                                                                    <span class="d-block"
                                                                                        >{{
                                                                                            address.gstNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.gstNumber
                                                                                                : ""
                                                                                        }}
                                                                                    </span>
                                                                                </a>
                                                                            </button>
                                                                        </mat-menu>
                                                                    </div>
                                                                </span>
                                                            </div>
                                                            <div
                                                                class="billing-address"
                                                                [ngClass]="{ 'disabled': autoFillShipping }"
                                                            >
                                                                <textarea
                                                                    matInput
                                                                    [readonly]="autoFillShipping"
                                                                    name="shippingDetails.address"
                                                                    class="form-control"
                                                                    [(ngModel)]="
                                                                        receiptFormData.account.shippingDetails
                                                                            .address[0]
                                                                    "
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                ></textarea>

                                                                <div class="clearfix form-group mb-0">
                                                                    <div class="row">
                                                                        <div class="col-sm-12 col-md-6">
                                                                            <div class="form-group mb-0">
                                                                                <label class="sales-country-label">
                                                                                    {{ customerCountryName }}
                                                                                </label>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-sm-12 col-md-6" #shippingState>
                                                                            <sales-sh-select
                                                                                [disabled]="autoFillShipping"
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_state
                                                                                "
                                                                                class="square pd-b01"
                                                                                #statesShipping
                                                                                [forceClearReactive]="
                                                                                    billingShippingForceClearReactive$
                                                                                        | async
                                                                                "
                                                                                [showBottomBorderOnly]="true"
                                                                                (selected)="
                                                                                    fillShippingBillingDetails(
                                                                                        $event,
                                                                                        false
                                                                                    )
                                                                                "
                                                                                [options]="statesSource"
                                                                                name="shippingDetails.stateCode"
                                                                                [(ngModel)]="
                                                                                    receiptFormData.account
                                                                                        .shippingDetails.state.code
                                                                                "
                                                                            >
                                                                            </sales-sh-select>
                                                                        </div>

                                                                        <div
                                                                            class="col-sm-6"
                                                                            *ngIf="shouldShowTrnGstField"
                                                                        >
                                                                            <text-field
                                                                                [readonly]="autoFillShipping"
                                                                                autocomplete="None"
                                                                                [maxlength]="15"
                                                                                type="text"
                                                                                name="shippingDetails.gstNumber"
                                                                                *ngIf="showGSTINNo"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                [(ngModel)]="
                                                                                    receiptFormData.account
                                                                                        .shippingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'shippingDetails',
                                                                                        statesShipping
                                                                                    )
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_gstin
                                                                                "
                                                                            ></text-field>
                                                                            <text-field
                                                                                [readonly]="autoFillShipping"
                                                                                [maxlength]="15"
                                                                                autocomplete="None"
                                                                                type="text"
                                                                                name="shippingDetails.gstNumber"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                *ngIf="showTRNNo"
                                                                                [(ngModel)]="
                                                                                    receiptFormData.account
                                                                                        .shippingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'shippingDetails',
                                                                                        statesShipping
                                                                                    )
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_trn
                                                                                "
                                                                            ></text-field>
                                                                        </div>
                                                                        <!-- static pin code  -->
                                                                        <div
                                                                            [ngClass]="{
                                                                                'col-sm-6': showGSTINNo || showTRNNo,
                                                                                'col-sm-12': !(showGSTINNo || showTRNNo)
                                                                            }"
                                                                        >
                                                                            <div class="form-group mr-b05">
                                                                                <text-field
                                                                                    [type]="'number'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    autocomplete="false"
                                                                                    name="shippingPinCode"
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_pin_code
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        receiptFormData.account
                                                                                            .shippingDetails.pincode
                                                                                    "
                                                                                    decimalDigitsDirective
                                                                                    [preventDecimal]="true"
                                                                                >
                                                                                </text-field>
                                                                            </div>
                                                                        </div>
                                                                        <!-- static pin code end-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                </div>
                                            </div>
                                        </section>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix">
                        <div class="inner-container">
                            <div class="clearfix">
                                <div class="row mr-b05">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 mt-3">
                                        <label>Attention To</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9">
                                        <mat-form-field appearance="fill" class="width-627">
                                            <text-field
                                                [cssClass]="'form-control mat-field-border'"
                                                name="attention-to"
                                                id="attention-to"
                                                placeholder="Enter Name"
                                                [(ngModel)]="receiptFormData.account.attentionTo"
                                            >
                                            </text-field>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix">
                                <div class="row mr-b05">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>&nbsp;</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9">
                                        <div class="width-627">
                                            <mat-checkbox
                                                color="primary"
                                                name="advance-receipt"
                                                [(ngModel)]="isAdvanceReceipt"
                                                >Advance Receipt</mat-checkbox
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix">
                                <div class="row position-relative mr-b2">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>Receipt Date <span class="red-text">*</span></label>
                                    </div>
                                    <div class="col-sm-12 col-xl-6 col-lg-5 col-md-10">
                                        <giddh-datepicker
                                            class="inline"
                                            name="receipt-date"
                                            [(ngModel)]="receiptFormData.date"
                                            [placeholder]="'Enter Date'"
                                            [cssClass]="'mat-field-border border-left-right-none form-control w-100'"
                                            [showToggleIcon]="false"
                                        ></giddh-datepicker>
                                    </div>
                                    <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 cheque-details">
                                        <div class="form-inline flex-row flex-nowrap">
                                            <div class="form-group">
                                                <label>Amount <span class="red-text">*</span></label>
                                                <mat-form-field appearance="fill" class="mr-l1">
                                                    <text-field
                                                        [cssClass]="'form-control mat-field-border'"
                                                        name="receipt-amount"
                                                        id="receipt-amount"
                                                        placeholder="Enter Amount"
                                                        decimalDigitsDirective
                                                        [mask]="inputMaskFormat"
                                                        [(ngModel)]="
                                                            receiptFormData.entries[0].transactions[0].amount
                                                                .amountForAccount
                                                        "
                                                        (ngModelChange)="calculateTotals()"
                                                    >
                                                    </text-field>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix pull-right receipt-card-table">
                                <ng-container>
                                    <div
                                        class="switch-currency d-flex align-items-center"
                                        *ngIf="isMulticurrencyAccount && !showSwitchCurrency"
                                    >
                                        <span class="left-currency mr-r1"
                                            >{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrencyName }}</span
                                        >
                                        <img
                                            class="switch-icon"
                                            src="{{ imgPath }}switch-icon.svg"
                                            alt="switch-icon"
                                            (click)="switchCurrencyImg(true)"
                                        />
                                        <span class="right-currency mr-r1 d-flex align-items-center">
                                            <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                                originalExchangeRate | giddhCurrency
                                            }}</span>
                                            <text-field
                                                [type]="'number'"
                                                name="exchangeRate"
                                                [(ngModel)]="exchangeRate"
                                                *ngIf="showCurrencyValue"
                                                [cssClass]="'form-control edit-currency'"
                                            >
                                            </text-field>
                                            {{ companyCurrency }}
                                        </span>

                                        <span class="edit-icon cp">
                                            <img
                                                src="{{ imgPath }}edit-pencilicon.svg"
                                                class="edit-pencil"
                                                *ngIf="!autoSaveIcon"
                                                (click)="
                                                    showCurrencyValue = !showCurrencyValue;
                                                    autoSaveIcon = !autoSaveIcon;
                                                    exchangeRate = originalExchangeRate
                                                "
                                            />
                                            <img
                                                src="{{ imgPath }}autosave.svg"
                                                class="edit-pencil"
                                                (click)="
                                                    originalExchangeRate = exchangeRate;
                                                    previousExchangeRate = exchangeRate;
                                                    autoSaveIcon = !autoSaveIcon;
                                                    showCurrencyValue = !showCurrencyValue;
                                                    calculateTotals()
                                                "
                                                *ngIf="autoSaveIcon"
                                            />
                                        </span>
                                    </div>
                                    <div class="switch-currency" *ngIf="isMulticurrencyAccount && showSwitchCurrency">
                                        <span class="left-currency mr-r1"
                                            >{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrency }}</span
                                        >
                                        <img
                                            class="switch-icon"
                                            src="{{ imgPath }}switch-icon.svg"
                                            alt="switch-icon"
                                            (click)="switchCurrencyImg(false)"
                                        />
                                        <span class="right-currency mr-l1">
                                            <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                                originalReverseExchangeRate | giddhCurrency
                                            }}</span>
                                            <text-field
                                                [type]="'number'"
                                                name="reverseExchangeRate"
                                                [(ngModel)]="reverseExchangeRate"
                                                *ngIf="showCurrencyValue"
                                                [cssClass]="'form-control edit-currency'"
                                            ></text-field>
                                            {{ companyCurrencyName }}
                                        </span>
                                        <span class="edit-icon cp">
                                            <img
                                                *ngIf="!autoSaveIcon"
                                                src="{{ imgPath }}edit-pencilicon.svg"
                                                class="edit-pencil"
                                                (click)="saveCancelExchangeRate(false)"
                                            />
                                            <img
                                                src="{{ imgPath }}autosave.svg"
                                                class="edit-pencil"
                                                (click)="saveCancelExchangeRate(true)"
                                                *ngIf="autoSaveIcon"
                                            />
                                        </span>
                                    </div>
                                </ng-container>
                            </div>
                            <div class="clearfix">
                                <table class="table receipt-table" width="100%" cellpadding="0" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>Receipt Mode <span class="red-text">*</span></th>
                                            <th>Cheque#</th>
                                            <th>Cheque Date</th>
                                            <th *ngIf="isAdvanceReceipt">
                                                Tax on advance <span class="red-text">*</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="clearfix">
                                                    <mat-form-field
                                                        appearance="fill"
                                                        class="mat-field-select width-100"
                                                    >
                                                        <mat-label>Select</mat-label>
                                                        <mat-select
                                                            name="receipt-mode"
                                                            [(ngModel)]="
                                                                receiptFormData.entries[0].transactions[0].account
                                                                    .uniqueName
                                                            "
                                                        >
                                                            <mat-option>
                                                                <ngx-mat-select-search
                                                                    [formControl]="searchBankAccount"
                                                                    placeholderLabel="Search"
                                                                    noEntriesFoundLabel="'No record found'"
                                                                >
                                                                </ngx-mat-select-search>
                                                            </mat-option>
                                                            <mat-option
                                                                *ngFor="let bankAccount of bankAccounts"
                                                                [value]="bankAccount.value"
                                                                >{{ bankAccount?.label }}
                                                            </mat-option>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                                <div class="clearfix mt-2">
                                                    <mat-form-field appearance="fill" class="width-100">
                                                        <textarea
                                                            matInput
                                                            class="mat-field-border form-control w-100 min-height-100"
                                                            name="description"
                                                            [(ngModel)]="receiptFormData.entries[0].description"
                                                        ></textarea>
                                                    </mat-form-field>
                                                </div>
                                            </td>
                                            <td>
                                                <mat-form-field appearance="fill" class="no-border-top width-100">
                                                    <text-field
                                                        [cssClass]="'form-control mat-field-border'"
                                                        name="cheque-no"
                                                        id="cheque-no"
                                                        placeholder="Cheque"
                                                        [(ngModel)]="receiptFormData.entries[0].chequeNumber"
                                                    >
                                                    </text-field>
                                                </mat-form-field>
                                            </td>
                                            <td>
                                                <giddh-datepicker
                                                    [placeholder]="'Enter Date'"
                                                    [cssClass]="
                                                        'mat-field-border border-left-right-none form-control w-100'
                                                    "
                                                    [showToggleIcon]="false"
                                                    name="cheque-clearance-date"
                                                    [(ngModel)]="receiptFormData.entries[0].chequeClearanceDate"
                                                >
                                                </giddh-datepicker>
                                            </td>
                                            <td class="overflow-visible" *ngIf="isAdvanceReceipt">
                                                <tax-control
                                                    class="d-inline-block"
                                                    [taxes]="companyTaxesList"
                                                    [date]="receiptFormData?.date"
                                                    [taxRenderData]="receiptFormData.entries[0].taxes"
                                                    [totalForTax]="
                                                        receiptFormData.entries[0].transactions[0].amount
                                                            .amountForAccount
                                                    "
                                                    [showHeading]="false"
                                                    [isMandatory]="true"
                                                    [exceptTaxTypes]="['tdsrc', 'tdspay', 'tcspay', 'tcsrc']"
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="activeCompany.baseCurrencySymbol"
                                                    [suffixInput]="''"
                                                    [applicableTaxes]="[]"
                                                    [isAdvanceReceipt]="true"
                                                    [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                    [commonLocaleData]="commonLocaleData"
                                                    (taxAmountSumEvent)="calculateTax()"
                                                >
                                                </tax-control>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="clearfix">
                                <div class="row position-relative">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label><i class="icon-file-path"></i> Attach file</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-4 col-lg-6 col-md-5">
                                        <label class="custom-file-label form-control cp position-relative" for="file">
                                            <em *ngIf="!selectedFileName && !isFileUploading"
                                                >Drag/Drop file or click here</em
                                            >
                                            <div
                                                *ngIf="isFileUploading"
                                                class="d-flex justify-content-center align-items-center"
                                            >
                                                <i class="fa fa-spinner rotate"></i>
                                            </div>
                                            <em *ngIf="selectedFileName && !isFileUploading" class="text-success">{{
                                                selectedFileName
                                            }}</em>
                                            <span class="text-success"
                                                ><i class="fa fa-check" *ngIf="selectedFileName && !isFileUploading"></i
                                            ></span>
                                            <input
                                                type="file"
                                                name="file"
                                                id="file"
                                                [options]="fileUploadOptions"
                                                ngFileSelect
                                                [uploadInput]="uploadInput"
                                                (uploadOutput)="onUploadOutput($event)"
                                                (change)="onFileChange($event?.target)"
                                                droppable="true"
                                            />
                                        </label>
                                    </div>
                                    <div class="col-sm-12 col-xl-8 col-lg-6 col-md-7 receipt-total">
                                        <div class="form-inline flex-row flex-nowrap pull-right d-block">
                                            <div class="clearfix">
                                                <div class="table-row">
                                                    <div class="table-cell">Sub Total</div>
                                                    <div class="table-cell figure-cell">
                                                        <span class="d-flex justify-content-end">
                                                            <amount-field
                                                                [amount]="totals.subTotal"
                                                                [currencyCode]="receiptFormData?.account?.currencyCode"
                                                                [currencySymbol]="
                                                                    receiptFormData?.account?.currencySymbol
                                                                "
                                                            >
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="table-row">
                                                    <div class="table-cell">Tax Total</div>
                                                    <div class="table-cell figure-cell">
                                                        <span class="d-flex justify-content-end">
                                                            <amount-field
                                                                [amount]="totals.taxTotal"
                                                                [currencyCode]="receiptFormData?.account?.currencyCode"
                                                                [currencySymbol]="
                                                                    receiptFormData?.account?.currencySymbol
                                                                "
                                                            >
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="table-row">
                                                    <div class="table-cell">Total</div>
                                                    <div class="table-cell figure-cell">
                                                        <span class="d-flex justify-content-end">
                                                            <amount-field
                                                                [amount]="totals.grandTotal"
                                                                [currencyCode]="receiptFormData?.account?.currencyCode"
                                                                [currencySymbol]="
                                                                    receiptFormData?.account?.currencySymbol
                                                                "
                                                            >
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="table-row" *ngIf="isMulticurrencyAccount">
                                                    <div class="table-cell">Total</div>
                                                    <div class="table-cell figure-cell">
                                                        <span class="d-flex justify-content-end">
                                                            <amount-field
                                                                [amount]="totals.grandTotalMultiCurrency"
                                                                [currencyCode]="companyCurrency"
                                                                [currencySymbol]="baseCurrencySymbol"
                                                            ></amount-field>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3 col-md-3 balance-due-absolute">
                            <div class="text-right">
                                <p class="font-20 pb-r1">
                                    <span class="balance-due">Amount</span>
                                    <span class="sp-rupees d-flex justify-content-end">
                                        <amount-field
                                            [amount]="totals.grandTotal"
                                            [currencyCode]="receiptFormData?.account?.currencyCode"
                                            [currencySymbol]="receiptFormData?.account?.currencySymbol"
                                        ></amount-field>
                                    </span>
                                </p>
                                <p class="font-20 pb-r1" *ngIf="isMulticurrencyAccount">
                                    <span class="balance-due">Amount</span>
                                    <span class="sp-rupees d-flex justify-content-end">
                                        <amount-field
                                            [amount]="totals.grandTotalMultiCurrency"
                                            [currencyCode]="companyCurrency"
                                            [currencySymbol]="baseCurrencySymbol"
                                        ></amount-field>
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <section class="clearfix mr-t100">
                    <section class="text-center mr-b2 giddh-overlap-block action-buttons">
                        <div class="col-12">
                            <div class="pull-right pr update-mode">
                                <button
                                    color="primary"
                                    type="button"
                                    mat-raised-button
                                    (click)="resetForm(receiptForm)"
                                >
                                    Clear
                                </button>
                                <button
                                    color="primary"
                                    type="button"
                                    mat-raised-button
                                    (click)="createReceipt(receiptForm)"
                                >
                                    Create Receipt
                                </button>
                                <span class="d-inline-block v-align-middle">
                                    <div class="btn-group dropup">
                                        <button mat-icon-button [matMenuTriggerFor]="menu">
                                            <span class="caret"></span>
                                        </button>
                                        <mat-menu #menu="matMenu" yPosition="above">
                                            <button mat-menu-item (click)="createReceipt(receiptForm, sendEmailModal)">
                                                <span>Create & Send</span>
                                            </button>
                                            <button mat-menu-item (click)="createReceipt(receiptForm, sendPrintModal)">
                                                <span>Create & Print</span>
                                            </button>
                                        </mat-menu>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </section>
                </section>
            </form>
        </mat-card-content>
    </mat-card>
    <div class="aside-overlay" *ngIf="accountAsideMenuState === 'in'"></div>
    <generic-aside-menu-account
        [class]="accountAsideMenuState"
        [@slideInOut]="accountAsideMenuState"
        (closeAsideEvent)="toggleAccountAsidePane($event)"
        [selectedGrpUniqueName]="selectedGrpUniqueNameForAddEditAccountModal"
        [keyboardShortcut]="{ 'esc': accountAsideMenuState === 'in' }"
        *ngIf="accountAsideMenuState === 'in'"
        [selectedAccountUniqueName]="selectedCustomerForDetails"
        (onShortcutPress)="toggleAccountAsidePane()"
        (addEvent)="addNewSidebarAccount($event)"
        (updateEvent)="updateSidebarAccount($event)"
    >
    </generic-aside-menu-account>
    <ng-template #sendEmailModal>
        <mat-dialog-content>
            <app-send-email-invoice-component
                [voucherType]="receiptResponse?.type"
                (successEvent)="sendEmail($event)"
                [selectedItem]="{
                    voucherNumber: receiptResponse?.number,
                    uniqueName: receiptResponse?.account?.uniqueName,
                    account: { email: receiptResponse?.account?.email }
                }"
                (cancelEvent)="cancelEmailModal()"
            ></app-send-email-invoice-component>
        </mat-dialog-content>
    </ng-template>
    <ng-template #sendPrintModal>
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <print
                    [localeData]="localeData"
                    [commonLocaleData]="commonLocaleData"
                    [selectedItem]="receiptResponse"
                    (cancelEvent)="cancelPrintModal()"
                ></print>
            </div>
        </div>
    </ng-template>
</ng-container>
