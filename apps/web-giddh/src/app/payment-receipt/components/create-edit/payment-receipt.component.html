<ng-container
    appTranslate
    [file]="'payment-receipt'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
>
    <mat-card class="receipt-card">
        <mat-card-content>
            <giddh-page-loader *ngIf="showLoader"></giddh-page-loader>
            <div [ngStyle]="{ 'display': !showLoader ? 'block' : 'none' }">
                <form autocomplete="off" novalidate class="receipt-form" #receiptForm="ngForm">
                    <div class="clearfix">
                        <div
                            class="clearfix pd-t15"
                            [ngClass]="{ 'wrapper-receipt-fields': !voucherFormData.account.uniqueName }"
                        >
                            <div class="inner-container">
                                <div
                                    class="clearfix"
                                    [keyboardShortcut]="'alt+c'"
                                    (onShortcutPress)="addAccountFromShortcut()"
                                >
                                    <div class="row">
                                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                            <label
                                                >{{
                                                    voucherFormData.type === receiptVoucherType
                                                        ? localeData?.customer_name
                                                        : localeData?.vendor_name
                                                }}
                                                <span class="red-text">*</span></label
                                            >
                                        </div>
                                        <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9 select-customer-name">
                                            <div class="clearfix d-flex flex-column">
                                                <div class="d-flex">
                                                    <sales-sh-select
                                                        [ngClass]="{
                                                            'error-box':
                                                                !isValidForm &&
                                                                !voucherFormData.account.uniqueName?.trim()
                                                        }"
                                                        class="float-left sales-select width-627"
                                                        name="customer-uniquename"
                                                        #customerNameDropDown
                                                        [options]="customerAccounts$ | async"
                                                        [(ngModel)]="voucherFormData.account.uniqueName"
                                                        [customFilter]="customMoveGroupFilter"
                                                        [isPaginationEnabled]="true"
                                                        (scrollEnd)="handleScrollEnd('customer')"
                                                        (dynamicSearchedQuery)="
                                                            onSearchQueryChanged($event, 1, 'customer')
                                                        "
                                                        [notFoundMsg]="noResultsFoundLabel"
                                                        [enableDynamicSearch]="true"
                                                        (onHide)="resetPreviousSearchResults(true, 'customer')"
                                                        (selected)="onSelectCustomer($event)"
                                                        [placeholder]="commonLocaleData?.app_select"
                                                        [notFoundLink]="true"
                                                        [doNotReset]="true"
                                                        [forceClearReactive]="forceClear$ | async"
                                                        [isFilterEnabled]="true"
                                                        (noResultsClicked)="addNewAccount()"
                                                        [multiple]="false"
                                                        [ItemHeight]="67"
                                                        [notFoundLinkText]="
                                                            voucherFormData.type === receiptVoucherType
                                                                ? localeData?.add_customer
                                                                : localeData?.add_vendor
                                                        "
                                                        (keyup)="resetCustomerName($event)"
                                                        (onClear)="resetCustomerName(null)"
                                                        [isOpen]="allowFocus"
                                                    >
                                                        <ng-template #optionTemplate let-option="option">
                                                            <a href="javascript:void(0)" class="list-item flex-column">
                                                                <div class="item">{{ option?.label }}</div>
                                                                <div class="item-unique">{{ option.value }}</div>
                                                            </a>
                                                        </ng-template>
                                                        <ng-template #notFoundLinkTemplate>
                                                            <a
                                                                href="javascript:void(0)"
                                                                class="
                                                                    list-item
                                                                    pd-l05 pd-r05
                                                                    border-none
                                                                    d-flex
                                                                    justify-content-between
                                                                    w-100
                                                                "
                                                                [keyboardShortcut]="'alt+c'"
                                                            >
                                                                <div class="item">
                                                                    {{
                                                                        voucherFormData.type === receiptVoucherType
                                                                            ? localeData?.add_customer
                                                                            : localeData?.add_vendor
                                                                    }}
                                                                </div>
                                                                <div class="item">
                                                                    {{ commonLocaleData?.app_alt_c }}
                                                                </div>
                                                            </a>
                                                        </ng-template>
                                                    </sales-sh-select>
                                                </div>
                                                <div
                                                    class="d-flex aqua-color"
                                                    *ngIf="voucherFormData?.account.uniqueName"
                                                >
                                                    <span class="cp aqua-color">
                                                        <a href="javascript:void(0)" (click)="getCustomerDetails()">{{
                                                            voucherFormData.type === receiptVoucherType
                                                                ? localeData?.customer_details
                                                                : localeData?.vendor_details
                                                        }}</a>
                                                    </span>
                                                </div>
                                            </div>
                                            <ng-container *ngIf="!voucherFormData.account.uniqueName">
                                                <img
                                                    src="{{ imgPath }}new/search_customer.svg"
                                                    *ngIf="voucherFormData.type === receiptVoucherType"
                                                    class="img-responsive search-arrow-image"
                                                />
                                                <img
                                                    src="{{ imgPath }}new/search-vendor.svg"
                                                    *ngIf="voucherFormData.type !== receiptVoucherType"
                                                    class="img-responsive search-arrow-image"
                                                />
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div
                                        class="col-sm-12 col-xl-9 offset-lg-3 col-lg-8 col-md-9 offset-xl-2 offset-md-3"
                                    >
                                        <ng-container>
                                            <section
                                                [ngClass]="{
                                                    'billing-address-wrap': !voucherFormData.account.uniqueName
                                                }"
                                            >
                                                <div class="wrap-billing-address clearfix w-100">
                                                    <div class="row">
                                                        <!-- region billing address -->
                                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                            <div class="form-group">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="pb-0 pd-r15">{{
                                                                        localeData?.billing_address
                                                                    }}</span>
                                                                    <span>
                                                                        <div
                                                                            class="
                                                                                btn-group btn-block
                                                                                change-address-dropdown
                                                                            "
                                                                            *ngIf="accountAddressList?.length > 1"
                                                                        >
                                                                            <a
                                                                                mat-button
                                                                                [matMenuTriggerFor]="billingAddressMenu"
                                                                                class="dropdown-toggle"
                                                                                [style.height.px]="29"
                                                                            >
                                                                                {{ localeData?.change }}</a
                                                                            >
                                                                            <mat-menu
                                                                                #billingAddressMenu="matMenu"
                                                                                class="change-address-mat-menu"
                                                                            >
                                                                                <button
                                                                                    mat-menu-item
                                                                                    *ngFor="
                                                                                        let address of accountAddressList
                                                                                    "
                                                                                >
                                                                                    <a
                                                                                        class="dropdown-item"
                                                                                        (click)="
                                                                                            selectAddress(
                                                                                                voucherFormData.account
                                                                                                    .billingDetails,
                                                                                                address
                                                                                            )
                                                                                        "
                                                                                    >
                                                                                        {{ address.address }}
                                                                                        {{ address.state?.name }}
                                                                                        <span class="d-block">
                                                                                            {{
                                                                                                address.gstNumber
                                                                                                    ? (showGstinNo
                                                                                                          ? commonLocaleData?.app_gstin +
                                                                                                            ": "
                                                                                                          : commonLocaleData?.app_trn +
                                                                                                            ": ") +
                                                                                                      address.gstNumber
                                                                                                    : ""
                                                                                            }}
                                                                                        </span>
                                                                                    </a>
                                                                                </button>
                                                                            </mat-menu>
                                                                        </div>
                                                                    </span>
                                                                </div>
                                                                <div class="billing-address clearfix">
                                                                    <textarea
                                                                        matInput
                                                                        name="billingdetails-address"
                                                                        class="form-control"
                                                                        (keyup)="autoFillShippingDetails()"
                                                                        rows="3"
                                                                        autocomplete="off"
                                                                        [(ngModel)]="
                                                                            voucherFormData.account.billingDetails
                                                                                .address[0]
                                                                        "
                                                                        autofocus="off"
                                                                        aria-autocomplete="none"
                                                                        #customerBillingAddress
                                                                    ></textarea>

                                                                    <div class="row">
                                                                        <div class="col-sm-12 col-md-6">
                                                                            <label class="sales-country-label">
                                                                                {{ customerCountryName }}
                                                                            </label>
                                                                        </div>

                                                                        <div class="col-sm-12 col-md-6" #billingState>
                                                                            <mat-form-field
                                                                                appearance="fill"
                                                                                class="
                                                                                    mat-field-select
                                                                                    width-100
                                                                                    only-bottom-border
                                                                                "
                                                                            >
                                                                                <mat-label
                                                                                    *ngIf="
                                                                                        !voucherFormData.account
                                                                                            .billingDetails.state.code
                                                                                    "
                                                                                >
                                                                                    {{
                                                                                        commonLocaleData?.app_state
                                                                                    }}</mat-label
                                                                                >
                                                                                <mat-select
                                                                                    name="billingdetails-statecode"
                                                                                    disableOptionCentering
                                                                                    [(ngModel)]="
                                                                                        voucherFormData.account
                                                                                            .billingDetails.state.code
                                                                                    "
                                                                                    (selectionChange)="
                                                                                        fillShippingBillingDetails(
                                                                                            $event,
                                                                                            true
                                                                                        );
                                                                                        autoFillShippingDetails()
                                                                                    "
                                                                                >
                                                                                    <mat-option>
                                                                                        <ngx-mat-select-search
                                                                                            [formControl]="
                                                                                                searchBillingStates
                                                                                            "
                                                                                            [placeholderLabel]="
                                                                                                commonLocaleData?.app_search
                                                                                            "
                                                                                            [noEntriesFoundLabel]="
                                                                                                commonLocaleData?.app_no_records_found
                                                                                            "
                                                                                        >
                                                                                        </ngx-mat-select-search>
                                                                                    </mat-option>
                                                                                    <mat-option
                                                                                        *ngFor="
                                                                                            let state of filteredBillingStates
                                                                                        "
                                                                                        [value]="state.value"
                                                                                        >{{ state?.label }}
                                                                                    </mat-option>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </div>

                                                                        <div
                                                                            class="col-sm-6 col-md-6"
                                                                            *ngIf="shouldShowTrnGstField"
                                                                        >
                                                                            <text-field
                                                                                [maxlength]="15"
                                                                                autocomplete="None"
                                                                                name="billingdetails-gstnumber"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                *ngIf="showGstinNo"
                                                                                [(ngModel)]="
                                                                                    voucherFormData.account
                                                                                        .billingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'billingDetails',
                                                                                        statesBilling
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_gstin
                                                                                "
                                                                            >
                                                                            </text-field>
                                                                            <text-field
                                                                                [maxlength]="15"
                                                                                autocomplete="None"
                                                                                type="text"
                                                                                name="billingdetails-gstnumber"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                *ngIf="showTrnNo"
                                                                                [(ngModel)]="
                                                                                    voucherFormData.account
                                                                                        .billingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'billingDetails',
                                                                                        statesBilling
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_trn
                                                                                "
                                                                            >
                                                                            </text-field>
                                                                        </div>
                                                                        <!-- static pin code  -->
                                                                        <div
                                                                            [ngClass]="{
                                                                                'col-sm-6 col-md-6':
                                                                                    showGstinNo || showTrnNo,
                                                                                'col-sm-12 col-md-12': !(
                                                                                    showGstinNo || showTrnNo
                                                                                )
                                                                            }"
                                                                        >
                                                                            <div class="form-group mr-b05">
                                                                                <text-field
                                                                                    [type]="'number'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    autocomplete="false"
                                                                                    name="billing-pincode"
                                                                                    (blur)="autoFillShippingDetails()"
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_pin_code
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        voucherFormData.account
                                                                                            .billingDetails.pincode
                                                                                    "
                                                                                    decimalDigitsDirective
                                                                                    [preventDecimal]="true"
                                                                                >
                                                                                </text-field>
                                                                            </div>
                                                                        </div>
                                                                        <!-- static pin code end-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->

                                                        <!-- region shipping address -->
                                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                            <div class="form-group p-0 width-100">
                                                                <div class="d-flex align-items-center pb-1">
                                                                    <span class="pb-0 pd-r15">
                                                                        <mat-checkbox
                                                                            color="primary"
                                                                            (change)="autoFillShippingDetails()"
                                                                            name="autofill-shipping"
                                                                            [(ngModel)]="autoFillShipping"
                                                                        >
                                                                            {{ localeData?.shipping_billing_same }}
                                                                        </mat-checkbox>
                                                                    </span>
                                                                    <span>
                                                                        <div
                                                                            class="
                                                                                btn-group btn-block
                                                                                change-address-dropdown
                                                                            "
                                                                            *ngIf="
                                                                                accountAddressList?.length > 1 &&
                                                                                !autoFillShipping
                                                                            "
                                                                        >
                                                                            <a
                                                                                mat-button
                                                                                [matMenuTriggerFor]="
                                                                                    shippingAddressMenu
                                                                                "
                                                                                type="button"
                                                                                class="dropdown-toggle"
                                                                                [style.height.px]="24"
                                                                            >
                                                                                {{ localeData?.change }}</a
                                                                            >
                                                                            <mat-menu #shippingAddressMenu="matMenu">
                                                                                <button
                                                                                    mat-menu-item
                                                                                    *ngFor="
                                                                                        let address of accountAddressList
                                                                                    "
                                                                                >
                                                                                    <a
                                                                                        class="dropdown-item"
                                                                                        (click)="
                                                                                            selectAddress(
                                                                                                voucherFormData.account
                                                                                                    .shippingDetails,
                                                                                                address
                                                                                            )
                                                                                        "
                                                                                    >
                                                                                        {{ address.address }}
                                                                                        {{ address.state?.name }}

                                                                                        <span class="d-block"
                                                                                            >{{
                                                                                                address.gstNumber
                                                                                                    ? (showGstinNo
                                                                                                          ? commonLocaleData?.app_gstin +
                                                                                                            ": "
                                                                                                          : commonLocaleData?.app_trn +
                                                                                                            ": ") +
                                                                                                      address.gstNumber
                                                                                                    : ""
                                                                                            }}
                                                                                        </span>
                                                                                    </a>
                                                                                </button>
                                                                            </mat-menu>
                                                                        </div>
                                                                    </span>
                                                                </div>
                                                                <div
                                                                    class="billing-address"
                                                                    [ngClass]="{ 'disabled': autoFillShipping }"
                                                                >
                                                                    <textarea
                                                                        matInput
                                                                        [readonly]="autoFillShipping"
                                                                        name="shippingdetails-address"
                                                                        class="form-control"
                                                                        [(ngModel)]="
                                                                            voucherFormData.account.shippingDetails
                                                                                .address[0]
                                                                        "
                                                                        rows="3"
                                                                        autocomplete="off"
                                                                    ></textarea>

                                                                    <div class="clearfix form-group mb-0">
                                                                        <div class="row">
                                                                            <div class="col-sm-12 col-md-6">
                                                                                <div class="form-group mb-0">
                                                                                    <label class="sales-country-label">
                                                                                        {{ customerCountryName }}
                                                                                    </label>
                                                                                </div>
                                                                            </div>

                                                                            <div
                                                                                class="col-sm-12 col-md-6"
                                                                                #shippingState
                                                                            >
                                                                                <mat-form-field
                                                                                    appearance="fill"
                                                                                    class="
                                                                                        mat-field-select
                                                                                        width-100
                                                                                        only-bottom-border
                                                                                    "
                                                                                >
                                                                                    <mat-label
                                                                                        *ngIf="
                                                                                            !voucherFormData.account
                                                                                                .shippingDetails.state
                                                                                                .code
                                                                                        "
                                                                                    >
                                                                                        {{
                                                                                            commonLocaleData?.app_state
                                                                                        }}</mat-label
                                                                                    >
                                                                                    <mat-select
                                                                                        name="shippingdetails-statecode"
                                                                                        disableOptionCentering
                                                                                        [(ngModel)]="
                                                                                            voucherFormData.account
                                                                                                .shippingDetails.state
                                                                                                .code
                                                                                        "
                                                                                        (selectionChange)="
                                                                                            fillShippingBillingDetails(
                                                                                                $event,
                                                                                                false
                                                                                            )
                                                                                        "
                                                                                        [disabled]="autoFillShipping"
                                                                                    >
                                                                                        <mat-option>
                                                                                            <ngx-mat-select-search
                                                                                                [formControl]="
                                                                                                    searchShippingStates
                                                                                                "
                                                                                                [placeholderLabel]="
                                                                                                    commonLocaleData?.app_search
                                                                                                "
                                                                                                [noEntriesFoundLabel]="
                                                                                                    commonLocaleData?.app_no_records_found
                                                                                                "
                                                                                            >
                                                                                            </ngx-mat-select-search>
                                                                                        </mat-option>
                                                                                        <mat-option
                                                                                            *ngFor="
                                                                                                let state of filteredShippingStates
                                                                                            "
                                                                                            [value]="state.value"
                                                                                            >{{ state?.label }}
                                                                                        </mat-option>
                                                                                    </mat-select>
                                                                                </mat-form-field>
                                                                            </div>

                                                                            <div
                                                                                class="col-sm-6"
                                                                                *ngIf="shouldShowTrnGstField"
                                                                            >
                                                                                <text-field
                                                                                    [readonly]="autoFillShipping"
                                                                                    autocomplete="None"
                                                                                    [maxlength]="15"
                                                                                    type="text"
                                                                                    name="shippingdetails-gstnumber"
                                                                                    *ngIf="showGstinNo"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        voucherFormData.account
                                                                                            .shippingDetails.gstNumber
                                                                                    "
                                                                                    (change)="
                                                                                        getStateCode(
                                                                                            'shippingDetails',
                                                                                            statesShipping
                                                                                        )
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_gstin
                                                                                    "
                                                                                ></text-field>
                                                                                <text-field
                                                                                    [readonly]="autoFillShipping"
                                                                                    [maxlength]="15"
                                                                                    autocomplete="None"
                                                                                    type="text"
                                                                                    name="shippingdetails-gstnumber"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    *ngIf="showTrnNo"
                                                                                    [(ngModel)]="
                                                                                        voucherFormData.account
                                                                                            .shippingDetails.gstNumber
                                                                                    "
                                                                                    (change)="
                                                                                        getStateCode(
                                                                                            'shippingDetails',
                                                                                            statesShipping
                                                                                        )
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_trn
                                                                                    "
                                                                                ></text-field>
                                                                            </div>
                                                                            <!-- static pin code  -->
                                                                            <div
                                                                                [ngClass]="{
                                                                                    'col-sm-6':
                                                                                        showGstinNo || showTrnNo,
                                                                                    'col-sm-12': !(
                                                                                        showGstinNo || showTrnNo
                                                                                    )
                                                                                }"
                                                                            >
                                                                                <div class="form-group mr-b05">
                                                                                    <text-field
                                                                                        [type]="'number'"
                                                                                        [cssClass]="
                                                                                            'form-control input-custom'
                                                                                        "
                                                                                        autocomplete="false"
                                                                                        name="shipping-pincode"
                                                                                        [placeholder]="
                                                                                            commonLocaleData?.app_pin_code
                                                                                        "
                                                                                        [(ngModel)]="
                                                                                            voucherFormData.account
                                                                                                .shippingDetails.pincode
                                                                                        "
                                                                                        decimalDigitsDirective
                                                                                        [preventDecimal]="true"
                                                                                    >
                                                                                    </text-field>
                                                                                </div>
                                                                            </div>
                                                                            <!-- static pin code end-->
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->
                                                    </div>
                                                </div>
                                            </section>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix">
                            <div class="inner-container">
                                <div class="clearfix">
                                    <div class="clearfix">
                                        <div class="row position-relative">
                                            <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                                <label>{{ localeData?.attention_to }}</label>
                                            </div>
                                            <div class="col-sm-12 col-xl-6 col-lg-5 col-md-10">
                                                <mat-form-field appearance="fill" class="no-border-top">
                                                    <text-field
                                                        [cssClass]="'form-control mat-field-border'"
                                                        name="attention-to"
                                                        id="attention-to"
                                                        [placeholder]="localeData?.attention_to"
                                                        [(ngModel)]="voucherFormData.account.attentionTo"
                                                    >
                                                    </text-field>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 cheque-details no-top">
                                                <div class="form-inline flex-row flex-nowrap">
                                                    <div class="form-group">
                                                        <label
                                                            >{{
                                                                voucherFormData.type === receiptVoucherType
                                                                    ? localeData?.receipt_date
                                                                    : localeData?.payment_date
                                                            }}
                                                            <span class="red-text">*</span></label
                                                        >
                                                        <giddh-datepicker
                                                            class="inline mr-l1"
                                                            [showError]="
                                                                (!isValidForm && !voucherFormData.date) ||
                                                                isInvalidVoucherDate
                                                            "
                                                            name="receipt-date"
                                                            [(ngModel)]="voucherFormData.date"
                                                            (ngModelChange)="validateVoucherDate()"
                                                            [placeholder]="commonLocaleData?.app_select_date"
                                                            [cssClass]="
                                                                'mat-field-border border-left-right-none form-control w-100'
                                                            "
                                                            [showToggleIcon]="false"
                                                        ></giddh-datepicker>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix" *ngIf="voucherFormData.type === receiptVoucherType">
                                    <div class="row mr-b05">
                                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                            <label>&nbsp;</label>
                                        </div>
                                        <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9">
                                            <div class="width-627">
                                                <mat-checkbox
                                                    color="primary"
                                                    name="advance-receipt"
                                                    [(ngModel)]="isAdvanceReceipt"
                                                >
                                                    {{ commonLocaleData?.app_voucher_types?.advance_receipt }}
                                                </mat-checkbox>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix pull-right receipt-card-table">
                                    <ng-container>
                                        <div
                                            class="switch-currency d-flex align-items-center"
                                            *ngIf="isMultiCurrencyAccount && !showSwitchCurrency"
                                        >
                                            <span class="left-currency mr-r05"
                                                >{{ commonLocaleData?.app_numbers?.one }}
                                                {{ companyCurrencyName }}</span
                                            >
                                            <img
                                                class="switch-icon"
                                                src="{{ imgPath }}switch-icon.svg"
                                                alt="switch-icon"
                                                (click)="switchCurrency(true)"
                                            />
                                            <span class="right-currency mr-r1 d-flex align-items-center">
                                                <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                                    originalExchangeRate | giddhCurrency
                                                }}</span>
                                                <text-field
                                                    [type]="'number'"
                                                    name="exchangeRate"
                                                    [(ngModel)]="exchangeRate"
                                                    *ngIf="showCurrencyValue"
                                                    [cssClass]="'form-control edit-currency'"
                                                >
                                                </text-field>
                                                <span class="mr-l4">{{ companyCurrency }}</span>
                                            </span>

                                            <span class="edit-icon cp">
                                                <img
                                                    src="{{ imgPath }}edit-pencilicon.svg"
                                                    class="edit-pencil"
                                                    *ngIf="!autoSaveIcon"
                                                    (click)="
                                                        showCurrencyValue = !showCurrencyValue;
                                                        autoSaveIcon = !autoSaveIcon;
                                                        exchangeRate = originalExchangeRate
                                                    "
                                                />
                                                <img
                                                    src="{{ imgPath }}autosave.svg"
                                                    class="edit-pencil"
                                                    (click)="
                                                        originalExchangeRate = exchangeRate;
                                                        previousExchangeRate = exchangeRate;
                                                        autoSaveIcon = !autoSaveIcon;
                                                        showCurrencyValue = !showCurrencyValue;
                                                        calculateTotals()
                                                    "
                                                    *ngIf="autoSaveIcon"
                                                />
                                            </span>
                                        </div>
                                        <div
                                            class="switch-currency"
                                            *ngIf="isMultiCurrencyAccount && showSwitchCurrency"
                                        >
                                            <span class="left-currency mr-r1"
                                                >{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrency }}</span
                                            >
                                            <img
                                                class="switch-icon"
                                                src="{{ imgPath }}switch-icon.svg"
                                                alt="switch-icon"
                                                (click)="switchCurrency(false)"
                                            />
                                            <span class="right-currency mr-l1">
                                                <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                                    originalReverseExchangeRate | giddhCurrency
                                                }}</span>
                                                <text-field
                                                    [type]="'number'"
                                                    name="reverseExchangeRate"
                                                    [(ngModel)]="reverseExchangeRate"
                                                    *ngIf="showCurrencyValue"
                                                    [cssClass]="'form-control edit-currency'"
                                                ></text-field>
                                                {{ companyCurrencyName }}
                                            </span>
                                            <span class="edit-icon cp">
                                                <img
                                                    *ngIf="!autoSaveIcon"
                                                    src="{{ imgPath }}edit-pencilicon.svg"
                                                    class="edit-pencil"
                                                    (click)="saveCancelExchangeRate(false)"
                                                />
                                                <img
                                                    src="{{ imgPath }}autosave.svg"
                                                    class="edit-pencil"
                                                    (click)="saveCancelExchangeRate(true)"
                                                    *ngIf="autoSaveIcon"
                                                />
                                            </span>
                                        </div>
                                    </ng-container>
                                </div>
                                <div class="clearfix">
                                    <table class="table receipt-table" width="100%" cellpadding="0" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>
                                                    {{
                                                        voucherFormData.type === receiptVoucherType
                                                            ? localeData?.receipt_mode
                                                            : localeData?.payment_mode
                                                    }}
                                                    <span class="red-text">*</span>
                                                </th>
                                                <th>
                                                    {{ commonLocaleData?.app_amount }} <span class="red-text">*</span>
                                                </th>
                                                <th>{{ localeData?.cheque_no }}</th>
                                                <th>{{ localeData?.cheque_date }}</th>
                                                <th *ngIf="isAdvanceReceipt">
                                                    {{ localeData?.tax_on_advance }} <span class="red-text">*</span>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div class="clearfix">
                                                        <mat-form-field
                                                            appearance="fill"
                                                            class="mat-field-select width-100"
                                                            [ngClass]="{
                                                                'error-box':
                                                                    !isValidForm &&
                                                                    !voucherFormData.entries[0].transactions[0].account
                                                                        .uniqueName
                                                            }"
                                                        >
                                                            <mat-label
                                                                *ngIf="
                                                                    !voucherFormData.entries[0].transactions[0].account
                                                                        .uniqueName
                                                                "
                                                            >
                                                                {{ commonLocaleData?.app_select }}</mat-label
                                                            >
                                                            <mat-select
                                                                name="receipt-mode"
                                                                disableOptionCentering
                                                                [(ngModel)]="
                                                                    voucherFormData.entries[0].transactions[0].account
                                                                        .uniqueName
                                                                "
                                                                [(value)]="
                                                                    voucherFormData.entries[0].transactions[0].account
                                                                        .uniqueName
                                                                "
                                                            >
                                                                <mat-option>
                                                                    <ngx-mat-select-search
                                                                        [formControl]="searchBankAccount"
                                                                        [placeholderLabel]="
                                                                            commonLocaleData?.app_search
                                                                        "
                                                                        [noEntriesFoundLabel]="
                                                                            commonLocaleData?.app_no_records_found
                                                                        "
                                                                    >
                                                                    </ngx-mat-select-search>
                                                                </mat-option>
                                                                <mat-option
                                                                    *ngFor="let bankAccount of bankAccounts"
                                                                    [value]="bankAccount.value"
                                                                    >{{ bankAccount?.label }}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="clearfix mt-2">
                                                        <mat-form-field appearance="fill" class="width-100">
                                                            <textarea
                                                                matInput
                                                                class="
                                                                    mat-field-border
                                                                    form-control
                                                                    w-100
                                                                    min-height-100
                                                                "
                                                                name="description"
                                                                [(ngModel)]="
                                                                    voucherFormData.templateDetails.other.message2
                                                                "
                                                                [placeholder]="localeData?.description"
                                                            ></textarea>
                                                        </mat-form-field>
                                                    </div>
                                                </td>
                                                <td>
                                                    <mat-form-field appearance="fill" class="no-border-top width-100">
                                                        <text-field
                                                            [cssClass]="'form-control mat-field-border'"
                                                            [showError]="
                                                                !isValidForm &&
                                                                !voucherFormData.entries[0].transactions[0].amount
                                                                    .amountForAccount
                                                            "
                                                            name="receipt-amount"
                                                            id="receipt-amount"
                                                            [placeholder]="localeData?.enter_amount"
                                                            decimalDigitsDirective
                                                            [mask]="inputMaskFormat"
                                                            [(ngModel)]="
                                                                voucherFormData.entries[0].transactions[0].amount
                                                                    .amountForAccount
                                                            "
                                                            (ngModelChange)="calculateTotals()"
                                                        >
                                                        </text-field>
                                                    </mat-form-field>
                                                </td>
                                                <td>
                                                    <mat-form-field appearance="fill" class="no-border-top width-100">
                                                        <text-field
                                                            [cssClass]="'form-control mat-field-border'"
                                                            name="cheque-no"
                                                            id="cheque-no"
                                                            [placeholder]="localeData?.cheque_no"
                                                            [(ngModel)]="voucherFormData.entries[0].chequeNumber"
                                                        >
                                                        </text-field>
                                                    </mat-form-field>
                                                </td>
                                                <td>
                                                    <giddh-datepicker
                                                        [placeholder]="commonLocaleData?.app_select_date"
                                                        [cssClass]="
                                                            'mat-field-border border-left-right-none form-control w-100'
                                                        "
                                                        [showError]="isInvalidChequeDate"
                                                        [showToggleIcon]="false"
                                                        name="cheque-clearance-date"
                                                        [(ngModel)]="voucherFormData.entries[0].chequeClearanceDate"
                                                        (ngModelChange)="validateChequeDate()"
                                                    >
                                                    </giddh-datepicker>
                                                </td>
                                                <td class="overflow-visible" *ngIf="isAdvanceReceipt">
                                                    <tax-control
                                                        [ngClass]="{
                                                            'error-box': !isValidForm && selectedTaxes?.length === 0
                                                        }"
                                                        class="dropdown-container w-100"
                                                        [taxes]="companyTaxesList"
                                                        [date]="voucherFormData?.date"
                                                        [taxRenderData]="voucherFormData.entries[0].taxes"
                                                        [totalForTax]="
                                                            voucherFormData.entries[0].transactions[0].amount
                                                                .amountForAccount
                                                        "
                                                        [showHeading]="false"
                                                        [isMandatory]="true"
                                                        [exceptTaxTypes]="['tdsrc', 'tdspay', 'tcspay', 'tcsrc']"
                                                        [maskInput]="inputMaskFormat"
                                                        [prefixInput]="activeCompany.baseCurrencySymbol"
                                                        [suffixInput]="''"
                                                        [applicableTaxes]="[]"
                                                        [isAdvanceReceipt]="true"
                                                        [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                        [commonLocaleData]="commonLocaleData"
                                                        (taxAmountSumEvent)="calculateTax()"
                                                    >
                                                    </tax-control>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="clearfix">
                                    <div class="row position-relative">
                                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                            <label><i class="icon-file-path"></i> {{ localeData?.attach_file }}</label>
                                        </div>
                                        <div class="col-sm-12 col-xl-4 col-lg-6 col-md-5">
                                            <label
                                                class="custom-file-label form-control cp position-relative"
                                                for="file"
                                            >
                                                <em *ngIf="!selectedFileName && !isFileUploading">{{
                                                    localeData?.drag_drop_file
                                                }}</em>
                                                <div
                                                    *ngIf="isFileUploading"
                                                    class="d-flex justify-content-center align-items-center"
                                                >
                                                    <i class="fa fa-spinner rotate"></i>
                                                </div>
                                                <em *ngIf="selectedFileName && !isFileUploading" class="text-success">{{
                                                    selectedFileName
                                                }}</em>
                                                <span class="text-success"
                                                    ><i
                                                        class="fa fa-check"
                                                        *ngIf="selectedFileName && !isFileUploading"
                                                    ></i
                                                ></span>
                                                <input
                                                    type="file"
                                                    name="file"
                                                    id="file"
                                                    class="cp"
                                                    [options]="fileUploadOptions"
                                                    ngFileSelect
                                                    [uploadInput]="uploadInput"
                                                    (uploadOutput)="onUploadOutput($event)"
                                                    (change)="onFileChange($event?.target)"
                                                    droppable="true"
                                                />
                                            </label>
                                        </div>
                                        <div class="col-sm-12 col-xl-8 col-lg-6 col-md-7 receipt-total">
                                            <div class="form-inline flex-row flex-nowrap pull-right d-block">
                                                <div class="clearfix">
                                                    <div class="table-row">
                                                        <div class="table-cell">
                                                            {{ commonLocaleData?.app_subtotal }}
                                                        </div>
                                                        <div class="table-cell figure-cell">
                                                            <span class="d-flex justify-content-end">
                                                                <amount-field
                                                                    [amount]="totals.subTotal"
                                                                    [currencyCode]="
                                                                        voucherFormData?.account?.currencyCode
                                                                    "
                                                                    [currencySymbol]="
                                                                        voucherFormData?.account?.currencySymbol
                                                                    "
                                                                >
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="table-row">
                                                        <div class="table-cell">{{ localeData?.tax_total }}</div>
                                                        <div class="table-cell figure-cell">
                                                            <span class="d-flex justify-content-end">
                                                                <amount-field
                                                                    [amount]="totals.taxTotal"
                                                                    [currencyCode]="
                                                                        voucherFormData?.account?.currencyCode
                                                                    "
                                                                    [currencySymbol]="
                                                                        voucherFormData?.account?.currencySymbol
                                                                    "
                                                                >
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="table-row">
                                                        <div class="table-cell">
                                                            <b
                                                                >{{ commonLocaleData?.app_total }}
                                                                <span *ngIf="isMultiCurrencyAccount">{{
                                                                    voucherFormData?.account?.currencySymbol
                                                                }}</span></b
                                                            >
                                                        </div>
                                                        <div class="table-cell figure-cell">
                                                            <span class="d-flex justify-content-end">
                                                                <amount-field
                                                                    [amount]="totals.grandTotal"
                                                                    [currencyCode]="
                                                                        isMultiCurrencyAccount
                                                                            ? voucherFormData?.account?.currencyCode
                                                                            : ''
                                                                    "
                                                                    [currencySymbol]="
                                                                        isMultiCurrencyAccount
                                                                            ? voucherFormData?.account?.currencySymbol
                                                                            : ''
                                                                    "
                                                                >
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="table-row" *ngIf="isMultiCurrencyAccount">
                                                        <div class="table-cell">
                                                            <b
                                                                >{{ commonLocaleData?.app_total }}
                                                                <span *ngIf="isMultiCurrencyAccount">{{
                                                                    activeCompany.baseCurrencySymbol
                                                                }}</span></b
                                                            >
                                                        </div>
                                                        <div class="table-cell figure-cell">
                                                            <span class="d-flex justify-content-end">
                                                                <amount-field
                                                                    [amount]="totals.grandTotalMultiCurrency"
                                                                    [currencyCode]="companyCurrency"
                                                                    [currencySymbol]="activeCompany.baseCurrencySymbol"
                                                                >
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-3 col-md-3 balance-due-absolute">
                                <div class="text-right">
                                    <p class="font-20 pb-r1 justify-content-end">
                                        <span class="balance-due pd-r05">{{ commonLocaleData?.app_amount }}</span>
                                        <span class="sp-rupees d-flex justify-content-end">
                                            <amount-field
                                                [amount]="totals.grandTotal"
                                                [currencyCode]="voucherFormData?.account?.currencyCode"
                                                [currencySymbol]="voucherFormData?.account?.currencySymbol"
                                            >
                                            </amount-field>
                                        </span>
                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="isMultiCurrencyAccount"
                                        >
                                            <amount-field
                                                [amount]="totals.grandTotalMultiCurrency"
                                                [currencyCode]="companyCurrency"
                                                [currencySymbol]="activeCompany.baseCurrencySymbol"
                                            >
                                            </amount-field>
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <section class="clearfix mr-t100">
                        <section class="text-center mr-b2 giddh-overlap-block action-buttons">
                            <div class="col-12">
                                <div class="pull-right pr update-mode">
                                    <button
                                        type="button"
                                        mat-raised-button
                                        *ngIf="!isUpdateMode"
                                        [disabled]="isLoading || isFileUploading"
                                        (click)="resetForm(receiptForm)"
                                    >
                                        {{ commonLocaleData?.app_clear }}
                                    </button>
                                    <button
                                        color="primary"
                                        type="button"
                                        mat-raised-button
                                        *ngIf="!isUpdateMode"
                                        [disabled]="isLoading || isFileUploading"
                                        (click)="createVoucher(receiptForm)"
                                    >
                                        {{
                                            voucherFormData.type === receiptVoucherType
                                                ? localeData?.create_receipt
                                                : localeData?.create_payment
                                        }}
                                    </button>
                                    <button
                                        type="button"
                                        mat-raised-button
                                        *ngIf="isUpdateMode"
                                        [routerLink]="
                                            '/pages/voucher/' +
                                            voucherFormData.type +
                                            '/preview/' +
                                            queryParams?.uniqueName +
                                            '/' +
                                            queryParams?.accountUniqueName
                                        "
                                    >
                                        {{ commonLocaleData?.app_cancel }}
                                    </button>
                                    <button
                                        color="primary"
                                        type="button"
                                        mat-raised-button
                                        *ngIf="isUpdateMode"
                                        [disabled]="isLoading || isFileUploading"
                                        (click)="updateVoucher()"
                                    >
                                        {{
                                            voucherFormData.type === receiptVoucherType
                                                ? localeData?.update_receipt
                                                : localeData?.update_payment
                                        }}
                                    </button>
                                    <span class="d-inline-block v-align-middle" *ngIf="!isUpdateMode">
                                        <div class="btn-group dropup">
                                            <button
                                                class="caret-button"
                                                mat-raised-button
                                                [matMenuTriggerFor]="menu"
                                                [disabled]="isLoading || isFileUploading"
                                            >
                                                <span class="caret"></span>
                                            </button>
                                            <mat-menu #menu="matMenu" yPosition="above">
                                                <button
                                                    mat-menu-item
                                                    (click)="createVoucher(receiptForm, sendEmailModal)"
                                                >
                                                    <span>{{ localeData?.create_send }}</span>
                                                </button>
                                                <button
                                                    mat-menu-item
                                                    (click)="createVoucher(receiptForm, sendPrintModal)"
                                                >
                                                    <span>{{ localeData?.create_print }}</span>
                                                </button>
                                            </mat-menu>
                                        </div>
                                    </span>
                                </div>
                            </div>
                        </section>
                    </section>
                </form>
            </div>
        </mat-card-content>
    </mat-card>
    <div class="aside-overlay" *ngIf="accountAsideMenuState === 'in'"></div>
    <generic-aside-menu-account
        [class]="accountAsideMenuState"
        [@slideInOut]="accountAsideMenuState"
        (closeAsideEvent)="toggleAccountAsidePane($event)"
        [selectedGrpUniqueName]="selectedGroupUniqueName"
        [keyboardShortcut]="{ 'esc': accountAsideMenuState === 'in' }"
        *ngIf="accountAsideMenuState === 'in'"
        [selectedAccountUniqueName]="selectedCustomerForDetails"
        (onShortcutPress)="toggleAccountAsidePane()"
        (addEvent)="addNewSidebarAccount($event)"
        (updateEvent)="updateSidebarAccount($event)"
    >
    </generic-aside-menu-account>
    <ng-template #sendEmailModal>
        <send-email
            [voucherType]="paymentReceiptResponse?.type"
            [email]="paymentReceiptResponse?.account?.email"
            (successEvent)="sendEmail($event)"
        ></send-email>
    </ng-template>
    <ng-template #sendPrintModal>
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <print
                    [localeData]="localeData"
                    [commonLocaleData]="commonLocaleData"
                    [selectedItem]="paymentReceiptResponse"
                    (cancelEvent)="closePrintDialog()"
                ></print>
            </div>
        </div>
    </ng-template>
</ng-container>
