<ng-container
    appTranslate
    [file]="'activity-logs'"
    (commonLocaleData)="commonLocaleData = $event"
    (localeData)="localeData = $event"
>
    <hamburger-menu></hamburger-menu>
    <div class="activity-container">
        <div class="activity-filter-wrap">
            <div class="mr-t15 mr-b15 custom-datepicker-wrapper">
                <div class="custom-datepicker" (click)="showGiddhDatepicker($event)">
                    <i class="icon-calender calendar-addon"></i>
                    <input
                        type="text"
                        name="selectedDateRange"
                        [value]="selectedDateRangeUi ? selectedDateRangeUi : ''"
                        class="giddh-datepicker date-range-picker"
                    />
                </div>
            </div>
            <div class="entity-wrapper mr-l1 filter-button">
                <select-field
                    [cssClass]="'form-control'"
                    [name]="'entity'"
                    [placeholder]="commonLocaleData?.app_entity"
                    [options]="entities"
                    (selectedOption)="activityObj.entity = $event.value; activityObjLabels.entity = $event.label"
                    [defaultValue]="activityObjLabels?.entity"
                >
                </select-field>
            </div>
            <div class="operation-wrapper mr-l1 filter-button">
                <select-field
                    [cssClass]="'form-control'"
                    [name]="'operation'"
                    [placeholder]="localeData?.operation"
                    [options]="filters[activityObj.entity ? activityObj.entity : '']"
                    (selectedOption)="activityObj.operation = $event.value; activityObjLabels.operation = $event.label"
                    [defaultValue]="activityObjLabels?.operation"
                >
                </select-field>
            </div>
            <div class="user-wrapper mr-l1 filter-button">
                <select-field
                    [cssClass]="'form-control'"
                    [name]="'user'"
                    [placeholder]="localeData?.user"
                    [options]="users"
                    (selectedOption)="selecteUserType($event); activityObjLabels.user = $event.label"
                    [defaultValue]="activityObjLabels?.user"
                >
                </select-field>
            </div>

            <div
                class="clear-filter form-group mb-0"
                *ngIf="
                    showDateReport ||
                    activityObj.entity ||
                    activityObj.operation ||
                    activityObj.userUniqueNames?.length > 0
                "
            >
                <button mat-raised-button class="btn-success min-width-100 mr-l1" (click)="resetFilter()">
                    <span class="icon-cross"></span> {{ commonLocaleData?.app_clear_filter }}
                </button>
            </div>
        </div>
        <button mat-raised-button class="btn-success min160 mr-l1" (click)="getActivityLogs(true)">
            {{ localeData?.get_logs }}
        </button>
        <div *ngIf="isLoading">
            <giddh-page-loader></giddh-page-loader>
        </div>
        <div class="table-content" *ngIf="!isLoading">
            <table mat-table [dataSource]="dataSource" *ngIf="dataSource?.length" class="giddh-table table">
                <!-- UserName Column -->
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef>{{ commonLocaleData?.app_name }}</th>
                    <td mat-cell *matCellDef="let element">
                        <span [matTooltip]="element.user.email">{{ element.user.name }}</span>
                    </td>
                </ng-container>

                <!-- Date Column -->
                <ng-container matColumnDef="time">
                    <th mat-header-cell *matHeaderCellDef>{{ commonLocaleData?.app_date }}</th>
                    <td mat-cell *matCellDef="let element">
                        <span [matTooltip]="element.timeonly"> {{ element.time }}</span>
                    </td>
                </ng-container>

                <!-- IP Column -->
                <ng-container matColumnDef="ip">
                    <th mat-header-cell *matHeaderCellDef>{{ localeData?.ip }}</th>
                    <td mat-cell *matCellDef="let element">{{ element.ip }}</td>
                </ng-container>

                <!-- Entity Column -->
                <ng-container matColumnDef="entity">
                    <th mat-header-cell *matHeaderCellDef>{{ commonLocaleData?.app_entity }}</th>
                    <td mat-cell *matCellDef="let element">{{ element.entity }}</td>
                </ng-container>

                <!-- Operation Column -->
                <ng-container matColumnDef="operation">
                    <th mat-header-cell *matHeaderCellDef>{{ localeData?.operation }}</th>
                    <td mat-cell *matCellDef="let element">{{ element.operation }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                    class="cursor-pointer"
                    mat-row
                    *matRowDef="let row; columns: displayedColumns"
                    (click)="openDialog(row)"
                ></tr>
            </table>
            <div class="no-data" *ngIf="!dataSource?.length && !isLoading">
                <no-data [secondaryMessage]="localeData?.no_logs"></no-data>
            </div>
        </div>
        <div class="pagination-wrapper" *ngIf="activityObj?.totalItems > activityObj.count && !isLoading">
            <pagination
                [totalItems]="activityObj?.totalItems"
                [(ngModel)]="activityObj.page"
                [maxSize]="5"
                class="pagination-sm"
                [boundaryLinks]="true"
                [itemsPerPage]="activityObj.count"
                [rotate]="false"
                (pageChanged)="pageChanged($event)"
                [firstText]="commonLocaleData?.app_first"
                [previousText]="commonLocaleData?.app_previous"
                [nextText]="commonLocaleData?.app_next"
                [lastText]="commonLocaleData?.app_last"
            ></pagination>
        </div>
    </div>
</ng-container>
<ng-template #datepickerTemplate>
    <div class="datepicker-modal">
        <div class="modal-body">
            <app-datepicker-wrapper
                [inputStartDate]="selectedDateRange?.startDate"
                [inputEndDate]="selectedDateRange?.endDate"
                [alwaysShowCalendars]="true"
                [ranges]="datePickerOptions"
                [selectedRangeLabel]="selectedRangeLabel"
                [showCustomRangeLabel]="true"
                [showClearButton]="false"
                [showCancel]="true"
                [linkedCalendars]="true"
                [showDropdowns]="true"
                [locale]="{ applyLabel: commonLocaleData?.app_done }"
                (rangeClicked)="dateSelectedCallback($event)"
                (datesUpdated)="dateSelectedCallback($event)"
                [keepCalendarOpeningWithRange]="false"
                [showRangeLabelOnInput]="false"
                [dateFieldPosition]="dateFieldPosition"
            ></app-datepicker-wrapper>
        </div>
    </div>
</ng-template>
