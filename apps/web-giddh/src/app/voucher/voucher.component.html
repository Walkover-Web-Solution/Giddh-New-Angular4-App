<ng-container appTranslate [file]="'proforma-invoice'" (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event" (translationComplete)="translationComplete($event)">
    <giddh-page-loader *ngIf="(showLoader && isUpdateMode) || isShowLoader"></giddh-page-loader>
    <hamburger-menu></hamburger-menu>
    <div class="vouchers" [ngStyle]="{ 'display': (!isUpdateMode || !showLoader) && !isShowLoader ? 'block' : 'none' }">
        <mat-card class="container-lg">
            <mat-card-content class="vouchers-content w-100 h-100">
                <!-- Voucher Page Heading -->
                <div class="vouchers-title d-flex align-items-center">
                    <h1>{{ invoiceTypeLabel }}</h1>
                    <small class="invoice-type-text" *ngIf="invoiceType === 'estimates'">
                        ({{ commonLocaleData?.app_beta }})
                    </small>
                    <div class="ml-auto" *ngIf="invoiceTypeLabel !== '' && (isCashInvoice || isSalesInvoice)">
                        <watch-video [cssClass]="'text-blue'"
                            [moduleName]="isCashInvoice ? 'VOUCHER_CASH' : 'VOUCHER_SALES'"></watch-video>
                    </div>
                </div>
                <!-- region update mode loader-->
                <ng-container *ngIf="isUpdateDataInProcess">
                    <div class="loader-class">
                        <giddh-page-loader></giddh-page-loader>
                    </div>
                </ng-container>
                <!--endregion-->
                <div class="vouchers-content-wrapper"
                    [hidden]="(isUpdateMode && isUpdateDataInProcess) || (isLastInvoiceCopied && isUpdateDataInProcess)">
                    <div class="font-15 mr-l1 mb-4" *ngIf="isEinvoiceGenerated">{{
                        commonLocaleData?.app_special_note
                        }}</div>
                    <form autocomplete="off" novalidate name="invoiceForm">
                        <!-- Voucher Form Top Section -->
                        <div class="vouchers-primary-form">
                            <div class="row">
                                <div class="col-10">
                                    <div class="d-flex align-items-center">
                                        <div class="vouchers-form-fields w-100" [keyboardShortcut]="'alt+c'"
                                            (onShortcutPress)="addAccountFromShortcut()">
                                            <ng-container *ngIf="!isCashInvoice">
                                                <dropdown-field #openAccountSelectionDropdown
                                                    [customPanelClass]="'panel-cl customer-dropdown-panel'"
                                                    [name]="'voucherDetails.customerName'"
                                                    [openDropdown]="openCustomerDropdown"
                                                    [placeholder]="customerPlaceHolder"
                                                    [options]="customerAcList$ | async"
                                                    (selectedOption)="onSelectCustomer($event)"
                                                    (createOption)="addNewAccount()" [readonly]="
                                                        isEinvoiceGenerated ||
                                                        (isUpdateMode &&
                                                            invoiceType !== 'sales' &&
                                                            invoiceType !== 'cash' &&
                                                            invoiceType !== 'purchase' &&
                                                            (voucherApiVersion === 1 ||
                                                                (voucherApiVersion === 2 &&
                                                                    invoiceType !== 'debit note' &&
                                                                    invoiceType !== 'credit note')))
                                                    " [defaultValue]="invFormData.voucherDetails.customerName"
                                                    [createNewText]="customerNotFoundText" [enableDynamicSearch]="true"
                                                    (dynamicSearchedQuery)="
                                                        isAccountSearchData = true;
                                                        onSearchQueryChanged($event, 1, 'customer')
                                                    " [allowValueReset]="true" (onClear)="resetCustomerName($event)"
                                                    [isPaginationEnabled]="true"
                                                    (scrollEnd)="handleScrollEnd('customer')"
                                                    [scrollableElementId]="'customerId'">
                                                    <ng-template #optionTemplate let-option="option">
                                                        <a href="javascript:void(0)">
                                                            <div class="option-label">
                                                                {{ option?.label }}
                                                            </div>
                                                            <div class="option-value">
                                                                {{ option?.value }}
                                                            </div>
                                                        </a>
                                                    </ng-template>
                                                </dropdown-field>
                                            </ng-container>
                                            <ng-container *ngIf="isCashInvoice">
                                                <input-field [type]="'text'" [name]="'voucherDetails.customerName'"
                                                    [autoFocus]="true" #inputCustomerName
                                                    [cssClass]="'cash-invoice-input'"
                                                    [(ngModel)]="invFormData.voucherDetails.customerName"
                                                    (change)="handleCustomerChange($event)" [readonly]="
                                                        isEinvoiceGenerated ||
                                                        (isUpdateMode &&
                                                            invoiceType !== 'sales' &&
                                                            invoiceType !== 'cash' &&
                                                            invoiceType !== 'credit note' &&
                                                            invoiceType !== 'debit note' &&
                                                            invoiceType !== 'purchase')
                                                    " [label]="localeData?.customer_name"></input-field>
                                            </ng-container>
                                        </div>
                                        <ng-container *ngIf="
                                                !isPurchaseInvoice &&
                                                ((voucherApiVersion === 2 && !isPendingVoucherType && !isCashInvoice) ||
                                                    (voucherApiVersion !== 2 &&
                                                        !(isPendingVoucherType && isCashInvoice))) &&
                                                (invFormData.voucherDetails.customerName ||
                                                    invFormData.voucherDetails.customerUniquename) &&
                                                lastInvoices.length &&
                                                !isUpdateMode
                                            ">
                                            <div class="vouchers-copy-sales mr-l3 cursor-pointer"
                                                [matMenuTriggerFor]="copyLastVouchers">
                                                <i class="icon-copy-file"></i>
                                                {{ copyPreviousInvoiceText }}
                                            </div>
                                            <mat-menu #copyLastVouchers="matMenu">
                                                <div class="mat-menu-width-large">
                                                    <ng-container *ngIf="lastInvoices?.length">
                                                        <button mat-menu-item *ngFor="let item of lastInvoices"
                                                            (click)="copyInvoice(item)" class="line-height-initial">
                                                            <div class="pd">
                                                                <div class="d-flex flex-column">
                                                                    <div class="d-flex justify-content-between">
                                                                        <span>{{ item?.versionNumber }}</span>
                                                                        <span>{{
                                                                            item?.grandTotal?.amountForAccount
                                                                            }}</span>
                                                                    </div>
                                                                    <span>{{ item?.date }} (
                                                                        {{ item?.account?.name }} )</span>
                                                                </div>
                                                            </div>
                                                        </button>
                                                    </ng-container>
                                                    <ng-container *ngIf="!lastInvoices?.length">
                                                        {{ commonLocaleData?.app_no_result_found }}
                                                    </ng-container>
                                                </div>
                                            </mat-menu>
                                        </ng-container>
                                    </div>
                                </div>
                                <div class="col-2 text-right" *ngIf="
                                        isSalesInvoice ||
                                        isProformaInvoice ||
                                        isEstimateInvoice ||
                                        (voucherApiVersion === 2 &&
                                            isPurchaseInvoice &&
                                            !isCashInvoice &&
                                            !isCashBankAccount)
                                    ">
                                    <span class="balance-due-label">{{
                                        isProformaInvoice || isEstimateInvoice
                                        ? commonLocaleData?.app_total_amount
                                        : localeData?.balance_due
                                        }}</span>
                                    <span class="sp-rupees d-flex justify-content-end" *ngIf="isMulticurrencyAccount">
                                        <amount-field [amount]="
                                                adjustPaymentData?.totalAdjustedAmount
                                                    ? adjustPaymentBalanceDueData
                                                    : invFormData.voucherDetails.balanceDue
                                            " [currencySymbol]="invFormData.accountDetails?.currencySymbol"
                                            [currencyCode]="invFormData.accountDetails?.currency?.code">
                                        </amount-field>
                                    </span>
                                    <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                    <span *ngIf="
                                            (voucherApiVersion !== 2 &&
                                                enableVoucherAdjustmentMultiCurrency &&
                                                isSalesInvoice &&
                                                isMulticurrencyAccount &&
                                                adjustPaymentBalanceDueData === 0 &&
                                                invFormData.voucherDetails.balanceDue === 0) ||
                                            (voucherApiVersion === 2 &&
                                                invFormData.voucherDetails.gainLoss &&
                                                invFormData.voucherDetails.gainLoss !== 0 &&
                                                invFormData.voucherDetails.balanceDue === 0)
                                        " class="balance-due">{{ localeData?.exchange_label }}
                                        {{
                                        voucherApiVersion === 2
                                        ? invFormData.voucherDetails.gainLoss >= 0
                                        ? commonLocaleData?.app_exchange_gain
                                        : commonLocaleData?.app_exchange_loss
                                        : getConvertedBalanceDue() <= 0 ? commonLocaleData?.app_exchange_gain :
                                            commonLocaleData?.app_exchange_loss }}:&nbsp;</span>
                                            <span class="sp-rupees d-flex justify-content-end"
                                                *ngIf="isMulticurrencyAccount && voucherApiVersion !== 2">
                                                <amount-field [amount]="
                                                isSalesInvoice &&
                                                adjustPaymentBalanceDueData === 0 &&
                                                invFormData.voucherDetails.balanceDue === 0
                                                    ? getConvertedBalanceDue(true)
                                                    : invFormData.voucherDetails.convertedBalanceDue
                                            " [currencySymbol]="baseCurrencySymbol" [currencyCode]="companyCurrency">
                                                </amount-field>
                                            </span>
                                            <span class="sp-rupees d-flex justify-content-end"
                                                *ngIf="!isMulticurrencyAccount">
                                                <amount-field [amount]="
                                                adjustPaymentData?.totalAdjustedAmount
                                                    ? adjustPaymentBalanceDueData
                                                    : invFormData.voucherDetails.balanceDue
                                            " [currencySymbol]="false" [currencyCode]="false">
                                                </amount-field>
                                            </span>
                                            <span class="sp-rupees d-flex justify-content-end" *ngIf="
                                            voucherApiVersion === 2 &&
                                            invFormData.voucherDetails.gainLoss &&
                                            invFormData.voucherDetails.gainLoss !== 0 &&
                                            invFormData.voucherDetails.balanceDue === 0
                                        ">
                                                <amount-field [amount]="invFormData.voucherDetails.gainLoss"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency">
                                                </amount-field>
                                            </span>
                                </div>
                                <div class="col-12 mt-1 mb-2" *ngIf="invFormData.voucherDetails.customerName">
                                    <span *ngIf="!isCashInvoice && !isUpdateMode"
                                        class="vouchers-form-fields-detail cursor-pointer"
                                        (click)="getCustomerDetails()">
                                        {{
                                        !isPurchaseInvoice
                                        ? localeData?.customer_details
                                        : localeData?.vendor_details
                                        }}</span>

                                    <ng-container *ngIf="isSalesInvoice && !isCashInvoice">
                                        <img src="{{ imgPath }}new/search_customer.svg" height="70" class="mb-3"
                                            *ngIf="!invFormData.voucherDetails.customerName" />
                                    </ng-container>
                                    <ng-container *ngIf="isPurchaseInvoice">
                                        <img src="{{ imgPath }}new/search-vendor.svg" height="70" class="mb-3"
                                            *ngIf="!invFormData.voucherDetails.customerName" />
                                    </ng-container>
                                    <ng-container *ngIf="isCashInvoice">
                                        <img src="{{ imgPath }}new/search-customer-cash-invoice.svg" height="70"
                                            class="mb-3" *ngIf="!invFormData.voucherDetails.customerName" />
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                        <!-- region search_customer image -->
                        <ng-container *ngIf="isSalesInvoice && !isCashInvoice">
                            <img src="{{ imgPath }}new/search_customer.svg" height="70" class="mb-3"
                                *ngIf="!invFormData.voucherDetails.customerName" />
                        </ng-container>
                        <!-- need to show this image on purchase invoice module -->
                        <ng-container *ngIf="isPurchaseInvoice">
                            <img src="{{ imgPath }}new/search-vendor.svg" height="70" class="mb-3"
                                *ngIf="!invFormData.voucherDetails.customerName" />
                        </ng-container>
                        <ng-container
                            *ngIf="isCashInvoice && invoiceType !== 'cash bill' && invoiceType !== 'cash debit note'">
                            <img src="{{ imgPath }}new/search-customer-cash-invoice.svg" height="70" class="mb-3"
                                *ngIf="!invFormData.voucherDetails.customerName" />
                        </ng-container>
                        <ng-container *ngIf="invoiceType === 'cash bill' || invoiceType === 'cash debit note'">
                            <img src="{{ imgPath }}search-vendor-cash-invoice.svg" height="70" class="mb-3"
                                *ngIf="!invFormData.voucherDetails.customerName" />
                        </ng-container>
                        <!-- endregion -->

                        <!-- Voucher Form Main Section -->
                        <div class="vouchers-secondary-form position-relative" [ngClass]="{
                                'vouchers-form-disable':
                                    !invFormData.voucherDetails.customerName &&
                                    !invFormData.voucherDetails.customerUniquename,
                                'mr-t15': isCreditNote || isDebitNote
                            }">
                            <div class="vouchers-small-container">
                                <div class="row">
                                    <div class="col-6">
                                        <label for="billingAddress" class="billing-label p-0">{{
                                            localeData?.billing_address }}
                                            <span *ngIf="!isCashInvoice">
                                                <span
                                                    *ngIf="invFormData.accountDetails.billingDetails.gstNumber || invFormData.accountDetails.billingDetails.taxNumber || invFormData.accountDetails.billingDetails.stateName || invFormData.accountDetails.billingDetails.state?.name || invFormData.accountDetails.billingDetails.state?.code || invFormData.accountDetails.billingDetails.county?.name || invFormData.accountDetails.billingDetails.county?.code || invFormData.accountDetails.billingDetails.stateCode">(
                                                    {{
                                                    commonLocaleData?.app_address }}
                                                    {{ accountBillingIndex }} )
                                                </span>
                                            </span>
                                        </label>
                                        <i *ngIf="!isEinvoiceGenerated && !isCashInvoice"
                                            [matMenuTriggerFor]="billingAddress"
                                            class="icon-edit text-blue cursor-pointer pl-2 font-12"></i>
                                        <mat-menu #billingAddress="matMenu">
                                            <div class="mat-menu-width-large vouchers-address-menu">
                                                <ng-container *ngFor="let address of accountAddressList; let i = index">
                                                    <button
                                                        *ngIf="address.gstNumber || address.taxNumber || address.state?.name || address.state?.code || address.county?.name || address.county?.code"
                                                        mat-menu-item (click)="
                                                            selectAddress('accountBilling',
                                                                invFormData.accountDetails.billingDetails,
                                                                address,
                                                                false,
                                                                i
                                                            )
                                                        ">
                                                        <div class="justify-content-between align-items-center d-flex">
                                                            <div>
                                                                <p> {{ commonLocaleData?.app_address }} {{ i + 1 }}</p>
                                                                <p>
                                                                    {{ address.address }}
                                                                </p>
                                                                <p class="text-gray">
                                                                    {{ address.state?.name ??address.county?.name }}
                                                                </p>
                                                                <p *ngIf="address.gstNumber">
                                                                    {{
                                                                    address.taxNumber
                                                                    ? (showGSTINNo
                                                                    ? commonLocaleData?.app_gstin + ":"
                                                                    : showTRNNo
                                                                    ? commonLocaleData?.app_trn + ":"
                                                                    : showVATNo
                                                                    ? commonLocaleData?.enter_vat_no + ":"
                                                                    : "") + address.gstNumber
                                                                    : ""
                                                                    }}
                                                                </p>
                                                            </div>
                                                            <i class="icon-tick" onLoad
                                                                (elementLoaded)="setIndex('accountBilling',i)"
                                                                *ngIf="(invFormData.accountDetails.billingDetails.state?.name || invFormData.accountDetails.billingDetails.stateName || invFormData.accountDetails.billingDetails.county?.name || invFormData.accountDetails.billingDetails.gstNumber || invFormData.accountDetails.billingDetails.taxNumber || invFormData.accountDetails.billingDetails.address[0]?.trim()) && (!invFormData.accountDetails.billingDetails.state?.name || (invFormData.accountDetails.billingDetails.state?.name && (invFormData.accountDetails.billingDetails.state?.name === address.state?.name || invFormData.accountDetails.billingDetails.stateName === address.state?.name))) && (!invFormData.accountDetails.billingDetails.county?.name || (invFormData.accountDetails.billingDetails.county?.name && (invFormData.accountDetails.billingDetails.county?.name === address.county?.name))) && (!invFormData.accountDetails.billingDetails.gstNumber || (invFormData.accountDetails.billingDetails.gstNumber && invFormData.accountDetails.billingDetails.gstNumber === address.gstNumber)) && (!invFormData.accountDetails.billingDetails.taxNumber || (invFormData.accountDetails.billingDetails.taxNumber && invFormData.accountDetails.billingDetails.taxNumber === address.gstNumber)) && (!invFormData.accountDetails.billingDetails.address[0]?.trim() || (invFormData.accountDetails.billingDetails.address[0]?.trim() && (invFormData.accountDetails.billingDetails.address[0]?.trim() === address.address?.trim())))"></i>
                                                        </div>
                                                    </button>
                                                    <mat-divider></mat-divider>
                                                </ng-container>
                                                <button mat-menu-item class="vouchers-add-new"
                                                    (click)="getCustomerDetails()">
                                                    {{ localeData?.add_new_address }}
                                                </button>
                                            </div>
                                        </mat-menu>
                                        <ng-container *ngIf="isCashInvoice">
                                            <div class="vouchers-address-form address-container" [ngClass]="{
                                                    'without-gstin': !showGSTINNo && !showTRNNo && !showVATNo
                                                }">
                                                <div class="address-field">
                                                    <textarea matInput name="billingDetails.address" class="w-100"
                                                        (keyup)="autoFillShippingDetails()" rows="2" autocomplete="off"
                                                        [(ngModel)]="
                                                            invFormData.accountDetails.billingDetails.address[0]
                                                        " autofocus="off" aria-autocomplete="none"
                                                        #customerBillingAddress
                                                        [disabled]="isEinvoiceGenerated"></textarea>
                                                </div>
                                                <div class="country-field">
                                                    <span>{{ customerCountryName }}</span>
                                                </div>
                                                <div class="state-field" *ngIf="statesSource?.length">
                                                    <select-field [placeholder]="commonLocaleData?.app_state"
                                                        [cssClass]="'border-0'" (selectedOption)="
                                                            fillShippingBillingDetails($event, true);
                                                            autoFillShippingDetails()
                                                        " #statesBilling [options]="statesSource"
                                                        [name]="'billingDetails.stateCode'" [allowValueReset]="true"
                                                        [defaultValue]="
                                                            invFormData?.accountDetails?.billingDetails?.state?.name
                                                        " (onClear)="
                                                            fillShippingBillingDetails($event, true);
                                                            autoFillShippingDetails()
                                                        " [readonly]="isEinvoiceGenerated">
                                                    </select-field>
                                                </div>
                                                <div class="state-field" *ngIf="regionsSource?.length">
                                                    <select-field [placeholder]="commonLocaleData?.app_region"
                                                        [cssClass]="'border-0'" (selectedOption)="
                                                            fillShippingBillingDetails($event, true);
                                                            autoFillShippingDetails()
                                                        " #statesBilling [options]="regionsSource"
                                                        [name]="'billingDetails.county.code'" [allowValueReset]="true"
                                                        [defaultValue]="
                                                            invFormData?.accountDetails?.billingDetails?.county?.name
                                                        " (onClear)="
                                                            fillShippingBillingDetails($event, true);
                                                            autoFillShippingDetails()
                                                        " [readonly]="isEinvoiceGenerated">
                                                    </select-field>
                                                </div>
                                                <div class="gstin-field"
                                                    *ngIf="shouldShowTrnGstVatField && showGSTINNo">
                                                    <text-field [maxlength]="15" autocomplete="None" [type]="'text'"
                                                        [name]="'billingDetails.gstNumber'" [cssClass]="'border-0'"
                                                        [(ngModel)]="
                                                            invFormData.accountDetails.billingDetails.gstNumber
                                                        " (change)="
                                                            getStateCode('billingDetails', statesBilling);
                                                            autoFillShippingDetails()
                                                        " [placeholder]="commonLocaleData?.app_gstin"
                                                        [readonly]="isEinvoiceGenerated">
                                                    </text-field>
                                                </div>
                                                <div class="gstin-field" *ngIf="shouldShowTrnGstVatField && showTRNNo">
                                                    <text-field [maxlength]="12" autocomplete="none" [type]="'text'"
                                                        [name]="'billingDetails.gstNumber'" [cssClass]="'border-0'"
                                                        [(ngModel)]="
                                                            invFormData.accountDetails.billingDetails.gstNumber
                                                        " (change)="
                                                            getStateCode('billingDetails', statesBilling);
                                                            autoFillShippingDetails()
                                                        " [placeholder]="commonLocaleData?.app_trn"
                                                        [readonly]="isEinvoiceGenerated">
                                                    </text-field>
                                                    <text-field [maxlength]="12" autocomplete="None" [type]="'text'"
                                                        [name]="'billingDetails.gstNumber'" [cssClass]="'border-0'"
                                                        *ngIf="showVATNo" [(ngModel)]="
                                                            invFormData.accountDetails.billingDetails.gstNumber
                                                        " (change)="autoFillShippingDetails()"
                                                        [placeholder]="commonLocaleData?.app_enter_vat">
                                                    </text-field>
                                                </div>
                                                <div class="gstin-field" *ngIf="shouldShowTrnGstVatField && showVATNo">
                                                    <text-field [maxlength]="12" autocomplete="None" [type]="'text'"
                                                        [name]="'billingDetails.gstNumber'" [cssClass]="'border-0'"
                                                        [(ngModel)]="
                                                            invFormData.accountDetails.billingDetails.gstNumber
                                                        " (change)="autoFillShippingDetails()"
                                                        [placeholder]="commonLocaleData?.app_enter_vat">
                                                    </text-field>
                                                </div>
                                                <div class="pin-code-field">
                                                    <text-field [type]="'number'" [cssClass]="'border-0'"
                                                        autocomplete="false" [name]="'billingPinCode'"
                                                        (change)="autoFillShippingDetails()"
                                                        [placeholder]="commonLocaleData?.app_pin_code"
                                                        [(ngModel)]="invFormData.accountDetails.billingDetails.pincode"
                                                        [allowDecimalDigitsOnly]="true"
                                                        [readonly]="isEinvoiceGenerated">
                                                    </text-field>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                    <!-- Shipping Address -->
                                    <div class="col-6">
                                        <ng-container>
                                            <mat-checkbox *ngIf="isCashInvoice"
                                                (keydown.enter)="$event.preventDefault()"
                                                (change)="autoFillShippingDetails()" name="autoFillShipping"
                                                color="primary" class="auto-fill-shipping-address"
                                                [ngModelOptions]="{ standalone: true }" [(ngModel)]="autoFillShipping"
                                                [disabled]="isEinvoiceGenerated">
                                                <span *ngIf="isCashInvoice"> {{ localeData?.shipping_billing_same
                                                    }}</span>
                                            </mat-checkbox>
                                            <span *ngIf="!isCashInvoice">
                                                {{ localeData?.shipping_address }}

                                                <span
                                                    *ngIf="invFormData.accountDetails.shippingDetails.gstNumber || invFormData.accountDetails.shippingDetails.taxNumber || invFormData.accountDetails.shippingDetails.stateName || invFormData.accountDetails.shippingDetails.state?.name|| invFormData.accountDetails.shippingDetails.state?.code || invFormData.accountDetails.shippingDetails.county?.name|| invFormData.accountDetails.shippingDetails.county?.code|| invFormData.accountDetails.shippingDetails.stateCode">(
                                                    {{
                                                    commonLocaleData?.app_address }}
                                                    {{ accountShippingIndex }} )
                                                </span>
                                            </span>
                                        </ng-container>
                                        <ng-container>
                                            <i *ngIf="!isEinvoiceGenerated && !isCashInvoice"
                                                [matMenuTriggerFor]="shippingAddress"
                                                class="icon-edit text-blue cursor-pointer pl-2 font-12"></i>
                                            <mat-menu #shippingAddress="matMenu">
                                                <div class="mat-menu-width-large vouchers-address-menu">
                                                    <ng-container
                                                        *ngFor="let address of accountAddressList; let i = index">
                                                        <button
                                                            *ngIf="address.gstNumber || address.taxNumber || address.state?.name || address.state?.code || address.county?.name || address.county?.code "
                                                            mat-menu-item (click)="
                                                                autoFillShipping = false;
                                                                selectAddress('accountShipping',
                                                                    invFormData.accountDetails.shippingDetails,
                                                                    address,
                                                                    false,
                                                                    i
                                                                )
                                                            ">
                                                            <div
                                                                class="justify-content-between align-items-center d-flex">
                                                                <div>
                                                                    <p> {{ commonLocaleData?.app_address }} {{ i + 1 }}
                                                                    </p>
                                                                    <p>
                                                                        {{ address.address }}
                                                                    </p>
                                                                    <p class="text-gray">
                                                                        {{ address.state?.name ??address.county?.name }}
                                                                    </p>
                                                                    <p *ngIf="address.gstNumber">
                                                                        {{
                                                                        address.taxNumber
                                                                        ? (showGSTINNo
                                                                        ? commonLocaleData?.app_gstin +
                                                                        ":"
                                                                        : showTRNNo
                                                                        ? commonLocaleData?.app_trn + ":"
                                                                        : showVATNo
                                                                        ? commonLocaleData?.enter_vat_no +
                                                                        ":"
                                                                        : "") + address.gstNumber
                                                                        : ""
                                                                        }}
                                                                    </p>
                                                                </div>
                                                                <i class="icon-tick" onLoad
                                                                    (elementLoaded)="setIndex('accountShipping',i)"
                                                                    *ngIf="(invFormData.accountDetails.shippingDetails.state?.name || invFormData.accountDetails.shippingDetails.stateName || invFormData.accountDetails.shippingDetails.county?.name || invFormData.accountDetails.shippingDetails.gstNumber || invFormData.accountDetails.shippingDetails.taxNumber || invFormData.accountDetails.shippingDetails.address[0]?.trim()) && (!invFormData.accountDetails.shippingDetails.state?.name || (invFormData.accountDetails.shippingDetails.state?.name && (invFormData.accountDetails.shippingDetails.state?.name === address.state?.name || invFormData.accountDetails.shippingDetails.stateName === address.state?.name))) && (!invFormData.accountDetails.shippingDetails.county?.name || (invFormData.accountDetails.shippingDetails.county?.name && (invFormData.accountDetails.shippingDetails.county?.name === address.county?.name))) && (!invFormData.accountDetails.shippingDetails.gstNumber || (invFormData.accountDetails.shippingDetails.gstNumber && invFormData.accountDetails.shippingDetails.gstNumber === address.gstNumber)) && (!invFormData.accountDetails.shippingDetails.taxNumber || (invFormData.accountDetails.shippingDetails.taxNumber && invFormData.accountDetails.shippingDetails.taxNumber === address.gstNumber)) && (!invFormData.accountDetails.shippingDetails.address[0]?.trim() || (invFormData.accountDetails.shippingDetails.address[0]?.trim() && (invFormData.accountDetails.shippingDetails.address[0]?.trim() === address.address?.trim())))"></i>
                                                            </div>
                                                        </button>
                                                        <mat-divider></mat-divider>
                                                    </ng-container>
                                                    <button mat-menu-item class="vouchers-add-new"
                                                        (click)="getCustomerDetails()">
                                                        {{ localeData?.add_new_address }}
                                                    </button>
                                                </div>
                                            </mat-menu>
                                        </ng-container>
                                        <ng-container *ngIf="isCashInvoice">
                                            <div class="vouchers-address-form address-container" [ngClass]="{
                                                    'form-disabled': autoFillShipping,
                                                    'without-gstin': !showGSTINNo && !showTRNNo && !showVATNo
                                                }">
                                                <div class="address-field">
                                                    <textarea matInput [readonly]="autoFillShipping"
                                                        name="shippingDetails.address" class="w-100" [(ngModel)]="
                                                            invFormData.accountDetails.shippingDetails.address[0]
                                                        " rows="2" autocomplete="off"
                                                        [disabled]="isEinvoiceGenerated"></textarea>
                                                </div>
                                                <div class="country-field">
                                                    <span>{{ customerCountryName }}</span>
                                                </div>
                                                <div class="state-field" *ngIf="statesSource?.length">
                                                    <select-field #customerShippingState
                                                        [placeholder]="commonLocaleData?.app_state"
                                                        [cssClass]="'border-0'" #statesShipping
                                                        (selectedOption)="fillShippingBillingDetails($event, false)"
                                                        [options]="statesSource" [name]="'shippingDetails.stateCode'"
                                                        [allowValueReset]="true" [defaultValue]="
                                                            invFormData?.accountDetails?.shippingDetails?.state?.name
                                                        " (onClear)="fillShippingBillingDetails($event, false)"
                                                        [readonly]="isEinvoiceGenerated">
                                                    </select-field>
                                                </div>
                                                <div class="state-field" *ngIf="regionsSource?.length">
                                                    <select-field #customerShippingState
                                                        [placeholder]="commonLocaleData?.app_region"
                                                        [cssClass]="'w-100 border-0'" #statesShipping
                                                        (selectedOption)="fillShippingBillingDetails($event, false)"
                                                        [options]="regionsSource" [name]="'shippingDetails.county.code'"
                                                        [allowValueReset]="true" [defaultValue]="
                                                            invFormData?.accountDetails?.shippingDetails?.county?.name
                                                        " (onClear)="fillShippingBillingDetails($event, false)"
                                                        [readonly]="isEinvoiceGenerated">
                                                    </select-field>
                                                </div>
                                                <div class="pin-code-field">
                                                    <text-field [type]="'number'" [cssClass]="'border-0'"
                                                        autocomplete="false" [name]="'shippingPinCode'"
                                                        [placeholder]="commonLocaleData?.app_pin_code"
                                                        [(ngModel)]="invFormData.accountDetails.shippingDetails.pincode"
                                                        [allowDecimalDigitsOnly]="true"
                                                        [readonly]="isEinvoiceGenerated">
                                                    </text-field>
                                                </div>
                                                <div class="gstin-field"
                                                    *ngIf="shouldShowTrnGstVatField && showGSTINNo">
                                                    <text-field [readonly]="autoFillShipping || isEinvoiceGenerated"
                                                        autocomplete="None" [maxlength]="15" [type]="'text'"
                                                        [name]="'shippingDetails.gstNumber'" [cssClass]="'border-0'"
                                                        [(ngModel)]="
                                                            invFormData.accountDetails.shippingDetails.gstNumber
                                                        " (change)="getStateCode('shippingDetails', statesShipping)"
                                                        [placeholder]="commonLocaleData?.app_gstin"></text-field>
                                                </div>
                                                <div class="gstin-field" *ngIf="shouldShowTrnGstVatField && showTRNNo">
                                                    <text-field [readonly]="autoFillShipping || isEinvoiceGenerated"
                                                        [maxlength]="15" autocomplete="None" [type]="'text'"
                                                        [name]="'shippingDetails.gstNumber'" [cssClass]="'border-0'"
                                                        [(ngModel)]="
                                                            invFormData.accountDetails.shippingDetails.gstNumber
                                                        " (change)="getStateCode('shippingDetails', statesShipping)"
                                                        [placeholder]="commonLocaleData?.app_trn"></text-field>
                                                </div>
                                                <div class="gstin-field" *ngIf="shouldShowTrnGstVatField && showVATNo">
                                                    <text-field [readonly]="autoFillShipping || isEinvoiceGenerated"
                                                        [maxlength]="12" autocomplete="None" [type]="'text'"
                                                        [name]="'shippingDetails.gstNumber'" [cssClass]="'border-0'"
                                                        [(ngModel)]="
                                                            invFormData.accountDetails.shippingDetails.gstNumber
                                                        " [placeholder]="commonLocaleData?.app_enter_vat"></text-field>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>

                                    <!-- Attention to -->
                                    <div class="col-6 mr-t15">
                                        <input-field [type]="'text'" [name]="'accountDetails.attention'"
                                            [placeholder]="localeData?.attention_to" [cssClass]="'attention-to'"
                                            [(ngModel)]="invFormData.accountDetails.attentionTo"></input-field>
                                    </div>

                                    <!-- Email Id -->
                                    <div class="col-6 mr-t15">
                                        <input-field [type]="'email'" [placeholder]="commonLocaleData?.app_email_id"
                                            [name]="'accountDetails.email'" [cssClass]="'attention-to'"
                                            [(ngModel)]="invFormData.accountDetails.email"></input-field>
                                    </div>

                                    <!-- Mobile Number -->
                                    <div class="col-6 mr-t15 mobile-number-wrapper">
                                        <div id="init-contact-wrapper" class="position-relative w-100">
                                            <input-field [name]="'accountDetails.mobileNumber'" [type]="'tel'"
                                                #initContactProforma class="flag-input" [id]="'init-contact-proforma'"
                                                (keydown.enter)="$event.preventDefault()"
                                                [label]="commonLocaleData?.app_mobile_number"
                                                [placeholder]="'98XXXXXXXX'" [floatLabel]="'always'">
                                            </input-field>
                                            <span id="init-contact-proforma-valid-msg" class="d-none"></span>
                                            <span id="init-contact-proforma-error-msg" class="d-none"></span>
                                        </div>
                                    </div>

                                    <!-- Warehouse -->
                                    <div class="col-6 mr-t15"
                                        *ngIf="shouldShowWarehouse && warehouses && warehouses.length > 1">
                                        <dropdown-field #selectWarehouse [cssClass]="'multi-select'"
                                            [name]="'warehouse'"
                                            [placeholder]="localeData?.select_warehouse_placeholder"
                                            [options]="warehouses" (selectedOption)="onSelectWarehouse($event)"
                                            [allowValueReset]="true" (onClear)="onSelectWarehouse($event)"
                                            [defaultValue]="selectedWarehouseName">
                                        </dropdown-field>
                                    </div>
                                </div>

                                <div class="row" *ngIf="isPurchaseInvoice">
                                    <div class="col-12 mr-t15">
                                        <span class="billing-deliver-label">{{ localeData?.deliver_to }}</span>
                                    </div>

                                    <!-- Billing Address -->
                                    <div class="col-6">
                                        <label for="billingAddress" class="billing-label p-0">
                                            {{ localeData?.billing_address }}
                                            <span
                                                *ngIf="purchaseBillCompany.billingDetails.gstNumber || purchaseBillCompany.billingDetails.taxNumber || purchaseBillCompany.billingDetails.stateName || purchaseBillCompany.billingDetails.state?.name || purchaseBillCompany.billingDetails.state?.code || purchaseBillCompany.billingDetails.county?.name || purchaseBillCompany.billingDetails.county?.code || purchaseBillCompany.billingDetails.stateCode">
                                                ( {{ commonLocaleData?.app_address }}
                                                {{ purchaseBillingIndex }} )
                                            </span>
                                        </label>
                                        <i *ngIf="companyAddressList?.length > 1"
                                            [matMenuTriggerFor]="companyBillingAddress"
                                            class="icon-edit text-blue cursor-pointer pl-2 font-12"></i>
                                        <mat-menu #companyBillingAddress="matMenu">
                                            <div class="mat-menu-width-large vouchers-address-menu">
                                                <ng-container *ngFor="let address of companyAddressList; let i = index">
                                                    <button
                                                        *ngIf="address.gstNumber || address.taxNumber||address.stateName || address.stateCode"
                                                        mat-menu-item (click)="
                                                            selectAddress('purchaseBilling',
                                                                purchaseBillCompany.billingDetails,
                                                                address,
                                                                true,
                                                                i
                                                            )
                                                        ">
                                                        <div class="justify-content-between align-items-center d-flex">
                                                            <div>
                                                                <p> {{ commonLocaleData?.app_address }} {{ i + 1 }}</p>
                                                                <p>
                                                                    {{ address.address }}
                                                                </p>
                                                                <p class="text-gray">
                                                                    {{ address.stateName }}
                                                                </p>
                                                                <p *ngIf="address.gstNumber">
                                                                    {{
                                                                    address.gstNumber
                                                                    ? (showGSTINNo
                                                                    ? commonLocaleData?.app_gstin + ":"
                                                                    : showTRNNo
                                                                    ? commonLocaleData?.app_trn + ":"
                                                                    : showVATNo
                                                                    ? commonLocaleData?.enter_vat_no + ":"
                                                                    : "") + address.gstNumber
                                                                    : ""
                                                                    }}
                                                                </p>
                                                                <p *ngIf="address.taxNumber">
                                                                    {{
                                                                    address.taxNumber
                                                                    ? (showGSTINNo
                                                                    ? commonLocaleData?.app_gstin + ":"
                                                                    : showTRNNo
                                                                    ? commonLocaleData?.app_trn + ":"
                                                                    : showVATNo
                                                                    ? commonLocaleData?.enter_vat_no + ":"
                                                                    : "") + address.taxNumber
                                                                    : ""
                                                                    }}
                                                                </p>
                                                            </div>
                                                            <i class="icon-tick" onLoad
                                                                (elementLoaded)="setIndex('purchaseBilling',i)"
                                                                *ngIf="(purchaseBillCompany.billingDetails.state?.name || purchaseBillCompany.billingDetails.stateName || purchaseBillCompany.billingDetails.county?.name || purchaseBillCompany.billingDetails.gstNumber || purchaseBillCompany.billingDetails.taxNumber || purchaseBillCompany.billingDetails.address[0]?.trim()) && (!purchaseBillCompany.billingDetails.state?.name || (purchaseBillCompany.billingDetails.state?.name && (purchaseBillCompany.billingDetails.state?.name === address.stateName || purchaseBillCompany.billingDetails.stateName === address.stateName))) && (!purchaseBillCompany.billingDetails.county?.name || (purchaseBillCompany.billingDetails.county?.name && (purchaseBillCompany.billingDetails.county?.name === address.county?.name))) && (!purchaseBillCompany.billingDetails.gstNumber || (purchaseBillCompany.billingDetails.gstNumber && (purchaseBillCompany.billingDetails.gstNumber === address.gstNumber || purchaseBillCompany.billingDetails.gstNumber === address.taxNumber))) && (!purchaseBillCompany.billingDetails.taxNumber || (purchaseBillCompany.billingDetails.taxNumber && (purchaseBillCompany.billingDetails.taxNumber === address.gstNumber || purchaseBillCompany.billingDetails.taxNumber === address.taxNumber))) && (!purchaseBillCompany.billingDetails.address[0]?.trim() || (purchaseBillCompany.billingDetails.address[0]?.trim() && (purchaseBillCompany.billingDetails.address[0]?.trim() === address.address?.trim())))"></i>
                                                        </div>
                                                    </button>
                                                    <mat-divider></mat-divider>
                                                </ng-container>
                                                <button mat-menu-item class="vouchers-add-new"
                                                    (click)="getCustomerDetails()">
                                                    {{ localeData?.add_new_address }}
                                                </button>
                                            </div>
                                        </mat-menu>
                                    </div>
                                    <!-- Shipping Address -->
                                    <div class="col-6">
                                        {{ localeData?.shipping_address }}
                                        <span
                                            *ngIf="purchaseBillCompany.shippingDetails.gstNumber || purchaseBillCompany.shippingDetails.taxNumber || purchaseBillCompany.shippingDetails.stateName  || purchaseBillCompany.shippingDetails.state?.name  || purchaseBillCompany.shippingDetails.state?.code  || purchaseBillCompany.shippingDetails.county?.name  || purchaseBillCompany.shippingDetails.county?.code|| purchaseBillCompany.shippingDetails.stateCode">(
                                            {{
                                            commonLocaleData?.app_address }}
                                            {{ purchaseShippingIndex }} )
                                        </span>
                                        <ng-container>
                                            <i *ngIf="companyAddressList?.length > 1"
                                                [matMenuTriggerFor]="shippingAddress"
                                                class="icon-edit text-blue cursor-pointer pl-2 font-12"></i>
                                            <mat-menu #shippingAddress="matMenu">
                                                <div class="mat-menu-width-large vouchers-address-menu">
                                                    <ng-container
                                                        *ngFor="let address of companyAddressList; let i = index">
                                                        <button
                                                            *ngIf="address.gstNumber || address.taxNumber || address.stateName || address.stateCode"
                                                            mat-menu-item (click)="
                                                         autoFillCompanyShipping = false;
                                                                selectAddress('purchaseShipping',
                                                                    purchaseBillCompany.shippingDetails,
                                                                    address,
                                                                    true,
                                                                    i
                                                                )
                                                            ">
                                                            <div
                                                                class="justify-content-between align-items-center d-flex">
                                                                <div>
                                                                    <p> {{ commonLocaleData?.app_address }} {{ i + 1 }}
                                                                    </p>
                                                                    <p>
                                                                        {{ address.address }}
                                                                    </p>
                                                                    <p class="text-gray">
                                                                        {{ address.stateName }}
                                                                    </p>
                                                                    <p *ngIf="address.gstNumber">
                                                                        {{
                                                                        address.gstNumber
                                                                        ? (showGSTINNo
                                                                        ? commonLocaleData?.app_gstin +
                                                                        ":"
                                                                        : showTRNNo
                                                                        ? commonLocaleData?.app_trn + ":"
                                                                        : showVATNo
                                                                        ? commonLocaleData?.enter_vat_no +
                                                                        ":"
                                                                        : "") + address.gstNumber
                                                                        : ""
                                                                        }}
                                                                    </p>
                                                                    <p *ngIf="address.taxNumber">
                                                                        {{
                                                                        address.taxNumber
                                                                        ? (showGSTINNo
                                                                        ? commonLocaleData?.app_gstin +
                                                                        ":"
                                                                        : showTRNNo
                                                                        ? commonLocaleData?.app_trn + ":"
                                                                        : showVATNo
                                                                        ? commonLocaleData?.enter_vat_no +
                                                                        ":"
                                                                        : "") + address.taxNumber
                                                                        : ""
                                                                        }}
                                                                    </p>
                                                                </div>
                                                                <i class="icon-tick" onLoad
                                                                    (elementLoaded)="setIndex('purchaseShipping',i)"
                                                                    *ngIf="(purchaseBillCompany.shippingDetails.state?.name || purchaseBillCompany.shippingDetails.stateName || purchaseBillCompany.shippingDetails.county?.name || purchaseBillCompany.shippingDetails.gstNumber || purchaseBillCompany.shippingDetails.taxNumber || purchaseBillCompany.shippingDetails.address[0]?.trim()) && (!purchaseBillCompany.shippingDetails.state?.name || (purchaseBillCompany.shippingDetails.state?.name && (purchaseBillCompany.shippingDetails.state?.name === address.stateName || purchaseBillCompany.shippingDetails.stateName === address.stateName))) && (!purchaseBillCompany.shippingDetails.county?.name || (purchaseBillCompany.shippingDetails.county?.name && (purchaseBillCompany.shippingDetails.county?.name === address.county?.name))) && (!purchaseBillCompany.shippingDetails.gstNumber || (purchaseBillCompany.shippingDetails.gstNumber && (purchaseBillCompany.shippingDetails.gstNumber === address.gstNumber || purchaseBillCompany.shippingDetails.gstNumber === address.taxNumber))) && (!purchaseBillCompany.shippingDetails.taxNumber || (purchaseBillCompany.shippingDetails.taxNumber && (purchaseBillCompany.shippingDetails.taxNumber === address.gstNumber || purchaseBillCompany.shippingDetails.taxNumber === address.taxNumber))) && (!purchaseBillCompany.shippingDetails.address[0]?.trim() || (purchaseBillCompany.shippingDetails.address[0]?.trim() && (purchaseBillCompany.shippingDetails.address[0]?.trim() === address.address?.trim())))"></i>
                                                            </div>
                                                        </button>
                                                        <mat-divider></mat-divider>
                                                    </ng-container>
                                                    <button mat-menu-item class="vouchers-add-new"
                                                        (click)="getCustomerDetails()">
                                                        {{ localeData?.add_new_address }}
                                                    </button>
                                                </div>
                                            </mat-menu>
                                        </ng-container>

                                    </div>
                                </div>
                                <!-- Row 3 -->
                                <div class="row row-gap mr-t15 mr-b15"
                                    *ngIf="isPurchaseInvoice && (!isUpdateMode || (isUpdateMode && poLinkUpdated))">
                                    <!-- Purchase Order -->
                                    <div class="col-6">
                                        <mat-select name="linkedPO" [(ngModel)]="linkedPo" [multiple]="true"
                                            (selectionChange)="getPurchaseOrder($event?.value, true)"
                                            class="po-mat-select" [placeholder]="localeData?.select_order_placeholder"
                                            [disabled]="linkedPo?.length === 0 && fieldFilteredOptions?.length === 0">
                                            <mat-select-trigger *ngIf="linkedPo?.length">
                                                <ng-container *ngFor="let poNumber of linkedPo; let i = index">{{
                                                    purchaseOrderNumberValueMapping[poNumber]
                                                    }}<ng-container *ngIf="linkedPo[i + 1]">, </ng-container>
                                                </ng-container>
                                            </mat-select-trigger>
                                            <mat-option class="po-options-line">
                                                <ngx-mat-select-search
                                                    [noEntriesFoundLabel]="commonLocaleData?.app_no_result_found"
                                                    [formControl]="linkPoDropdown"
                                                    [placeholderLabel]="localeData?.select_order_placeholder">
                                                    <i class="icon-cross" ngxMatSelectSearchClear></i>
                                                </ngx-mat-select-search>
                                            </mat-option>

                                            <mat-option *ngFor="let option of fieldFilteredOptions"
                                                [value]="option?.value" class="po-options-line" [disabled]="showLoader">
                                                <span class="po-option-label"> {{ option?.label }}</span>
                                                <span class="po-option-value" *ngIf="option?.additional?.pending">
                                                    {{ localeData?.pending }}: {{ option?.additional?.pending }}</span>
                                                <span class="po-option-value" *ngIf="option.additional?.grandTotal">
                                                    {{ commonLocaleData?.app_amount }}:
                                                    {{ option?.additional?.grandTotal }}</span>
                                            </mat-option>
                                        </mat-select>
                                    </div>
                                </div>

                                <!-- Row 4 -->
                                <div class="row row-gap mr-t15">
                                    <!-- Voucher Number -->
                                    <div class="col-6">
                                        <input-field *ngIf="!isCreditNote && !isDebitNote" [type]="'text'"
                                            [name]="'accountDetails.invoiceNum'"
                                            [cssClass]="'invoice-date attention-to invoice-number-class'"
                                            [ngClass]="{ 'date-invoice': !isPurchaseInvoice }" [readonly]="
                                                isUpdateMode && !(isDebitNote || isPurchaseInvoice) ? 'disabled' : null
                                            " [(ngModel)]="invFormData.voucherDetails.voucherNumber"
                                            [placeholder]="commonLocaleData?.app_voucher_number">
                                        </input-field>
                                        <input-field *ngIf="voucherApiVersion === 2 && (isCreditNote || isDebitNote)"
                                            [type]="'text'" [name]="'accountDetails.invoiceNum'"
                                            [cssClass]="'invoice-date attention-to invoice-number-class'"
                                            [ngClass]="{ 'date-invoice': !isPurchaseInvoice }" [readonly]="
                                                isUpdateMode && !(isDebitNote || isPurchaseInvoice) ? 'disabled' : null
                                            " [(ngModel)]="invFormData.voucherDetails.voucherNumber"
                                            [placeholder]="commonLocaleData?.app_voucher_number">
                                        </input-field>
                                    </div>
                                    <!-- Voucher Date -->
                                    <div class="col-3 pr-2">
                                        <giddh-datepicker #voucherDate="ngModel"
                                            (keydown.enter)="$event.preventDefault()" [label]="invoiceDateLabel"
                                            [placeholder]="giddhDateFormat" name="voucherDate"
                                            [(ngModel)]="invFormData.voucherDetails.voucherDate" [class.invalid-inp]="
                                                voucherDate.errors && (voucherDate.dirty || voucherDate.touched)
                                            "
                                            [disabled]="invoiceType !== 'purchase' && isUpdateMode ? 'disabled' : null"
                                            (datepickerState)="onFocusInvoiceDate()" (dateSelected)="
                                                onVoucherDateChanged($event, invFormData.voucherDetails.voucherDate);
                                                onBlurInvoiceDate(0)
                                            " (focusOut)="
                                                !(
                                                    currentVoucherFormDetails?.dueDate ||
                                                    isSalesInvoice ||
                                                    isPurchaseInvoice ||
                                                    isProformaInvoice ||
                                                    isEstimateInvoice
                                                )
                                                    ? openFirstEntry()
                                                    : ''
                                            " [showToggleIcon]="false" [appearance]="'outline'">
                                        </giddh-datepicker>
                                        <p class="text-danger"
                                            *ngIf="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)">
                                            {{ localeData?.invalid_date }}
                                        </p>
                                    </div>

                                    <!-- Due Date -->
                                    <div class="col-3 pl-2" *ngIf="
                                            (currentVoucherFormDetails?.dueDate ||
                                                isSalesInvoice ||
                                                isPurchaseInvoice ||
                                                isProformaInvoice ||
                                                isEstimateInvoice) &&
                                            !isCashInvoice
                                        ">
                                        <giddh-datepicker [placeholder]="giddhDateFormat" [label]="invoiceDueDateLabel"
                                            (keydown.enter)="$event.preventDefault()" #dueDate="ngModel" name="dueDate"
                                            [(ngModel)]="invFormData.voucherDetails.dueDate"
                                            [class.invalid-inp]="dueDate.errors && (dueDate.dirty || dueDate.touched)"
                                            (blur)="onBlurDueDate(0)" (focusOut)="openFirstEntry()"
                                            [showToggleIcon]="false" [appearance]="'outline'">
                                        </giddh-datepicker>
                                        <p class="text-danger"
                                            *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)">
                                            {{ localeData?.invalid_date }}
                                        </p>
                                    </div>
                                </div>
                                <div class="row mr-t15"
                                    *ngIf="(isCreditNote || isDebitNote) || companyCountryCode === 'AE'">
                                    <div class="col-6"  *ngIf="isCreditNote || isDebitNote">
                                        <div 
                                           >
                                            <div class="w-100 position-relative">
                                                <dropdown-field #linkingDropdown *ngIf="voucherApiVersion === 2"
                                                    [cssClass]="'linking-dropdown'" [name]="'invoiceLinking'"
                                                    [placeholder]="commonLocaleData?.app_select_voucher"
                                                    [options]="invoiceList$ | async"
                                                    (selectedOption)="creditNoteInvoiceSelected($event)"
                                                    [defaultValue]="selectedInvoiceLabel" [hasMoreValue]="true"
                                                    [enableDynamicSearch]="true" (dynamicSearchedQuery)="
                                                        searchReferenceVoucher = $event;
                                                        resetInvoiceList();
                                                        getInvoiceListsForCreditNote()
                                                    " [isPaginationEnabled]="true" (scrollEnd)="
                                                        !searchReferenceVoucher ? getInvoiceListsForCreditNote() : ''
                                                    " [scrollableElementId]="'referenceVoucher'"
                                                    [readonly]="isEinvoiceGenerated">
                                                    <ng-template #optionTemplate let-option="option">
                                                        <a *ngIf="option" href="javascript:void(0)"
                                                            class="linking-item">
                                                            <div class="option-label">{{ option?.label }}</div>
                                                            <div class="option-value">
                                                                ({{ commonLocaleData?.app_dated }}:
                                                                {{ option.additional?.voucherDate }})
                                                            </div>
                                                            <div class="option-value-stock">
                                                                ({{ commonLocaleData?.app_amount }}:
                                                                {{
                                                                voucherApiVersion === 2
                                                                ? (option.additional?.unadjustedAmount
                                                                ?.amountForAccount | giddhCurrency)
                                                                : (option.additional?.balanceDue
                                                                ?.amountForAccount | giddhCurrency)
                                                                }})
                                                            </div>
                                                        </a>
                                                    </ng-template>
                                                </dropdown-field>

                                                <dropdown-field #invoiceListDropdown *ngIf="voucherApiVersion !== 2"
                                                    [name]="'invoiceLinking'"
                                                    [placeholder]="commonLocaleData?.app_select_voucher"
                                                    [options]="invoiceList"
                                                    (selectedOption)="creditNoteInvoiceSelected($event)"
                                                    [defaultValue]="invoiceSelectedLabel" [hasMoreValue]="true"
                                                    [readonly]="isEinvoiceGenerated">
                                                    <ng-template #optionTemplate let-option="option">
                                                        <a *ngIf="option" href="javascript:void(0)"
                                                            class="linking-item">
                                                            <div class="option-label">{{ option?.label }}</div>
                                                            <div class="option-value">
                                                                ({{ commonLocaleData?.app_dated }}:
                                                                {{ option?.additional?.voucherDate }}))
                                                            </div>
                                                            <div class="option-value-stock">
                                                                ({{ commonLocaleData?.app_amount }}:
                                                                {{
                                                                option.additional?.balanceDue?.amountForAccount
                                                                | giddhCurrency
                                                                }})
                                                            </div>
                                                        </a>
                                                    </ng-template>
                                                </dropdown-field>
                                            </div>
                                            <div *ngIf="selectedInvoice && !isEinvoiceGenerated"
                                                class="cp for-mobile-screen remove-invoice"
                                                (click)="removeSelectedInvoice()">
                                                <span class="remove-invoice-icon mr-r05"><i
                                                        class="icon-trash"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                    <ng-container *ngIf="companyCountryCode === 'AE'">
                                        <div class="col-12">
                                            <!-- For Tourist Scheme start -->
                                            <div *ngIf="isSalesInvoice || isCashInvoice">
                                                <mat-checkbox color="primary" (keydown.enter)="$event.preventDefault()"
                                                    id="tourist-scheme" name="touristSchemeApplicable"
                                                    [(ngModel)]="invFormData.touristSchemeApplicable"
                                                    (ngModelChange)="touristSchemeApplicableToggle()"
                                                    [disabled]="isEinvoiceGenerated">
                                                    {{ localeData?.transaction_tourist_scheme }}
                                                </mat-checkbox>
                                            </div>
                                        </div>
                                        <div class="col-6 mt-3 mb-1" *ngIf="
                                        (isSalesInvoice || isCashInvoice) &&
                                        invFormData.touristSchemeApplicable
                                    ">
                                            <div>
                                                <input-field [type]="'text'" [name]="'passportNumber'"
                                                    [placeholder]="localeData?.passport_number"
                                                    [cssClass]="'attention-to'" [(ngModel)]="invFormData.passportNumber"
                                                    (keypress)="allowAlphanumericChar()"
                                                    (blur)="allowAlphanumericChar()"></input-field>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <!-- For Tourist Scheme end -->
                                    <!-- <div class="col-12"
                                        *ngIf="!isCreditNote && !isDebitNote || companyCountryCode === 'AE'"></div> -->
                                </div>
                                <div class="row mr-t15 pb-1" *ngIf="
                                isPurchaseInvoice ||
                                (currentVoucherFormDetails?.rcmAllowed &&
                                    (companyCountryName === 'India' ||
                                        companyCountryName === 'United Kingdom'))
                            ">
                                    <!-- Reverse Charge Checkbox -->
                                    <div class="col-12">
                                        <div class="d-flex">
                                            <mat-checkbox (keydown.enter)="$event.preventDefault()" #rcmCheckbox
                                                id="reverse-charge" [(ngModel)]="isRcmEntry"
                                                (change)="changeRcmCheckboxState($event)" class="mr-r1" name="rcmEntry"
                                                [disabled]="isEinvoiceGenerated" color="primary">
                                            </mat-checkbox>
                                            <label class="checkbox-custom-label" for="reverse-charge" (click)="
                                                    !isEinvoiceGenerated ? toggleRcmCheckbox(rcmCheckbox, 'label') : ''
                                                " [innerHTML]="localeData?.transaction_reverse_charge">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="vouchers-large-container mt-3 pt-4">
                                <div class="change-currency d-flex justify-content-end align-items-center column-gap1 text-uppercase pb-2"
                                    *ngIf="isMulticurrencyAccount && !showSwitchedCurr">
                                    <span>{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrencyName }}</span>
                                    <img alt="switch-icon" (click)="switchCurrencyImg(true)" class="cp" height="15px"
                                        src="/assets/images/switch-icon.svg" />
                                    <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                        originalExchangeRate | giddhCurrency
                                        }}</span>
                                    <div class="currency-input-wrapper">
                                        <text-field [name]="'exchangeRate'" [(ngModel)]="newExchangeRate"
                                            class="exchange-rate-original" [cssClass]="'form-control edit-currency '"
                                            *ngIf="showCurrencyValue" [readonly]="isEinvoiceGenerated"></text-field>
                                        {{ companyCurrency }}
                                    </div>
                                    <i class="icon-save text-blue cursor-pointer" (click)="
                                            exchangeRate = newExchangeRate;
                                            originalExchangeRate = exchangeRate;
                                            previousExchangeRate = exchangeRate;
                                            autoSaveIcon = !autoSaveIcon;
                                            showCurrencyValue = !showCurrencyValue;
                                            exchangeRateChanged();
                                            calculateGrandTotal()
                                        " *ngIf="autoSaveIcon && !isEinvoiceGenerated"></i>
                                    <i class="icon-edit text-blue cursor-pointer"
                                        *ngIf="!autoSaveIcon && !isEinvoiceGenerated" (click)="
                                            showCurrencyValue = !showCurrencyValue;
                                            autoSaveIcon = !autoSaveIcon;
                                            newExchangeRate = originalExchangeRate
                                        "></i>
                                </div>

                                <div class="change-currency d-flex justify-content-end align-items-center column-gap1 text-uppercase pb-2"
                                    *ngIf="isMulticurrencyAccount && showSwitchedCurr">
                                    <span>{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrency }}</span>
                                    <img alt="switch-icon" (click)="switchCurrencyImg(false)" height="15px" class="cp"
                                        src="/assets/images/switch-icon.svg" />
                                    <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                        originalReverseExchangeRate | giddhCurrency
                                        }}</span>
                                    <div class="currency-input-wrapper">
                                        <text-field [type]="'number'" [name]="'exchangeRate'"
                                            class="exchange-rate-original" [(ngModel)]="reverseExchangeRate"
                                            [cssClass]="'form-control edit-currency'" *ngIf="showCurrencyValue"
                                            [readonly]="isEinvoiceGenerated"></text-field>
                                        {{ companyCurrencyName }}
                                    </div>
                                    <i class="icon-save text-blue cursor-pointer" (click)="saveCancelExcRate(true)"
                                        *ngIf="autoSaveIcon && !isEinvoiceGenerated"></i>
                                    <i class="icon-edit text-blue cursor-pointer"
                                        *ngIf="!autoSaveIcon && !isEinvoiceGenerated"
                                        (click)="saveCancelExcRate(false)"></i>
                                </div>

                                <!-- Voucher Table for Multiple Entries-->
                                <div class="vouchers-entry-table">
                                    <table class="w-100">
                                        <thead>
                                            <tr>
                                                <th *ngFor="let item of theadArrReadOnly" [hidden]="!item.display"
                                                    class="thead-sales-invoice" [ngClass]="{ 'd-none' : 
                                                        ((commonLocaleData?.app_quantity_unit === item?.label) || (commonLocaleData?.app_rate === item?.label)) 
                                                        && !hasStock }"
                                                    >
                                                    {{ item?.label }}
                                                    <span *ngIf="item.label === 'Tax' && isRcmEntry">({{
                                                        commonLocaleData?.app_rcm }})<sup
                                                            class="mandatory-asterisk">*</sup></span>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody [hidden]="showBulkLoader" (clickOutside)="handleOutsideClick($event)"
                                            [exclude]="'.entries-tr, .add-line-bulk-item, .mat-option'">
                                            <ng-container #itemsContainer></ng-container>
                                        </tbody>
                                        <tbody *ngIf="showBulkLoader">
                                            <tr>
                                                <td colspan="8">
                                                    <giddh-page-loader></giddh-page-loader>
                                                </td>
                                            </tr>
                                        </tbody>
                                        <ng-template #entry let-entry let-entryIdx="entryIdx"
                                            let-transaction="transaction">
                                            <tr (click)="setActiveIndx(entryIdx); $event.stopPropagation()"
                                                *ngIf="activeIndx !== entryIdx" class="entries-tr set-active" [ngClass]="{
                                                    'is-other-tax': entry.isOtherTaxApplicable && isMulticurrencyAccount
                                                }">
                                                <td class="text-left">{{ entryIdx + 1 }}</td>
                                                <td class="text-left product-column">
                                                    <div class="product-name">
                                                        <label *ngIf="!transaction.accountName"
                                                            class="select-account-label">{{ localeData?.select_account
                                                            }}</label>
                                                        {{ transaction.accountName }}
                                                        <span *ngIf="transaction.stockDetails?.uniqueName">({{
                                                            transaction.stockDetails?.name }})</span>
                                                    </div>
                                                    <p *ngIf="
                                                            transaction.variant?.name &&
                                                            ((stockVariants | async)[entryIdx] | async)?.length > 1
                                                        " class="variant">
                                                        {{ localeData?.variant + ": " + transaction.variant?.name }}
                                                    </p>
                                                    <div class="description">
                                                        {{ transaction.description }}
                                                    </div>
                                                    <p class="small text-muted sku-and-custom-fields"
                                                        *ngIf="transaction.sku_and_customfields">
                                                        {{ transaction.sku_and_customfields }}
                                                    </p>
                                                    <div class="date-hsn-code">
                                                        <div class="row mr-0 ml-0 mt-1">
                                                            <div class="col-6 col-sm-6 pl-0" *ngIf="entry?.entryDate">
                                                                <div class="entry-date font-12">
                                                                    <label class="font-12 w-100 d-block">{{
                                                                        localeData?.entry_date }}:
                                                                    </label>
                                                                    {{ entry?.entryDate }}
                                                                    <span class="edit-icon cp ml-1"
                                                                        *ngIf="!isUpdateMode">
                                                                        <img src="{{ imgPath }}edit-pencilicon.svg" />
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="col-6 col-sm-6 pl-0"
                                                                *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                                                <div class="hsn-code text-right">
                                                                    <label class="font-12 w-100 d-block">{{
                                                                        transaction.showCodeType === "hsn"
                                                                        ? commonLocaleData?.app_hsn
                                                                        : commonLocaleData?.app_sac
                                                                        }}:</label>
                                                                    <span class="font-12 w-100 d-inline-block">
                                                                        {{
                                                                        transaction.showCodeType === "hsn"
                                                                        ? transaction.hsnNumber
                                                                        : transaction.sacNumber
                                                                        }}
                                                                        <span class="edit-icon cp">
                                                                            <img
                                                                                src="{{ imgPath }}edit-pencilicon.svg" />
                                                                        </span>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td width="12%" *ngIf="
                                                        !currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.quantityAllowed
                                                    " [ngClass]="{ 'd-none' : !hasStock}">
                                                    <div class="wrap-td-data">
                                                        {{ transaction.quantity | giddhCurrency }}
                                                        {{ transaction.stockUnitCode }}
                                                    </div>
                                                </td>
                                                <td width="12%" *ngIf="
                                                        !currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.rateAllowed
                                                    " [ngClass]="{ 'd-none' : !hasStock}">
                                                    <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                                        <div class="td-wrapper flex-grow-1">
                                                            <div class="flex-grow-1">
                                                                <div class="wrap-td-data">
                                                                    <span class="d-flex justify-content-end">
                                                                        <amount-field [amount]="transaction.rate"
                                                                            [currencySymbol]="
                                                                                isMulticurrencyAccount
                                                                                    ? invFormData.accountDetails
                                                                                          ?.currencySymbol
                                                                                    : false
                                                                            " [currencyCode]="
                                                                                isMulticurrencyAccount
                                                                                    ? invFormData.accountDetails
                                                                                          ?.currency?.code
                                                                                    : false
                                                                            " [ratePrecision]="true">
                                                                        </amount-field>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="differ-currency d-flex justify-content-end">
                                                            <span>
                                                                <amount-field *ngIf="isMulticurrencyAccount" [amount]="
                                                                        transaction.rate * exchangeRate
                                                                            ? transaction.rate * exchangeRate
                                                                            : 0
                                                                    " [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td [width]="hasStock ? '12%' : '16%'">
                                                    <div class="td-wrapper">
                                                        <div class="flex-grow-1">
                                                            <div class="wrap-td-data">
                                                                <span class="d-flex justify-content-end">
                                                                    <amount-field [amount]="
                                                                            transaction.amount
                                                                                ? transaction.amount
                                                                                : '0'
                                                                        " [currencySymbol]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails
                                                                                      ?.currencySymbol
                                                                                : false
                                                                        " [currencyCode]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails?.currency
                                                                                      ?.code
                                                                                : false
                                                                        ">
                                                                    </amount-field>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="differ-currency d-flex justify-content-end">
                                                        <span *ngIf="isMulticurrencyAccount">
                                                            <amount-field [amount]="transaction.convertedAmount"
                                                                [currencySymbol]="baseCurrencySymbol"
                                                                [currencyCode]="companyCurrency">
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </td>
                                                <td [width]="hasStock ? '9%' : '16%'" *ngIf="
                                                        !currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.discountAllowed
                                                    ">
                                                    <div class="text-right td-wrapper">
                                                        <div class="flex-grow-1">
                                                            <div class="wrap-td-data">
                                                                <span class="d-flex justify-content-end">
                                                                    <amount-field [amount]="entry.discountSum"
                                                                        [currencySymbol]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails
                                                                                      ?.currencySymbol
                                                                                : false
                                                                        " [currencyCode]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails?.currency
                                                                                      ?.code
                                                                                : false
                                                                        ">
                                                                    </amount-field>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="differ-currency d-flex justify-content-end"
                                                        *ngIf="isMulticurrencyAccount">
                                                        <span>
                                                            <amount-field [amount]="entry.discountSum * exchangeRate"
                                                                [currencySymbol]="baseCurrencySymbol"
                                                                [currencyCode]="companyCurrency">
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </td>
                                                <td [class.error-box]="transaction.requiredTax" [width]="hasStock ? '12%' : '16%'"
                                                    (focus)="transaction.requiredTax = false" *ngIf="
                                                        !currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.taxesAllowed
                                                    ">
                                                    <div class="td-wrapper">
                                                        <div class="flex-grow-1">
                                                            <div class="wrap-td-data">
                                                                <span class="d-flex justify-content-end">
                                                                    <amount-field [amount]="
                                                                            giddhRoundOff(
                                                                                entry.taxSum + entry.cessSum,
                                                                                giddhBalanceDecimalPlaces
                                                                            )
                                                                        " [currencySymbol]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails
                                                                                      ?.currencySymbol
                                                                                : false
                                                                        " [currencyCode]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails?.currency
                                                                                      ?.code
                                                                                : false
                                                                        ">
                                                                    </amount-field>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="differ-currency d-flex justify-content-end"
                                                        *ngIf="isMulticurrencyAccount">
                                                        <span>
                                                            <amount-field
                                                                [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                                [currencySymbol]="baseCurrencySymbol"
                                                                [currencyCode]="companyCurrency">
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </td>
                                                <td width="20%"
                                                    class="text-right item-tax position-relative delete-btn-absolute">
                                                    <div class="td-wrapper">
                                                        <div class="flex-fill">
                                                            <div class="wrap-td-data">
                                                                <span class="d-flex justify-content-end">
                                                                    <amount-field [amount]="transaction.total"
                                                                        [currencySymbol]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails
                                                                                      ?.currencySymbol
                                                                                : false
                                                                        " [currencyCode]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails?.currency
                                                                                      ?.code
                                                                                : false
                                                                        ">
                                                                    </amount-field>
                                                                    <br />
                                                                </span>
                                                                <span class="d-flex flex-wrap justify-content-end"
                                                                    *ngIf="
                                                                        entry.isOtherTaxApplicable &&
                                                                        entry.otherTaxModal?.appliedOtherTax?.name
                                                                    ">
                                                                    <p>
                                                                        {{
                                                                        entry.otherTaxModal?.appliedOtherTax?.name
                                                                        }}
                                                                        :
                                                                    </p>
                                                                    <amount-field *ngIf="isMulticurrencyAccount"
                                                                        [amount]="entry.otherTaxSum" [currencySymbol]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails
                                                                                      ?.currencySymbol
                                                                                : false
                                                                        " [currencyCode]="
                                                                            isMulticurrencyAccount
                                                                                ? invFormData.accountDetails?.currency
                                                                                      ?.code
                                                                                : false
                                                                        ">
                                                                    </amount-field>
                                                                    <amount-field *ngIf="!isMulticurrencyAccount"
                                                                        [amount]="entry.otherTaxSum"
                                                                        [currencySymbol]="false" [currencyCode]="false">
                                                                    </amount-field>
                                                                </span>
                                                            </div>
                                                            <div class="tax-in-currency" *ngIf="
                                                                    entry.isOtherTaxApplicable &&
                                                                    isMulticurrencyAccount &&
                                                                    entry.otherTaxModal?.appliedOtherTax?.name
                                                                ">
                                                                <span class="differ-currency d-flex justify-content-end"
                                                                    *ngIf="isMulticurrencyAccount">
                                                                    <amount-field
                                                                        [amount]="entry.otherTaxSum * exchangeRate"
                                                                        [currencySymbol]="baseCurrencySymbol"
                                                                        [currencyCode]="companyCurrency">
                                                                    </amount-field>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="differ-currency d-flex justify-content-end"
                                                            *ngIf="isMulticurrencyAccount">
                                                            <span>
                                                                <amount-field [amount]="transaction.convertedTotal"
                                                                    [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="trash-icon-delete" *ngIf="!isEinvoiceGenerated" (click)="
                                                            removeTransaction(entryIdx);
                                                            $event.preventDefault();
                                                            $event.stopPropagation()
                                                        ">
                                                        <i class="icon-trash font-16 cursor-pointer delete-btn position-absolute"
                                                            [ngClass]="{ 'multi-currency': isMulticurrencyAccount }"></i>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr *ngIf="activeIndx === entryIdx" class="entries-tr default-active"
                                                (click)="$event.stopPropagation()">
                                                <td class="text-left"
                                                    (click)="closeDiscountPopup(); closeTaxControlPopup()">
                                                    {{ entryIdx + 1 }}
                                                </td>
                                                <td class="text-left product-column"
                                                    (click)="closeDiscountPopup(); closeTaxControlPopup()">
                                                    <div class="product-name">
                                                        <div class="ng-select-wrap" (click)="setUserManuallyClicked()">
                                                            <select-field #selectAccount [isPaginationEnabled]="true"
                                                                (scrollEnd)="handleScrollEnd('item')"
                                                                [scrollableElementId]="'selectAccount'"
                                                                [cssClass]="'form-control mat-field-border'"
                                                                [name]="'transaction.fakeAccForSelect2_' + entryIdx"
                                                                [placeholder]="localeData?.select_acc"
                                                                [options]="salesAccounts$ | async" (selectedOption)="
                                                                    transaction.fakeAccForSelect2 = $event?.value;
                                                                    entry['initiallyCall'] = undefined;
                                                                    onSelectSalesAccount(
                                                                        $event,
                                                                        transaction,
                                                                        entry,
                                                                        false,
                                                                        false,
                                                                        entryIdx
                                                                    );
                                                                    noResultsFoundLabel = localeData?.search_acc
                                                                " (createOption)="onNoResultsClicked(entryIdx)"
                                                                [showCreateNew]="true" [defaultValue]="
                                                                    transaction.stockDetails &&
                                                                    transaction.stockDetails.name
                                                                        ? transaction.accountName +
                                                                          ' (' +
                                                                          transaction.stockDetails?.name +
                                                                          ')'
                                                                        : transaction.accountName
                                                                " [enableDynamicSearch]="true" (dynamicSearchedQuery)="
                                                                    isAccountSearchData = true;
                                                                    onSearchQueryChanged($event, 1, 'item')
                                                                " (onClear)="onClearSalesAccount(transaction)"
                                                                [hasMoreValue]="true" [readonly]="isEinvoiceGenerated">
                                                                <ng-template #optionTemplate let-option="option">
                                                                    <ng-container *ngIf="!option.additional?.stock">
                                                                        <a href="javascript:void(0)"
                                                                            class="flex-column">
                                                                            <div class="option-label">
                                                                                {{ option?.label }}
                                                                            </div>
                                                                            <div class="option-value">
                                                                                {{ option.additional?.uniqueName }}
                                                                            </div>
                                                                        </a>
                                                                    </ng-container>
                                                                    <ng-container *ngIf="option.additional?.stock">
                                                                        <a href="javascript:void(0)"
                                                                            class="flex-column">
                                                                            <div class="option-label">
                                                                                {{ option?.label }}
                                                                            </div>
                                                                            <div class="option-value">
                                                                                {{ option.additional?.uniqueName }}
                                                                            </div>
                                                                            <div class="option-value-stock">
                                                                                {{ commonLocaleData?.app_stock }}:
                                                                                {{
                                                                                option.additional?.stock?.uniqueName
                                                                                }}
                                                                            </div>
                                                                        </a>
                                                                    </ng-container>
                                                                </ng-template>
                                                            </select-field>
                                                        </div>
                                                    </div>
                                                    <ng-container *ngIf="
                                                            transaction?.isStockTxn &&
                                                            ((stockVariants | async)[entryIdx] | async) as variants
                                                        ">
                                                        <div *ngIf="variants?.length > 1" class="variant-name mt-2">
                                                            <sh-select [placeholder]="localeData?.select_variant"
                                                                [options]="variants"
                                                                (selected)="variantChanged($event, transaction, entry)"
                                                                [isRequired]="true" name="{{ 'variant' + entryIdx }}"
                                                                [(ngModel)]="transaction.variant.uniqueName"></sh-select>
                                                        </div>
                                                    </ng-container>
                                                    <div *ngIf="transaction.fakeAccForSelect2">
                                                        <div class="description">
                                                            <textarea matInput type="text" rows="2"
                                                                [placeholder]="localeData?.add_description"
                                                                name="transaction.description_'+entryIdx"
                                                                class="form-control mt-2"
                                                                [(ngModel)]="transaction.description"
                                                                [maxlength]="entryDescriptionLength"
                                                                #description></textarea>
                                                            <p class="font-12 mt-1">
                                                                {{ commonLocaleData?.app_characters_left }}:
                                                                {{
                                                                entryDescriptionLength -
                                                                transaction.description?.length
                                                                }}
                                                            </p>
                                                            <p class="small text-muted sku-and-custom-fields"
                                                                *ngIf="transaction.sku_and_customfields">
                                                                {{ transaction.sku_and_customfields }}
                                                            </p>
                                                        </div>
                                                        <!-- region entry date/ hsncode -->
                                                        <div class="date-hsn-code">
                                                            <div class="row mr-0 ml-0 mt-1">
                                                                <div class="col-6 col-sm-6 pl-0">
                                                                    <div class="entry-date">
                                                                        <label class="font-12 w-100 d-block">{{
                                                                            localeData?.entry_date }}:
                                                                        </label>
                                                                        <span *ngIf="!isUpdateMode"
                                                                            class="custom-date-entries custom-input-field d-flex">
                                                                            <giddh-datepicker
                                                                                class="date-border entries-giddh-datepicker"
                                                                                [showToggleIcon]="true" #dp="ngModel"
                                                                                (keydown.enter)="
                                                                                    $event.preventDefault()
                                                                                " (dateSelected)="
                                                                                    onBlurEntryDate(entryIdx, true)
                                                                                " id="transaction.date_{{ entryIdx }}"
                                                                                [disabled]="isUpdateMode"
                                                                                [cssClass]="'entry-custom-date'"
                                                                                name="transaction.date_{{ entryIdx }}"
                                                                                [(ngModel)]="entry.entryDate"
                                                                                [appearance]="'fill'" (datepickerState)="
                                                                                    onFocusEntryDate($event)
                                                                                " [isOpened]="isEntryDatepickerOpen">
                                                                            </giddh-datepicker>
                                                                            <span class="custom-edit-date cp"
                                                                                [attr.aria-expanded]="dp.isOpen"
                                                                                (click)="isEntryDatepickerOpen = true">
                                                                                <img src="{{
                                                                                        imgPath
                                                                                    }}edit-pencilicon.svg" />
                                                                            </span>
                                                                        </span>
                                                                        <span *ngIf="isUpdateMode">
                                                                            {{ entry?.entryDate }}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-6 col-sm-6 pl-0">
                                                                    <div class="wrap-hsn-box">
                                                                        <div class="hsn-code text-right"
                                                                            (click)="toggleHsnSacDropDown(transaction)">
                                                                            <label class="font-12 w-100 d-block">{{
                                                                                transaction.showCodeType === "hsn"
                                                                                ? commonLocaleData?.app_hsn
                                                                                : commonLocaleData?.app_sac
                                                                                }}:</label>
                                                                            <span>
                                                                                {{
                                                                                transaction.showCodeType === "hsn"
                                                                                ? transaction.hsnNumber
                                                                                : transaction.sacNumber
                                                                                }}
                                                                                <span *ngIf="
                                                                                        !transaction.hsnNumber &&
                                                                                        !transaction.sacNumber &&
                                                                                        !isEinvoiceGenerated
                                                                                    " class="update-text font-12">{{
                                                                                    commonLocaleData?.app_update }}
                                                                                </span>
                                                                                <span class="edit-icon cp"
                                                                                    *ngIf="!isEinvoiceGenerated">
                                                                                    <img src="{{
                                                                                            imgPath
                                                                                        }}edit-pencilicon.svg" />
                                                                                </span>
                                                                            </span>
                                                                        </div>
                                                                        <div class="hsn-code-dropdown"
                                                                            *ngIf="hsnDropdownShow">
                                                                            <mat-radio-group class="d-flex mb-2"
                                                                                [(ngModel)]="transaction.showCodeType"
                                                                                (change)="
                                                                                    onChangeHsnSacType(transaction)
                                                                                " name="showCodeType{{ entryIdx }}"
                                                                                [disabled]="isEinvoiceGenerated">
                                                                                <mat-radio-button color="primary"
                                                                                    id="hsnCodeType{{ entryIdx }}"
                                                                                    [value]="'hsn'">
                                                                                    {{ commonLocaleData?.app_hsn_code }}
                                                                                </mat-radio-button>
                                                                                <mat-radio-button color="primary"
                                                                                    id="sacCodeType{{ entryIdx }}"
                                                                                    [value]="'sac'">
                                                                                    {{ commonLocaleData?.app_sac_code }}
                                                                                </mat-radio-button>
                                                                            </mat-radio-group>
                                                                            <text-field [type]="'text'"
                                                                                [cssClass]="'form-control'"
                                                                                maxLength="10"
                                                                                [allowDecimalDigitsOnly]="true"
                                                                                [placeholder]="localeData?.hsn_number"
                                                                                [name]="
                                                                                    'transaction.hsnNumber_' + entryIdx
                                                                                " *ngIf="
                                                                                    transaction.showCodeType === 'hsn'
                                                                                " [(ngModel)]="transaction.hsnNumber"
                                                                                [readonly]="isEinvoiceGenerated"></text-field>
                                                                            <text-field [type]="'text'"
                                                                                [cssClass]="'form-control'"
                                                                                maxLength="10"
                                                                                [allowDecimalDigitsOnly]="true"
                                                                                [placeholder]="localeData?.sac_number"
                                                                                [name]="
                                                                                    'transaction.hsnNumber_' + entryIdx
                                                                                " *ngIf="
                                                                                    transaction.showCodeType === 'sac'
                                                                                " [(ngModel)]="transaction.sacNumber"
                                                                                [readonly]="isEinvoiceGenerated"></text-field>
                                                                            <div
                                                                                class="d-inline-flex mt-2 pt-1 column-gap5">
                                                                                <button mat-stroked-button
                                                                                    color="primary" class="btn-sm"
                                                                                    type="button" (click)="
                                                                                        hsnDropdownShow =
                                                                                            !hsnDropdownShow
                                                                                    " [disabled]="isEinvoiceGenerated">
                                                                                    {{ commonLocaleData?.app_save }}
                                                                                </button>
                                                                                <button mat-stroked-button class="mr-0"
                                                                                    (click)="
                                                                                        hideHsnSacEditPopup(transaction)
                                                                                    ">
                                                                                    {{ commonLocaleData?.app_cancel }}
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->
                                                    </div>
                                                </td>
                                                <td (click)="closeDiscountPopup(); closeTaxControlPopup()" *ngIf="
                                                        (!currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.quantityAllowed)
                                                    " width="12%" [ngClass]="{ 'd-none' : !hasStock}">
                                                    <ng-container *ngIf="!(!transaction.isStockTxn || isEinvoiceGenerated)">
                                                        <text-field [placeholder]="commonLocaleData?.app_quantity"
                                                            [readonly]="!transaction.isStockTxn || isEinvoiceGenerated"
                                                            [type]="'text'"
                                                            [cssClass]="'form-control mat-field-border text-right stock1'"
                                                            [name]="'transaction.quantity_' + entryIdx"
                                                            [mask]="inputMaskFormat" [useMask]="true"
                                                            [(ngModel)]="transaction.quantity"
                                                            (change)="handleQuantityBlur(entry, transaction)"
                                                            [allowDecimalDigitsOnly]="true">
                                                        </text-field>
                                                        <div class="select-quantity">
                                                            <mat-select class="form-control mt-2"
                                                                [placeholder]="commonLocaleData?.app_select"
                                                                [disabled]="!transaction.isStockTxn || isEinvoiceGenerated"
                                                                (selectionChange)="
                                                                    onChangeUnit(entry, transaction, $event);
                                                                    handlePriceCalculationOnUnitChange(entry, transaction)
                                                                " [value]="transaction.stockUnit"
                                                                [(ngModel)]="transaction.stockUnit"
                                                                [name]="'transaction.stockUnit_' + entryIdx">
                                                                <div class="select-quantity-option">
                                                                    <mat-option *ngFor="let stock of transaction.stockList"
                                                                        [value]="stock.id">
                                                                        {{ stock.text }}
                                                                    </mat-option>
                                                                </div>
                                                            </mat-select>
                                                        </div>
                                                </ng-container>
                                                </td>
                                                <td (click)="closeDiscountPopup(); closeTaxControlPopup()" width="12%" [ngClass]="{ 'd-none' : !hasStock}"
                                                    *ngIf="
                                                        (!currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.rateAllowed)
                                                    ">
                                                    <div class="td-wrapper" *ngIf="!(!transaction.isStockTxn || isEinvoiceGenerated)">
                                                        <div class="flex-fill">
                                                            <text-field [readonly]="
                                                                    !transaction.isStockTxn || isEinvoiceGenerated
                                                                " [placeholder]="commonLocaleData?.app_rate"
                                                                [type]="'text'" [cssClass]="
                                                                    'form-control mat-field-border transaction-rate text-right '
                                                                " [name]="'transaction.rate_' + entryIdx"
                                                                [prefix]="invFormData.accountDetails.currencySymbol + ' '"
                                                                [suffix]="transaction.rate === 0 ? '.00' + selectedSuffixForCurrency : selectedSuffixForCurrency"
                                                                [mask]="inputMaskFormat" [useMask]="true"
                                                                [(ngModel)]="transaction.rate" (change)="
                                                                    calculateStockEntryAmount(transaction);
                                                                    calculateWhenTrxAltered(entry, transaction)
                                                                "
                                                                [customDecimalPlaces]="highPrecisionRate"></text-field>
                                                        </div>
                                                        <!-- please add condition for show and hide -->
                                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                            <span>
                                                                <amount-field [amount]="
                                                                        transaction.rate * exchangeRate
                                                                            ? transaction.rate * exchangeRate
                                                                            : 0
                                                                    " [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency"
                                                                    [ratePrecision]="true">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td (click)="closeDiscountPopup(); closeTaxControlPopup()" [width]="hasStock ? '12%' : '16%'"> 
                                                    <div class="td-wrapper">
                                                        <div class="flex-fill">
                                                            <text-field (click)="transactionAmountClicked(transaction)"
                                                                [placeholder]="commonLocaleData?.app_amount"
                                                                [type]="'text'"
                                                                [cssClass]="'form-control mat-field-border text-right '"
                                                                [name]="'transaction.amount_' + entryIdx"
                                                                [prefix]="invFormData.accountDetails.currencySymbol + ' '"
                                                                [suffix]="transaction.amount === 0 ? '.00' + selectedSuffixForCurrency : selectedSuffixForCurrency"
                                                                [mask]="inputMaskFormat" 
                                                                [useMask]="true"
                                                                [(ngModel)]="transaction.amount"
                                                                (change)="
                                                                    calculateWhenTrxAltered(
                                                                        entry,
                                                                        transaction,
                                                                        true,
                                                                        $event
                                                                    )
                                                                " [readonly]="isEinvoiceGenerated">
                                                            </text-field>
                                                        </div>
                                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                            <span>
                                                                <amount-field [amount]="transaction.convertedAmount"
                                                                    [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td (click)="closeTaxControlPopup()" [width]="hasStock ? '9%' : '16%'" *ngIf="
                                                        !currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.discountAllowed
                                                    ">
                                                    <div class="td-wrapper">
                                                        <div class="text-right flex-fill">
                                                            <discount-control-component #discountComponent
                                                                [discountMenu]="false" [discountsList]="discountsList"
                                                                [discountPercentageModal]="
                                                                    entry.discountPercentageModal
                                                                " [discountFixedValueModal]="
                                                                    entry.discountFixedValueModal
                                                                " [discountAccountsDetails]="entry.discounts"
                                                                [discountSum]="entry.discountSum"
                                                                [showHeaderText]="false"
                                                                (hideOtherPopups)="closeTaxControlPopup()"
                                                                (discountTotalUpdated)="
                                                                    calculateWhenTrxAltered(
                                                                        entry,
                                                                        transaction,
                                                                        false,
                                                                        $event
                                                                    )
                                                                " [maskInput]="inputMaskFormat" [prefixInput]="
                                                                    invFormData.accountDetails.currencySymbol + ' '
                                                                " [suffixInput]="entry.discountSum === 0 ? '.00' + selectedSuffixForCurrency : selectedSuffixForCurrency"
                                                                [commonLocaleData]="commonLocaleData"
                                                                [readonly]="isEinvoiceGenerated">
                                                            </discount-control-component>
                                                        </div>
                                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                            <span>
                                                                <amount-field
                                                                    [amount]="entry.discountSum * exchangeRate"
                                                                    [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td (click)="closeDiscountPopup()" *ngIf="
                                                        !currentVoucherFormDetails ||
                                                        currentVoucherFormDetails?.taxesAllowed
                                                    " [width]="hasStock ? '12%' : '16%'">
                                                    <div class="td-wrapper">
                                                        <div class="text-right flex-fill">
                                                            <tax-control #taxControlComponent [taxes]="companyTaxesList"
                                                                [date]="entry?.entryDate" [taxRenderData]="entry.taxes"
                                                                [totalForTax]="transaction.taxableValue"
                                                                [applicableTaxes]="transaction.applicableTaxes"
                                                                [exceptTaxTypes]="exceptTaxTypes"
                                                                [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                                [showHeading]="false"
                                                                [rootClass]="'sales-invoice-table'" (selectedTaxEvent)="
                                                                    transaction.applicableTaxes = $event
                                                                " (taxAmountSumEvent)="
                                                                    calculateWhenTrxAltered(entry, transaction)
                                                                " (hideOtherPopups)="closeDiscountPopup()"
                                                                [maskInput]="inputMaskFormat" [prefixInput]="
                                                                    invFormData.accountDetails.currencySymbol + ' '
                                                                " [suffixInput]="transaction.taxableValue === 0 ? '.00' + selectedSuffixForCurrency : selectedSuffixForCurrency"
                                                                [readonly]="isEinvoiceGenerated">
                                                            </tax-control>
                                                        </div>
                                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                            <span>
                                                                <amount-field [amount]="
                                                                        (entry.taxSum + entry.cessSum) * exchangeRate
                                                                    " [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="position-relative item-tax"
                                                    (click)="closeDiscountPopup(); closeTaxControlPopup()" width="20%">
                                                    <div class="td-wrapper">
                                                        <div class="flex-fill">
                                                            <text-field [type]="'text'"
                                                                [cssClass]="'form-control mat-field-border text-right '"
                                                                [name]="'transaction.total_' + entryIdx"
                                                                [prefix]="invFormData.accountDetails.currencySymbol + ' '"
                                                                [suffix]="transaction.total === 0 ? '.00' + selectedSuffixForCurrency : selectedSuffixForCurrency"
                                                                [mask]="inputMaskFormat" [useMask]="true"
                                                                [allowDecimalDigitsOnly]="true"
                                                                [(ngModel)]="transaction.total" (change)="
                                                                    calculateTransactionValueInclusively(
                                                                        entry,
                                                                        transaction
                                                                    )
                                                                " [readonly]="isEinvoiceGenerated">
                                                            </text-field>
                                                            <div *ngIf="isTcsTdsApplicable" class="wrap-other-tax">
                                                                <mat-checkbox (keydown.enter)="$event.preventDefault()"
                                                                    *ngIf="!entry.isOtherTaxApplicable"
                                                                    [checked]="entry.isOtherTaxApplicable"
                                                                    color="primary"
                                                                    id="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                                    [(ngModel)]="entry.isOtherTaxApplicable" (change)="
                                                                        toggleOtherTaxesAsidePane(
                                                                            entry.isOtherTaxApplicable,
                                                                            entryIdx
                                                                        )
                                                                    " class="other-taxes-checkbox"
                                                                    name="entry.isOtherTaxApplicable_'+entryIdx"
                                                                    [disabled]="isEinvoiceGenerated">
                                                                </mat-checkbox>
                                                                <label for="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                                    *ngIf="!entry.isOtherTaxApplicable"
                                                                    class="other-tax-label font-15 align-middle"
                                                                    (click)="tcsTdsIndex = entryIdx">{{
                                                                    localeData?.other_tax }}</label>
                                                            </div>
                                                            <div *ngIf="entry.isOtherTaxApplicable" class="mr-t1">
                                                                <span>
                                                                    <div
                                                                        class="d-flex align-items-center justify-content-end">
                                                                        <span class="mr-r05">
                                                                            <a href="javascript:;"
                                                                                *ngIf="!isEinvoiceGenerated" (click)="
                                                                                    toggleOtherTaxesAsidePane(
                                                                                        true,
                                                                                        entryIdx
                                                                                    )
                                                                                ">
                                                                                <img src="{{
                                                                                        imgPath
                                                                                    }}edit-pencilicon.svg" />
                                                                            </a>
                                                                        </span>
                                                                        <text-field [readonly]="'disabled'" [cssClass]="
                                                                                'text-right form-control other-taxes-input w100'
                                                                            "
                                                                            [name]="'entry.otherTaxesSum_' + entryIdx"
                                                                            [prefix]="
                                                                                invFormData.accountDetails
                                                                                    .currencySymbol
                                                                            " [suffix]="selectedSuffixForCurrency"
                                                                            [mask]="inputMaskFormat" [useMask]="true"
                                                                            [(ngModel)]="entry.otherTaxSum"></text-field>
                                                                    </div>
                                                                    <p class="mr-r05 font-12 text-capitalize mr-b2">
                                                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                                    </p>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div *ngIf="
                                                                entry.isOtherTaxApplicable &&
                                                                isMulticurrencyAccount &&
                                                                entry.otherTaxModal?.appliedOtherTax?.name
                                                            " class="tax-in-currency">
                                                            <span>
                                                                <amount-field
                                                                    [amount]="entry.otherTaxSum * exchangeRate"
                                                                    [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                            <span>
                                                                <amount-field [amount]="transaction.convertedTotal"
                                                                    [currencySymbol]="baseCurrencySymbol"
                                                                    [currencyCode]="companyCurrency">
                                                                </amount-field>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="trash-icon-delete" *ngIf="!isEinvoiceGenerated" (click)="
                                                            removeTransaction(entryIdx);
                                                            $event.preventDefault();
                                                            $event.stopPropagation()
                                                        ">
                                                        <i class="icon-trash font-16 cursor-pointer delete-btn position-absolute"
                                                            [ngClass]="{ 'multi-currency': isMulticurrencyAccount }"></i>
                                                    </div>
                                                </td>
                                            </tr>
                                            <!-- endregion -->
                                            <!-- </ng-container> -->
                                        </ng-template>
                                    </table>
                                </div>
                                <!-- Add new row/line -->
                                <div class="text-blue mt-2 px-0" *ngIf="!isEinvoiceGenerated">
                                    <span class="cursor-pointer"
                                        (click)="$event?.stopPropagation(); addBlankRow(null)">{{
                                        localeData?.add_new_line }}</span>
                                    <span class="grey-color px-2">|</span>
                                    <span class="cursor-pointer" (click)="addBulkItems()">{{
                                        localeData?.add_bulk_entries
                                        }}</span>
                                </div>

                                <div class="vouchers-other-detail container-lg mt-4 px-0">
                                    <div class="row mx-0 row-gap-25">
                                        <div class="col-lg-8 col-md-7 col-12 px-0">
                                            <div class="container-md px-0">
                                                <div class="row row-gap">
                                                    <div class="col-12" *ngIf="
                                                            !hideDepositSection &&
                                                            (isSalesInvoice ||
                                                                currentVoucherFormDetails?.depositAllowed ||
                                                                (voucherApiVersion === 2 &&
                                                                    (isSalesInvoice ||
                                                                        isPurchaseInvoice ||
                                                                        isCreditNote ||
                                                                        isDebitNote ||
                                                                        isPendingVoucherType))) &&
                                                            !(
                                                                voucherApiVersion !== 2 &&
                                                                isPendingVoucherType &&
                                                                isCashInvoice
                                                            )
                                                        ">
                                                        <mat-card *ngIf="
                                                                ((isSalesInvoice ||
                                                                    isPurchaseInvoice ||
                                                                    isCreditNote ||
                                                                    isDebitNote) &&
                                                                    (isAccountHaveAdvanceReceipts ||
                                                                        isInvoiceAdjustedWithAdvanceReceipts)) ||
                                                                (!isUpdateMode &&
                                                                    (isSalesInvoice ||
                                                                        currentVoucherFormDetails?.depositAllowed))
                                                            ">
                                                            <mat-card-header>
                                                                <mat-card-title>
                                                                    <p class="font-16 mb-3">
                                                                        {{ localeData?.deposit }}
                                                                    </p>
                                                                </mat-card-title>
                                                            </mat-card-header>
                                                            <mat-card-content>
                                                                <div class="container px-0">
                                                                    <div class="row align-items-center">
                                                                        <div class="container">
                                                                            <div class="row align-items-center">
                                                                                <ng-container *ngIf="
                                                                                        !isUpdateMode &&
                                                                                        (isSalesInvoice ||
                                                                                            currentVoucherFormDetails?.depositAllowed)
                                                                                    ">
                                                                                    <div class="col" [ngClass]="{
                                                                                            'col-6': isCashInvoice
                                                                                        }">
                                                                                        <div class="payment-mode">
                                                                                            <dropdown-field
                                                                                                #depositDropdown
                                                                                                [cssClass]="
                                                                                                    'pull-right'
                                                                                                " [name]="
                                                                                                    'depositAccountUniqueName'
                                                                                                " [options]="
                                                                                                    bankAccounts$
                                                                                                        | async
                                                                                                " (selectedOption)="
                                                                                                    onSelectPaymentMode(
                                                                                                        $event
                                                                                                    )
                                                                                                " [placeholder]="
                                                                                                    commonLocaleData?.app_select_account
                                                                                                " (onClear)="
                                                                                                    depositAccountUniqueName =
                                                                                                        '';
                                                                                                    onSelectPaymentMode(
                                                                                                        $event,
                                                                                                        true
                                                                                                    )
                                                                                                " [defaultValue]="
                                                                                                    isCashInvoice
                                                                                                        ? selectedBankAccount
                                                                                                        : selectPaymentValue
                                                                                                " class="w-100">
                                                                                            </dropdown-field>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col payment-mode-amount"
                                                                                        *ngIf="
                                                                                            (isSalesInvoice ||
                                                                                                currentVoucherFormDetails?.depositAllowed) &&
                                                                                            !isCashInvoice
                                                                                        ">
                                                                                        <div class="payment-mode">
                                                                                            <input-field (change)="
                                                                                                    calculateBalanceDue();
                                                                                                    updateDepositAmount(
                                                                                                        $event?.target
                                                                                                            ?.value
                                                                                                    )
                                                                                                " [placeholder]="
                                                                                                    commonLocaleData?.app_amount
                                                                                                " [cssClass]="
                                                                                                    'amount-field due-amount-field text-right pull-right max-width-100 multicurrency-grandtotal'
                                                                                                " [name]="'dueAmount'"
                                                                                                [prefix]="
                                                                                                    depositCurrSymbol
                                                                                                " [suffix]="
                                                                                                    selectedSuffixForCurrency
                                                                                                "
                                                                                                [mask]="inputMaskFormat"
                                                                                                [useMask]="true"
                                                                                                [(ngModel)]="
                                                                                                    depositAmount
                                                                                                " [required]="
                                                                                                    depositAccountUniqueName
                                                                                                        ? true
                                                                                                        : false
                                                                                                " [type]="'text'"
                                                                                                [readonly]="
                                                                                                    isEinvoiceGenerated
                                                                                                "
                                                                                                class="w-100"></input-field>
                                                                                        </div>
                                                                                    </div>
                                                                                </ng-container>
                                                                                <div class="col" *ngIf="
                                                                                        (isSalesInvoice ||
                                                                                            isPurchaseInvoice ||
                                                                                            isCreditNote ||
                                                                                            isDebitNote ||
                                                                                            isPendingVoucherType) &&
                                                                                        (isAccountHaveAdvanceReceipts ||
                                                                                            isInvoiceAdjustedWithAdvanceReceipts)
                                                                                    ">
                                                                                    <div
                                                                                        class="d-flex align-items-center column-gap1 adjustment-height pd-b05">
                                                                                        <div class="clearfix mr-b1 text-left"
                                                                                            *ngIf="
                                                                                                voucherApiVersion !== 2
                                                                                            ">
                                                                                            <mat-radio-group
                                                                                                class="d-flex mb-2"
                                                                                                [(ngModel)]="
                                                                                                    isAdjustAmount
                                                                                                "
                                                                                                name="advanceReceipt">
                                                                                                <mat-radio-button
                                                                                                    color="primary"
                                                                                                    id="adjustAmountNo"
                                                                                                    [value]="false"
                                                                                                    (click)="
                                                                                                        clickAdjustAmount(
                                                                                                            false
                                                                                                        )
                                                                                                    " (change)="
                                                                                                        clickAdjustAmount(
                                                                                                            $event
                                                                                                        )
                                                                                                    ">
                                                                                                    {{
                                                                                                    commonLocaleData?.app_no
                                                                                                    }}
                                                                                                </mat-radio-button>
                                                                                                <mat-radio-button
                                                                                                    color="primary" id="sacCodeType{{
                                                                                                        entryIdx
                                                                                                    }}" [value]="true"
                                                                                                    (click)="
                                                                                                        clickAdjustAmount(
                                                                                                            true
                                                                                                        )
                                                                                                    " (change)="
                                                                                                        clickAdjustAmount(
                                                                                                            $event
                                                                                                        )
                                                                                                    ">
                                                                                                    {{
                                                                                                    commonLocaleData?.app_yes
                                                                                                    }}
                                                                                                </mat-radio-button>
                                                                                            </mat-radio-group>
                                                                                        </div>
                                                                                        <span>{{
                                                                                            localeData?.adjust_amount
                                                                                            }}</span>
                                                                                        <span class="text-gray">
                                                                                            <amount-field [amount]="
                                                                                                    adjustPaymentData.totalAdjustedAmount
                                                                                                        | replace
                                                                                                            : '-'
                                                                                                            : ''
                                                                                                " [currencySymbol]="
                                                                                                    isMulticurrencyAccount
                                                                                                        ? invFormData
                                                                                                              .accountDetails
                                                                                                              ?.currencySymbol
                                                                                                        : false
                                                                                                " [currencyCode]="
                                                                                                    isMulticurrencyAccount
                                                                                                        ? invFormData
                                                                                                              .accountDetails
                                                                                                              ?.currency
                                                                                                              ?.code
                                                                                                        : false
                                                                                                ">
                                                                                            </amount-field></span>
                                                                                        <a href="javascript:void(0)"
                                                                                            (click)="
                                                                                                clickAdjustAmount(true)
                                                                                            "
                                                                                            class="font-12 pl-0 color-primary"><i
                                                                                                class="icon-edit11"></i></a>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </mat-card-content>
                                                        </mat-card>
                                                    </div>
                                                    <div class="col-12 mt-3" *ngIf="
                                                            !currentVoucherFormDetails ||
                                                            currentVoucherFormDetails?.otherDetails
                                                        ">
                                                        <mat-accordion>
                                                            <mat-expansion-panel>
                                                                <mat-expansion-panel-header>
                                                                    <mat-panel-title>
                                                                        {{ commonLocaleData?.app_other_details }}
                                                                    </mat-panel-title>
                                                                </mat-expansion-panel-header>

                                                                <div class="row row-gap mx-0 px-2 pb-3">
                                                                    <div class="col-4 px-2">
                                                                        <giddh-datepicker
                                                                            (keydown.enter)="$event.preventDefault()"
                                                                            #shippingDate="ngModel" [placeholder]="
                                                                                templatePlaceholder?.shippedDateLabel
                                                                            " name="shippingDate" [(ngModel)]="
                                                                                invFormData.templateDetails.other
                                                                                    .shippingDate
                                                                            " [class.invalid-inp]="
                                                                                shippingDate.errors &&
                                                                                (shippingDate.dirty ||
                                                                                    shippingDate.touched)
                                                                            " [showToggleIcon]="false"
                                                                            [appearance]="'outline'">
                                                                        </giddh-datepicker>
                                                                    </div>
                                                                    <div class="col-4 px-2">
                                                                        <input-field [type]="'text'"
                                                                            [name]="'shippedVia'" [(ngModel)]="
                                                                                invFormData.templateDetails.other
                                                                                    .shippedVia
                                                                            " [placeholder]="
                                                                                templatePlaceholder?.shippedViaLabel ||
                                                                                localeData?.ship_via
                                                                            ">
                                                                        </input-field>
                                                                    </div>
                                                                    <div class="col-4 px-2">
                                                                        <input-field [type]="'text'" [(ngModel)]="
                                                                                invFormData.templateDetails.other
                                                                                    .trackingNumber
                                                                            " [placeholder]="
                                                                                templatePlaceholder?.trackingNumber ||
                                                                                localeData?.tracking_number
                                                                            " [name]="'trackingNumber'">
                                                                        </input-field>
                                                                    </div>
                                                                    <div class="col-4 px-2">
                                                                        <input-field [type]="'text'"
                                                                            [name]="'customField1'" [(ngModel)]="
                                                                                invFormData.templateDetails.other
                                                                                    .customField1
                                                                            " [placeholder]="
                                                                                templatePlaceholder?.customField1Label ||
                                                                                localeData?.field1
                                                                            ">
                                                                        </input-field>
                                                                    </div>
                                                                    <div class="col-4 px-2">
                                                                        <input-field [type]="'text'"
                                                                            [name]="'customField2'" [(ngModel)]="
                                                                                invFormData.templateDetails.other
                                                                                    .customField2
                                                                            " [placeholder]="
                                                                                templatePlaceholder?.customField2Label ||
                                                                                localeData?.field2
                                                                            ">
                                                                        </input-field>
                                                                    </div>
                                                                    <div class="col-4 px-2">
                                                                        <input-field [type]="'text'"
                                                                            [name]="'customField3'" [(ngModel)]="
                                                                                invFormData.templateDetails.other
                                                                                    .customField3
                                                                            " [placeholder]="
                                                                                templatePlaceholder?.customField3Label ||
                                                                                localeData?.field3
                                                                            ">
                                                                        </input-field>
                                                                    </div>
                                                                    <div class="col-12 px-2" *ngIf="!isPurchaseInvoice">
                                                                        <mat-form-field class="w-100"
                                                                            appearance="outline">
                                                                            <mat-label>{{
                                                                                commonLocaleData?.app_note
                                                                                }}</mat-label>
                                                                            <textarea matInput hasFocus
                                                                                #message2="hasFocus" [class.error-box]="
                                                                                    (invoiceForm?.controls)['message2']
                                                                                        ?.errors?.maxlength
                                                                                " name="message2" [maxlength]="
                                                                                    shouldApplyMaxLengthOnNotes &&
                                                                                    !showNotesAtLastPage
                                                                                        ? 200
                                                                                        : null
                                                                                " [(ngModel)]="
                                                                                    invFormData.templateDetails.other
                                                                                        .message2
                                                                                ">
                                                                            </textarea>
                                                                        </mat-form-field>
                                                                        <ng-container *ngIf="
                                                                                shouldApplyMaxLengthOnNotes &&
                                                                                invFormData?.templateDetails?.other
                                                                                    ?.message2?.length &&
                                                                                !showNotesAtLastPage &&
                                                                                (message2?.isFocused ||
                                                                                    (invoiceForm?.controls)['message2']
                                                                                        ?.errors?.maxlength)
                                                                            ">
                                                                            <span class="max-character-label">{{
                                                                                commonLocaleData?.app_characters_left
                                                                                }}:&nbsp;</span><span
                                                                                class="max-character-value">{{
                                                                                200 -
                                                                                invFormData?.templateDetails?.other
                                                                                ?.message2?.length
                                                                                }}</span>
                                                                        </ng-container>
                                                                    </div>
                                                                    <div class="col-12 px-2" *ngIf="
                                                                            currentVoucherFormDetails?.attachmentAllowed
                                                                        ">
                                                                        <ng-container *ngIf="!selectedFileName">
                                                                            <div class="vouchers-attachment mat-form-field-border d-flex align-items-center column-gap1 p-2"
                                                                                [matTooltip]="'No file chosen'"
                                                                                matTooltipPosition="right">
                                                                                <input type="file"
                                                                                    class="position-absolute"
                                                                                    name="invoiceFile" id="invoiceFile"
                                                                                    (change)="uploadFile()"
                                                                                    droppable="true" />
                                                                                <ng-container *ngIf="isFileUploading">
                                                                                    <mat-spinner
                                                                                        [diameter]="30"></mat-spinner>
                                                                                </ng-container>
                                                                                <ng-container *ngIf="!isFileUploading">
                                                                                    <div class="attachment-add-icon">
                                                                                        <i class="icon-add"></i>
                                                                                    </div>
                                                                                    <span
                                                                                        class="attachment-placeholder">Attach
                                                                                        File to voucher</span>
                                                                                </ng-container>
                                                                            </div>
                                                                        </ng-container>
                                                                        <ng-container
                                                                            *ngIf="!isFileUploading && selectedFileName">
                                                                            <div
                                                                                class="vouchers-attachment mat-form-field-border d-flex align-items-center column-gap1 p-2 text-success">
                                                                                <div class="attachment-add-icon">
                                                                                    <i class="icon-tick"></i>
                                                                                </div>
                                                                                <span class="attachment-placeholder">{{
                                                                                    selectedFileName
                                                                                    }}</span>
                                                                                <button mat-icon-button (click)="
                                                                                        deleteAttachementConfirmation()
                                                                                    "
                                                                                    class="ml-auto remove-attachment font-16">
                                                                                    <i class="icon-cross"></i>
                                                                                </button>
                                                                            </div>
                                                                        </ng-container>
                                                                    </div>
                                                                </div>
                                                            </mat-expansion-panel>
                                                        </mat-accordion>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-lg-4 col-md-5 col-12 px-0">
                                            <div class="row text-right row-gap total-amount-wrapper">
                                                <div class="col-7 pr-0">
                                                    {{ commonLocaleData?.app_total_amount }}
                                                </div>
                                                <div class="col-5">
                                                    <amount-field [amount]="invFormData?.voucherDetails?.subTotal"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currencySymbol
                                                                : false
                                                        " [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currency?.code
                                                                : false
                                                        ">
                                                    </amount-field>
                                                </div>
                                                <div class="col-7 pr-0">
                                                    {{ commonLocaleData?.app_discount }}
                                                </div>
                                                <div class="col-5">
                                                    <amount-field
                                                        [amount]="invFormData?.voucherDetails.totalDiscount * -1"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currencySymbol
                                                                : false
                                                        " [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currency?.code
                                                                : false
                                                        ">
                                                    </amount-field>
                                                </div>
                                                <div class="col-7 pr-0">
                                                    {{ commonLocaleData?.app_taxable_value }}
                                                </div>
                                                <div class="col-5">
                                                    <amount-field
                                                        [amount]="invFormData?.voucherDetails.totalTaxableValue"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currencySymbol
                                                                : false
                                                        " [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currency?.code
                                                                : false
                                                        ">
                                                    </amount-field>
                                                </div>
                                                <ng-container *ngIf="!excludeTax">
                                                    <div class="col-7 pr-0">
                                                        {{ commonLocaleData?.app_tax }}
                                                    </div>
                                                    <div class="col-5">
                                                        <amount-field
                                                            [amount]="invFormData?.voucherDetails.gstTaxesTotal"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData?.accountDetails?.currencySymbol
                                                                    : false
                                                            " [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData?.accountDetails?.currency?.code
                                                                    : false
                                                            ">
                                                        </amount-field>
                                                    </div>
                                                    <div class="col-7 pr-0">
                                                        {{ commonLocaleData?.app_cess }}
                                                    </div>
                                                    <div class="col-5">
                                                        <amount-field [amount]="invFormData?.voucherDetails.cessTotal"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData?.accountDetails?.currencySymbol
                                                                    : false
                                                            " [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData?.accountDetails?.currency?.code
                                                                    : false
                                                            ">
                                                        </amount-field>
                                                    </div>
                                                </ng-container>
                                                <ng-container *ngIf="calculatedRoundOff !== 0">
                                                    <div class="col-7 pr-0">
                                                        {{ commonLocaleData?.app_round_off }}
                                                    </div>
                                                    <div class="col-5">
                                                        <amount-field [amount]="calculatedRoundOff" [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData?.accountDetails?.currencySymbol
                                                                    : false
                                                            " [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData?.accountDetails?.currency?.code
                                                                    : false
                                                            ">
                                                        </amount-field>
                                                    </div>
                                                </ng-container>
                                                <div class="col-7 pr-0">
                                                    {{ commonLocaleData?.app_total }}
                                                    <span *ngIf="isMulticurrencyAccount">{{
                                                        invFormData.accountDetails.currencySymbol
                                                        }}</span>
                                                </div>
                                                <div class="col-5">
                                                    <amount-field [amount]="invFormData.voucherDetails.grandTotal"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData.accountDetails?.currencySymbol
                                                                : false
                                                        " [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData.accountDetails?.currency?.code
                                                                : false
                                                        ">
                                                    </amount-field>
                                                </div>
                                                <div class="col-7 pr-0 bigger-dollar blnc-due">
                                                    <ng-container *ngIf="
                                                            isSalesInvoice ||
                                                            (voucherApiVersion === 2 &&
                                                                (isPurchaseInvoice ||
                                                                    isCreditNote ||
                                                                    isDebitNote ||
                                                                    isPendingVoucherType))
                                                        ">
                                                        <strong>{{ localeData?.balance_due }}</strong>
                                                    </ng-container>
                                                </div>
                                                <div class="col-5">
                                                    <ng-container *ngIf="
                                                            isSalesInvoice ||
                                                            (voucherApiVersion === 2 &&
                                                                (isPurchaseInvoice ||
                                                                    isCreditNote ||
                                                                    isDebitNote ||
                                                                    isPendingVoucherType))
                                                        ">
                                                        <strong class="blnc-due-num">
                                                            <span *ngIf="isMulticurrencyAccount">{{
                                                                invFormData.accountDetails.currencySymbol
                                                                }}</span>
                                                            <ng-container
                                                                *ngIf="adjustPaymentData?.totalAdjustedAmount">
                                                                {{ adjustPaymentBalanceDueData | giddhCurrency }}
                                                            </ng-container>
                                                            <ng-container
                                                                *ngIf="!adjustPaymentData?.totalAdjustedAmount">
                                                                {{
                                                                invFormData.voucherDetails.balanceDue
                                                                | giddhCurrency
                                                                }}
                                                            </ng-container>
                                                        </strong>
                                                    </ng-container>
                                                </div>
                                                <ng-container *ngIf="isMulticurrencyAccount">
                                                    <div class="col-7 pr-0">
                                                        {{ commonLocaleData?.app_total }}
                                                        <span>{{ baseCurrencySymbol }}</span>
                                                    </div>
                                                    <div class="col-5">
                                                        <text-field #grandTotalInr [type]="'text'" [cssClass]="
                                                                'form-control mat-field-border multicurrency-grandtotal'
                                                            " [name]="'grandTotalMulDum'" [prefix]="baseCurrencySymbol"
                                                            [suffix]="selectedSuffixForCurrency"
                                                            [mask]="inputMaskFormat" [useMask]="true"
                                                            [(ngModel)]="grandTotalMulDum" (blur)="
                                                                updateExchangeRate(grandTotalInr?.value);
                                                                recalculateConvertedTotal()
                                                            " [readonly]="isEinvoiceGenerated"></text-field>
                                                    </div>
                                                </ng-container>
                                                <ng-container *ngIf="isTcsPresent">
                                                    <div class="col-7 pr-0">
                                                        {{ commonLocaleData?.app_tcs }}
                                                    </div>
                                                    <div class="col-5">
                                                        <amount-field [amount]="invFormData.voucherDetails.tcsTotal"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            " [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            ">
                                                        </amount-field>
                                                    </div>
                                                </ng-container>
                                                <ng-container *ngIf="isTdsPresent">
                                                    <div class="col-7 pr-0">
                                                        {{ commonLocaleData?.app_tds }}
                                                    </div>
                                                    <div class="col-5">
                                                        <amount-field [amount]="invFormData.voucherDetails.tdsTotal"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            " [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            ">
                                                        </amount-field>
                                                    </div>
                                                </ng-container>
                                                <ng-container *ngIf="isPurchaseInvoice && voucherApiVersion !== 2">
                                                    <div class="col-7 pr-0">
                                                        {{ localeData?.balance_due }}
                                                        <span *ngIf="isMulticurrencyAccount">{{
                                                            invFormData.accountDetails.currencySymbol
                                                            }}</span>
                                                    </div>
                                                    <div class="col-5">
                                                        {{ invFormData.voucherDetails.balanceDue | giddhCurrency }}
                                                    </div>
                                                </ng-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="vouchers-actions d-flex justify-content-end column-gap1 pd-t2 pd-b2 mt-4">
                                    <div class="pull-right pr update-mode d-flex d-flex column-gap15"
                                        *ngIf="!isUpdateMode">
                                        <button mat-stroked-button color="warn" (click)="resetInvoiceForm(invoiceForm)"
                                            class="d-inline-block">
                                            {{ commonLocaleData?.app_clear }}
                                        </button>
                                        <!-- region purchase invoice -->
                                        <span *ngIf="isPurchaseInvoice">
                                            <button mat-stroked-button color="primary" *ngIf="!isCompany" [disabled]="
                                                    isFileUploading ||
                                                    !hasVoucherEntry ||
                                                    (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                                    isMobileNumberInvalid
                                                " (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)">
                                                {{ commonLocaleData?.app_save }}
                                            </button>
                                        </span>
                                        <!-- endregion -->
                                        <!-- region non purchase -->
                                        <span class="d-flex column-gap15"
                                            *ngIf="!isPurchaseInvoice && !isProformaInvoice && !isEstimateInvoice">
                                            <button mat-stroked-button [disabled]="
                                                    !hasVoucherEntry ||
                                                    (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                                    isMobileNumberInvalid
                                                " (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, true)"
                                                *ngIf="!isCompany && isCustomerSelected && !isPendingVoucherType">
                                                {{ generateInvoiceText }}
                                                {{ localeData?.and_update_acc }}
                                            </button>
                                            <div *ngIf="!isCompany" class="d-inline-flex" [isDisabled]="
                                                    !hasVoucherEntry ||
                                                    (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                                    isMobileNumberInvalid
                                                ">
                                                <button mat-stroked-button [disabled]="
                                                        !hasVoucherEntry ||
                                                        (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                                        isMobileNumberInvalid
                                                    "
                                                    (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                                    class="generate-invoice">
                                                    {{ generateInvoiceText }}
                                                </button>
                                            </div>
                                            <ng-container *ngIf="!isCompany">
                                                <mat-menu #dropdownMenu="matMenu" class="bottom-dropdown-menu"
                                                    yPosition="above">
                                                    <mat-list>
                                                        <mat-list-item>
                                                            <a class="dropdown-item cp font-14" (click)="
                                                                    doAction(2);
                                                                    triggerSubmitInvoiceForm(invoiceForm, false)
                                                                ">{{ localeData?.create_send }}</a>
                                                        </mat-list-item>
                                                        <mat-list-item>
                                                            <a class="dropdown-item cp font-14" (click)="
                                                                    doAction(3);
                                                                    triggerSubmitInvoiceForm(invoiceForm, false)
                                                                ">{{ localeData?.create_print }}</a>
                                                        </mat-list-item>
                                                        <mat-list-item *ngIf="voucherApiVersion !== 2">
                                                            <a class="dropdown-item cp font-14" (click)="
                                                                    doAction(4);
                                                                    triggerSubmitInvoiceForm(invoiceForm, false)
                                                                ">{{ localeData?.generate_recurring }}</a>
                                                        </mat-list-item>
                                                    </mat-list>
                                                </mat-menu>
                                                <button [matMenuTriggerFor]="dropdownMenu" id="button-dropup"
                                                    *ngIf="invoiceType === 'sales'" mat-stroked-button
                                                    class="min-width-auto">
                                                    <span class="caret"></span>
                                                </button>
                                            </ng-container>
                                        </span>
                                        <!-- endregion -->
                                        <!-- region proforma/estimates -->
                                        <span class="d-flex column-gap15"
                                            *ngIf="!isCompany && (isProformaInvoice || isEstimateInvoice)">
                                            <div class="d-inline-flex column-gap15" [isDisabled]="
                                                    !hasVoucherEntry ||
                                                    (invoiceForm?.controls)['message2']?.errors?.maxlength
                                                ">
                                                <button *ngIf="!isCompany" mat-stroked-button [disabled]="
                                                        !hasVoucherEntry ||
                                                        (invoiceForm?.controls)['message2']?.errors?.maxlength
                                                    "
                                                    (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                                    class="h3">
                                                    {{ commonLocaleData?.app_create }}
                                                </button>
                                                <button [matMenuTriggerFor]="dropdownMenu2" id="button-dropup"
                                                    mat-stroked-button class="min-width-auto dropdown-toggle-split">
                                                    <span class="caret"></span>
                                                </button>
                                                <mat-menu #dropdownMenu2="matMenu" class="bottom-dropdown-menu"
                                                    yPosition="above">
                                                    <mat-list>
                                                        <mat-list-item>
                                                            <a class="dropdown-item cp font-14" (click)="
                                                                    doAction(2);
                                                                    triggerSubmitInvoiceForm(invoiceForm, false)
                                                                ">{{ localeData?.create_send }}</a></mat-list-item>
                                                        <mat-list-item>
                                                            <a class="dropdown-item cp font-14" (click)="
                                                                    doAction(3);
                                                                    triggerSubmitInvoiceForm(invoiceForm, false)
                                                                ">{{ localeData?.create_print }}</a>
                                                        </mat-list-item>
                                                    </mat-list>
                                                </mat-menu>
                                            </div>
                                        </span>
                                        <!-- endregion -->
                                    </div>
                                    <!-- endregion -->
                                    <!-- region update mode -->
                                    <div class="pull-right pr d-flex column-gap15" *ngIf="isUpdateMode">
                                        <button mat-stroked-button class="d-inline-block" (click)="cancelUpdate()">
                                            {{ commonLocaleData?.app_cancel }}
                                        </button>
                                        <button *ngIf="!isCompany" mat-stroked-button color="primary" [disabled]="
                                                isFileUploading ||
                                                !hasVoucherEntry ||
                                                (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                                isMobileNumberInvalid
                                            " (click)="submitUpdateForm(invoiceForm)">
                                            {{ updateInvoiceText }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </mat-card-content>
        </mat-card>
    </div>

    <div class="aside-overlay" *ngIf="
            accountAsideMenuState === 'in' ||
            asideMenuStateForRecurringEntry === 'in' ||
            asideMenuStateForOtherTaxes === 'in'
        " (click)="closeAsideMenuStateForOtherTaxes()"></div>
    <generic-aside-menu-account [class]="accountAsideMenuState" [@slideInOut]="accountAsideMenuState"
        (closeAsideEvent)="toggleAccountAsidePane($event)"
        [selectedGrpUniqueName]="selectedGrpUniqueNameForAddEditAccountModal"
        [keyboardShortcut]="{ 'esc': accountAsideMenuState === 'in' && !hasUnsavedChanges }"
        *ngIf="accountAsideMenuState === 'in'" [selectedAccountUniqueName]="selectedCustomerForDetails"
        (onShortcutPress)="toggleAccountAsidePane()" (addEvent)="addNewSidebarAccount($event)"
        (updateEvent)="updateSidebarAccount($event)">
    </generic-aside-menu-account>
    <!--&lt;!&ndash; open product service aside &ndash;&gt;-->
    <ng-template #asideMenuProductService>
        <aside-menu-product-service [selectedVoucherType]="selectedVoucherType"
            (closeAsideEvent)="closeAsideMenuProductServiceModal()">
        </aside-menu-product-service>
    </ng-template>
    <app-aside-recurring-entry *ngIf="asideMenuStateForRecurringEntry === 'in'" [voucherType]="invoiceType"
        [voucherNumber]="voucherNumber" [class]="asideMenuStateForRecurringEntry"
        [@slideInOut]="asideMenuStateForRecurringEntry" (closeAsideEvent)="toggleRecurringAsidePane('out')">
    </app-aside-recurring-entry>
    <!-- region send email popup -->
    <ng-template #sendEmailModal>
        <ng-container *ngIf="actionAfterGenerateORUpdate === 2">
            <app-send-email-invoice-component [voucherType]="invoiceType" (successEvent)="sendEmail($event)"
                [selectedItem]="{
                    voucherNumber: invoiceNo,
                    uniqueName: accountUniqueName,
                    account: customerAccount,
                    voucherUniqueName: newVoucherUniqueName
                }" (cancelEvent)="cancelEmailModal()"></app-send-email-invoice-component>
        </ng-container>
    </ng-template>
    <!-- endregion -->
    <div id="top0">
        <app-aside-menu-other-taxes *ngIf="asideMenuStateForOtherTaxes === 'in'" [class]="asideMenuStateForOtherTaxes"
            [taxes]="companyTaxesList" [otherTaxesModal]="activeEntry.otherTaxModal"
            [commonLocaleData]="commonLocaleData" [@slideInOut]="asideMenuStateForOtherTaxes"
            (closeModal)="closeAsideMenuStateForOtherTaxes()" (applyTaxes)="
                calculateOtherTaxes($event, activeEntry);
                toggleOtherTaxesAsidePane(true, null);
                calculateAffectedThingsFromOtherTaxChanges()
            ">
        </app-aside-menu-other-taxes>
    </div>
    <!-- region print voucher popup -->
    <ng-template #printVoucherModal>
        <ng-container *ngIf="actionAfterGenerateORUpdate === 3 && invoiceNo && accountUniqueName">
            <voucher-print-in-place-component [voucherType]="invoiceType" [localeData]="localeData"
                [commonLocaleData]="commonLocaleData" [selectedItem]="{
                    voucherNumber: invoiceNo,
                    uniqueName: accountUniqueName,
                    voucherUniqueName: newVoucherUniqueName
                }" (cancelEvent)="cancelPrintModal()"></voucher-print-in-place-component>
        </ng-container>
    </ng-template>
    <!-- common template ref for displaying invoice type with first letter capital -->
    <ng-template #invoiceTypeDisplayRef>
        {{ getInvoiceType() | titlecase }}
    </ng-template>
    <!-- region purchase  order  popup -->
    <ng-template #purchaseRecordConfirmationPopup>
        <confirmation-modal [configuration]="purchaseRecordConfirmationConfiguration"
            (buttonClicked)="handlePurchaseRecordConfirmation($event)"></confirmation-modal>
    </ng-template>
    <!-- region bulk items -->
    <ng-template #bulkItemsModal>
        <voucher-add-bulk-items-component [invoiceType]="invoiceType"
            [accountUniqueName]="invFormData.accountDetails.uniqueName" (saveItemsEvent)="addBulkStockItems($event)"
            (closeEvent)="cancelBulkItemsModal()"></voucher-add-bulk-items-component>
    </ng-template>
    <!-- region  adjust payment  popup -->
    <ng-template #adjustPaymentModal>
        <advance-receipt-adjustment-component *ngIf="showAdvanceReceiptAdjust" #advanceReceiptComponent
            [adjustedVoucherType]="voucherApiVersion === 2 && isPendingVoucherType ? invoiceType : selectedVoucherType"
            [isUpdateMode]="isUpdateMode" [depositAmount]="depositAmount" [invoiceFormDetails]="invFormData"
            [isVoucherModule]="voucherApiVersion !== 2"
            [advanceReceiptAdjustmentUpdatedData]="advanceReceiptAdjustmentData"
            (closeModelEvent)="closeAdvanceReceiptModal()" (submitClicked)="getAdvanceReceiptAdjustData($event)"
            [voucherForAdjustment]="voucherForAdjustment">
        </advance-receipt-adjustment-component>
    </ng-template>
    <!-- region  date change confirmation popup -->
    <ng-template #dateChangeConfirmationModel>
        <confirmation-modal [configuration]="dateChangeConfiguration"
            (buttonClicked)="handleDateChangeConfirmation($event)"></confirmation-modal>
    </ng-template>
    <!-- region  delete attachment confirmation popup -->
    <ng-template #attachmentDeleteConfirmationModel>
        <confirmation-modal (buttonClicked)="handleAttachmentDelete($event)"
            [configuration]="attachmentDeleteConfiguration"></confirmation-modal>
    </ng-template>
</ng-container>