<ng-container
    appTranslate
    [file]="'proforma-invoice'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
    (translationComplete)="translationComplete($event)"
>
    <giddh-page-loader *ngIf="showLoader"></giddh-page-loader>
    <div [ngStyle]="{ 'display': !showLoader ? 'block' : 'none' }">
        <!-- region page change menu -->
        <div class="d-flex border-bottom mobile-view-padding">
            <hamburger-menu
                [pageHeading]="(isCashInvoice ? localeData?.invoice_types?.cash : getInvoiceType()) | titlecase"
            >
            </hamburger-menu>
            <div class="form-group mr-b05 clearfix pro-invoice-heading">
                <div class="clearfix">
                    <div class="btn-group proforma-sales-time" dropdown>
                        <button
                            id="giddh-page-heading-link"
                            dropdownToggle
                            type="button"
                            class="btn more-btn-dropdown dropdown-toggle"
                            aria-controls="dropdown-basic"
                            *ngIf="!isUpdateMode"
                        >
                            <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                {{ localeData?.invoice_types?.cash }}
                            </span>

                            <small *ngIf="invoiceType === 'estimates'"> ({{ commonLocaleData?.app_beta }}) </small>
                            <span class="caret"></span>
                        </button>
                        <button
                            id="giddh-page-heading-link"
                            type="button"
                            class="btn more-btn-dropdown dropdown-toggle"
                            aria-controls="dropdown-basic"
                            *ngIf="isUpdateMode"
                        >
                            <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                {{ localeData?.invoice_types?.cash }}
                            </span>

                            <small *ngIf="invoiceType === 'estimates'"> ({{ commonLocaleData?.app_beta }}) </small>
                            <span class="caret" *ngIf="!isUpdateMode"></span>
                        </button>

                        <ng-container *ngIf="!isUpdateMode">
                            <ul
                                id="dropdown1-basic"
                                *dropdownMenu
                                class="dropdown-menu"
                                role="menu"
                                aria-labelledby="button-basic"
                            >
                                <li
                                    role="menuitem"
                                    (click)="pageChanged(item.value, item.additional.label)"
                                    *ngFor="let item of pageList"
                                >
                                    <a class="dropdown-item cp">{{ item.additional?.label }}</a>
                                </li>
                            </ul>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>

        <!-- endregion -->

        <!-- region update mode loader-->
        <ng-container *ngIf="isUpdateDataInProcess">
            <div class="loader-class">
                <giddh-page-loader></giddh-page-loader>
            </div>
        </ng-container>
        <!--endregion-->
        <!-- region main form -->
        <div
            [hidden]="(isUpdateMode && isUpdateDataInProcess) || (isLastInvoiceCopied && isUpdateDataInProcess)"
            id="button-focus-proforma"
        >
            <form
                #invoiceForm="ngForm"
                novalidate
                autocomplete="off"
                [ngClass]="{
                    'customer-invoice-form':
                        !invFormData.voucherDetails.customerName && !invFormData.voucherDetails.customerUniquename,
                    'customer-invoice-form-purchase': isPurchaseInvoice || isCreditNote || isDebitNote,
                    'sales-proforma-estimate': isSalesInvoice || isProformaInvoice || isEstimateInvoice,
                    'for-multi-currency': isMulticurrencyAccount
                }"
            >
                <div class="clearfix" [keyboardShortcut]="'alt+c'" (onShortcutPress)="addAccountFromShortcut()">
                    <div class="clearfix wrapper-customer-table pd-t15">
                        <!-- region customer and address section -->
                        <div class="customer-invoice-table">
                            <div class="inner-container">
                                <div
                                    class="show-on-small-screen"
                                    [ngClass]="{ 'pending-sales-balance-due': isPendingSales }"
                                    *ngIf="
                                        isSalesInvoice ||
                                        isProformaInvoice ||
                                        isEstimateInvoice ||
                                        (voucherApiVersion === 2 &&
                                            isPurchaseInvoice &&
                                            !isCashInvoice &&
                                            !isCashBankAccount)
                                    "
                                >
                                    <div class="text-right">
                                        <p class="font-20 b pb-r1">
                                            <span class="balance-due">{{
                                                isProformaInvoice || isEstimateInvoice
                                                    ? commonLocaleData?.app_total_amount
                                                    : localeData?.balance_due
                                            }}</span>

                                            <span
                                                class="sp-rupees d-flex justify-content-end"
                                                *ngIf="isMulticurrencyAccount"
                                            >
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.balanceDue"
                                                    [currencySymbol]="invFormData.accountDetails?.currencySymbol"
                                                    [currencyCode]="invFormData.accountDetails?.currency?.code"
                                                >
                                                </amount-field>
                                            </span>

                                            <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                            <span
                                                class="sp-rupees d-flex justify-content-end"
                                                *ngIf="isMulticurrencyAccount"
                                            >
                                                <amount-field
                                                    [amount]="
                                                        enableVoucherAdjustmentMultiCurrency && isSalesInvoice
                                                            ? getConvertedBalanceDue()
                                                            : invFormData.voucherDetails.convertedBalanceDue
                                                    "
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>

                                            <span
                                                class="sp-rupees d-flex justify-content-end"
                                                *ngIf="!isMulticurrencyAccount"
                                            >
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.balanceDue"
                                                    [currencySymbol]="false"
                                                    [currencyCode]="false"
                                                >
                                                </amount-field>
                                            </span>
                                        </p>
                                    </div>
                                </div>

                                <!-- region customer section -->
                                <div class="clearfix">
                                    <div class="row">
                                        <!-- region customer name -->
                                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                            <label
                                                >{{
                                                    !isPurchaseInvoice && !isDebitNote
                                                        ? localeData?.customer_name
                                                        : commonLocaleData?.app_vendor_name
                                                }}<span class="red-text">*</span></label
                                            >
                                        </div>
                                        <!-- endregion -->

                                        <!-- region customer dropdown -->
                                        <div
                                            class="col-sm-12 col-xl-7 col-lg-8 col-md-9 col-xs-12 select-customers-name"
                                        >
                                            <div class="clearfix d-flex flex-column">
                                                <div class="d-flex">
                                                    <!-- region if not cashinvoice show customer dropdown -->
                                                    <ng-container *ngIf="!isCashInvoice">
                                                        <select-field
                                                            [cssClass]="
                                                                'form-control mat-field-border customer-dropdown'
                                                            "
                                                            [name]="'voucherDetails.customerName'"
                                                            [placeholder]="customerPlaceHolder"
                                                            [options]="customerAcList$ | async"
                                                            [openDropdown]="openProductSelectionDropdown"
                                                            (selectedOption)="onSelectCustomer($event)"
                                                            (createOption)="addNewAccount()"
                                                            [disabled]="
                                                                isUpdateMode &&
                                                                invoiceType !== 'sales' &&
                                                                invoiceType !== 'cash' &&
                                                                invoiceType !== 'purchase' &&
                                                                (voucherApiVersion === 1 ||
                                                                    (voucherApiVersion === 2 &&
                                                                        invoiceType !== 'debit note' &&
                                                                        invoiceType !== 'credit note'))
                                                            "
                                                            [defaultValue]="invFormData.voucherDetails.customerName"
                                                            [createNewText]="customerNotFoundText"
                                                            [enableDynamicSearch]="true"
                                                            [showValueInLabel]="true"
                                                            (dynamicSearchedQuery)="
                                                                onSearchQueryChanged($event, 1, 'customer')
                                                            "
                                                            [allowValueReset]="true"
                                                            (onClear)="resetCustomerName($event)"
                                                        >
                                                        </select-field>
                                                    </ng-container>
                                                    <!-- endregion -->
                                                    <!-- region if not cashinvoice show customer dropdown -->
                                                    <ng-container *ngIf="isCashInvoice">
                                                        <text-field
                                                            type="text"
                                                            name="voucherDetails.customerName"
                                                            [autoFocus]="true"
                                                            #inputCustomerName
                                                            [cssClass]="
                                                                'form-control mat-field-border cash-invoice-input'
                                                            "
                                                            [(ngModel)]="invFormData.voucherDetails.customerName"
                                                            (change)="handleCustomerChange($event)"
                                                            [readOnly]="
                                                                isUpdateMode &&
                                                                invoiceType !== 'sales' &&
                                                                invoiceType !== 'cash'
                                                            "
                                                        ></text-field>
                                                    </ng-container>
                                                    <!-- endregion -->

                                                    <!-- region previous details commented for multicurrency changes-->
                                                    <div
                                                        class="d-flex cp aqua-color align-items-center ml-3"
                                                        #copyPreviousEstimate
                                                        *ngIf="
                                                            !isPurchaseInvoice &&
                                                            ((voucherApiVersion === 2 &&
                                                                !isPendingVoucherType &&
                                                                !isCashInvoice) ||
                                                                (voucherApiVersion !== 2 &&
                                                                    !(isPendingVoucherType && isCashInvoice))) &&
                                                            (invFormData.voucherDetails.customerName ||
                                                                invFormData.voucherDetails.customerUniquename) &&
                                                            lastInvoices.length &&
                                                            !isUpdateMode
                                                        "
                                                    >
                                                        <a href="javascript:;" [matMenuTriggerFor]="menu">
                                                            <i class="icon-copy-file"></i> {{ copyPreviousInvoiceText }}
                                                        </a>
                                                        <div class="previous-estimate-wrapper">
                                                            <mat-menu #menu="matMenu" class="copy-invoice-menu">
                                                                <button
                                                                    mat-menu-item
                                                                    *ngFor="let item of lastInvoices"
                                                                    (click)="copyInvoice(item)"
                                                                    class="line-height-initial"
                                                                >
                                                                    <div class="pd">
                                                                        <div class="d-flex flex-column">
                                                                            <div class="d-flex justify-content-between">
                                                                                <span>{{ item?.versionNumber }}</span>
                                                                                <span>{{
                                                                                    item?.grandTotal?.amountForAccount
                                                                                }}</span>
                                                                            </div>
                                                                            <span
                                                                                >{{ item?.date }} (
                                                                                {{ item?.account?.name }} )</span
                                                                            >
                                                                        </div>
                                                                    </div>
                                                                </button>
                                                            </mat-menu>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                </div>
                                                <!-- region Unregistered Business / customer details -->
                                                <div
                                                    class="d-flex aqua-color"
                                                    *ngIf="invFormData.voucherDetails.customerName"
                                                >
                                                    <ng-container
                                                        *ngTemplateOutlet="
                                                            gstTreatmentModal;
                                                            context: { $implicit: showGstTreatmentModal }
                                                        "
                                                    >
                                                    </ng-container>

                                                    <span
                                                        class="cp aqua-color mr-r05"
                                                        *ngIf="!isCashInvoice && !isUpdateMode"
                                                    >
                                                        <a href="javascript:void(0)" (click)="getCustomerDetails()">{{
                                                            !isPurchaseInvoice
                                                                ? localeData?.customer_details
                                                                : localeData?.vendor_details
                                                        }}</a>
                                                    </span>
                                                </div>
                                                <!-- endregion -->
                                            </div>
                                            <!-- region search_customer image -->
                                            <ng-container *ngIf="isSalesInvoice && !isCashInvoice">
                                                <img
                                                    src="assets/images/new/search_customer.svg"
                                                    class="img-responsive search-arrow-image"
                                                    *ngIf="!invFormData.voucherDetails.customerName"
                                                />
                                            </ng-container>

                                            <!-- need to show this image on purchase invoice module -->
                                            <ng-container *ngIf="isPurchaseInvoice">
                                                <img
                                                    src="assets/images/new/search-vendor.svg"
                                                    class="img-responsive search-arrow-image"
                                                    *ngIf="!invFormData.voucherDetails.customerName"
                                                />
                                            </ng-container>

                                            <ng-container *ngIf="isCashInvoice">
                                                <img
                                                    src="assets/images/new/search_customer_Cash Invoice.svg"
                                                    class="img-responsive cash-invoice-tip-img search-arrow-image"
                                                    *ngIf="!invFormData.voucherDetails.customerName"
                                                />
                                            </ng-container>
                                            <!-- endregion -->
                                        </div>
                                        <!-- endregion -->
                                    </div>
                                </div>
                                <!-- endregion -->

                                <!-- region customer address section -->
                                <div
                                    class="row"
                                    *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.addressAllowed"
                                >
                                    <div
                                        class="col-sm-12 col-xl-9 offset-lg-3 col-lg-8 col-md-9 offset-xl-2 offset-md-3"
                                    >
                                        <ng-container>
                                            <section
                                                [ngClass]="{
                                                    'billing-address-wrap': !invFormData.voucherDetails.customerName
                                                }"
                                            >
                                                <div class="wrap-billing-address clearfix w-100">
                                                    <div class="row">
                                                        <!-- region billing address -->
                                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                            <div class="form-group">
                                                                <div class="d-flex align-items-center pb-1">
                                                                    <span class="pb-0 pd-r15">{{
                                                                        localeData?.billing_address
                                                                    }}</span>
                                                                    <span>
                                                                        <div
                                                                            class="
                                                                                btn-group btn-block
                                                                                change-address-dropdown
                                                                            "
                                                                            [attachOutsideOnClick]="true"
                                                                            *ngIf="accountAddressList?.length > 1"
                                                                        >
                                                                            <a
                                                                                [matMenuTriggerFor]="
                                                                                    changeBillingAddress
                                                                                "
                                                                                class="dropdown-toggle cp"
                                                                            >
                                                                                {{ localeData?.change }}</a
                                                                            >
                                                                            <mat-menu #changeBillingAddress="matMenu">
                                                                                <a
                                                                                    mat-menu-item
                                                                                    disableRipple="true"
                                                                                    class="
                                                                                        d-flex
                                                                                        flex-column
                                                                                        justify-content-center
                                                                                        line-height-initial
                                                                                    "
                                                                                    *ngFor="
                                                                                        let address of accountAddressList
                                                                                    "
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            invFormData.accountDetails
                                                                                                .billingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    {{ address.address }}
                                                                                    {{ address.state?.name }}
                                                                                    <p class="font-12">
                                                                                        {{
                                                                                            address.gstNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.gstNumber
                                                                                                : ""
                                                                                        }}
                                                                                    </p>
                                                                                </a>
                                                                            </mat-menu>
                                                                        </div>
                                                                    </span>
                                                                </div>
                                                                <div class="billing-address clearfix">
                                                                    <textarea
                                                                        matInput
                                                                        name="billingDetails.address"
                                                                        class="form-control"
                                                                        (keyup)="autoFillShippingDetails()"
                                                                        rows="3"
                                                                        autocomplete="off"
                                                                        [(ngModel)]="
                                                                            invFormData.accountDetails.billingDetails
                                                                                .address[0]
                                                                        "
                                                                        autofocus="off"
                                                                        aria-autocomplete="none"
                                                                        #customerBillingAddress
                                                                    ></textarea>

                                                                    <div class="row">
                                                                        <div class="col-sm-12 col-md-6">
                                                                            <label class="sales-country-label">
                                                                                {{ customerCountryName }}
                                                                            </label>
                                                                        </div>
                                                                        <div
                                                                            class="col-sm-12 col-md-6 billingStateOnly"
                                                                            #billingState
                                                                        >
                                                                            <select-field
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_state
                                                                                "
                                                                                [cssClass]="'form-control input-custom'"
                                                                                (selectedOption)="
                                                                                    fillShippingBillingDetails(
                                                                                        $event,
                                                                                        true
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                                #statesBilling
                                                                                [options]="statesSource"
                                                                                [name]="'billingDetails.stateCode'"
                                                                                [allowValueReset]="true"
                                                                                [defaultValue]="
                                                                                    invFormData?.accountDetails
                                                                                        ?.billingDetails?.state?.name
                                                                                "
                                                                                (onClear)="
                                                                                    fillShippingBillingDetails(
                                                                                        $event,
                                                                                        true
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                            >
                                                                            </select-field>
                                                                        </div>
                                                                        <div
                                                                            class="col-sm-6 col-md-6"
                                                                            *ngIf="shouldShowTrnGstField"
                                                                        >
                                                                            <text-field
                                                                                [maxlength]="15"
                                                                                autocomplete="None"
                                                                                type="text"
                                                                                [name]="'billingDetails.gstNumber'"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                *ngIf="showGSTINNo"
                                                                                [(ngModel)]="
                                                                                    invFormData.accountDetails
                                                                                        .billingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'billingDetails',
                                                                                        statesBilling
                                                                                    )
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_gstin
                                                                                "
                                                                                (input)="autoFillShippingDetails()"
                                                                            >
                                                                            </text-field>
                                                                            <text-field
                                                                                [maxlength]="15"
                                                                                autocomplete="None"
                                                                                [type]="'text'"
                                                                                [name]="'billingDetails.gstNumber'"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                *ngIf="showTRNNo"
                                                                                [(ngModel)]="
                                                                                    invFormData.accountDetails
                                                                                        .billingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'billingDetails',
                                                                                        statesBilling
                                                                                    )
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_trn
                                                                                "
                                                                                (input)="autoFillShippingDetails()"
                                                                            >
                                                                            </text-field>
                                                                        </div>
                                                                        <!-- static pin code  -->
                                                                        <div
                                                                            [ngClass]="{
                                                                                'col-sm-6 col-md-6':
                                                                                    showGSTINNo || showTRNNo,
                                                                                'col-sm-12 col-md-12': !(
                                                                                    showGSTINNo || showTRNNo
                                                                                )
                                                                            }"
                                                                        >
                                                                            <div class="form-group mr-b05">
                                                                                <text-field
                                                                                    [type]="'number'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    autocomplete="false"
                                                                                    [name]="'billingPinCode'"
                                                                                    (input)="autoFillShippingDetails()"
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_pin_code
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        invFormData.accountDetails
                                                                                            .billingDetails.pincode
                                                                                    "
                                                                                    [allowDecimalDigitsOnly]="true"
                                                                                >
                                                                                </text-field>
                                                                            </div>
                                                                        </div>
                                                                        <!-- static pin code end-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->

                                                        <!-- region shipping address -->
                                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                            <div class="form-group p-0 width-100">
                                                                <div class="d-flex align-items-center pb-1">
                                                                    <span class="pb-0 pd-r15">
                                                                        <mat-checkbox
                                                                            (change)="autoFillShippingDetails()"
                                                                            name="autoFillShipping"
                                                                            color="primary"
                                                                            class="auto-fill-shipping-address"
                                                                            [ngModelOptions]="{ standalone: true }"
                                                                            [(ngModel)]="autoFillShipping"
                                                                        >
                                                                            {{ localeData?.shipping_billing_same }}
                                                                        </mat-checkbox>
                                                                    </span>
                                                                    <span>
                                                                        <div
                                                                            class="
                                                                                btn-group btn-block
                                                                                change-address-dropdown
                                                                            "
                                                                            [attachOutsideOnClick]="true"
                                                                            *ngIf="
                                                                                accountAddressList?.length > 1 &&
                                                                                !autoFillShipping
                                                                            "
                                                                        >
                                                                            <a
                                                                                [matMenuTriggerFor]="
                                                                                    shippingBillingAddressSame
                                                                                "
                                                                                class="dropdown-toggle cp"
                                                                            >
                                                                                {{ localeData?.change }}</a
                                                                            >
                                                                            <mat-menu
                                                                                #shippingBillingAddressSame="matMenu"
                                                                            >
                                                                                <a
                                                                                    mat-menu-item
                                                                                    disableRipple="true"
                                                                                    class="
                                                                                        d-flex
                                                                                        flex-column
                                                                                        justify-content-center
                                                                                        line-height-initial
                                                                                    "
                                                                                    *ngFor="
                                                                                        let address of accountAddressList
                                                                                    "
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            invFormData.accountDetails
                                                                                                .shippingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    {{ address.address }}
                                                                                    {{ address.state?.name }}

                                                                                    <p class="font-12">
                                                                                        {{
                                                                                            address.gstNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.gstNumber
                                                                                                : ""
                                                                                        }}
                                                                                    </p>
                                                                                </a>
                                                                            </mat-menu>
                                                                        </div>
                                                                    </span>
                                                                </div>
                                                                <div
                                                                    class="billing-address"
                                                                    [ngClass]="{ 'disabled': autoFillShipping }"
                                                                >
                                                                    <textarea
                                                                        matInput
                                                                        [readonly]="autoFillShipping"
                                                                        name="shippingDetails.address"
                                                                        class="form-control"
                                                                        [(ngModel)]="
                                                                            invFormData.accountDetails.shippingDetails
                                                                                .address[0]
                                                                        "
                                                                        rows="3"
                                                                        autocomplete="off"
                                                                    ></textarea>

                                                                    <div class="clearfix form-group mb-0">
                                                                        <div class="row">
                                                                            <div class="col-sm-12 col-md-6">
                                                                                <div class="form-group mb-0">
                                                                                    <label class="sales-country-label">
                                                                                        {{ customerCountryName }}
                                                                                    </label>
                                                                                </div>
                                                                            </div>

                                                                            <div
                                                                                class="
                                                                                    col-sm-12 col-md-6
                                                                                    billingStateOnly
                                                                                "
                                                                                #shippingState
                                                                            >
                                                                                <select-field
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_state
                                                                                    "
                                                                                    [cssClass]="'select-bdr-bottom'"
                                                                                    #statesShipping
                                                                                    (selectedOption)="
                                                                                        fillShippingBillingDetails(
                                                                                            $event,
                                                                                            false
                                                                                        )
                                                                                    "
                                                                                    [options]="statesSource"
                                                                                    [name]="'shippingDetails.stateCode'"
                                                                                    [allowValueReset]="true"
                                                                                    [defaultValue]="
                                                                                        invFormData?.accountDetails
                                                                                            ?.shippingDetails?.state
                                                                                            ?.name
                                                                                    "
                                                                                    (onClear)="
                                                                                        fillShippingBillingDetails(
                                                                                            $event,
                                                                                            false
                                                                                        )
                                                                                    "
                                                                                >
                                                                                </select-field>
                                                                            </div>

                                                                            <div
                                                                                class="col-sm-6"
                                                                                *ngIf="shouldShowTrnGstField"
                                                                            >
                                                                                <text-field
                                                                                    [readonly]="autoFillShipping"
                                                                                    autocomplete="None"
                                                                                    [maxlength]="15"
                                                                                    [type]="'text'"
                                                                                    [name]="'shippingDetails.gstNumber'"
                                                                                    *ngIf="showGSTINNo"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        invFormData.accountDetails
                                                                                            .shippingDetails.gstNumber
                                                                                    "
                                                                                    (change)="
                                                                                        getStateCode(
                                                                                            'shippingDetails',
                                                                                            statesShipping
                                                                                        )
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_gstin
                                                                                    "
                                                                                ></text-field>
                                                                                <text-field
                                                                                    [readonly]="autoFillShipping"
                                                                                    [maxlength]="15"
                                                                                    autocomplete="None"
                                                                                    [type]="'text'"
                                                                                    [name]="'shippingDetails.gstNumber'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    *ngIf="showTRNNo"
                                                                                    [(ngModel)]="
                                                                                        invFormData.accountDetails
                                                                                            .shippingDetails.gstNumber
                                                                                    "
                                                                                    (change)="
                                                                                        getStateCode(
                                                                                            'shippingDetails',
                                                                                            statesShipping
                                                                                        )
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_trn
                                                                                    "
                                                                                ></text-field>
                                                                            </div>
                                                                            <!-- static pin code  -->
                                                                            <div
                                                                                [ngClass]="{
                                                                                    'col-sm-6':
                                                                                        showGSTINNo || showTRNNo,
                                                                                    'col-sm-12': !(
                                                                                        showGSTINNo || showTRNNo
                                                                                    )
                                                                                }"
                                                                            >
                                                                                <div class="form-group mr-b05">
                                                                                    <text-field
                                                                                        [type]="'number'"
                                                                                        [cssClass]="
                                                                                            'form-control input-custom'
                                                                                        "
                                                                                        autocomplete="false"
                                                                                        [name]="'shippingPinCode'"
                                                                                        [placeholder]="
                                                                                            commonLocaleData?.app_pin_code
                                                                                        "
                                                                                        [(ngModel)]="
                                                                                            invFormData.accountDetails
                                                                                                .shippingDetails.pincode
                                                                                        "
                                                                                        [allowDecimalDigitsOnly]="true"
                                                                                    >
                                                                                    </text-field>
                                                                                </div>
                                                                            </div>
                                                                            <!-- static pin code end-->
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->
                                                    </div>
                                                </div>
                                            </section>
                                        </ng-container>
                                    </div>
                                </div>
                                <!-- endregion -->
                            </div>
                            <!-- region balance due -->
                            <!-- region balance due -->
                            <div
                                class="col-sm-3 col-md-3 balance-due-absolute"
                                *ngIf="
                                    isSalesInvoice ||
                                    isProformaInvoice ||
                                    isEstimateInvoice ||
                                    (voucherApiVersion === 2 &&
                                        isPurchaseInvoice &&
                                        !isCashInvoice &&
                                        !isCashBankAccount)
                                "
                            >
                                <div class="text-right">
                                    <p class="font-20 pb-r1">
                                        <span class="balance-due">{{
                                            isProformaInvoice || isEstimateInvoice
                                                ? commonLocaleData?.app_total_amount
                                                : localeData?.balance_due
                                        }}</span>

                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount"
                                        >
                                            <amount-field
                                                [amount]="
                                                    adjustPaymentData?.totalAdjustedAmount
                                                        ? adjustPaymentBalanceDueData
                                                        : invFormData.voucherDetails.balanceDue
                                                "
                                                [currencySymbol]="invFormData.accountDetails?.currencySymbol"
                                                [currencyCode]="invFormData.accountDetails?.currency?.code"
                                            >
                                            </amount-field>
                                        </span>

                                        <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                        <span
                                            *ngIf="
                                                (voucherApiVersion !== 2 &&
                                                    enableVoucherAdjustmentMultiCurrency &&
                                                    isSalesInvoice &&
                                                    isMulticurrencyAccount &&
                                                    adjustPaymentBalanceDueData === 0 &&
                                                    invFormData.voucherDetails.balanceDue === 0) ||
                                                (voucherApiVersion === 2 &&
                                                    invFormData.voucherDetails.gainLoss &&
                                                    invFormData.voucherDetails.gainLoss !== 0 &&
                                                    invFormData.voucherDetails.balanceDue === 0)
                                            "
                                            class="balance-due"
                                            >{{ localeData?.exchange_label }}
                                            {{
                                                voucherApiVersion === 2
                                                    ? invFormData.voucherDetails.gainLoss >= 0
                                                        ? commonLocaleData?.app_exchange_gain
                                                        : commonLocaleData?.app_exchange_loss
                                                    : getConvertedBalanceDue() <= 0
                                                    ? commonLocaleData?.app_exchange_gain
                                                    : commonLocaleData?.app_exchange_loss
                                            }}:&nbsp;</span
                                        >
                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount && voucherApiVersion !== 2"
                                        >
                                            <amount-field
                                                [amount]="
                                                    isSalesInvoice &&
                                                    adjustPaymentBalanceDueData === 0 &&
                                                    invFormData.voucherDetails.balanceDue === 0
                                                        ? getConvertedBalanceDue(true)
                                                        : invFormData.voucherDetails.convertedBalanceDue
                                                "
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency"
                                            >
                                            </amount-field>
                                        </span>

                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="!isMulticurrencyAccount"
                                        >
                                            <amount-field
                                                [amount]="
                                                    adjustPaymentData?.totalAdjustedAmount
                                                        ? adjustPaymentBalanceDueData
                                                        : invFormData.voucherDetails.balanceDue
                                                "
                                                [currencySymbol]="false"
                                                [currencyCode]="false"
                                            >
                                            </amount-field>
                                        </span>
                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="
                                                voucherApiVersion === 2 &&
                                                invFormData.voucherDetails.gainLoss &&
                                                invFormData.voucherDetails.gainLoss !== 0 &&
                                                invFormData.voucherDetails.balanceDue === 0
                                            "
                                        >
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.gainLoss"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency"
                                            >
                                            </amount-field>
                                        </span>
                                    </p>
                                </div>
                            </div>
                            <!-- endregion -->
                        </div>
                        <!-- endregion -->

                        <!-- region attention to, email, mobile, voucher section -->
                        <div class="customer-invoice-table bg-white pd-b2 pd-t2">
                            <div class="inner-container">
                                <!-- region attention to -->
                                <div class="row">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                        <label>{{ localeData?.attention_to }}</label>
                                    </div>

                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="pl-0 col-sm-12 col-xl-6 col-lg-10 col-md-10">
                                            <text-field
                                                [type]="'text'"
                                                [name]="'accountDetails.attention'"
                                                [placeholder]="localeData?.attention_to"
                                                [cssClass]="'form-control attention-to mat-field-border'"
                                                [(ngModel)]="invFormData.accountDetails.attentionTo"
                                            ></text-field>
                                        </div>
                                    </div>
                                </div>
                                <!-- endregion-->

                                <!-- region email -->
                                <div class="row mt-1">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>{{ commonLocaleData?.app_email_id }}</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                            <text-field
                                                [type]="'email'"
                                                [placeholder]="localeData?.account_email_placeholder"
                                                [name]="'accountDetails.email'"
                                                [cssClass]="'form-control attention-to mat-field-border'"
                                                [(ngModel)]="invFormData.accountDetails.email"
                                            ></text-field>
                                        </div>
                                    </div>
                                </div>

                                <!-- endregion-->

                                <!-- region mobile no -->
                                <div class="row mt-1 mobile-number-wrapper">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>{{ commonLocaleData?.app_mobile_number }}</label>
                                    </div>

                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0 mobile-number">
                                            <input
                                                name="accountDetails.mobileNumber"
                                                type="tel"
                                                #initContactProforma
                                                id="init-contact-proforma"
                                                [placeholder]="localeData?.mobile_number_placeholder"
                                            />
                                            <span id="init-contact-proforma-valid-msg" class="d-none"></span>
                                            <span id="init-contact-proforma-error-msg" class="d-none"></span>
                                        </div>
                                    </div>
                                </div>
                                <!-- endregion-->
                                <!-- warehouse selection -->
                                <div
                                    class="row mt-1 warehouse-wrapper"
                                    *ngIf="shouldShowWarehouse && warehouses && warehouses.length > 1"
                                >
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                        <label>{{ commonLocaleData?.app_warehouse }}</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                            <select-field
                                                [cssClass]="'multi-select mat-field-border'"
                                                [name]="'warehouse'"
                                                [placeholder]="localeData?.select_warehouse_placeholder"
                                                [options]="warehouses"
                                                (selectedOption)="onSelectWarehouse($event)"
                                                [allowValueReset]="true"
                                                (onClear)="onSelectWarehouse($event)"
                                                [defaultValue]="selectedWarehouseName"
                                            >
                                            </select-field>
                                        </div>
                                    </div>
                                </div>
                                <!-- end warehouse field -->

                                <div class="row mt-1 delivery-from-field" *ngIf="isPurchaseInvoice">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>{{ localeData?.deliver_to }}<span class="red-text">*</span></label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                                        <section class="form-inline">
                                            <div class="wrap-billing-address w-100 clearfix">
                                                <div class="row">
                                                    <!-- region billing address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group">
                                                            <div class="d-flex align-items-center pb-1">
                                                                <span class="pd-r15">{{
                                                                    localeData?.billing_address
                                                                }}</span>
                                                                <span>
                                                                    <div
                                                                        class="
                                                                            btn-group btn-block
                                                                            change-address-dropdown
                                                                        "
                                                                        [attachOutsideOnClick]="true"
                                                                        *ngIf="companyAddressList?.length > 1"
                                                                    >
                                                                        <a
                                                                            [matMenuTriggerFor]="
                                                                                companyBillingAddressDropDownWeb
                                                                            "
                                                                            type="button"
                                                                            class="dropdown-toggle"
                                                                        >
                                                                            {{ localeData?.change }}</a
                                                                        >
                                                                        <mat-menu
                                                                            #companyBillingAddressDropDownWeb="matMenu"
                                                                        >
                                                                            <ul
                                                                                *dropdownMenu
                                                                                class="
                                                                                    dropdown-menu dropdown-menu-right
                                                                                "
                                                                                role="menu"
                                                                            >
                                                                                <li
                                                                                    role="menuitem"
                                                                                    *ngFor="
                                                                                        let address of companyAddressList
                                                                                    "
                                                                                >
                                                                                    <a
                                                                                        class="dropdown-item"
                                                                                        (click)="
                                                                                            selectAddress(
                                                                                                purchaseBillCompany.billingDetails,
                                                                                                address,
                                                                                                true
                                                                                            )
                                                                                        "
                                                                                    >
                                                                                        {{ address.address }}
                                                                                        {{ address.stateName }}
                                                                                        <span class="d-block">{{
                                                                                            address.taxNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.taxNumber
                                                                                                : ""
                                                                                        }}</span>
                                                                                    </a>
                                                                                </li>
                                                                            </ul>
                                                                        </mat-menu>
                                                                    </div>
                                                                </span>
                                                            </div>
                                                            <div class="billing-address clearfix">
                                                                <textarea
                                                                    name="companyBillingDetailsAddress"
                                                                    (keyup)="autoFillCompanyShippingDetails()"
                                                                    [(ngModel)]="
                                                                        purchaseBillCompany.billingDetails.address[0]
                                                                    "
                                                                    class="form-control"
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                    autofocus="off"
                                                                    aria-autocomplete="none"
                                                                ></textarea>
                                                                <div class="row">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <label class="sales-country-label">
                                                                            {{ companyCountryName }}
                                                                        </label>
                                                                    </div>
                                                                    <div
                                                                        class="col-sm-12 col-md-6"
                                                                        #billingStateCompany
                                                                    >
                                                                        <select-field
                                                                            [placeholder]="commonLocaleData?.app_state"
                                                                            [cssClass]="'select-border-bottom'"
                                                                            (selectedOption)="
                                                                                fillShippingBillingCompanyDetails(
                                                                                    $event,
                                                                                    true
                                                                                );
                                                                                autoFillCompanyShippingDetails()
                                                                            "
                                                                            [allowValueReset]="true"
                                                                            (onClear)="
                                                                                fillShippingBillingCompanyDetails(
                                                                                    $event,
                                                                                    true
                                                                                );
                                                                                autoFillCompanyShippingDetails()
                                                                            "
                                                                            [options]="companyStatesSource"
                                                                            [name]="'companyBillingDetailsStateCode'"
                                                                            [readonly]="
                                                                                purchaseBillCompany.billingDetails
                                                                                    .gstNumber &&
                                                                                purchaseBillCompany.billingDetails
                                                                                    .gstNumber.length >= 2
                                                                                    ? true
                                                                                    : null
                                                                            "
                                                                            [defaultValue]="
                                                                                purchaseBillCompany.billingDetails.state
                                                                                    .name
                                                                            "
                                                                        >
                                                                        </select-field>
                                                                    </div>
                                                                    <div
                                                                        class="col-sm-6 col-md-6"
                                                                        *ngIf="
                                                                            shouldShowTrnGstField &&
                                                                            (showGSTINNo || showTRNNo)
                                                                        "
                                                                    >
                                                                        <text-field
                                                                            [maxlength]="15"
                                                                            autocomplete="None"
                                                                            [type]="'text'"
                                                                            [name]="'companyBillingDetailsTax'"
                                                                            [(ngModel)]="
                                                                                purchaseBillCompany.billingDetails
                                                                                    .gstNumber
                                                                            "
                                                                            [cssClass]="'form-control input-custom'"
                                                                            (blur)="autoFillCompanyShippingDetails()"
                                                                            (change)="
                                                                                getStateCodeCompany('billingDetails')
                                                                            "
                                                                            [placeholder]="
                                                                                showGSTINNo
                                                                                    ? commonLocaleData?.app_gstin
                                                                                    : commonLocaleData?.app_trn
                                                                            "
                                                                        ></text-field>
                                                                    </div>
                                                                    <!-- static pin code  -->
                                                                    <div
                                                                        [ngClass]="{
                                                                            'col-sm-6 col-md-6':
                                                                                showGSTINNo || showTRNNo,
                                                                            'col-sm-12 col-md-12': !(
                                                                                showGSTINNo || showTRNNo
                                                                            )
                                                                        }"
                                                                    >
                                                                        <div class="form-group mr-b05">
                                                                            <text-field
                                                                                [type]="'number'"
                                                                                [cssClass]="'form-control input-custom'"
                                                                                autocomplete="false"
                                                                                [name]="'purchaseBillBillingPinCode'"
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_pin_code
                                                                                "
                                                                                [(ngModel)]="
                                                                                    purchaseBillCompany.billingDetails
                                                                                        .pincode
                                                                                "
                                                                                (blur)="
                                                                                    autoFillCompanyShippingDetails()
                                                                                "
                                                                                [allowDecimalDigitsOnly]="true"
                                                                            >
                                                                            </text-field>
                                                                        </div>
                                                                    </div>
                                                                    <!-- static pin code end-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->

                                                    <!-- region shipping address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group p-0 width-100">
                                                            <div class="d-flex align-items-center pb-1">
                                                                <span class="pd-r15">
                                                                    <mat-checkbox
                                                                        autocomplete="None"
                                                                        name="autoFillCompanyShipping"
                                                                        [(ngModel)]="autoFillCompanyShipping"
                                                                        (change)="autoFillCompanyShippingDetails()"
                                                                    >
                                                                        {{ localeData?.shipping_billing_same }}
                                                                    </mat-checkbox>
                                                                </span>
                                                            </div>
                                                            <div
                                                                [ngClass]="{
                                                                    'billing-address': true,
                                                                    'disabled': autoFillCompanyShipping
                                                                }"
                                                            >
                                                                <textarea
                                                                    name="companyShippingDetailsAddress"
                                                                    [(ngModel)]="
                                                                        purchaseBillCompany.shippingDetails.address[0]
                                                                    "
                                                                    class="form-control"
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                    autofocus="off"
                                                                    aria-autocomplete="none"
                                                                ></textarea>
                                                                <div class="clearfix">
                                                                    <div class="form-group row deliver-same-address">
                                                                        <div class="col-sm-12 col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="sales-country-label">
                                                                                    {{ companyCountryName }}
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div
                                                                            class="col-sm-12 col-md-6"
                                                                            #shippingStateCompany
                                                                        >
                                                                            <select-field
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_state
                                                                                "
                                                                                [cssClass]="'select-border-bottom'"
                                                                                [ngClass]="{
                                                                                    'disabled': autoFillCompanyShipping
                                                                                }"
                                                                                (selectedOption)="
                                                                                    fillShippingBillingCompanyDetails(
                                                                                        $event,
                                                                                        false
                                                                                    )
                                                                                "
                                                                                [allowValueReset]="true"
                                                                                (onClear)="
                                                                                    fillShippingBillingCompanyDetails(
                                                                                        $event,
                                                                                        false
                                                                                    )
                                                                                "
                                                                                [options]="companyStatesSource"
                                                                                [name]="
                                                                                    'companyShippingDetailsStateCode'
                                                                                "
                                                                                [readonly]="
                                                                                    autoFillCompanyShipping ||
                                                                                    (purchaseBillCompany.shippingDetails
                                                                                        .gstNumber &&
                                                                                        purchaseBillCompany
                                                                                            .shippingDetails.gstNumber
                                                                                            .length >= 2)
                                                                                        ? true
                                                                                        : null
                                                                                "
                                                                                [defaultValue]="
                                                                                    purchaseBillCompany.shippingDetails
                                                                                        .state.name
                                                                                "
                                                                            >
                                                                            </select-field>
                                                                        </div>
                                                                        <div
                                                                            class="col-sm-6 col-md-6"
                                                                            *ngIf="
                                                                                shouldShowTrnGstField &&
                                                                                (showGSTINNo || showTRNNo)
                                                                            "
                                                                        >
                                                                            <text-field
                                                                                [maxlength]="15"
                                                                                autocomplete="None"
                                                                                [type]="'text'"
                                                                                [name]="'companyShippingDetailsTax'"
                                                                                [(ngModel)]="
                                                                                    purchaseBillCompany.shippingDetails
                                                                                        .gstNumber
                                                                                "
                                                                                [cssClass]="'form-control input-custom'"
                                                                                (change)="
                                                                                    getStateCodeCompany(
                                                                                        'shippingDetails'
                                                                                    )
                                                                                "
                                                                                [placeholder]="
                                                                                    showGSTINNo
                                                                                        ? commonLocaleData?.app_gstin
                                                                                        : commonLocaleData?.app_trn
                                                                                "
                                                                            ></text-field>
                                                                        </div>
                                                                        <!-- static pin code  -->
                                                                        <div
                                                                            [ngClass]="{
                                                                                'col-sm-6 col-md-6':
                                                                                    showGSTINNo || showTRNNo,
                                                                                'col-sm-12 col-md-12': !(
                                                                                    showGSTINNo || showTRNNo
                                                                                )
                                                                            }"
                                                                        >
                                                                            <div class="form-group mr-b05">
                                                                                <text-field
                                                                                    [type]="'number'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom'
                                                                                    "
                                                                                    autocomplete="false"
                                                                                    [name]="
                                                                                        'purchaseBillShippingPinCode'
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_pin_code
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        purchaseBillCompany
                                                                                            .shippingDetails.pincode
                                                                                    "
                                                                                    [allowDecimalDigitsOnly]="true"
                                                                                >
                                                                                </text-field>
                                                                            </div>
                                                                        </div>
                                                                        <!-- static pin code end-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                                <div
                                    class="row mt-1"
                                    *ngIf="
                                        voucherApiVersion !== 2 &&
                                        isPurchaseInvoice &&
                                        (!isUpdateMode || (isUpdateMode && poLinkUpdated))
                                    "
                                >
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                        <label>{{ localeData?.link_purchase_order }}</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-xl-6 col-lg-10 col-md-10 pl-0 purchase-link">
                                            <mat-select
                                                name="linkedPO"
                                                [placeholder]="localeData?.select_order_placeholder"
                                                [multiple]="true"
                                                [(ngModel)]="linkedPo"
                                                (ngModelChange)="getPurchaseOrder($event, true)"
                                                [compareWith]="compareFn"
                                                class="po-mat-salect"
                                            >
                                                <mat-option class="po-options-line">
                                                    <ngx-mat-select-search [formControl]="linkPoDropdown">
                                                    </ngx-mat-select-search>
                                                </mat-option>

                                                <mat-option
                                                    *ngFor="let option of fieldFilteredOptions"
                                                    [value]="option"
                                                    class="po-options-line"
                                                >
                                                    <span class="po-option-label"> {{ option?.label }}</span>
                                                    <span class="po-option-value" *ngIf="option?.additional?.pending">
                                                        {{ localeData?.pending }}:
                                                        {{ option?.additional?.pending }}</span
                                                    >
                                                    <span class="po-option-value" *ngIf="option.additional?.grandTotal">
                                                        {{ commonLocaleData?.app_amount }}:
                                                        {{ option?.additional?.grandTotal }}</span
                                                    >
                                                </mat-option>
                                            </mat-select>
                                        </div>
                                    </div>
                                </div>
                                <!-- end Link purchase order -->

                                <!-- region invoice no, invoice date, Expiry date -->
                                <div class="row mt-1">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label> {{ invoiceNoLabel }} </label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-12 col-xl-6 col-lg-5 col-md-10 pl-0">
                                            <!-- Enabled for CR/DR update flow -->
                                            <div>
                                                <text-field
                                                    *ngIf="!isCreditNote && !isDebitNote"
                                                    type="text"
                                                    name="accountDetails.invoiceNum"
                                                    class="form-control invoice-date attention-to"
                                                    [ngClass]="{ 'date-invoice': !isPurchaseInvoice }"
                                                    [disabled]="
                                                        isUpdateMode && !(isDebitNote || isPurchaseInvoice)
                                                            ? 'disabled'
                                                            : null
                                                    "
                                                    [(ngModel)]="invFormData.voucherDetails.voucherNumber"
                                                >
                                                </text-field>
                                                <ng-container *ngIf="isCreditNote || isDebitNote">
                                                    <sh-select
                                                        *ngIf="voucherApiVersion === 2"
                                                        [options]="invoiceList$ | async"
                                                        [placeholder]="commonLocaleData?.app_select_accounts"
                                                        [fixedValue]="invoiceSelected?.label"
                                                        [forceClearReactive]="invoiceForceClearReactive$ | async"
                                                        class="linking-dropdown"
                                                        [notFoundLink]="false"
                                                        [(ngModel)]="selectedInvoice"
                                                        name="invoiceLinking"
                                                        (selected)="creditNoteInvoiceSelected($event)"
                                                        [multiple]="false"
                                                        [ItemHeight]="67"
                                                        [showClear]="false"
                                                        [isPaginationEnabled]="true"
                                                        (scrollEnd)="
                                                            !searchReferenceVoucher
                                                                ? getInvoiceListsForCreditNote()
                                                                : ''
                                                        "
                                                        [enableDynamicSearch]="true"
                                                        (dynamicSearchedQuery)="
                                                            searchReferenceVoucher = $event;
                                                            resetInvoiceList();
                                                            getInvoiceListsForCreditNote()
                                                        "
                                                    >
                                                        <ng-template #optionTemplate let-option="option">
                                                            <a
                                                                *ngIf="option"
                                                                href="javascript:void(0)"
                                                                class="linking-item list-item sh-template"
                                                            >
                                                                <div class="item">{{ option?.label }}</div>
                                                                <div class="item-unique">
                                                                    ({{ commonLocaleData?.app_dated }}:
                                                                    {{ option.additional?.voucherDate }})
                                                                </div>
                                                                <div class="item-unique">
                                                                    ({{ commonLocaleData?.app_amount }}:
                                                                    {{
                                                                        voucherApiVersion === 2
                                                                            ? (option.additional?.unadjustedAmount
                                                                                  ?.amountForAccount | giddhCurrency)
                                                                            : (option.additional?.balanceDue
                                                                                  ?.amountForAccount | giddhCurrency)
                                                                    }})
                                                                </div>
                                                            </a>
                                                        </ng-template>
                                                    </sh-select>
                                                    <sh-select
                                                        *ngIf="voucherApiVersion !== 2"
                                                        [options]="invoiceList"
                                                        [placeholder]="commonLocaleData?.app_select_accounts"
                                                        [fixedValue]="invoiceSelected?.label"
                                                        [forceClearReactive]="invoiceForceClearReactive$ | async"
                                                        class="linking-dropdown"
                                                        [notFoundLink]="false"
                                                        [(ngModel)]="selectedInvoice"
                                                        name="invoiceLinking"
                                                        (selected)="creditNoteInvoiceSelected($event)"
                                                        [multiple]="false"
                                                        [ItemHeight]="67"
                                                        [showClear]="false"
                                                    >
                                                        <ng-template #optionTemplate let-option="option">
                                                            <a
                                                                *ngIf="option"
                                                                href="javascript:void(0)"
                                                                class="linking-item list-item sh-template"
                                                            >
                                                                <div class="item">{{ option?.label }}</div>
                                                                <div class="item-unique">
                                                                    ({{ commonLocaleData?.app_dated }}:
                                                                    {{ option.additional?.voucherDate }})
                                                                </div>
                                                                <div class="item-unique">
                                                                    ({{ commonLocaleData?.app_amount }}:
                                                                    {{
                                                                        voucherApiVersion === 2
                                                                            ? (option.additional?.unadjustedAmount
                                                                                  ?.amountForAccount | giddhCurrency)
                                                                            : (option.additional?.balanceDue
                                                                                  ?.amountForAccount | giddhCurrency)
                                                                    }})
                                                                </div>
                                                            </a>
                                                        </ng-template>
                                                    </sh-select>
                                                </ng-container>
                                            </div>
                                            <div
                                                *ngIf="(isCreditNote || isDebitNote) && selectedInvoice"
                                                class="cp for-mobile-screen remove-invoice"
                                                (click)="removeSelectedInvoice()"
                                            >
                                                <span class="remove-invoice-icon mr-r05"
                                                    ><i class="icon-trash"></i
                                                ></span>
                                            </div>
                                        </div>
                                        <div
                                            class="col-sm-12 col-xl-6 col-lg-10 col-md-10 invoice-date-due-date"
                                            *ngIf="!isMobileScreen"
                                        >
                                            <div class="form-inline flex-row flex-nowrap">
                                                <div
                                                    *ngIf="(isCreditNote || isDebitNote) && selectedInvoice"
                                                    class="cp remove-invoice"
                                                    (click)="removeSelectedInvoice()"
                                                >
                                                    <span class="remove-invoice-icon mr-r05"
                                                        ><i class="icon-trash"></i
                                                    ></span>
                                                </div>
                                                <div class="form-group invoice-date-label">
                                                    <label>{{ invoiceDateLabel }}</label>
                                                    <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                        <giddh-datepicker
                                                            type="text"
                                                            #voucherDate="ngModel"
                                                            [placeholder]="giddhDateFormat"
                                                            name="voucherDate"
                                                            [(ngModel)]="invFormData.voucherDetails.voucherDate"
                                                            [class.invalid-inp]="
                                                                voucherDate.errors &&
                                                                (voucherDate.dirty || voucherDate.touched)
                                                            "
                                                            [disabled]="
                                                                invoiceType !== 'purchase' && isUpdateMode
                                                                    ? 'disabled'
                                                                    : null
                                                            "
                                                            (datepickerState)="onFocusInvoiceDate()"
                                                            (dateSelected)="
                                                                onVoucherDateChanged(
                                                                    $event,
                                                                    invFormData.voucherDetails.voucherDate
                                                                );
                                                                onBlurInvoiceDate(0)
                                                            "
                                                        >
                                                        </giddh-datepicker>

                                                        <p
                                                            class="text-danger"
                                                            *ngIf="
                                                                voucherDate.errors &&
                                                                (voucherDate.dirty || voucherDate.touched)
                                                            "
                                                        >
                                                            {{ localeData?.invalid_date }}
                                                        </p>
                                                    </div>
                                                </div>

                                                <div
                                                    class="form-group invoice-due-label"
                                                    *ngIf="
                                                        currentVoucherFormDetails?.dueDate ||
                                                        isSalesInvoice ||
                                                        isPurchaseInvoice ||
                                                        isProformaInvoice ||
                                                        isEstimateInvoice
                                                    "
                                                >
                                                    <label>{{ invoiceDueDateLabel }}</label>
                                                    <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                        <giddh-datepicker
                                                            type="text"
                                                            [placeholder]="giddhDateFormat"
                                                            #dueDate="ngModel"
                                                            name="dueDate"
                                                            class="date-invoice"
                                                            [(ngModel)]="invFormData.voucherDetails.dueDate"
                                                            [class.invalid-inp]="
                                                                dueDate.errors && (dueDate.dirty || dueDate.touched)
                                                            "
                                                            (blur)="onBlurDueDate(0)"
                                                        >
                                                        </giddh-datepicker>
                                                        <p
                                                            class="text-danger"
                                                            *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)"
                                                        >
                                                            {{ localeData?.invalid_date }}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-1" *ngIf="voucherApiVersion === 2 && (isCreditNote || isDebitNote)">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label> {{ commonLocaleData?.app_number }} </label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9">
                                        <div class="col-sm-12 col-xl-6 col-lg-5 col-md-10 pl-0">
                                            <div>
                                                <text-field
                                                    type="text"
                                                    name="accountDetails.invoiceNum"
                                                    class="form-control invoice-date attention-to"
                                                    [ngClass]="{ 'date-invoice': !isPurchaseInvoice }"
                                                    [disabled]="
                                                        isUpdateMode && !(isDebitNote || isPurchaseInvoice)
                                                            ? 'disabled'
                                                            : null
                                                    "
                                                    [(ngModel)]="invFormData.voucherDetails.voucherNumber"
                                                >
                                                </text-field>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-1 mobile-invoice-date-due-date" *ngIf="isMobileScreen">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>{{ invoiceDateLabel }}</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                            <giddh-datepicker
                                                type="text"
                                                [placeholder]="giddhDateFormat"
                                                #voucherDate="ngModel"
                                                name="voucherDate"
                                                class="date-invoice"
                                                [(ngModel)]="invFormData.voucherDetails.voucherDate"
                                                (focus)="onFocusInvoiceDate()"
                                                (blur)="onBlurInvoiceDate(0)"
                                                (ngModelChange)="
                                                    onVoucherDateChanged($event, invFormData.voucherDetails.voucherDate)
                                                "
                                                [disabled]="
                                                    invoiceType !== 'purchase' && isUpdateMode ? 'disabled' : null
                                                "
                                                [class.invalid-inp]="
                                                    voucherDate.errors && (voucherDate.dirty || voucherDate.touched)
                                                "
                                            >
                                            </giddh-datepicker>
                                            <p
                                                class="text-danger"
                                                *ngIf="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)"
                                            >
                                                {{ localeData?.invalid_date }}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    class="row mt-1 mobile-invoice-date-due-date"
                                    *ngIf="
                                        isMobileScreen &&
                                        (currentVoucherFormDetails?.dueDate ||
                                            isSalesInvoice ||
                                            isPurchaseInvoice ||
                                            isProformaInvoice ||
                                            isEstimateInvoice)
                                    "
                                >
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3">
                                        <label>{{ invoiceDueDateLabel }}</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                            <giddh-datepicker
                                                type="text"
                                                [placeholder]="giddhDateFormat"
                                                #dueDate="ngModel"
                                                name="dueDate"
                                                class="date-invoice"
                                                [(ngModel)]="invFormData.voucherDetails.dueDate"
                                                [class.invalid-inp]="
                                                    dueDate.errors && (dueDate.dirty || dueDate.touched)
                                                "
                                            >
                                            </giddh-datepicker>
                                            <p
                                                class="text-danger"
                                                *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)"
                                            >
                                                {{ localeData?.invalid_date }}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- reverse charge transction start -->
                                <!-- for purchase record start -->
                                <div
                                    class="row mt-1"
                                    *ngIf="
                                        isPurchaseInvoice ||
                                        (currentVoucherFormDetails?.rcmAllowed && companyCountryName === 'India')
                                    "
                                >
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3" *ngIf="!isMobileView">
                                        <label></label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-6 col-xl-6 col-lg-10 col-md-10 pl-0">
                                            <mat-checkbox
                                                #rcmCheckbox
                                                color="primary"
                                                id="reverse-charge"
                                                [(ngModel)]="isRcmEntry"
                                                (change)="changeRcmCheckboxState($event)"
                                                class="mr-r1"
                                                name="rcmEntry"
                                                [disabled]="isReadOnly"
                                            >
                                            </mat-checkbox>
                                            <label
                                                class="checkbox-custom-label"
                                                for="reverse-charge"
                                                (click)="!isReadOnly ? toggleRcmCheckbox(rcmCheckbox, 'label') : ''"
                                                [innerHTML]="localeData?.transaction_reverse_charge"
                                            >
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <!-- for purchase record end -->
                                <!-- reverse charge transction end  -->
                                <!-- For Tourist Scheme start -->
                                <!-- for sales invoice start (ngModelChange)="touristSchemeApplicableToggle($event)"-->
                                <ng-container *ngIf="companyCountryCode === 'AE'">
                                    <div class="row mt-1" *ngIf="isSalesInvoice || isCashInvoice">
                                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3" *ngIf="!isMobileView">
                                            <label></label>
                                        </div>
                                        <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                            <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                                <mat-checkbox
                                                    id="tourist-scheme"
                                                    name="touristSchemeApplicable"
                                                    [(ngModel)]="invFormData.touristSchemeApplicable"
                                                    (ngModelChange)="touristSchemeApplicableToggle()"
                                                >
                                                    {{ localeData?.transaction_tourist_scheme }}
                                                </mat-checkbox>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- endregion -->
                                    <div
                                        class="row mt-1"
                                        *ngIf="(isSalesInvoice || isCashInvoice) && invFormData.touristSchemeApplicable"
                                    >
                                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                            <label>{{ localeData?.passport_number }}</label>
                                        </div>
                                        <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                            <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                                <text-field
                                                    [type]="'text'"
                                                    [name]="'passportNumber'"
                                                    [placeholder]="localeData?.passport_number"
                                                    [cssClass]="'form-control attention-to mat-field-border'"
                                                    [(ngModel)]="invFormData.passportNumber"
                                                    (keypress)="allowAlphanumericChar()"
                                                    (blur)="allowAlphanumericChar()"
                                                ></text-field>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                                <!-- For Tourist Scheme end -->
                                <!-- for sales invoice end -->
                                <!-- endregion -->
                            </div>
                        </div>
                        <!-- endregion -->
                    </div>
                </div>
                <!-- region entries table -->
                <ng-container>
                    <!-- region normal view -->
                    <section
                        class="
                            static-invoice-table
                            sales-invoice-table
                            clearfix
                            mr-b2
                            white-bg
                            container-fluid
                            ng-tns-c8-0
                        "
                        *ngIf="!isMobileScreen"
                    >
                        <ng-container>
                            <!-- switch currency on click, remaining functional work , UI is completed -->
                            <div class="switch-currency" *ngIf="isMulticurrencyAccount && !showSwitchedCurr">
                                <span class="left-currency"
                                    >{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrencyName }}</span
                                >
                                <img
                                    class="switch-icon"
                                    src="assets/images/switch-icon.svg"
                                    alt="switch-icon"
                                    (click)="switchCurrencyImg(true)"
                                />
                                <span class="right-currency">
                                    <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                        originalExchangeRate | giddhCurrency
                                    }}</span>
                                    <text-field
                                        type="number"
                                        [name]="exchangeRate"
                                        [(ngModel)]="newExchangeRate"
                                        class="form-control edit-currency"
                                        *ngIf="showCurrencyValue"
                                        class="exchange-rate-original"
                                    ></text-field>
                                    {{ companyCurrency }}
                                </span>

                                <span class="edit-icon cp">
                                    <img
                                        src="assets/images/edit-pencilicon.svg"
                                        class="edit-pencil"
                                        *ngIf="!autoSaveIcon"
                                        (click)="
                                            showCurrencyValue = !showCurrencyValue;
                                            autoSaveIcon = !autoSaveIcon;
                                            newExchangeRate = originalExchangeRate
                                        "
                                    />
                                    <img
                                        src=" assets/images/autosave.svg"
                                        class="edit-pencil"
                                        (click)="
                                            exchangeRate = newExchangeRate;
                                            originalExchangeRate = exchangeRate;
                                            previousExchangeRate = exchangeRate;
                                            autoSaveIcon = !autoSaveIcon;
                                            showCurrencyValue = !showCurrencyValue;
                                            exchangeRateChanged();
                                            calculateGrandTotal()
                                        "
                                        *ngIf="autoSaveIcon"
                                    />
                                </span>
                            </div>
                            <!-- switch currency on click, remaining functional work , UI is completed -->
                            <div class="switch-currency" *ngIf="isMulticurrencyAccount && showSwitchedCurr">
                                <span class="left-currency"
                                    >{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrency }}</span
                                >
                                <img
                                    class="switch-icon"
                                    src="assets/images/switch-icon.svg"
                                    alt="switch-icon"
                                    (click)="switchCurrencyImg(false)"
                                />
                                <span class="right-currency">
                                    <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                        originalReverseExchangeRate | giddhCurrency
                                    }}</span>
                                    <text-field
                                        type="number"
                                        name="exchangeRate"
                                        [(ngModel)]="reverseExchangeRate"
                                        class="form-control edit-currency"
                                        *ngIf="showCurrencyValue"
                                    ></text-field>
                                    {{ companyCurrencyName }}
                                </span>

                                <span class="edit-icon cp">
                                    <img
                                        *ngIf="!autoSaveIcon"
                                        src="assets/images/edit-pencilicon.svg"
                                        class="edit-pencil"
                                        (click)="saveCancelExcRate(false)"
                                    />
                                    <img
                                        src=" assets/images/autosave.svg"
                                        class="edit-pencil"
                                        (click)="saveCancelExcRate(true)"
                                        *ngIf="autoSaveIcon"
                                    />
                                </span>
                            </div>
                        </ng-container>
                        <table class="table table-custom-invoice basic">
                            <thead>
                                <tr>
                                    <th
                                        *ngFor="let item of theadArrReadOnly"
                                        [hidden]="!item.display"
                                        class="thead-sales-invoice"
                                        [ngClass]="item?.label"
                                    >
                                        {{ item?.label }}
                                        <span *ngIf="item.label === 'Tax' && isRcmEntry"
                                            >({{ commonLocaleData?.app_rcm }})<sup class="mandatory-asterisk"
                                                >*</sup
                                            ></span
                                        >
                                    </th>
                                </tr>
                            </thead>
                            <tbody
                                [hidden]="showBulkLoader"
                                (clickOutside)="handleOutsideClick()"
                                [exclude]="'.entries-tr, .add-line-bulk-item'"
                            >
                                <ng-container #itemsContainer></ng-container>
                            </tbody>
                            <tbody *ngIf="showBulkLoader">
                                <tr>
                                    <td colspan="8">
                                        <giddh-page-loader></giddh-page-loader>
                                    </td>
                                </tr>
                            </tbody>

                            <ng-template #entry let-entry let-entryIdx="entryIdx" let-transaction="transaction">
                                <!-- <ng-container *ngFor="let transaction of entry.transactions;"> -->
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature) -->
                                <!-- region static entries-->
                                <tr
                                    (click)="setActiveIndx(entryIdx); $event.stopPropagation()"
                                    *ngIf="activeIndx !== entryIdx"
                                    class="entries-tr set-active"
                                    [ngClass]="{ 'is-other-tax': entry.isOtherTaxApplicable && isMulticurrencyAccount }"
                                >
                                    <td>{{ entryIdx + 1 }}</td>

                                    <td>
                                        <div class="product-name">
                                            <label *ngIf="!transaction.accountName" class="select-account-label">{{
                                                localeData?.select_account
                                            }}</label>
                                            {{ transaction.accountName }}
                                            <span *ngIf="transaction.stockDetails?.uniqueName"
                                                >({{ transaction.stockDetails?.name }})</span
                                            >
                                        </div>

                                        <div class="sku-number">
                                            <label>{{ commonLocaleData?.app_sku }}:</label
                                            >{{ commonLocaleData?.app_number }}
                                        </div>

                                        <div class="description">
                                            {{ transaction.description }}
                                        </div>
                                        <p
                                            class="small text-muted sku-and-custom-fields"
                                            *ngIf="transaction.sku_and_customfields"
                                        >
                                            {{ transaction.sku_and_customfields }}
                                        </p>
                                        <div class="date-hsn-code">
                                            <div class="row mr-0 ml-0">
                                                <div class="col-6 col-sm-6 pl-0" *ngIf="entry.entryDate">
                                                    <div class="entry-date">
                                                        <label>{{ localeData?.entry_date }}: </label>
                                                        {{ entry.entryDate }}
                                                        <span class="edit-icon cp" *ngIf="!isUpdateMode">
                                                            <img src="assets/images/edit-pencilicon.svg" />
                                                        </span>
                                                    </div>
                                                </div>

                                                <div
                                                    class="col-6 col-sm-6 pl-0"
                                                    *ngIf="transaction.hsnNumber || transaction.sacNumber"
                                                >
                                                    <div class="hsn-code text-right">
                                                        <label
                                                            >{{
                                                                transaction.showCodeType === "hsn"
                                                                    ? commonLocaleData?.app_hsn
                                                                    : commonLocaleData?.app_sac
                                                            }}:</label
                                                        >
                                                        <span>
                                                            {{
                                                                transaction.showCodeType === "hsn"
                                                                    ? transaction.hsnNumber
                                                                    : transaction.sacNumber
                                                            }}
                                                            <span class="edit-icon cp">
                                                                <img src="assets/images/edit-pencilicon.svg" />
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td
                                        class="text-right stock-unit"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.quantityAllowed"
                                    >
                                        <div class="wrap-td-data">
                                            {{ transaction.quantity | giddhCurrency }} {{ transaction.stockUnit }}
                                        </div>
                                    </td>
                                    <td
                                        class="text-right trans-rate item-rate height-rate"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.rateAllowed"
                                    >
                                        <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                            <div class="td-wrapper flex-grow-1">
                                                <div class="flex-grow-1">
                                                    <div class="wrap-td-data">
                                                        <span class="d-flex justify-content-end">
                                                            <amount-field
                                                                [amount]="transaction.rate"
                                                                [currencySymbol]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails?.currencySymbol
                                                                        : false
                                                                "
                                                                [currencyCode]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails?.currency?.code
                                                                        : false
                                                                "
                                                                [ratePrecision]="true"
                                                            >
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="differ-currency d-flex justify-content-end">
                                                <span>
                                                    <amount-field
                                                        *ngIf="isMulticurrencyAccount"
                                                        [amount]="
                                                            transaction.rate * exchangeRate
                                                                ? transaction.rate * exchangeRate
                                                                : 0
                                                        "
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-right item-amount height-rate">
                                        <div class="td-wrapper">
                                            <div class="flex-grow-1">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="transaction.amount ? transaction.amount : '0'"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="differ-currency d-flex justify-content-end">
                                            <span *ngIf="isMulticurrencyAccount">
                                                <amount-field
                                                    [amount]="transaction.convertedAmount"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </td>
                                    <td
                                        class="item-discount"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.discountAllowed"
                                    >
                                        <div class="text-right td-wrapper">
                                            <div class="flex-grow-1">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="entry.discountSum"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div
                                            class="differ-currency d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount"
                                        >
                                            <span>
                                                <amount-field
                                                    [amount]="entry.discountSum * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </td>
                                    <td
                                        [class.error-box]="transaction.requiredTax"
                                        class="text-right item-tax"
                                        (focus)="transaction.requiredTax = false"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.taxesAllowed"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-grow-1">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="entry.taxSum + entry.cessSum"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div
                                            class="differ-currency d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount"
                                        >
                                            <span>
                                                <amount-field
                                                    [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="text-right item-tax delete-btn-absolute">
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="transaction.total"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                        <br />
                                                    </span>

                                                    <span
                                                        class="d-flex justify-content-end"
                                                        *ngIf="
                                                            entry.isOtherTaxApplicable &&
                                                            entry.otherTaxModal?.appliedOtherTax?.name
                                                        "
                                                    >
                                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                                        <amount-field
                                                            *ngIf="isMulticurrencyAccount"
                                                            [amount]="entry.otherTaxSum"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                        <amount-field
                                                            *ngIf="!isMulticurrencyAccount"
                                                            [amount]="entry.otherTaxSum"
                                                            [currencySymbol]="false"
                                                            [currencyCode]="false"
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                                <div
                                                    class="tax-in-currency"
                                                    *ngIf="
                                                        entry.isOtherTaxApplicable &&
                                                        isMulticurrencyAccount &&
                                                        entry.otherTaxModal?.appliedOtherTax?.name
                                                    "
                                                >
                                                    <span
                                                        class="differ-currency d-flex justify-content-end"
                                                        *ngIf="isMulticurrencyAccount"
                                                    >
                                                        <amount-field
                                                            [amount]="entry.otherTaxSum * exchangeRate"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                            <div
                                                class="differ-currency d-flex justify-content-end"
                                                *ngIf="isMulticurrencyAccount"
                                            >
                                                <span>
                                                    <amount-field
                                                        [amount]="transaction.convertedTotal"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>

                                        <div
                                            class="trash-icon-delete"
                                            (click)="
                                                removeTransaction(entryIdx);
                                                $event.preventDefault();
                                                $event.stopPropagation()
                                            "
                                        >
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                </tr>

                                <!-- endregion -->

                                <!-- region dynamic entries-->
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature)-->
                                <tr
                                    *ngIf="activeIndx === entryIdx"
                                    class="entries-tr default-active"
                                    (click)="$event.stopPropagation()"
                                >
                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup()">{{ entryIdx + 1 }}</td>
                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup()">
                                        <div class="product-name">
                                            <div class="ng-select-wrap">
                                                <select-field
                                                    #selectAccount
                                                    [openDropdown]="openProductSelectionDropdown"
                                                    [cssClass]="'form-control mat-field-border'"
                                                    [name]="'transaction.fakeAccForSelect2_{{ entryIdx }}'"
                                                    [placeholder]="localeData?.select_acc"
                                                    [options]="salesAccounts$ | async"
                                                    (selectedOption)="
                                                        transaction.fakeAccForSelect2 = $event.value;
                                                        onSelectSalesAccount(
                                                            $event,
                                                            transaction,
                                                            entry,
                                                            false,
                                                            false,
                                                            entryIdx
                                                        );
                                                        noResultsFoundLabel = localeData?.search_acc
                                                    "
                                                    [defaultValue]="
                                                        transaction.stockDetails && transaction.stockDetails.name
                                                            ? transaction.accountName +
                                                              ' (' +
                                                              transaction.stockDetails?.name +
                                                              ')'
                                                            : transaction.accountName
                                                    "
                                                    [enableDynamicSearch]="true"
                                                    (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'item')"
                                                    (onClear)="onClearSalesAccount(transaction)"
                                                    [showValueInLabel]="true"
                                                    [hasStock]="true"
                                                >
                                                </select-field>
                                            </div>
                                        </div>

                                        <div *ngIf="transaction.fakeAccForSelect2">
                                            <div class="sku-number">
                                                <label>{{ commonLocaleData?.app_sku }}:</label
                                                >{{ commonLocaleData?.app_number }}
                                            </div>

                                            <div class="description">
                                                <textarea
                                                    type="text"
                                                    rows="3"
                                                    [placeholder]="localeData?.add_description"
                                                    name="transaction.description_{{ entryIdx }}"
                                                    class="form-control"
                                                    [(ngModel)]="transaction.description"
                                                    [maxlength]="entryDescriptionLength"
                                                    #description
                                                ></textarea>
                                                <p class="font-12">
                                                    {{ commonLocaleData?.app_characters_left }}:
                                                    {{ entryDescriptionLength - transaction.description?.length }}
                                                </p>
                                                <p
                                                    class="small text-muted sku-and-custom-fields"
                                                    *ngIf="transaction.sku_and_customfields"
                                                >
                                                    {{ transaction.sku_and_customfields }}
                                                </p>
                                            </div>
                                            <!-- region entry date/ hsncode -->
                                            <div class="date-hsn-code">
                                                <div class="row mr-0 ml-0">
                                                    <div class="col-6 col-sm-6 pl-0">
                                                        <div class="entry-date">
                                                            <label>{{ localeData?.entry_date }}: </label>
                                                            <span *ngIf="!isUpdateMode">
                                                                <input
                                                                    type="text"
                                                                    [placeholder]="giddhDateFormat"
                                                                    bsDatepicker
                                                                    name="transaction.date_{{ entryIdx }}"
                                                                    id="transaction.date_{{ entryIdx }}"
                                                                    class="form-control text-left"
                                                                    [(ngModel)]="entry.entryDate"
                                                                    [disabled]="isUpdateMode"
                                                                    (onShown)="hsnDropdownShow = false"
                                                                    [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                                    (bsValueChange)="
                                                                        onBlurEntryDate(entryIdx, dp.isOpen)
                                                                    "
                                                                    #dp="bsDatepicker"
                                                                    placement="right"
                                                                />
                                                                <span
                                                                    class="edit-icon cp"
                                                                    (click)="dp.toggle()"
                                                                    [attr.aria-expanded]="dp.isOpen"
                                                                >
                                                                    <img src="assets/images/edit-pencilicon.svg" />
                                                                </span>
                                                            </span>

                                                            <span *ngIf="isUpdateMode">
                                                                {{ entry.entryDate }}
                                                            </span>
                                                        </div>
                                                    </div>

                                                    <div class="col-6 col-sm-6 pl-0">
                                                        <div class="wrap-hsn-box">
                                                            <div
                                                                class="hsn-code text-right"
                                                                (click)="toggleHsnSacDropDown(transaction)"
                                                            >
                                                                <label
                                                                    >{{
                                                                        transaction.showCodeType === "hsn"
                                                                            ? commonLocaleData?.app_hsn
                                                                            : commonLocaleData?.app_sac
                                                                    }}:</label
                                                                >
                                                                <span>
                                                                    {{
                                                                        transaction.showCodeType === "hsn"
                                                                            ? transaction.hsnNumber
                                                                            : transaction.sacNumber
                                                                    }}
                                                                    <span
                                                                        *ngIf="
                                                                            !transaction.hsnNumber &&
                                                                            !transaction.sacNumber
                                                                        "
                                                                        class="update-text"
                                                                        >{{ commonLocaleData?.app_update }}
                                                                    </span>
                                                                    <span class="edit-icon cp">
                                                                        <img src="assets/images/edit-pencilicon.svg" />
                                                                    </span>
                                                                </span>
                                                            </div>
                                                            <div class="hsn-code-dropdown" *ngIf="hsnDropdownShow">
                                                                <mat-radio-group
                                                                    class="d-flex mb-2"
                                                                    [(ngModel)]="transaction.showCodeType"
                                                                    (change)="onChangeHsnSacType(transaction)"
                                                                    name="showCodeType{{ entryIdx }}"
                                                                >
                                                                    <mat-radio-button
                                                                        color="primary"
                                                                        id="hsnCodeType{{ entryIdx }}"
                                                                        [value]="'hsn'"
                                                                        >{{ commonLocaleData?.app_hsn_code }}
                                                                    </mat-radio-button>
                                                                    <mat-radio-button
                                                                        color="primary"
                                                                        id="sacCodeType{{ entryIdx }}"
                                                                        [value]="'sac'"
                                                                        >{{ commonLocaleData?.app_sac_code }}
                                                                    </mat-radio-button>
                                                                </mat-radio-group>
                                                                <text-field
                                                                    type="text"
                                                                    maxLength="10"
                                                                    decimalDigitsDirective
                                                                    [placeholder]="localeData?.hsn_number"
                                                                    name="transaction.hsnNumber_{{ entryIdx }}"
                                                                    *ngIf="transaction.showCodeType === 'hsn'"
                                                                    [(ngModel)]="transaction.hsnNumber"
                                                                ></text-field>
                                                                <text-field
                                                                    type="text"
                                                                    maxLength="10"
                                                                    decimalDigitsDirective
                                                                    [placeholder]="localeData?.sac_number"
                                                                    name="transaction.hsnNumber_{{ entryIdx }}"
                                                                    *ngIf="transaction.showCodeType === 'sac'"
                                                                    [(ngModel)]="transaction.sacNumber"
                                                                ></text-field>

                                                                <div class="btn-group mt-2 pt-1 d-flex">
                                                                    <button
                                                                        mat-button
                                                                        class="btn btn-sm btn-success-green"
                                                                        type="button"
                                                                        (click)="hsnDropdownShow = !hsnDropdownShow"
                                                                    >
                                                                        {{ commonLocaleData?.app_save }}
                                                                    </button>
                                                                    <button
                                                                        mat-button
                                                                        class="btn cancel-button mr-0"
                                                                        (click)="hideHsnSacEditPopup(transaction)"
                                                                    >
                                                                        {{ commonLocaleData?.app_cancel }}
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- endregion -->
                                        </div>
                                    </td>

                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.quantityAllowed"
                                        class="text-right stock-unit"
                                    >
                                        <text-field
                                            [placeholder]="commonLocaleData?.app_quantity"
                                            [readonly]="!transaction.isStockTxn"
                                            type="text"
                                            [cssClass]="'form-control mat-field-border text-right'"
                                            [name]="'transaction.quantity_{{ entryIdx }}'"
                                            [mask]="inputMaskFormat"
                                            [useMask]="true"
                                            [(ngModel)]="transaction.quantity"
                                            (change)="handleQuantityBlur(entry, transaction)"
                                            decimalDigitsDirective
                                        >
                                        </text-field>
                                        <mat-select
                                            class="form-control"
                                            [disabled]="!transaction.isStockTxn"
                                            (selectionChange)="
                                                onChangeUnit(transaction, $event);
                                                transaction.setAmount(entry);
                                                calculateWhenTrxAltered(entry, transaction)
                                            "
                                            [value]="transaction.stockUnit"
                                        >
                                            <mat-option *ngFor="let stock of transaction.stockList" [value]="stock.id">
                                                {{ stock.text }}
                                            </mat-option>
                                        </mat-select>
                                    </td>

                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        class="text-right item-rate"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.rateAllowed"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <!-- [customDecimalPlaces]="highPrecisionRate" -->
                                                <text-field
                                                    [readOnly]="!transaction.isStockTxn"
                                                    [placeholder]="commonLocaleData?.app_rate"
                                                    [type]="'text'"
                                                    [cssClass]="
                                                        'form-control mat-field-border transaction-rate text-right '
                                                    "
                                                    [name]="'transaction.rate_{{ entryIdx }}'"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency"
                                                    [mask]="inputMaskFormat"
                                                    [useMask]="true"
                                                    [(ngModel)]="transaction.rate"
                                                    (change)="
                                                        calculateStockEntryAmount(transaction);
                                                        calculateWhenTrxAltered(entry, transaction)
                                                    "
                                                ></text-field>
                                            </div>
                                            <!-- please add condition for show and hide -->
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="
                                                            transaction.rate * exchangeRate
                                                                ? transaction.rate * exchangeRate
                                                                : 0
                                                        "
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                        [ratePrecision]="true"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>

                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        class="text-right item-amount"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <text-field
                                                    (click)="transactionAmountClicked(transaction)"
                                                    [placeholder]="commonLocaleData?.app_amount"
                                                    [type]="'text'"
                                                    [cssClass]="'form-control mat-field-border text-right '"
                                                    [name]="'transaction.amount_{{ entryIdx }}'"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency"
                                                    [mask]="inputMaskFormat"
                                                    [useMask]="true"
                                                    [(ngModel)]="transaction.amount"
                                                    (change)="calculateWhenTrxAltered(entry, transaction, true, $event)"
                                                    decimalDigitsDirective
                                                ></text-field>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="transaction.convertedAmount"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>

                                    <td
                                        (click)="closeTaxControlPopup()"
                                        class="item-discount"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.discountAllowed"
                                    >
                                        <div class="td-wrapper">
                                            <div class="text-right flex-fill">
                                                <discount-control-component
                                                    #discountComponent
                                                    [discountMenu]="false"
                                                    [discountsList]="discountsList"
                                                    [discountAccountsDetails]="entry.discounts"
                                                    [discountSum]="entry.discountSum"
                                                    [showHeaderText]="false"
                                                    (hideOtherPopups)="closeTaxControlPopup()"
                                                    (discountTotalUpdated)="
                                                        calculateWhenTrxAltered(entry, transaction, false, $event)
                                                    "
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency"
                                                    [commonLocaleData]="commonLocaleData"
                                                >
                                                </discount-control-component>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="entry.discountSum * exchangeRate"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>

                                    <td
                                        (click)="closeDiscountPopup()"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.taxesAllowed"
                                        class="position-relative dropdown-container item-tax"
                                    >
                                        <div class="td-wrapper">
                                            <div class="text-right flex-fill">
                                                <tax-control
                                                    #taxControlComponent
                                                    [taxes]="companyTaxesList"
                                                    [date]="entry.entryDate"
                                                    [taxRenderData]="entry.taxes"
                                                    [totalForTax]="transaction.taxableValue"
                                                    [applicableTaxes]="transaction.applicableTaxes"
                                                    [exceptTaxTypes]="exceptTaxTypes"
                                                    [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                    [showHeading]="false"
                                                    [rootClass]="'sales-invoice-table'"
                                                    (selectedTaxEvent)="transaction.applicableTaxes = $event"
                                                    (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                                    (hideOtherPopups)="closeDiscountPopup()"
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency"
                                                >
                                                </tax-control>
                                            </div>

                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>

                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        class="text-right item-total delete-btn-absolute"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <text-field
                                                    [type]="'text'"
                                                    [cssClass]="'form-control mat-field-border text-right '"
                                                    [name]="'transaction.amount_{{ entryIdx }}'"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency"
                                                    [mask]="inputMaskFormat"
                                                    [useMask]="true"
                                                    decimalDigitsDirective
                                                    [(ngModel)]="transaction.total"
                                                    (change)="calculateTransactionValueInclusively(entry, transaction)"
                                                >
                                                </text-field>

                                                <div *ngIf="isTcsTdsApplicable" class="wrap-other-tax">
                                                    <mat-checkbox
                                                        *ngIf="!entry.isOtherTaxApplicable"
                                                        [checked]="entry.isOtherTaxApplicable"
                                                        color="primary"
                                                        id="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                        [(ngModel)]="entry.isOtherTaxApplicable"
                                                        (change)="
                                                            toggleOtherTaxesAsidePane(
                                                                entry.isOtherTaxApplicable,
                                                                entryIdx
                                                            )
                                                        "
                                                        class="other-taxes-checkbox"
                                                        name="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                    >
                                                    </mat-checkbox>
                                                    <label
                                                        for="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                        *ngIf="!entry.isOtherTaxApplicable"
                                                        class="other-tax-label font-13 align-middle"
                                                        (click)="tcsTdsIndex = entryIdx"
                                                        >{{ localeData?.other_tax }}</label
                                                    >
                                                </div>
                                                <div *ngIf="entry.isOtherTaxApplicable" class="mr-t1">
                                                    <span>
                                                        <div class="d-flex align-items-center">
                                                            <span class="mr-r05">
                                                                <a
                                                                    href="javascript: void 0"
                                                                    (click)="toggleOtherTaxesAsidePane(true, entryIdx)"
                                                                >
                                                                    <img src="assets/images/edit-pencilicon.svg" />
                                                                </a>
                                                            </span>
                                                            <text-field
                                                                [readOnly]="disabled"
                                                                [cssClass]="'text-right form-control other-taxes-input'"
                                                                [name]="'transaction.amount_{{ entryIdx }}'"
                                                                [prefix]="invFormData.accountDetails.currencySymbol"
                                                                [suffix]="selectedSuffixForCurrency"
                                                                [mask]="inputMaskFormat"
                                                                [useMask]="true"
                                                                [(ngModel)]="entry.otherTaxSum"
                                                            ></text-field>
                                                        </div>

                                                        <p class="mr-r05 font-12 text-capitalize mr-b2">
                                                            {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                        </p>
                                                    </span>
                                                </div>
                                            </div>
                                            <div
                                                *ngIf="
                                                    entry.isOtherTaxApplicable &&
                                                    isMulticurrencyAccount &&
                                                    entry.otherTaxModal?.appliedOtherTax?.name
                                                "
                                                class="tax-in-currency"
                                            >
                                                <span>
                                                    <amount-field
                                                        [amount]="entry.otherTaxSum * exchangeRate"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="transaction.convertedTotal"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>

                                            <ng-container
                                                *ngTemplateOutlet="otherTaxesModal; context: { $implicit: entry }"
                                            >
                                            </ng-container>
                                        </div>

                                        <div
                                            class="trash-icon-delete"
                                            (click)="
                                                removeTransaction(entryIdx);
                                                $event.preventDefault();
                                                $event.stopPropagation()
                                            "
                                        >
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <!-- endregion -->
                                <!-- </ng-container> -->
                            </ng-template>

                            <!-- region add bulk items -->
                            <div class="p-1 aqua-color add-line-bulk-item width-100">
                                <a href="javascript:;" (click)="addBlankRow(null)">{{ localeData?.add_new_line }}</a>
                                <span class="font-14 add-bulk-button"> | </span>
                                <a (click)="addBulkItems()" href="javascript:;">{{ localeData?.add_bulk_entries }}</a>
                            </div>
                            <!-- endregion -->
                        </table>

                        <div class="row mr-0 ml-0 other-details-section">
                            <div class="col-md-6">
                                <!-- region other details-->
                                <div *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.otherDetails">
                                    <div class="collapse-pane clearfix">
                                        <div
                                            class="collapse-pane-heading"
                                            (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed"
                                        >
                                            <div class="ico-box-wrap">
                                                <div class="ico-box">
                                                    <span
                                                        [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                                        aria-hidden="true"
                                                    ></span>
                                                </div>
                                            </div>

                                            <div class="ico-head">{{ commonLocaleData?.app_other_details }}</div>
                                        </div>

                                        <div
                                            [collapse]="isOthrDtlCollapsed"
                                            class="clearfix max-width-600 pd-l3 m-0 other-details-section-list"
                                        >
                                            <div class="row">
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <giddh-datepicker
                                                        [cssClass]="'shipping-date'"
                                                        #shippingDate="ngModel"
                                                        [placeholder]="templatePlaceholder?.shippedDateLabel"
                                                        name="shippingDate"
                                                        [(ngModel)]="invFormData.templateDetails.other.shippingDate"
                                                        [class.invalid-inp]="
                                                            shippingDate.errors &&
                                                            (shippingDate.dirty || shippingDate.touched)
                                                        "
                                                    >
                                                    </giddh-datepicker>

                                                    <p
                                                        class="text-danger"
                                                        *ngIf="
                                                            shippingDate.errors &&
                                                            (shippingDate.dirty || shippingDate.touched)
                                                        "
                                                    >
                                                        {{ localeData?.invalid_date }}
                                                    </p>
                                                </div>

                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        type="text"
                                                        name="shippedVia"
                                                        [(ngModel)]="invFormData.templateDetails.other.shippedVia"
                                                        class="form-control"
                                                        [placeholder]="
                                                            templatePlaceholder?.shippedViaLabel || localeData?.ship_via
                                                        "
                                                    ></text-field>
                                                </div>

                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        type="text"
                                                        name="trackingNumber"
                                                        [(ngModel)]="invFormData.templateDetails.other.trackingNumber"
                                                        class="form-control"
                                                        [placeholder]="
                                                            templatePlaceholder?.trackingNumber ||
                                                            localeData?.tracking_number
                                                        "
                                                    ></text-field>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        type="text"
                                                        name="customField1"
                                                        [(ngModel)]="invFormData.templateDetails.other.customField1"
                                                        class="form-control"
                                                        [placeholder]="
                                                            templatePlaceholder?.customField1Label || localeData?.field1
                                                        "
                                                    ></text-field>
                                                </div>

                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        type="text"
                                                        name="customField2"
                                                        [(ngModel)]="invFormData.templateDetails.other.customField2"
                                                        class="form-control"
                                                        [placeholder]="
                                                            templatePlaceholder?.customField2Label || localeData?.field2
                                                        "
                                                    ></text-field>
                                                </div>

                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        type="text"
                                                        name="customField3"
                                                        [(ngModel)]="invFormData.templateDetails.other.customField3"
                                                        class="form-control"
                                                        [placeholder]="
                                                            templatePlaceholder?.customField3Label || localeData?.field3
                                                        "
                                                    ></text-field>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- endregion -->

                                <!-- region note/messages -->
                                <div class="pd-t1 pl-0 max-width-600" *ngIf="!isPurchaseInvoice">
                                    <label class="mr-b1">{{ commonLocaleData?.app_note }}</label>
                                    <textarea
                                        class="form-control textarea-height"
                                        hasFocus
                                        #message2="hasFocus"
                                        [class.error-box]="(invoiceForm?.controls)['message2']?.errors?.maxlength"
                                        name="message2"
                                        [maxlength]="shouldApplyMaxLengthOnNotes && !showNotesAtLastPage ? 200 : null"
                                        [(ngModel)]="invFormData.templateDetails.other.message2"
                                    >
                                    </textarea>
                                    <ng-container
                                        *ngIf="
                                            shouldApplyMaxLengthOnNotes &&
                                            invFormData?.templateDetails?.other?.message2?.length &&
                                            !showNotesAtLastPage &&
                                            (message2?.isFocused ||
                                                (invoiceForm?.controls)['message2']?.errors?.maxlength)
                                        "
                                    >
                                        <span class="max-character-label"
                                            >{{ commonLocaleData?.app_characters_left }}:&nbsp;</span
                                        ><span class="max-character-value">{{
                                            200 - invFormData?.templateDetails?.other?.message2?.length
                                        }}</span>
                                    </ng-container>
                                </div>
                                <!-- endregion -->

                                <div
                                    class="pd-t1 pl-0 max-width-600 position-relative"
                                    *ngIf="currentVoucherFormDetails?.attachmentAllowed || isPurchaseInvoice"
                                >
                                    <label class="mr-b1"
                                        ><i class="icon-file-path"></i> {{ localeData?.attachment }}</label
                                    >

                                    <label
                                        class="custom-file-label form-control cp position-relative"
                                        for="invoiceFile"
                                    >
                                        <em *ngIf="!selectedFileName && !isFileUploading">{{
                                            localeData?.drag_drop_file
                                        }}</em>
                                        <div
                                            *ngIf="isFileUploading"
                                            class="d-flex justify-content-center align-items-center"
                                        >
                                            <i class="fa fa-spinner rotate"></i>
                                        </div>
                                        <em *ngIf="selectedFileName && !isFileUploading" class="text-success">{{
                                            selectedFileName
                                        }}</em>
                                        <span class="text-success"
                                            ><i class="fa fa-check" *ngIf="selectedFileName && !isFileUploading"></i
                                        ></span>
                                        <span
                                            class="delete-image"
                                            (click)="attachmentDeleteConfirmationModel.show(); $event.preventDefault()"
                                            *ngIf="voucherApiVersion === 2 && selectedFileName && !isFileUploading"
                                        >
                                            <img src="assets/images/multiply.svg" />
                                        </span>
                                        <input
                                            type="file"
                                            name="invoiceFile"
                                            id="invoiceFile"
                                            [options]="fileUploadOptions"
                                            ngFileSelect
                                            [uploadInput]="uploadInput"
                                            (uploadOutput)="onUploadOutput($event)"
                                            (change)="onFileChange($event.target)"
                                            droppable="true"
                                        />
                                    </label>
                                </div>
                                <!-- endregion -->
                            </div>
                            <!-- region total section -->
                            <div class="col-md-6">
                                <section class="table-sec form-group">
                                    <div class="table-row">
                                        <div class="table-cell">{{ commonLocaleData?.app_total_amount }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails?.subTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="table-row">
                                        <div class="table-cell">{{ commonLocaleData?.app_discount }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.totalDiscount * -1"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="table-row">
                                        <div class="table-cell">{{ commonLocaleData?.app_taxable_value }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.totalTaxableValue"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="table-row" *ngIf="!excludeTax">
                                        <div class="table-cell">{{ commonLocaleData?.app_tax }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.gstTaxesTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="table-row" *ngIf="!excludeTax">
                                        <div class="table-cell">{{ commonLocaleData?.app_cess }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.cessTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="table-row" *ngIf="calculatedRoundOff !== 0">
                                        <div class="table-cell">
                                            <strong>{{ commonLocaleData?.app_round_off }}</strong>
                                        </div>

                                        <div class="table-cell figure-cell">
                                            <strong>
                                                <span class="d-flex justify-content-end">
                                                    <amount-field
                                                        [amount]="calculatedRoundOff"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currencySymbol
                                                                : false
                                                        "
                                                        [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currency?.code
                                                                : false
                                                        "
                                                    >
                                                    </amount-field>
                                                </span>
                                            </strong>
                                        </div>
                                    </div>

                                    <div class="table-row">
                                        <div class="table-cell bigger-dollar">
                                            <strong
                                                >{{ commonLocaleData?.app_total }}
                                                <span *ngIf="isMulticurrencyAccount">{{
                                                    invFormData.accountDetails.currencySymbol
                                                }}</span>
                                            </strong>
                                        </div>

                                        <div class="table-cell figure-cell">
                                            <strong>
                                                <span class="d-flex justify-content-end">
                                                    <amount-field
                                                        [amount]="invFormData.voucherDetails.grandTotal"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData.accountDetails?.currencySymbol
                                                                : false
                                                        "
                                                        [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData.accountDetails?.currency?.code
                                                                : false
                                                        "
                                                    >
                                                    </amount-field>
                                                </span>
                                            </strong>
                                        </div>
                                    </div>
                                    <!-- multicurrency feature (editable grand total make it functional) -->
                                    <div class="table-row" *ngIf="isMulticurrencyAccount">
                                        <div class="table-cell bigger-dollar">
                                            <strong
                                                >{{ commonLocaleData?.app_total }}
                                                <span>{{ baseCurrencySymbol }}</span>
                                            </strong>
                                        </div>

                                        <div class="table-cell figure-cell">
                                            <text-field
                                                #grandTotalInr
                                                type="text"
                                                [cssClass]="'form-control mat-field-border multicurrency-grandtotal '"
                                                [name]="'grandTotalMulDum'"
                                                [prefix]="baseCurrencySymbol"
                                                [suffix]="selectedSuffixForCurrency"
                                                [mask]="inputMaskFormat"
                                                [useMask]="true"
                                                [(ngModel)]="grandTotalMulDum"
                                                (blur)="
                                                    updateExchangeRate(grandTotalInr.value); recalculateConvertedTotal()
                                                "
                                            ></text-field>
                                        </div>
                                    </div>

                                    <div class="table-row" *ngIf="isTcsPresent">
                                        <div class="table-cell">{{ commonLocaleData?.app_tcs }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.tcsTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="table-row" *ngIf="isTdsPresent">
                                        <div class="table-cell">{{ commonLocaleData?.app_tds }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.tdsTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>

                                    <!--region balance due for non-purchase-->
                                    <div
                                        class="table-row"
                                        *ngIf="
                                            (isSalesInvoice ||
                                                currentVoucherFormDetails?.depositAllowed ||
                                                (voucherApiVersion === 2 &&
                                                    (isSalesInvoice ||
                                                        isPurchaseInvoice ||
                                                        isCreditNote ||
                                                        isDebitNote ||
                                                        isPendingVoucherType))) &&
                                            !(voucherApiVersion !== 2 && isPendingVoucherType && isCashInvoice)
                                        "
                                    >
                                        <div
                                            class="table-cell deposit-section"
                                            *ngIf="
                                                ((isSalesInvoice || isPurchaseInvoice || isCreditNote || isDebitNote) &&
                                                    (isAccountHaveAdvanceReceipts ||
                                                        isInvoiceAdjustedWithAdvanceReceipts)) ||
                                                (!isUpdateMode &&
                                                    (isSalesInvoice || currentVoucherFormDetails?.depositAllowed))
                                            "
                                        >
                                            <div class="btn-group">
                                                <div
                                                    (click)="clickedInside($event)"
                                                    id="deposit-dropdown"
                                                    class="form-group pd-1"
                                                >
                                                    <p>{{ localeData?.deposit }}</p>
                                                    <ul>
                                                        <ng-container
                                                            *ngIf="
                                                                (isSalesInvoice ||
                                                                    isPurchaseInvoice ||
                                                                    isCreditNote ||
                                                                    isDebitNote ||
                                                                    isPendingVoucherType) &&
                                                                (isAccountHaveAdvanceReceipts ||
                                                                    isInvoiceAdjustedWithAdvanceReceipts)
                                                            "
                                                        >
                                                            <li role="menuitem" class="mr-t1">
                                                                <div class="clearfix payment-mode deposit-payment-mode">
                                                                    <div class="pull-right balance-due-text">
                                                                        <div
                                                                            class="clearfix mr-b1 text-left"
                                                                            *ngIf="voucherApiVersion !== 2"
                                                                        >
                                                                            <mat-radio-group
                                                                                class="d-flex mb-2"
                                                                                [(ngModel)]="isAdjustAmount"
                                                                                name="advanceReceipt"
                                                                            >
                                                                                <mat-radio-button
                                                                                    color="primary"
                                                                                    id="adjustAmountNo"
                                                                                    [value]="false"
                                                                                    (click)="clickAdjustAmount(false)"
                                                                                    (change)="clickAdjustAmount($event)"
                                                                                    >{{ commonLocaleData?.app_no }}
                                                                                </mat-radio-button>
                                                                                <mat-radio-button
                                                                                    color="primary"
                                                                                    id="sacCodeType{{ entryIdx }}"
                                                                                    [value]="true"
                                                                                    (click)="clickAdjustAmount(true)"
                                                                                    (change)="clickAdjustAmount($event)"
                                                                                    >{{ commonLocaleData?.app_yes }}
                                                                                </mat-radio-button>
                                                                            </mat-radio-group>
                                                                        </div>

                                                                        <div class="clearfix mr-t05">
                                                                            <span class="pull-left">
                                                                                <p class="text-light">
                                                                                    <amount-field
                                                                                        [amount]="
                                                                                            adjustPaymentData.totalAdjustedAmount
                                                                                                | replace: '-':''
                                                                                        "
                                                                                        [currencySymbol]="
                                                                                            isMulticurrencyAccount
                                                                                                ? invFormData
                                                                                                      .accountDetails
                                                                                                      ?.currencySymbol
                                                                                                : false
                                                                                        "
                                                                                        [currencyCode]="
                                                                                            isMulticurrencyAccount
                                                                                                ? invFormData
                                                                                                      .accountDetails
                                                                                                      ?.currency?.code
                                                                                                : false
                                                                                        "
                                                                                    >
                                                                                    </amount-field>
                                                                                </p>
                                                                            </span>
                                                                            <a
                                                                                href="javascript:void(0)"
                                                                                (click)="clickAdjustAmount(true)"
                                                                                class="font-12 pl-1 color-primary"
                                                                                ><i class="icon-edit11"></i
                                                                            ></a>
                                                                        </div>
                                                                    </div>
                                                                    <label class="pull-right">{{
                                                                        localeData?.adjust_amount
                                                                    }}</label>
                                                                </div>
                                                            </li>
                                                        </ng-container>

                                                        <ng-container
                                                            *ngIf="
                                                                !isUpdateMode &&
                                                                (isSalesInvoice ||
                                                                    currentVoucherFormDetails?.depositAllowed)
                                                            "
                                                        >
                                                            <li role="menuitem" class="mr-t1">
                                                                <div class="clearfix payment-mode">
                                                                    <select-field
                                                                        [cssClass]="
                                                                            'form-control mat-field-border pull-right'
                                                                        "
                                                                        [name]="'depositAccountUniqueName'"
                                                                        [options]="bankAccounts$ | async"
                                                                        (selectedOption)="onSelectPaymentMode($event)"
                                                                        [placeholder]="
                                                                            commonLocaleData?.app_select_account
                                                                        "
                                                                        (onClear)="onSelectPaymentMode($event, true)"
                                                                    >
                                                                    </select-field>

                                                                    <label class="pull-right">{{
                                                                        commonLocaleData?.app_payment_mode
                                                                    }}</label>
                                                                </div>
                                                            </li>

                                                            <li
                                                                class="
                                                                    clearfix
                                                                    mr-t1
                                                                    d-flex
                                                                    align-items-center
                                                                    payment-mode-amount
                                                                "
                                                                *ngIf="
                                                                    isSalesInvoice ||
                                                                    currentVoucherFormDetails?.depositAllowed
                                                                "
                                                            >
                                                                <text-field
                                                                    (change)="
                                                                        calculateBalanceDue();
                                                                        updateDepositAmount($event.target.value)
                                                                    "
                                                                    [placeholder]="commonLocaleData?.app_amount"
                                                                    [cssClass]="
                                                                        'form-control
                                                                        amount-field
                                                                        due-amount-field
                                                                        text-right
                                                                        pull-right
                                                                        max-width-100
                                                                        mat-field-border 
                                                                        multicurrency-grandtotal'
                                                                    "
                                                                    [name]="'dueAmount'"
                                                                    [prefix]="depositCurrSymbol"
                                                                    [suffix]="selectedSuffixForCurrency"
                                                                    [mask]="inputMaskFormat"
                                                                    [useMask]="true"
                                                                    [(ngModel)]="depositAmount"
                                                                    [attr.required]="
                                                                        depositAccountUniqueName ? true : false
                                                                    "
                                                                    [type]="text"
                                                                ></text-field>
                                                                <label class="pull-right">{{
                                                                    commonLocaleData?.app_amount
                                                                }}</label>
                                                            </li>

                                                            <li
                                                                class="
                                                                    clearfix
                                                                    mr-t1
                                                                    d-flex
                                                                    align-items-center
                                                                    payment-mode-amount
                                                                "
                                                                *ngIf="isCashInvoice"
                                                            >
                                                                <span
                                                                    class="
                                                                        amount-field
                                                                        pull-right
                                                                        max-width-100
                                                                        amount-filed-cash
                                                                    "
                                                                >
                                                                    <span *ngIf="isMulticurrencyAccount">{{
                                                                        invFormData.accountDetails.currencySymbol
                                                                    }}</span>
                                                                    {{
                                                                        invFormData.voucherDetails.balanceDue
                                                                            | giddhCurrency
                                                                    }}</span
                                                                >
                                                                <label class="pull-right">{{
                                                                    commonLocaleData?.app_amount
                                                                }}</label>
                                                            </li>

                                                            <li
                                                                class="clearfix mr-t1 bigger-dollar"
                                                                *ngIf="
                                                                    isSalesInvoice ||
                                                                    (voucherApiVersion === 2 &&
                                                                        (isPurchaseInvoice ||
                                                                            isCreditNote ||
                                                                            isDebitNote ||
                                                                            isPendingVoucherType))
                                                                "
                                                            >
                                                                <strong class="pull-right balance-due-text">
                                                                    <span *ngIf="isMulticurrencyAccount">{{
                                                                        invFormData.accountDetails.currencySymbol
                                                                    }}</span>
                                                                    <ng-container
                                                                        *ngIf="adjustPaymentData?.totalAdjustedAmount"
                                                                    >
                                                                        {{
                                                                            adjustPaymentBalanceDueData | giddhCurrency
                                                                        }}
                                                                    </ng-container>
                                                                    <ng-container
                                                                        *ngIf="!adjustPaymentData?.totalAdjustedAmount"
                                                                    >
                                                                        {{
                                                                            invFormData.voucherDetails.balanceDue
                                                                                | giddhCurrency
                                                                        }}
                                                                    </ng-container>
                                                                </strong>
                                                                <strong class="pull-right">{{
                                                                    localeData?.balance_due
                                                                }}</strong>
                                                            </li>
                                                        </ng-container>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div
                                        class="table-row"
                                        *ngIf="
                                            !hideDepositSection &&
                                            !isUpdateMode &&
                                            isCashInvoice &&
                                            !(
                                                isSalesInvoice ||
                                                isPurchaseInvoice ||
                                                isCreditNote ||
                                                isDebitNote ||
                                                isPendingVoucherType ||
                                                isAccountHaveAdvanceReceipts ||
                                                isInvoiceAdjustedWithAdvanceReceipts
                                            )
                                        "
                                    >
                                        <div class="table-cell deposit-section">
                                            <div class="btn-group">
                                                <div
                                                    (click)="clickedInside($event)"
                                                    id="deposit-dropdown"
                                                    class="form-group pd-1"
                                                >
                                                    <p>{{ localeData?.deposit }}</p>
                                                    <ul>
                                                        <ng-container>
                                                            <li role="menuitem" class="mr-t1">
                                                                <div class="clearfix payment-mode">
                                                                    <select-field
                                                                        [cssClass]="
                                                                            'form-control mat-field-border pull-right'
                                                                        "
                                                                        [name]="'depositAccountUniqueName'"
                                                                        [options]="bankAccounts$ | async"
                                                                        (selectedOption)="onSelectPaymentMode($event)"
                                                                        [placeholder]="
                                                                            commonLocaleData?.app_select_account
                                                                        "
                                                                        (onClear)="onSelectPaymentMode($event, true)"
                                                                        [defaultValue]="selectedBankAccount"
                                                                    >
                                                                    </select-field>
                                                                    <label class="pull-right">{{
                                                                        localeData?.account
                                                                    }}</label>
                                                                </div>
                                                            </li>
                                                        </ng-container>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--endregion-->

                                    <!-- region balance due for purchase -->
                                    <div class="table-row" *ngIf="isPurchaseInvoice && voucherApiVersion !== 2">
                                        <div class="table-cell">
                                            <strong
                                                >{{ localeData?.balance_due }}
                                                <span *ngIf="isMulticurrencyAccount">{{
                                                    invFormData.accountDetails.currencySymbol
                                                }}</span></strong
                                            >
                                        </div>
                                        <div class="table-cell figure-cell">
                                            <strong>{{ invFormData.voucherDetails.balanceDue | giddhCurrency }}</strong>
                                        </div>
                                    </div>
                                    <!-- endregion -->
                                </section>
                            </div>
                            <!-- endregion -->
                        </div>
                    </section>
                    <!-- endregion -->

                    <!-- region mobile view -->
                    <div class="show-in-mobile" *ngIf="isMobileScreen">
                        <div
                            class="card-invoice-table-wrapper"
                            *ngFor="let entry of invFormData.entries; let entryIdx = index"
                        >
                            <ng-container *ngFor="let transaction of entry.transactions">
                                <!-- region static entry -->
                                <div class="card-invoice-table" [hidden]="activeIndx === entryIdx">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="single-card-row">
                                                <div class="product-name">
                                                    <label class="card-label">{{
                                                        localeData?.product_service_description
                                                    }}</label>
                                                    <label
                                                        *ngIf="!transaction.accountName"
                                                        class="select-account-label"
                                                        >{{ localeData?.select_account }}</label
                                                    >
                                                    <p>{{ transaction.accountName }}</p>
                                                    <span *ngIf="transaction.stockDetails?.uniqueName"
                                                        >({{ transaction.stockDetails?.name }})</span
                                                    >
                                                </div>

                                                <p class="description">
                                                    {{ transaction.description }}
                                                </p>
                                                <p
                                                    class="small text-muted sku-and-custom-fields"
                                                    *ngIf="transaction.sku_and_customfields"
                                                >
                                                    {{ transaction.sku_and_customfields }}
                                                </p>

                                                <div class="date-hsn-code pr-0">
                                                    <div class="row">
                                                        <div class="col-sm-6" *ngIf="entry.entryDate">
                                                            <div class="entry-date">
                                                                <label
                                                                    >{{ localeData?.entry_date }}:
                                                                    {{ entry.entryDate }}
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div
                                                            class="col-sm-6 pl-0"
                                                            *ngIf="transaction.hsnNumber || transaction.sacNumber"
                                                        >
                                                            <div class="hsn-code text-right">
                                                                <label
                                                                    >{{
                                                                        transaction.showCodeType === "hsn"
                                                                            ? commonLocaleData?.app_hsn
                                                                            : commonLocaleData?.app_sac
                                                                    }}:
                                                                    {{
                                                                        transaction.showCodeType === "hsn"
                                                                            ? transaction.hsnNumber
                                                                            : transaction.sacNumber
                                                                    }}</label
                                                                >
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="single-card-row">
                                                <div class="qty-unit">
                                                    <label class="card-label">{{
                                                        commonLocaleData?.app_quantity_unit
                                                    }}</label>
                                                    <p>{{ transaction.quantity }} {{ transaction.stockUnit }}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="single-card-row">
                                                <div class="card-rate">
                                                    <label class="card-label">{{ commonLocaleData?.app_rate }}</label>
                                                    <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                                        <p class="d-flex">
                                                            <amount-field
                                                                [amount]="transaction.rate"
                                                                [currencySymbol]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails.currencySymbol
                                                                        : false
                                                                "
                                                                [currencyCode]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails?.currency?.code
                                                                        : false
                                                                "
                                                                [ratePrecision]="true"
                                                            >
                                                            </amount-field>
                                                        </p>
                                                        <div *ngIf="isMulticurrencyAccount" class="differ-currency">
                                                            <amount-field
                                                                [amount]="
                                                                    transaction.rate * exchangeRate
                                                                        ? transaction.rate * exchangeRate
                                                                        : 0
                                                                "
                                                                [currencySymbol]="baseCurrencySymbol"
                                                                [currencyCode]="companyCurrency"
                                                                [ratePrecision]="true"
                                                            >
                                                            </amount-field>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="single-card-row">
                                                <div class="card-amount">
                                                    <label class="card-label">{{ commonLocaleData?.app_amount }}</label>
                                                    <p class="d-flex">
                                                        <amount-field
                                                            [amount]="transaction.amount ? transaction.amount : '0'"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </p>

                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="transaction.convertedAmount"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="single-card-row">
                                                <div class="card-discount">
                                                    <label class="card-label">{{
                                                        commonLocaleData?.app_discount
                                                    }}</label>
                                                    <p class="d-flex">
                                                        <amount-field
                                                            [amount]="entry.discountSum"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </p>
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="entry.discountSum * exchangeRate"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="single-card-row">
                                                <div class="card-tax">
                                                    <label class="card-label">{{ commonLocaleData?.app_tax }}</label>
                                                    <p class="d-flex">
                                                        <amount-field
                                                            [amount]="entry.taxSum"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </p>
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="single-card-row">
                                                <div class="card-total">
                                                    <label class="card-label">{{ commonLocaleData?.app_total }}</label>
                                                    <p class="d-flex">
                                                        <amount-field
                                                            [amount]="transaction.total"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </p>
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="transaction.convertedTotal"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="edit-card" (click)="setActiveIndx(entryIdx); $event.stopPropagation()">
                                        <img src="assets/images/edit-pencilicon.svg" />
                                    </div>

                                    <div
                                        class="del-card"
                                        (click)="
                                            removeTransaction(entryIdx);
                                            $event.preventDefault();
                                            $event.stopPropagation()
                                        "
                                    >
                                        <i class="icon-trash" aria-hidden="true"></i>
                                    </div>
                                </div>
                                <!-- endregion -->

                                <!-- region dynamic entry -->
                                <div
                                    class="card-invoice-table edit-card-invoice-table"
                                    [hidden]="activeIndx !== entryIdx"
                                >
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="single-card-row">
                                                <div class="product-name">
                                                    <label class="card-label">{{
                                                        localeData?.product_service_description
                                                    }}</label>
                                                    <div class="product-name">
                                                        <div class="ng-select-wrap">
                                                            <sh-select
                                                                [options]="salesAccounts$ | async"
                                                                #selectAccount
                                                                [(ngModel)]="transaction.fakeAccForSelect2"
                                                                name="transaction.fakeAccForSelect2_{{ entryIdx }}"
                                                                (selected)="
                                                                    onSelectSalesAccount(
                                                                        $event,
                                                                        transaction,
                                                                        entry,
                                                                        false,
                                                                        false,
                                                                        entryIdx
                                                                    )
                                                                "
                                                                [placeholder]="localeData?.select_acc"
                                                                [notFoundLink]="true"
                                                                [isPaginationEnabled]="true"
                                                                (scrollEnd)="handleScrollEnd('item')"
                                                                (dynamicSearchedQuery)="
                                                                    onSearchQueryChanged($event, 1, 'item')
                                                                "
                                                                [notFoundMsg]="noResultsFoundLabel"
                                                                [enableDynamicSearch]="true"
                                                                (onHide)="resetPreviousSearchResults(true, 'item')"
                                                                [forceClearReactive]="forceClear$ | async"
                                                                (noResultsClicked)="onNoResultsClicked(entryIdx)"
                                                                [multiple]="false"
                                                                [ItemHeight]="67"
                                                                (onClear)="onClearSalesAccount(transaction)"
                                                                [useInBuiltFilterForFlattenAc]="true"
                                                            >
                                                                <ng-template #optionTemplate let-option="option">
                                                                    <ng-container *ngIf="!option.additional?.stock">
                                                                        <a
                                                                            href="javascript:void(0)"
                                                                            class="list-item flex-column"
                                                                        >
                                                                            <div class="item">{{ option?.label }}</div>
                                                                            <div class="item-unique">
                                                                                {{ option.additional?.uniqueName }}
                                                                            </div>
                                                                        </a>
                                                                    </ng-container>
                                                                    <ng-container *ngIf="option.additional?.stock">
                                                                        <a
                                                                            href="javascript:void(0)"
                                                                            class="list-item flex-column"
                                                                        >
                                                                            <div class="item">{{ option?.label }}</div>
                                                                            <div class="item-unique">
                                                                                {{ option.additional?.uniqueName }}
                                                                            </div>
                                                                            <div class="item-stock">
                                                                                {{ commonLocaleData?.app_stock }}:
                                                                                {{
                                                                                    option.additional?.stock?.uniqueName
                                                                                }}
                                                                            </div>
                                                                        </a>
                                                                    </ng-container>
                                                                </ng-template>
                                                            </sh-select>
                                                        </div>
                                                    </div>

                                                    <div *ngIf="transaction.fakeAccForSelect2">
                                                        <div class="sku-number">
                                                            <label>{{ commonLocaleData?.app_sku }}:</label
                                                            >{{ commonLocaleData?.app_number }}
                                                        </div>

                                                        <div class="description">
                                                            <textarea
                                                                type="text"
                                                                rows="3"
                                                                [placeholder]="localeData?.add_description"
                                                                #description
                                                                name="transaction.description_{{ entryIdx }}"
                                                                class="form-control"
                                                                [(ngModel)]="transaction.description"
                                                                [maxlength]="entryDescriptionLength"
                                                            >
                                                            </textarea>
                                                            <p class="font-12">
                                                                {{ commonLocaleData?.app_characters_left }}:
                                                                {{
                                                                    entryDescriptionLength -
                                                                        transaction.description?.length
                                                                }}
                                                            </p>
                                                            <p
                                                                class="small text-muted sku-and-custom-fields"
                                                                *ngIf="transaction.sku_and_customfields"
                                                            >
                                                                {{ transaction.sku_and_customfields }}
                                                            </p>
                                                        </div>

                                                        <!-- region entry date/ hsncode -->
                                                        <div class="date-hsn-code">
                                                            <div class="row">
                                                                <div class="col-xs-6 col-sm-6 pr-0">
                                                                    <div class="entry-date">
                                                                        <label>{{ localeData?.entry_date }}: </label>

                                                                        <span *ngIf="!isUpdateMode">
                                                                            <input
                                                                                type="text"
                                                                                [placeholder]="giddhDateFormat"
                                                                                bsDatepicker
                                                                                name="transaction.date_{{ entryIdx }}"
                                                                                id="transaction.date_{{ entryIdx }}"
                                                                                class="form-control text-left"
                                                                                [(ngModel)]="entry.entryDate"
                                                                                [disabled]="isUpdateMode"
                                                                                (onShown)="hsnDropdownShow = false"
                                                                                [bsConfig]="{
                                                                                    dateInputFormat: giddhDateFormat
                                                                                }"
                                                                                (bsValueChange)="
                                                                                    onBlurEntryDate(entryIdx, dp.isOpen)
                                                                                "
                                                                                #dp="bsDatepicker"
                                                                            />
                                                                            <span
                                                                                class="edit-icon cp"
                                                                                (click)="dp.toggle()"
                                                                                [attr.aria-expanded]="dp.isOpen"
                                                                            >
                                                                                <img
                                                                                    src="assets/images/edit-pencilicon.svg"
                                                                                />
                                                                            </span>
                                                                        </span>

                                                                        <span *ngIf="isUpdateMode">
                                                                            {{ entry.entryDate }}
                                                                        </span>
                                                                    </div>
                                                                </div>

                                                                <div class="col-6 pl-0">
                                                                    <div class="wrap-hsn-box 1">
                                                                        <div
                                                                            class="hsn-code text-right"
                                                                            (click)="toggleHsnSacDropDown(transaction)"
                                                                        >
                                                                            <label
                                                                                >{{
                                                                                    transaction.showCodeType === "hsn"
                                                                                        ? commonLocaleData?.app_hsn
                                                                                        : commonLocaleData?.app_sac
                                                                                }}:</label
                                                                            >
                                                                            <span>
                                                                                {{
                                                                                    transaction.showCodeType === "hsn"
                                                                                        ? transaction.hsnNumber
                                                                                        : transaction.sacNumber
                                                                                }}
                                                                                <span
                                                                                    *ngIf="
                                                                                        !transaction.hsnNumber &&
                                                                                        !transaction.sacNumber
                                                                                    "
                                                                                    class="update-text"
                                                                                    >{{ commonLocaleData?.app_update }}
                                                                                </span>
                                                                                <span class="edit-icon cp">
                                                                                    <img
                                                                                        src="assets/images/edit-pencilicon.svg"
                                                                                    />
                                                                                </span>
                                                                            </span>
                                                                        </div>

                                                                        <div
                                                                            class="hsn-code-dropdown"
                                                                            *ngIf="hsnDropdownShow"
                                                                        >
                                                                            <mat-radio-group
                                                                                class="d-flex mb-2"
                                                                                [(ngModel)]="transaction.showCodeType"
                                                                                (change)="
                                                                                    onChangeHsnSacType(transaction)
                                                                                "
                                                                                name="showCodeType{{ entryIdx }}"
                                                                            >
                                                                                <mat-radio-button
                                                                                    color="primary"
                                                                                    id="hsnCodeType{{ entryIdx }}"
                                                                                    [value]="'hsn'"
                                                                                    >{{
                                                                                        commonLocaleData?.app_hsn_code
                                                                                    }}
                                                                                </mat-radio-button>
                                                                                <mat-radio-button
                                                                                    color="primary"
                                                                                    id="sacCodeType{{ entryIdx }}"
                                                                                    [value]="'sac'"
                                                                                    >{{
                                                                                        commonLocaleData?.app_sac_code
                                                                                    }}
                                                                                </mat-radio-button>
                                                                            </mat-radio-group>
                                                                            <text-field
                                                                                type="text"
                                                                                maxLength="10"
                                                                                decimalDigitsDirective
                                                                                [placeholder]="localeData?.hsn_number"
                                                                                name="transaction.hsnNumber_{{
                                                                                    entryIdx
                                                                                }}"
                                                                                *ngIf="
                                                                                    transaction.showCodeType === 'hsn'
                                                                                "
                                                                                [(ngModel)]="transaction.hsnNumber"
                                                                            ></text-field>
                                                                            <text-field
                                                                                type="text"
                                                                                maxLength="10"
                                                                                decimalDigitsDirective
                                                                                [placeholder]="localeData?.sac_number"
                                                                                name="transaction.hsnNumber_{{
                                                                                    entryIdx
                                                                                }}"
                                                                                *ngIf="
                                                                                    transaction.showCodeType === 'sac'
                                                                                "
                                                                                [(ngModel)]="transaction.sacNumber"
                                                                            ></text-field>
                                                                            <div class="btn-group mt-2 pt-1 d-flex">
                                                                                <button
                                                                                    class="btn btn-sm btn-success"
                                                                                    type="button"
                                                                                    (click)="
                                                                                        hsnDropdownShow =
                                                                                            !hsnDropdownShow
                                                                                    "
                                                                                >
                                                                                    {{ commonLocaleData?.app_save }}
                                                                                </button>
                                                                                <button
                                                                                    class="btn btn-sm btn-primary mr-0"
                                                                                    type="button"
                                                                                    (click)="
                                                                                        hideHsnSacEditPopup(transaction)
                                                                                    "
                                                                                >
                                                                                    {{ commonLocaleData?.app_cancel }}
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row quantity-unit-w100">
                                        <div
                                            class="col-xs-6 col-sm-6"
                                            *ngIf="
                                                !currentVoucherFormDetails || currentVoucherFormDetails?.quantityAllowed
                                            "
                                        >
                                            <div class="single-card-row">
                                                <div class="qty-unit">
                                                    <div class="row">
                                                        <div class="col-xs-6 col-sm-6">
                                                            <label class="card-label text-right">{{
                                                                localeData?.qty
                                                            }}</label>
                                                            <text-field
                                                                type="text"
                                                                [readOnly]="!transaction.isStockTxn"
                                                                (change)="handleQuantityBlur(entry, transaction)"
                                                                [placeholder]="commonLocaleData?.app_quantity"
                                                                decimalDigitsDirective
                                                                [name]="'transaction.quantity_{{ entryIdx }}'"
                                                                [cssClass]="'form-control mat-field-border text-right'"
                                                                [(ngModel)]="transaction.quantity"
                                                            ></text-field>
                                                        </div>
                                                        <div class="col-xs-6 col-sm-6">
                                                            <label class="card-label text-right">{{
                                                                commonLocaleData?.app_unit
                                                            }}</label>
                                                            <mat-select
                                                                name="transaction.stockUnit_{{ entryIdx }}"
                                                                class="form-control"
                                                                [disabled]="!transaction.isStockTxn"
                                                                (selectionChange)="
                                                                    onChangeUnit(transaction, $event);
                                                                    transaction.setAmount(entry);
                                                                    calculateWhenTrxAltered(entry, transaction)
                                                                "
                                                                [value]="transaction.stockUnit"
                                                            >
                                                                <mat-option
                                                                    *ngFor="let stock of transaction.stockList"
                                                                    [value]="stock.id"
                                                                >
                                                                    {{ stock.text }}
                                                                </mat-option>
                                                            </mat-select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div
                                            class="col-xs-6 col-sm-6"
                                            *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.rateAllowed"
                                        >
                                            <div class="single-card-row">
                                                <div class="card-rate">
                                                    <label class="card-label text-right">{{
                                                        commonLocaleData?.app_rate
                                                    }}</label>
                                                    <div class="flex-fill">
                                                        <!--
                                                        [customDecimalPlaces]="highPrecisionRate"
                                                        -->
                                                        <text-field
                                                            [readOnly]="!transaction.isStockTxn"
                                                            [placeholder]="commonLocaleData?.app_rate"
                                                            [type]="'text'"
                                                            [cssClass]="
                                                                'form-control mat-field-border transaction-rate text-right '
                                                            "
                                                            [name]="'transaction.rate_{{ entryIdx }}'"
                                                            [prefix]="invFormData.accountDetails.currencySymbol"
                                                            [suffix]="selectedSuffixForCurrency"
                                                            [mask]="inputMaskFormat"
                                                            [useMask]="true"
                                                            [(ngModel)]="transaction.rate"
                                                            (change)="
                                                                calculateStockEntryAmount(transaction);
                                                                calculateWhenTrxAltered(
                                                                    entry,
                                                                    transaction,
                                                                    false,
                                                                    $event
                                                                )
                                                            "
                                                        ></text-field>
                                                    </div>
                                                    <!-- please add condition for show and hide -->
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="
                                                                transaction.rate * exchangeRate
                                                                    ? transaction.rate * exchangeRate
                                                                    : 0
                                                            "
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                            [ratePrecision]="true"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-6 col-sm-6">
                                            <div class="single-card-row">
                                                <div class="card-amount">
                                                    <label class="card-label text-right">{{
                                                        commonLocaleData?.app_amount
                                                    }}</label>
                                                    <div class="flex-fill">
                                                        <text-field
                                                            (click)="transactionAmountClicked(transaction)"
                                                            [placeholder]="commonLocaleData?.app_amount"
                                                            [type]="'tel'"
                                                            [cssClass]="
                                                                'form-control mat-field-border text-right hello'
                                                            "
                                                            [name]="'transaction.amount_{{ entryIdx }}'"
                                                            [prefix]="invFormData.accountDetails.currencySymbol"
                                                            [suffix]="selectedSuffixForCurrency"
                                                            [mask]="inputMaskFormat"
                                                            [useMask]="true"
                                                            decimalDigitsDirective
                                                            [(ngModel)]="transaction.amount"
                                                            (change)="
                                                                calculateWhenTrxAltered(
                                                                    entry,
                                                                    transaction,
                                                                    true,
                                                                    $event
                                                                )
                                                            "
                                                        ></text-field>
                                                    </div>
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="transaction.convertedAmount"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div
                                            class="col-xs-6 col-sm-6"
                                            *ngIf="
                                                !currentVoucherFormDetails || currentVoucherFormDetails?.discountAllowed
                                            "
                                        >
                                            <div class="single-card-row">
                                                <div class="card-discount">
                                                    <label class="card-label text-right">{{
                                                        commonLocaleData?.app_discount
                                                    }}</label>
                                                    <div class="text-right flex-fill">
                                                        <discount-control-component
                                                            #discountComponent
                                                            [discountMenu]="false"
                                                            [discountsList]="discountsList"
                                                            [discountAccountsDetails]="entry.discounts"
                                                            [discountSum]="entry.discountSum"
                                                            [showHeaderText]="false"
                                                            (hideOtherPopups)="closeTaxControlPopup()"
                                                            (discountTotalUpdated)="
                                                                calculateWhenTrxAltered(
                                                                    entry,
                                                                    transaction,
                                                                    false,
                                                                    $event
                                                                )
                                                            "
                                                            [maskInput]="inputMaskFormat"
                                                            [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                            [suffixInput]="selectedSuffixForCurrency"
                                                            [commonLocaleData]="commonLocaleData"
                                                        >
                                                        </discount-control-component>
                                                    </div>
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="entry.discountSum * exchangeRate"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div
                                            class="col-xs-6 col-sm-6"
                                            *ngIf="
                                                !currentVoucherFormDetails || currentVoucherFormDetails?.taxesAllowed
                                            "
                                        >
                                            <div class="single-card-row">
                                                <div class="card-tax">
                                                    <label class="card-label text-right">{{
                                                        commonLocaleData?.app_tax
                                                    }}</label>

                                                    <div class="text-right flex-fill">
                                                        <tax-control
                                                            #taxControlComponent
                                                            [taxes]="companyTaxesList"
                                                            [date]="entry.entryDate"
                                                            [taxRenderData]="entry.taxes"
                                                            [totalForTax]="transaction.taxableValue"
                                                            [applicableTaxes]="transaction.applicableTaxes"
                                                            [exceptTaxTypes]="exceptTaxTypes"
                                                            [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                            [showHeading]="false"
                                                            [rootClass]="'sales-invoice-table'"
                                                            (selectedTaxEvent)="transaction.applicableTaxes = $event"
                                                            (taxAmountSumEvent)="
                                                                calculateWhenTrxAltered(entry, transaction)
                                                            "
                                                            (hideOtherPopups)="closeDiscountPopup()"
                                                            [maskInput]="inputMaskFormat"
                                                            [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                            [suffixInput]="selectedSuffixForCurrency"
                                                        >
                                                        </tax-control>
                                                    </div>
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xs-6 col-sm-6">
                                            <div class="single-card-row">
                                                <div class="card-total">
                                                    <label class="card-label text-right">{{
                                                        commonLocaleData?.app_total
                                                    }}</label>
                                                    <div class="flex-fill">
                                                        <text-field
                                                            [type]="'tel'"
                                                            [cssClass]="'form-control mat-field-border text-right '"
                                                            [name]="'transaction.total_{{ entryIdx }}'"
                                                            [prefix]="invFormData.accountDetails.currencySymbol"
                                                            [suffix]="selectedSuffixForCurrency"
                                                            [mask]="inputMaskFormat"
                                                            [useMask]="true"
                                                            decimalDigitsDirective
                                                            [(ngModel)]="transaction.total"
                                                            (change)="
                                                                calculateTransactionValueInclusively(entry, transaction)
                                                            "
                                                        >
                                                        </text-field>

                                                        <div *ngIf="isTcsTdsApplicable" class="wrap-other-tax">
                                                            <mat-checkbox
                                                                *ngIf="!entry.isOtherTaxApplicable"
                                                                [checked]="entry.isOtherTaxApplicable"
                                                                color="primary"
                                                                id="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                                [(ngModel)]="entry.isOtherTaxApplicable"
                                                                (change)="
                                                                    toggleOtherTaxesAsidePane(
                                                                        entry.isOtherTaxApplicable,
                                                                        entryIdx
                                                                    )
                                                                "
                                                                class="other-taxes-checkbox"
                                                                name="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                            >
                                                            </mat-checkbox>
                                                            <label
                                                                for="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                                *ngIf="!entry.isOtherTaxApplicable"
                                                                class="other-tax-label font-13 align-middle"
                                                                (click)="tcsTdsIndex = entryIdx"
                                                                >{{ localeData?.other_tax }}</label
                                                            >
                                                        </div>
                                                        <div
                                                            *ngIf="entry.isOtherTaxApplicable"
                                                            class="mr-t1 other-taxes"
                                                        >
                                                            <span>
                                                                <div class="d-flex align-items-center">
                                                                    <span class="mr-r05">
                                                                        <a
                                                                            href="javascript:;"
                                                                            (click)="
                                                                                toggleOtherTaxesAsidePane(
                                                                                    true,
                                                                                    entryIdx
                                                                                )
                                                                            "
                                                                        >
                                                                            <img
                                                                                src="assets/images/edit-pencilicon.svg"
                                                                            />
                                                                        </a>
                                                                    </span>
                                                                    <text-field
                                                                        [readonly]="disabled"
                                                                        type="text"
                                                                        [cssClass]="
                                                                            'form-control mat-field-border text-right  other-taxes-input'
                                                                        "
                                                                        [prefix]="
                                                                            invFormData.accountDetails.currencySymbol
                                                                        "
                                                                        [suffix]="selectedSuffixForCurrency"
                                                                        [name]="'entry.otherTaxesSum_{{ entryIdx }}'"
                                                                        [mask]="inputMaskFormat"
                                                                        [useMask]="true"
                                                                        [(ngModel)]="entry.otherTaxSum"
                                                                    >
                                                                    </text-field>
                                                                </div>

                                                                <p class="mr-t05 font-12 text-capitalize mr-b2">
                                                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                                </p>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div
                                                        *ngIf="
                                                            entry.isOtherTaxApplicable &&
                                                            isMulticurrencyAccount &&
                                                            entry.otherTaxModal?.appliedOtherTax?.name
                                                        "
                                                        class="tax-in-currency d-flex"
                                                    >
                                                        <span class="mr-l05">
                                                            <amount-field
                                                                [amount]="entry.otherTaxSum * exchangeRate"
                                                                [currencySymbol]="baseCurrencySymbol"
                                                                [currencyCode]="companyCurrency"
                                                            >
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                    <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                        <amount-field
                                                            [amount]="transaction.convertedTotal"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </div>

                                                    <ng-container
                                                        *ngTemplateOutlet="
                                                            otherTaxesModal;
                                                            context: { $implicit: entry }
                                                        "
                                                    >
                                                    </ng-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="save-card-data pointer" (click)="handleOutsideClick()">
                                        <i class="icon-save" aria-hidden="true"></i>
                                    </div>

                                    <div
                                        class="del-card pointer"
                                        (click)="
                                            removeTransaction(entryIdx);
                                            $event.preventDefault();
                                            $event.stopPropagation()
                                        "
                                    >
                                        <i class="icon-trash" aria-hidden="true"></i>
                                    </div>
                                </div>
                                <!-- endregion -->
                            </ng-container>
                        </div>

                        <div class="add-btn">
                            <button class="btn btn-sm btn-success" (click)="addBlankRow(null)">
                                {{ commonLocaleData?.app_add_more }}
                            </button>
                        </div>

                        <div class="other-detail-card">
                            <div *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.otherDetails">
                                <mat-expansion-panel class="other-details-expansion-panel">
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>
                                            {{ commonLocaleData?.app_other_details }}
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <div class="row invoice-other-details-row">
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <giddh-datepicker
                                                [cssClass]="'shipping-date'"
                                                #shippingDate="ngModel"
                                                [placeholder]="templatePlaceholder?.shippedDateLabel"
                                                name="shippingDate"
                                                [(ngModel)]="invFormData.templateDetails.other.shippingDate"
                                                [class.invalid-inp]="
                                                    shippingDate.errors && (shippingDate.dirty || shippingDate.touched)
                                                "
                                            >
                                            </giddh-datepicker>
                                            <p
                                                class="text-danger"
                                                *ngIf="
                                                    shippingDate.errors && (shippingDate.dirty || shippingDate.touched)
                                                "
                                            >
                                                {{ localeData?.invalid_date }}
                                            </p>
                                        </div>
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <text-field
                                                type="text"
                                                name="shippedVia"
                                                [(ngModel)]="invFormData.templateDetails.other.shippedVia"
                                                class="form-control"
                                                [placeholder]="
                                                    templatePlaceholder?.shippedViaLabel || localeData?.ship_via
                                                "
                                            ></text-field>
                                        </div>
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <text-field
                                                type="text"
                                                name="trackingNumber"
                                                [(ngModel)]="invFormData.templateDetails.other.trackingNumber"
                                                class="form-control"
                                                [placeholder]="
                                                    templatePlaceholder?.trackingNumber || localeData?.tracking_number
                                                "
                                            ></text-field>
                                        </div>
                                    </div>
                                    <div class="row invoice-other-details-row">
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <text-field
                                                type="text"
                                                name="customField1"
                                                [(ngModel)]="invFormData.templateDetails.other.customField1"
                                                [cssClass]="'form-control mat-field-border'"
                                                [placeholder]="
                                                    templatePlaceholder?.customField1Label || localeData?.field1
                                                "
                                            ></text-field>
                                        </div>
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <text-field
                                                type="text"
                                                name="customField2"
                                                [(ngModel)]="invFormData.templateDetails.other.customField2"
                                                [cssClass]="'form-control mat-field-border'"
                                                [placeholder]="
                                                    templatePlaceholder?.customField2Label || localeData?.field2
                                                "
                                            ></text-field>
                                        </div>
                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                            <text-field
                                                type="text"
                                                name="customField3"
                                                [(ngModel)]="invFormData.templateDetails.other.customField3"
                                                [cssClass]="'form-control mat-field-border'"
                                                [placeholder]="
                                                    templatePlaceholder?.customField3Label || localeData?.field3
                                                "
                                            ></text-field>
                                        </div>
                                    </div>
                                </mat-expansion-panel>
                            </div>
                            <div class="pd-t1 pl-0 max-width-600" *ngIf="!isPurchaseInvoice">
                                <label class="mr-b1">{{ commonLocaleData?.app_note }}</label>
                                <textarea
                                    matInput
                                    class="form-control textarea-height mat-field-border"
                                    hasFocus
                                    #message2="hasFocus"
                                    [class.error-box]="(invoiceForm?.controls)['message2']?.errors?.maxlength"
                                    name="message2"
                                    [maxlength]="shouldApplyMaxLengthOnNotes && !showNotesAtLastPage ? 200 : null"
                                    [(ngModel)]="invFormData.templateDetails.other.message2"
                                >
                                </textarea>
                            </div>
                        </div>

                        <div class="total-amount-description">
                            <section class="table-sec form-group">
                                <div class="table-row">
                                    <div class="table-cell">{{ commonLocaleData?.app_total_amount }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.subTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row">
                                    <div class="table-cell">{{ commonLocaleData?.app_discount }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.totalDiscount * -1"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row">
                                    <div class="table-cell">{{ commonLocaleData?.app_taxable_value }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.totalTaxableValue"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="!excludeTax">
                                    <div class="table-cell">{{ commonLocaleData?.app_tax }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.gstTaxesTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="!excludeTax">
                                    <div class="table-cell">{{ commonLocaleData?.app_cess }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.cessTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>
                                <div class="table-row" *ngIf="calculatedRoundOff > 0 || calculatedRoundOff < 0">
                                    <div class="table-cell">
                                        <strong>{{ commonLocaleData?.app_round_off }}</strong>
                                    </div>

                                    <div class="table-cell figure-cell">
                                        <strong>
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="calculatedRoundOff"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </strong>
                                    </div>
                                </div>
                                <div class="table-row">
                                    <div class="table-cell">
                                        <strong
                                            >{{ commonLocaleData?.app_total }}
                                            <span *ngIf="isMulticurrencyAccount">{{
                                                invFormData.accountDetails.currencySymbol
                                            }}</span></strong
                                        >
                                    </div>

                                    <div class="table-cell figure-cell">
                                        <strong>
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.grandTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </strong>
                                    </div>
                                </div>
                                <div class="table-row" *ngIf="isMulticurrencyAccount">
                                    <div class="table-cell bigger-dollar">
                                        <strong
                                            >{{ commonLocaleData?.app_total }} <span>{{ baseCurrencySymbol }}</span>
                                        </strong>
                                    </div>

                                    <div class="table-cell figure-cell">
                                        <text-field
                                            #grandTotalInr
                                            type="text"
                                            [cssClass]="'form-control mat-field-border multicurrency-grandtotal '"
                                            name="grandTotalMulDum"
                                            [prefix]="baseCurrencySymbol"
                                            [suffix]="selectedSuffixForCurrency"
                                            [mask]="inputMaskFormat"
                                            [useMask]="true"
                                            [(ngModel)]="grandTotalMulDum"
                                            (blur)="
                                                updateExchangeRate(grandTotalInr.value); recalculateConvertedTotal()
                                            "
                                        ></text-field>
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="isTcsPresent">
                                    <div class="table-cell">{{ commonLocaleData?.app_tcs }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.tcsTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.accountDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>

                                <div class="table-row" *ngIf="isTdsPresent">
                                    <div class="table-cell">{{ commonLocaleData?.app_tds }}</div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.tdsTotal"
                                                [currencySymbol]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.voucherDetails?.currencySymbol
                                                        : false
                                                "
                                                [currencyCode]="
                                                    isMulticurrencyAccount
                                                        ? invFormData.voucherDetails?.currency?.code
                                                        : false
                                                "
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>
                                <!--region balance due for non-purchase-->
                                <div
                                    class="table-row"
                                    *ngIf="
                                        !hideDepositSection &&
                                        (isSalesInvoice || currentVoucherFormDetails?.depositAllowed) &&
                                        !isUpdateMode
                                    "
                                >
                                    <div class="table-cell deposit-section">
                                        <div class="btn-group">
                                            <div
                                                (click)="clickedInside($event)"
                                                id="deposit-dropdown"
                                                class="form-group pd-1"
                                            >
                                                <p>{{ localeData?.deposit }}</p>
                                                <ul>
                                                    <li role="menuitem" class="mr-t1">
                                                        <div class="clearfix payment-mode deposit-payment-mode">
                                                            <select-field
                                                                [cssClass]="'form-control mat-field-border pull-right'"
                                                                [name]="'depositAccountUniqueName'"
                                                                [options]="bankAccounts$ | async"
                                                                (selectedOption)="onSelectPaymentMode($event)"
                                                                [placeholder]="commonLocaleData?.app_select_account"
                                                                (onClear)="onSelectPaymentMode($event, true)"
                                                            >
                                                            </select-field>

                                                            <label class="pull-right pt-1">{{
                                                                commonLocaleData?.app_payment_mode
                                                            }}</label>
                                                        </div>
                                                    </li>

                                                    <li
                                                        class="
                                                            clearfix
                                                            mr-t1
                                                            d-flex
                                                            align-items-center
                                                            payment-mode-amount
                                                        "
                                                        *ngIf="
                                                            isSalesInvoice || currentVoucherFormDetails?.depositAllowed
                                                        "
                                                    >
                                                        <text-field
                                                            type="text"
                                                            (change)="
                                                                calculateBalanceDue();
                                                                updateDepositAmount($event.target.value)
                                                            "
                                                            [placeholder]="commonLocaleData?.app_amount"
                                                            [name]="'dueAmount'"
                                                            [cssClass]="
                                                                '
                                                                form-control
                                                                amount-field
                                                                text-right
                                                                pull-right
                                                                max-width-100
                                                                multicurrency-grandtotal'
                                                            "
                                                            [(ngModel)]="depositAmount"
                                                            [prefix]="depositCurrSymbol"
                                                            [suffix]="selectedSuffixForCurrency"
                                                            [mask]="inputMaskFormat"
                                                            [attr.required]="depositAccountUniqueName ? true : false"
                                                        >
                                                        </text-field>
                                                        <label class="pull-right pt-1">{{
                                                            commonLocaleData?.app_amount
                                                        }}</label>
                                                    </li>

                                                    <li
                                                        class="
                                                            clearfix
                                                            mr-t1
                                                            d-flex
                                                            align-items-center
                                                            payment-mode-amount
                                                        "
                                                        *ngIf="isCashInvoice"
                                                    >
                                                        <span
                                                            class="
                                                                amount-field
                                                                pull-right
                                                                max-width-100
                                                                amount-filed-cash
                                                            "
                                                        >
                                                            <amount-field
                                                                [amount]="invFormData.voucherDetails.balanceDue"
                                                                [currencySymbol]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails?.currencySymbol
                                                                        : false
                                                                "
                                                                [currencyCode]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails?.currency?.code
                                                                        : false
                                                                "
                                                            >
                                                            </amount-field>
                                                        </span>
                                                        <label class="pull-right pt-1">{{
                                                            commonLocaleData?.app_amount
                                                        }}</label>
                                                    </li>

                                                    <li class="clearfix mr-t1 bigger-dollar" *ngIf="isSalesInvoice">
                                                        <strong class="pull-right balance-due-text">
                                                            <span>
                                                                <amount-field
                                                                    [amount]="invFormData.voucherDetails.balanceDue"
                                                                    [currencySymbol]="
                                                                        isMulticurrencyAccount
                                                                            ? invFormData.accountDetails?.currencySymbol
                                                                            : false
                                                                    "
                                                                    [currencyCode]="
                                                                        isMulticurrencyAccount
                                                                            ? invFormData.accountDetails?.currency?.code
                                                                            : false
                                                                    "
                                                                >
                                                                </amount-field>
                                                            </span>
                                                        </strong>
                                                        <strong class="pull-right">{{
                                                            localeData?.balance_due
                                                        }}</strong>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--endregion-->

                                <!-- region balance due for purchase -->
                                <div class="table-row" *ngIf="isPurchaseInvoice">
                                    <div class="table-cell">
                                        <strong
                                            >{{ localeData?.balance_due }}
                                            <span *ngIf="isMulticurrencyAccount">{{
                                                invFormData.accountDetails.currencySymbol
                                            }}</span></strong
                                        >
                                    </div>
                                    <div class="table-cell figure-cell">
                                        <span class="d-flex justify-content-end">
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.balanceDue"
                                                [currencySymbol]="false"
                                                [currencyCode]="false"
                                            >
                                            </amount-field>
                                        </span>
                                    </div>
                                </div>
                                <!-- endregion -->
                            </section>
                        </div>
                    </div>
                    <!-- endregion -->
                </ng-container>
                <!-- endregion -->

                <!-- endregion -->

                <!-- region submit actions-->
                <section class="clearfix mr-b5">
                    <section
                        id="actionPane"
                        class="text-center mr-b2"
                        [ngClass]="{ 'giddh-overlap-block': invFormData.voucherDetails.customerName }"
                    >
                        <div class="col-12">
                            <!-- region generate mode -->
                            <div class="pull-right pr update-mode" *ngIf="!isUpdateMode">
                                <button
                                    mat-button
                                    (click)="resetInvoiceForm(invoiceForm)"
                                    class="btn btn-danger d-inline-block v-align-middle"
                                >
                                    {{ commonLocaleData?.app_clear }}
                                </button>

                                <!-- region purchase invoice -->
                                <span class="d-inline-block v-align-middle" *ngIf="isPurchaseInvoice">
                                    <button
                                        mat-button
                                        *ngIf="!isCompany"
                                        [disabled]="
                                            isFileUploading ||
                                            !hasVoucherEntry ||
                                            (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                            isMobileNumberInvalid
                                        "
                                        (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                        class="btn btn-default"
                                    >
                                        {{ commonLocaleData?.app_save }}
                                    </button>
                                </span>
                                <!-- endregion -->

                                <!-- region non purchase -->
                                <span
                                    class="d-inline-block v-align-middle"
                                    *ngIf="!isPurchaseInvoice && !isProformaInvoice && !isEstimateInvoice"
                                >
                                    <button
                                        mat-button
                                        [disabled]="
                                            !hasVoucherEntry ||
                                            (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                            isMobileNumberInvalid
                                        "
                                        (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, true)"
                                        class="btn btn-default"
                                        *ngIf="!isCompany && isCustomerSelected && !isPendingVoucherType"
                                    >
                                        {{ generateInvoiceText }}
                                        {{ localeData?.and_update_acc }}
                                    </button>

                                    <div
                                        *ngIf="!isCompany"
                                        class="btn-group"
                                        [isDisabled]="
                                            !hasVoucherEntry ||
                                            (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                            isMobileNumberInvalid
                                        "
                                    >
                                        <button
                                            mat-button
                                            [disabled]="
                                                !hasVoucherEntry ||
                                                (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                                isMobileNumberInvalid
                                            "
                                            (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                            class="btn btn-default generate-invoice"
                                        >
                                            {{ generateInvoiceText }}
                                        </button>
                                    </div>

                                    <div *ngIf="!isCompany" class="btn-group">
                                        <mat-menu #dropdownMenu="matMenu" class="bottom-dropdown-menu">
                                            <ul id="dropdown-dropup" class="create-send-menu h1">
                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(2); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_send }}</a
                                                    >
                                                </li>

                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(3); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_print }}</a
                                                    >
                                                </li>

                                                <li
                                                    role="menuitem"
                                                    (click)="doAction(4); triggerSubmitInvoiceForm(invoiceForm, false)"
                                                    *ngIf="voucherApiVersion !== 2"
                                                >
                                                    <a class="dropdown-item cp">{{ localeData?.generate_recurring }}</a>
                                                </li>
                                            </ul>
                                        </mat-menu>
                                        <button
                                            [matMenuTriggerFor]="dropdownMenu"
                                            id="button-dropup"
                                            *ngIf="invoiceType === 'sales'"
                                            mat-button
                                            class="btn btn-default dropdown-toggle h2"
                                        >
                                            <span class="caret"></span>
                                        </button>
                                    </div>
                                </span>
                                <!-- endregion -->

                                <!-- region proforma/estimates -->
                                <span
                                    class="d-inline-block v-align-middle"
                                    *ngIf="!isCompany && (isProformaInvoice || isEstimateInvoice)"
                                >
                                    <div
                                        class="btn-group"
                                        [isDisabled]="
                                            !hasVoucherEntry || (invoiceForm?.controls)['message2']?.errors?.maxlength
                                        "
                                    >
                                        <button
                                            *ngIf="!isCompany"
                                            mat-button
                                            [disabled]="
                                                !hasVoucherEntry ||
                                                (invoiceForm?.controls)['message2']?.errors?.maxlength
                                            "
                                            (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                            class="btn btn-default h3"
                                        >
                                            {{ commonLocaleData?.app_create }}
                                        </button>
                                        <button
                                            [matMenuTriggerFor]="dropdownMenu2"
                                            id="button-dropup"
                                            mat-button
                                            class="btn btn-default dropdown-toggle dropdown-toggle-split"
                                        >
                                            <span class="caret"></span>
                                        </button>
                                        <mat-menu #dropdownMenu2="matMenu" class="bottom-dropdown-menu">
                                            <ul id="dropdown-dropup" class="create-send-menu h1" role="menu">
                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(2); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_send }}</a
                                                    >
                                                </li>

                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(3); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_print }}</a
                                                    >
                                                </li>
                                            </ul>
                                        </mat-menu>
                                    </div>
                                </span>
                                <!-- endregion -->
                            </div>
                            <!-- endregion -->

                            <!-- region update mode -->
                            <div class="pull-right pr" *ngIf="isUpdateMode">
                                <button
                                    mat-button
                                    class="btn btn-danger d-inline-block v-align-middle"
                                    (click)="cancelUpdate()"
                                >
                                    {{ commonLocaleData?.app_cancel }}
                                </button>

                                <button
                                    *ngIf="!isCompany"
                                    mat-button
                                    class="btn btn-default"
                                    [disabled]="
                                        isFileUploading ||
                                        !hasVoucherEntry ||
                                        (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                        isMobileNumberInvalid
                                    "
                                    (click)="submitUpdateForm(invoiceForm)"
                                >
                                    {{ updateInvoiceText }}
                                </button>
                            </div>
                            <!-- endregion -->
                        </div>
                    </section>
                </section>
                <!-- endregion -->
            </form>
        </div>
        <!-- endregion -->
    </div>

    <!-- region models section -->
    <!-- open account aside -->
    <div
        class="aside-overlay"
        *ngIf="
            accountAsideMenuState === 'in' ||
            asideMenuStateForProductService === 'in' ||
            asideMenuStateForRecurringEntry === 'in' ||
            asideMenuStateForOtherTaxes === 'in'
        "
        (click)="closeAsideMenuStateForOtherTaxes()"
    ></div>

    <generic-aside-menu-account
        [class]="accountAsideMenuState"
        [@slideInOut]="accountAsideMenuState"
        (closeAsideEvent)="toggleAccountAsidePane($event)"
        [selectedGrpUniqueName]="selectedGrpUniqueNameForAddEditAccountModal"
        [keyboardShortcut]="{ 'esc': accountAsideMenuState === 'in' }"
        *ngIf="accountAsideMenuState === 'in'"
        [selectedAccountUniqueName]="selectedCustomerForDetails"
        (onShortcutPress)="toggleAccountAsidePane()"
        (addEvent)="addNewSidebarAccount($event)"
        (updateEvent)="updateSidebarAccount($event)"
    >
    </generic-aside-menu-account>

    <!--&lt;!&ndash; open product service aside &ndash;&gt;-->
    <aside-menu-product-service
        *ngIf="asideMenuStateForProductService === 'in'"
        [class]="asideMenuStateForProductService"
        [selectedVoucherType]="selectedVoucherType"
        [@slideInOut]="asideMenuStateForProductService"
        (closeAsideEvent)="onNoResultsClicked()"
    >
    </aside-menu-product-service>

    <app-aside-recurring-entry
        *ngIf="asideMenuStateForRecurringEntry === 'in'"
        [voucherType]="invoiceType"
        [voucherNumber]="voucherNumber"
        [class]="asideMenuStateForRecurringEntry"
        [@slideInOut]="asideMenuStateForRecurringEntry"
        (closeAsideEvent)="toggleRecurringAsidePane('out')"
    >
    </app-aside-recurring-entry>
    <!-- region send email popup -->
    <ng-template #sendEmailModal>
        <ng-container *ngIf="actionAfterGenerateORUpdate === 2">
            <app-send-email-invoice-component
                [voucherType]="invoiceType"
                (successEvent)="sendEmail($event)"
                [selectedItem]="{
                    voucherNumber: invoiceNo,
                    uniqueName: accountUniqueName,
                    account: customerAccount,
                    voucherUniqueName: newVoucherUniqueName
                }"
                (cancelEvent)="cancelEmailModal()"
            ></app-send-email-invoice-component>
        </ng-container>
    </ng-template>
    <!-- endregion -->

    <!-- region bulk items -->

    <ng-template #bulkItemsModal>
        <ng-container>
            <voucher-add-bulk-items-component
                [invoiceType]="invoiceType"
                (saveItemsEvent)="addBulkStockItems($event)"
                (closeEvent)="cancelBulkItemsModal()"
            ></voucher-add-bulk-items-component>
        </ng-container>
    </ng-template>
    <!-- endregion -->

    <!-- region gst treatment modal-->
    <ng-template #gstTreatmentModal let-show>
        <div *ngIf="show" class="gst-treatment-modal">
            <voucher-gst-treatment-component
                [localeData]="localeData"
                [commonLocaleData]="commonLocaleData"
                (closeEvent)="showGstTreatmentModal = false"
            >
            </voucher-gst-treatment-component>
        </div>
    </ng-template>
    <!-- endregion -->

    <ng-template let-entry #otherTaxesModal>
        <div id="top0">
            <app-aside-menu-other-taxes
                *ngIf="asideMenuStateForOtherTaxes === 'in'"
                [class]="asideMenuStateForOtherTaxes"
                [taxes]="companyTaxesList"
                [otherTaxesModal]="entry.otherTaxModal"
                [commonLocaleData]="commonLocaleData"
                [@slideInOut]="asideMenuStateForOtherTaxes"
                (closeModal)="closeAsideMenuStateForOtherTaxes()"
                (applyTaxes)="
                    calculateOtherTaxes($event, entry);
                    toggleOtherTaxesAsidePane(true, null);
                    calculateAffectedThingsFromOtherTaxChanges()
                "
            >
            </app-aside-menu-other-taxes>
        </div>
    </ng-template>

    <!-- region print voucher popup -->
    <ng-template #printVoucherModal>
        <ng-container *ngIf="actionAfterGenerateORUpdate === 3 && invoiceNo && accountUniqueName">
            <voucher-print-in-place-component
                [voucherType]="invoiceType"
                [localeData]="localeData"
                [commonLocaleData]="commonLocaleData"
                [selectedItem]="{
                    voucherNumber: invoiceNo,
                    uniqueName: accountUniqueName,
                    voucherUniqueName: newVoucherUniqueName
                }"
                (cancelEvent)="cancelPrintModal()"
            ></voucher-print-in-place-component>
        </ng-container>
    </ng-template>
    <!-- common template ref for displaying invoice type with first letter capital -->
    <ng-template #invoiceTypeDisplayRef>
        {{ getInvoiceType() | titlecase }}
    </ng-template>

    <!-- region purchase  order  popup -->
    <ng-template #purchaseRecordConfirmationPopup>
        <div class="modal-dialog">
            <div class="modal-content">
                <confirmation-modal
                    [configuration]="purchaseRecordConfirmationConfiguration"
                    (buttonClicked)="handlePurchaseRecordConfirmation($event)"
                ></confirmation-modal>
            </div>
        </div>
    </ng-template>
    <!-- region  adjust payment  popup -->
    <ng-template #adjustPaymentModal>
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <advance-receipt-adjustment-component
                    *ngIf="showAdvanceReceiptAdjust"
                    #advanceReceiptComponent
                    [adjustedVoucherType]="
                        voucherApiVersion === 2 && isPendingVoucherType ? invoiceType : selectedVoucherType
                    "
                    [isUpdateMode]="isUpdateMode"
                    [depositAmount]="depositAmount"
                    [invoiceFormDetails]="invFormData"
                    [isVoucherModule]="true && voucherApiVersion !== 2"
                    [advanceReceiptAdjustmentUpdatedData]="advanceReceiptAdjustmentData"
                    (closeModelEvent)="closeAdvanceReceiptModal()"
                    (submitClicked)="getAdvanceReceiptAdjustData($event)"
                    [voucherForAdjustment]="voucherForAdjustment"
                >
                </advance-receipt-adjustment-component>
            </div>
        </div>
    </ng-template>
    <!-- region  date change confirmation popup -->
    <ng-template #dateChangeConfirmationModel>
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <confirmation-modal
                    [configuration]="dateChangeConfiguration"
                    (buttonClicked)="handleDateChangeConfirmation($event)"
                ></confirmation-modal>
            </div>
        </div>
    </ng-template>
    <!-- region  date change confirmation popup -->
    <ng-template #dateChangeConfirmationModel>
        <div class="modal-dialog modal-md">
            <div class="modal-content" *ngIf="attachmentDeleteConfirmationModel?.isShown">
                <confirm-modal
                    [body]="localeData?.confirm_delete_file"
                    (successCallBack)="deleteAttachment(); attachmentDeleteConfirmationModel.hide()"
                    (cancelCallBack)="attachmentDeleteConfirmationModel.hide()"
                ></confirm-modal>
            </div>
        </div>
    </ng-template>
</ng-container>
