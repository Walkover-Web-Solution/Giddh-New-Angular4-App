<ng-container
    appTranslate
    [file]="'proforma-invoice'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
    (translationComplete)="translationComplete($event)"
>
    <giddh-page-loader *ngIf="(showLoader && isUpdateMode) || isShowLoader"></giddh-page-loader>
    <div [ngStyle]="{ 'display': (!isUpdateMode || !showLoader) && !isShowLoader ? 'block' : 'none' }">
        <!-- region page change menu -->
        <div class="d-flex border-bottom mobile-view-padding">
            <hamburger-menu
                [pageHeading]="(isCashInvoice ? localeData?.invoice_types?.cash : getInvoiceType()) | titlecase"
            >
            </hamburger-menu>
            <div class="form-group mr-b05 clearfix pro-invoice-heading">
                <div class="clearfix">
                    <div class="btn-group proforma-sales-time" dropdown>
                        <button
                            id="giddh-page-heading-link"
                            dropdownToggle
                            type="button"
                            class="btn more-btn-dropdown dropdown-toggle"
                            aria-controls="dropdown-basic"
                            *ngIf="!isUpdateMode"
                        >
                            <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                {{ localeData?.invoice_types?.cash }}
                            </span>
                            <small *ngIf="invoiceType === 'estimates'"> ({{ commonLocaleData?.app_beta }}) </small>
                            <span class="caret"></span>
                        </button>
                        <button
                            id="giddh-page-heading-link"
                            type="button"
                            class="btn more-btn-dropdown dropdown-toggle"
                            aria-controls="dropdown-basic"
                            *ngIf="isUpdateMode"
                        >
                            <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                {{ localeData?.invoice_types?.cash }}
                            </span>
                            <small *ngIf="invoiceType === 'estimates'"> ({{ commonLocaleData?.app_beta }}) </small>
                            <span class="caret" *ngIf="!isUpdateMode"></span>
                        </button>
                        <ng-container *ngIf="!isUpdateMode">
                            <ul
                                id="dropdown1-basic"
                                *dropdownMenu
                                class="dropdown-menu"
                                role="menu"
                                aria-labelledby="button-basic"
                            >
                                <li
                                    role="menuitem"
                                    (click)="pageChanged(item?.value, item.additional.label)"
                                    *ngFor="let item of pageList"
                                >
                                    <a class="dropdown-item cp">{{ item.additional?.label }}</a>
                                </li>
                            </ul>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>
        <!-- endregion -->
        <!-- region update mode loader-->
        <ng-container *ngIf="isUpdateDataInProcess">
            <div class="loader-class">
                <giddh-page-loader></giddh-page-loader>
            </div>
        </ng-container>
        <!--endregion-->
        <!-- region main form -->
        <div
            [hidden]="(isUpdateMode && isUpdateDataInProcess) || (isLastInvoiceCopied && isUpdateDataInProcess)"
            id="button-focus-proforma"
        >
            <span class="font-15 mr-l1" *ngIf="isEinvoiceGenerated">{{ commonLocaleData?.app_special_note }}</span>
            <form
                #invoiceForm="ngForm"
                novalidate
                autocomplete="off"
                [ngClass]="{
                    'customer-invoice-form':
                        !invFormData.voucherDetails.customerName && !invFormData.voucherDetails.customerUniquename,
                    'customer-invoice-form-purchase': isPurchaseInvoice || isCreditNote || isDebitNote,
                    'sales-proforma-estimate': isSalesInvoice || isProformaInvoice || isEstimateInvoice,
                    'for-multi-currency': isMulticurrencyAccount
                }"
            >
                <div class="clearfix" [keyboardShortcut]="'alt+c'" (onShortcutPress)="addAccountFromShortcut()">
                    <div class="clearfix wrapper-customer-table pd-t15">
                        <!-- region customer and address section -->
                        <div class="customer-invoice-table">
                            <div class="inner-container">
                                <div
                                    class="show-on-small-screen"
                                    [ngClass]="{ 'pending-sales-balance-due': isPendingSales }"
                                    *ngIf="
                                        isSalesInvoice ||
                                        isProformaInvoice ||
                                        isEstimateInvoice ||
                                        (voucherApiVersion === 2 &&
                                            isPurchaseInvoice &&
                                            !isCashInvoice &&
                                            !isCashBankAccount)
                                    "
                                >
                                    <div class="text-right">
                                        <p class="font-16 b pb-r1">
                                            <span class="balance-due">{{
                                                isProformaInvoice || isEstimateInvoice
                                                    ? commonLocaleData?.app_total_amount
                                                    : localeData?.balance_due
                                            }}</span>
                                            <span
                                                class="sp-rupees d-flex justify-content-end"
                                                *ngIf="isMulticurrencyAccount"
                                            >
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.balanceDue"
                                                    [currencySymbol]="invFormData.accountDetails?.currencySymbol"
                                                    [currencyCode]="invFormData.accountDetails?.currency?.code"
                                                >
                                                </amount-field>
                                            </span>
                                            <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                            <span
                                                class="sp-rupees d-flex justify-content-end"
                                                *ngIf="isMulticurrencyAccount"
                                            >
                                                <amount-field
                                                    [amount]="
                                                        enableVoucherAdjustmentMultiCurrency && isSalesInvoice
                                                            ? getConvertedBalanceDue()
                                                            : invFormData.voucherDetails.convertedBalanceDue
                                                    "
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                            <span
                                                class="sp-rupees d-flex justify-content-end"
                                                *ngIf="!isMulticurrencyAccount"
                                            >
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.balanceDue"
                                                    [currencySymbol]="false"
                                                    [currencyCode]="false"
                                                >
                                                </amount-field>
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <!-- region customer section -->
                                <div class="clearfix">
                                    <div class="row align-items-baseline">
                                        <!-- endregion -->
                                        <!-- region customer dropdown -->
                                        <div
                                            class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12 select-customers-name"
                                        >
                                            <div class="w-100">
                                                <!-- region if not cashinvoice show customer dropdown -->
                                                <ng-container *ngIf="!isCashInvoice">
                                                    <dropdown-field
                                                        #openAccountSelectionDropdown
                                                        [customPanelClass]="'panel-cl customer-dropdown-panel'"
                                                        [name]="'voucherDetails.customerName'"
                                                        [openDropdown]="openCustomerDropdown"
                                                        [placeholder]="customerPlaceHolder"
                                                        [options]="customerAcList$ | async"
                                                        (selectedOption)="onSelectCustomer($event)"
                                                        (createOption)="addNewAccount()"
                                                        [readonly]="
                                                            isEinvoiceGenerated ||
                                                            (isUpdateMode &&
                                                                invoiceType !== 'sales' &&
                                                                invoiceType !== 'cash' &&
                                                                invoiceType !== 'purchase' &&
                                                                (voucherApiVersion === 1 ||
                                                                    (voucherApiVersion === 2 &&
                                                                        invoiceType !== 'debit note' &&
                                                                        invoiceType !== 'credit note')))
                                                        "
                                                        [defaultValue]="invFormData.voucherDetails.customerName"
                                                        [createNewText]="customerNotFoundText"
                                                        [enableDynamicSearch]="true"
                                                        (dynamicSearchedQuery)="
                                                            onSearchQueryChanged($event, 1, 'customer')
                                                        "
                                                        [allowValueReset]="true"
                                                        (onClear)="resetCustomerName($event)"
                                                        [isPaginationEnabled]="true"
                                                        (scrollEnd)="handleScrollEnd('customer')"
                                                        [scrollableElementId]="'customerId'"
                                                    >
                                                        <ng-template #optionTemplate let-option="option">
                                                            <a href="javascript:void(0)">
                                                                <div class="option-label">
                                                                    {{ option?.label }}
                                                                </div>
                                                                <div class="option-value">
                                                                    {{ option?.value }}
                                                                </div>
                                                            </a>
                                                        </ng-template>
                                                    </dropdown-field>
                                                </ng-container>
                                                <!-- endregion -->
                                                <!-- region if not cashinvoice show customer dropdown -->
                                                <ng-container *ngIf="isCashInvoice">
                                                    <input-field
                                                        [type]="'text'"
                                                        [name]="'voucherDetails.customerName'"
                                                        [autoFocus]="true"
                                                        #inputCustomerName
                                                        [cssClass]="'cash-invoice-input'"
                                                        [(ngModel)]="invFormData.voucherDetails.customerName"
                                                        (change)="handleCustomerChange($event)"
                                                        [readonly]="
                                                            isEinvoiceGenerated ||
                                                            (isUpdateMode &&
                                                                invoiceType !== 'sales' &&
                                                                invoiceType !== 'cash')
                                                        "
                                                    ></input-field>
                                                </ng-container>
                                                <!-- endregion -->
                                                <!-- endregion -->
                                            </div>
                                            <!-- region Unregistered Business / customer details -->
                                            <div
                                                class="d-flex aqua-color"
                                                *ngIf="invFormData.voucherDetails.customerName"
                                            >
                                                <span
                                                    class="cp aqua-color mr-r05"
                                                    *ngIf="!isCashInvoice && !isUpdateMode"
                                                >
                                                    <a href="javascript:void(0)" (click)="getCustomerDetails()">{{
                                                        !isPurchaseInvoice
                                                            ? localeData?.customer_details
                                                            : localeData?.vendor_details
                                                    }}</a>
                                                </span>
                                            </div>
                                            <!-- endregion -->
                                            <!-- region search_customer image -->
                                            <ng-container *ngIf="isSalesInvoice && !isCashInvoice">
                                                <img
                                                    src="assets/images/new/search_customer.svg"
                                                    class="img-responsive search-arrow-image"
                                                    *ngIf="!invFormData.voucherDetails.customerName"
                                                />
                                            </ng-container>
                                            <!-- need to show this image on purchase invoice module -->
                                            <ng-container *ngIf="isPurchaseInvoice">
                                                <img
                                                    src="assets/images/new/search-vendor.svg"
                                                    class="img-responsive search-arrow-image"
                                                    *ngIf="!invFormData.voucherDetails.customerName"
                                                />
                                            </ng-container>
                                            <ng-container *ngIf="isCashInvoice">
                                                <img
                                                    src="assets/images/new/search_customer_Cash Invoice.svg"
                                                    class="img-responsive cash-invoice-tip-img search-arrow-image"
                                                    *ngIf="!invFormData.voucherDetails.customerName"
                                                />
                                            </ng-container>
                                            <!-- endregion -->
                                        </div>
                                        <div class="col-lg-6">
                                            <!-- region previous details commented for multicurrency changes-->
                                            <div
                                                class="d-flex cp aqua-color align-items-center ml-3"
                                                #copyPreviousEstimate
                                                *ngIf="
                                                    !isPurchaseInvoice &&
                                                    ((voucherApiVersion === 2 &&
                                                        !isPendingVoucherType &&
                                                        !isCashInvoice) ||
                                                        (voucherApiVersion !== 2 &&
                                                            !(isPendingVoucherType && isCashInvoice))) &&
                                                    (invFormData.voucherDetails.customerName ||
                                                        invFormData.voucherDetails.customerUniquename) &&
                                                    lastInvoices.length &&
                                                    !isUpdateMode
                                                "
                                            >
                                                <a href="javascript:;" [matMenuTriggerFor]="menu">
                                                    <i class="icon-copy-file"></i> {{ copyPreviousInvoiceText }}
                                                </a>
                                                <div class="previous-estimate-wrapper">
                                                    <mat-menu #menu="matMenu" class="copy-invoice-menu">
                                                        <button
                                                            mat-menu-item
                                                            *ngFor="let item of lastInvoices"
                                                            (click)="copyInvoice(item)"
                                                            class="line-height-initial"
                                                        >
                                                            <div class="pd">
                                                                <div class="d-flex flex-column">
                                                                    <div class="d-flex justify-content-between">
                                                                        <span>{{ item?.versionNumber }}</span>
                                                                        <span>{{
                                                                            item?.grandTotal?.amountForAccount
                                                                        }}</span>
                                                                    </div>
                                                                    <span
                                                                        >{{ item?.date }} (
                                                                        {{ item?.account?.name }} )</span
                                                                    >
                                                                </div>
                                                            </div>
                                                        </button>
                                                    </mat-menu>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- endregion -->
                                    </div>
                                </div>
                                <!-- endregion -->
                                <!-- region customer address section -->
                                <div
                                    class="row"
                                    *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.addressAllowed"
                                >
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9">
                                        <ng-container>
                                            <section
                                                [ngClass]="{
                                                    'billing-address-wrap': !invFormData.voucherDetails.customerName
                                                }"
                                            >
                                                <div class="wrap-billing-address clearfix w-100">
                                                    <div class="row">
                                                        <!-- region billing address -->
                                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                            <div class="form-group">
                                                                <div class="d-flex align-items-center pb-2">
                                                                    <span class="pb-0 pd-r15">{{
                                                                        localeData?.billing_address
                                                                    }}</span>
                                                                    <span>
                                                                        <div
                                                                            class="
                                                                                btn-group btn-block
                                                                                change-address-dropdown
                                                                            "
                                                                            *ngIf="
                                                                                accountAddressList?.length > 1 &&
                                                                                !isEinvoiceGenerated
                                                                            "
                                                                        >
                                                                            <a
                                                                                [matMenuTriggerFor]="
                                                                                    changeBillingAddress
                                                                                "
                                                                                class="dropdown-toggle cp"
                                                                            >
                                                                                {{ localeData?.change }}</a
                                                                            >
                                                                            <mat-menu
                                                                                #changeBillingAddress="matMenu"
                                                                                class="billing-company"
                                                                            >
                                                                                <a
                                                                                    mat-menu-item
                                                                                    disableRipple="true"
                                                                                    class="
                                                                                        d-flex
                                                                                        flex-column
                                                                                        justify-content-center
                                                                                        line-height-initial
                                                                                        billing-company-address
                                                                                    "
                                                                                    *ngFor="
                                                                                        let address of accountAddressList
                                                                                    "
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            invFormData.accountDetails
                                                                                                .billingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    <p class="font-12 pl-0 text-indent">
                                                                                        {{ address.address }}
                                                                                    </p>
                                                                                    <p class="font-12 text-indent">
                                                                                        {{ address.state?.name }}
                                                                                    </p>
                                                                                    <p
                                                                                        class="font-12 text-indent"
                                                                                        *ngIf="address.gstNumber"
                                                                                    >
                                                                                        {{
                                                                                            address.gstNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.gstNumber
                                                                                                : ""
                                                                                        }}
                                                                                    </p>
                                                                                </a>
                                                                            </mat-menu>
                                                                        </div>
                                                                    </span>
                                                                </div>
                                                                <div class="billing-address clearfix">
                                                                    <textarea
                                                                        matInput
                                                                        name="billingDetails.address"
                                                                        class="form-control"
                                                                        (keyup)="autoFillShippingDetails()"
                                                                        rows="3"
                                                                        autocomplete="off"
                                                                        [(ngModel)]="
                                                                            invFormData.accountDetails.billingDetails
                                                                                .address[0]
                                                                        "
                                                                        autofocus="off"
                                                                        aria-autocomplete="none"
                                                                        #customerBillingAddress
                                                                        [disabled]="isEinvoiceGenerated"
                                                                    ></textarea>
                                                                    <div class="row row-gap">
                                                                        <div class="col-sm-12 col-md-6">
                                                                            <label class="sales-country-label">
                                                                                {{ customerCountryName }}
                                                                            </label>
                                                                        </div>
                                                                        <div
                                                                            class="
                                                                                col-sm-12 col-md-6
                                                                                billing-shipping-value
                                                                            "
                                                                        >
                                                                            <select-field
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_state
                                                                                "
                                                                                [cssClass]="
                                                                                    'select-bdr-bottom form-control  input-bill'
                                                                                "
                                                                                (selectedOption)="
                                                                                    fillShippingBillingDetails(
                                                                                        $event,
                                                                                        true
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                                #statesBilling
                                                                                [options]="statesSource"
                                                                                [name]="'billingDetails.stateCode'"
                                                                                [allowValueReset]="true"
                                                                                [defaultValue]="
                                                                                    invFormData?.accountDetails
                                                                                        ?.billingDetails?.state?.name
                                                                                "
                                                                                (onClear)="
                                                                                    fillShippingBillingDetails(
                                                                                        $event,
                                                                                        true
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                                [readonly]="isEinvoiceGenerated"
                                                                            >
                                                                            </select-field>
                                                                        </div>
                                                                        <div
                                                                            class="col-sm-6 col-md-6"
                                                                            *ngIf="shouldShowTrnGstField"
                                                                        >
                                                                            <text-field
                                                                                [maxlength]="15"
                                                                                autocomplete="None"
                                                                                [type]="'text'"
                                                                                [name]="'billingDetails.gstNumber'"
                                                                                [cssClass]="
                                                                                    'form-control input-custom billing input-bill'
                                                                                "
                                                                                *ngIf="showGSTINNo"
                                                                                [(ngModel)]="
                                                                                    invFormData.accountDetails
                                                                                        .billingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'billingDetails',
                                                                                        statesBilling
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_gstin
                                                                                "
                                                                                [readonly]="isEinvoiceGenerated"
                                                                            >
                                                                            </text-field>
                                                                            <text-field
                                                                                [maxlength]="15"
                                                                                autocomplete="none"
                                                                                [type]="'text'"
                                                                                [name]="'billingDetails.gstNumber'"
                                                                                [cssClass]="
                                                                                    'form-control input-custom input-bill'
                                                                                "
                                                                                *ngIf="showTRNNo"
                                                                                [(ngModel)]="
                                                                                    invFormData.accountDetails
                                                                                        .billingDetails.gstNumber
                                                                                "
                                                                                (change)="
                                                                                    getStateCode(
                                                                                        'billingDetails',
                                                                                        statesBilling
                                                                                    );
                                                                                    autoFillShippingDetails()
                                                                                "
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_trn
                                                                                "
                                                                                [readonly]="isEinvoiceGenerated"
                                                                            >
                                                                            </text-field>
                                                                        </div>
                                                                        <!-- static pin code  -->
                                                                        <div
                                                                            [ngClass]="{
                                                                                'col-sm-6 col-md-6':
                                                                                    showGSTINNo || showTRNNo,
                                                                                'col-sm-12 col-md-12': !(
                                                                                    showGSTINNo || showTRNNo
                                                                                )
                                                                            }"
                                                                        >
                                                                            <div class="form-group mr-b05">
                                                                                <text-field
                                                                                    [type]="'number'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom input-bill'
                                                                                    "
                                                                                    autocomplete="false"
                                                                                    [name]="'billingPinCode'"
                                                                                    (change)="autoFillShippingDetails()"
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_pin_code
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        invFormData.accountDetails
                                                                                            .billingDetails.pincode
                                                                                    "
                                                                                    [allowDecimalDigitsOnly]="true"
                                                                                    [readonly]="isEinvoiceGenerated"
                                                                                >
                                                                                </text-field>
                                                                            </div>
                                                                        </div>
                                                                        <!-- static pin code end-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->
                                                        <!-- region shipping address -->
                                                        <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                            <div class="form-group p-0 width-100">
                                                                <div class="d-flex align-items-center pb-1">
                                                                    <span class="pb-0 pd-r15">
                                                                        <mat-checkbox
                                                                            (keydown.enter)="$event.preventDefault()"
                                                                            (change)="autoFillShippingDetails()"
                                                                            name="autoFillShipping"
                                                                            color="primary"
                                                                            class="auto-fill-shipping-address"
                                                                            [ngModelOptions]="{ standalone: true }"
                                                                            [(ngModel)]="autoFillShipping"
                                                                            [disabled]="isEinvoiceGenerated"
                                                                        >
                                                                            {{ localeData?.shipping_billing_same }}
                                                                        </mat-checkbox>
                                                                    </span>
                                                                    <span>
                                                                        <div
                                                                            class="
                                                                                btn-group btn-block
                                                                                change-address-dropdown
                                                                            "
                                                                            [attachOutsideOnClick]="true"
                                                                            *ngIf="
                                                                                accountAddressList?.length > 1 &&
                                                                                !autoFillShipping &&
                                                                                !isEinvoiceGenerated
                                                                            "
                                                                        >
                                                                            <a
                                                                                [matMenuTriggerFor]="
                                                                                    shippingBillingAddressSame
                                                                                "
                                                                                class="dropdown-toggle cp"
                                                                            >
                                                                                {{ localeData?.change }}</a
                                                                            >
                                                                            <mat-menu
                                                                                class="billing-company"
                                                                                #shippingBillingAddressSame="matMenu"
                                                                            >
                                                                                <a
                                                                                    mat-menu-item
                                                                                    disableRipple="true"
                                                                                    class="
                                                                                        d-flex
                                                                                        flex-column
                                                                                        justify-content-center
                                                                                        line-height-initial
                                                                                        billing-company-address
                                                                                    "
                                                                                    *ngFor="
                                                                                        let address of accountAddressList
                                                                                    "
                                                                                    (click)="
                                                                                        selectAddress(
                                                                                            invFormData.accountDetails
                                                                                                .shippingDetails,
                                                                                            address
                                                                                        )
                                                                                    "
                                                                                >
                                                                                    <p class="font-12 pl-0 text-indent">
                                                                                        {{ address.address }}
                                                                                    </p>
                                                                                    <p class="font-12 text-indent">
                                                                                        {{ address.state?.name }}
                                                                                    </p>
                                                                                    <p
                                                                                        class="font-12 text-indent"
                                                                                        *ngIf="address.gstNumber"
                                                                                    >
                                                                                        {{
                                                                                            address.gstNumber
                                                                                                ? (showGSTINNo
                                                                                                      ? commonLocaleData?.app_gstin +
                                                                                                        ": "
                                                                                                      : commonLocaleData?.app_trn +
                                                                                                        ": ") +
                                                                                                  address.gstNumber
                                                                                                : ""
                                                                                        }}
                                                                                    </p>
                                                                                </a>
                                                                            </mat-menu>
                                                                        </div>
                                                                    </span>
                                                                </div>
                                                                <div
                                                                    class="billing-address"
                                                                    [ngClass]="{ 'disabled': autoFillShipping }"
                                                                >
                                                                    <textarea
                                                                        matInput
                                                                        [readonly]="autoFillShipping"
                                                                        name="shippingDetails.address"
                                                                        class="form-control"
                                                                        [(ngModel)]="
                                                                            invFormData.accountDetails.shippingDetails
                                                                                .address[0]
                                                                        "
                                                                        rows="3"
                                                                        autocomplete="off"
                                                                        [disabled]="isEinvoiceGenerated"
                                                                    ></textarea>
                                                                    <div class="clearfix form-group mb-0">
                                                                        <div class="row row-gap">
                                                                            <div class="col-sm-12 col-md-6">
                                                                                <div class="form-group mb-0">
                                                                                    <label class="sales-country-label">
                                                                                        {{ customerCountryName }}
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                class="
                                                                                    col-sm-12 col-md-6
                                                                                    billing-shipping-value
                                                                                "
                                                                                #shippingState
                                                                            >
                                                                                <select-field
                                                                                    #customerShippingState
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_state
                                                                                    "
                                                                                    [cssClass]="
                                                                                        'select-bdr-bottom form-control input-bill'
                                                                                    "
                                                                                    #statesShipping
                                                                                    (selectedOption)="
                                                                                        fillShippingBillingDetails(
                                                                                            $event,
                                                                                            false
                                                                                        )
                                                                                    "
                                                                                    [options]="statesSource"
                                                                                    [name]="'shippingDetails.stateCode'"
                                                                                    [allowValueReset]="true"
                                                                                    [defaultValue]="
                                                                                        invFormData?.accountDetails
                                                                                            ?.shippingDetails?.state
                                                                                            ?.name
                                                                                    "
                                                                                    (onClear)="
                                                                                        fillShippingBillingDetails(
                                                                                            $event,
                                                                                            false
                                                                                        )
                                                                                    "
                                                                                    [readonly]="isEinvoiceGenerated"
                                                                                >
                                                                                </select-field>
                                                                            </div>
                                                                            <div
                                                                                class="col-sm-6"
                                                                                *ngIf="shouldShowTrnGstField"
                                                                            >
                                                                                <text-field
                                                                                    [readonly]="
                                                                                        autoFillShipping ||
                                                                                        isEinvoiceGenerated
                                                                                    "
                                                                                    autocomplete="None"
                                                                                    [maxlength]="15"
                                                                                    [type]="'text'"
                                                                                    [name]="'shippingDetails.gstNumber'"
                                                                                    *ngIf="showGSTINNo"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom input-bill'
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        invFormData.accountDetails
                                                                                            .shippingDetails.gstNumber
                                                                                    "
                                                                                    (change)="
                                                                                        getStateCode(
                                                                                            'shippingDetails',
                                                                                            statesShipping
                                                                                        )
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_gstin
                                                                                    "
                                                                                ></text-field>
                                                                                <text-field
                                                                                    [readonly]="
                                                                                        autoFillShipping ||
                                                                                        isEinvoiceGenerated
                                                                                    "
                                                                                    [maxlength]="15"
                                                                                    autocomplete="None"
                                                                                    [type]="'text'"
                                                                                    [name]="'shippingDetails.gstNumber'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom input-bill'
                                                                                    "
                                                                                    *ngIf="showTRNNo"
                                                                                    [(ngModel)]="
                                                                                        invFormData.accountDetails
                                                                                            .shippingDetails.gstNumber
                                                                                    "
                                                                                    (change)="
                                                                                        getStateCode(
                                                                                            'shippingDetails',
                                                                                            statesShipping
                                                                                        )
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_trn
                                                                                    "
                                                                                ></text-field>
                                                                            </div>
                                                                            <!-- static pin code  -->
                                                                            <div
                                                                                [ngClass]="{
                                                                                    'col-sm-6':
                                                                                        showGSTINNo || showTRNNo,
                                                                                    'col-sm-12': !(
                                                                                        showGSTINNo || showTRNNo
                                                                                    )
                                                                                }"
                                                                            >
                                                                                <div class="form-group mr-b05">
                                                                                    <text-field
                                                                                        [type]="'number'"
                                                                                        [cssClass]="
                                                                                            'form-control input-custom input-bill'
                                                                                        "
                                                                                        autocomplete="false"
                                                                                        [name]="'shippingPinCode'"
                                                                                        [placeholder]="
                                                                                            commonLocaleData?.app_pin_code
                                                                                        "
                                                                                        [(ngModel)]="
                                                                                            invFormData.accountDetails
                                                                                                .shippingDetails.pincode
                                                                                        "
                                                                                        [allowDecimalDigitsOnly]="true"
                                                                                        [readonly]="isEinvoiceGenerated"
                                                                                    >
                                                                                    </text-field>
                                                                                </div>
                                                                            </div>
                                                                            <!-- static pin code end-->
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- endregion -->
                                                    </div>
                                                </div>
                                            </section>
                                        </ng-container>
                                    </div>
                                </div>
                                <!-- endregion -->
                            </div>
                            <!-- region balance due -->
                            <!-- region balance due -->
                            <div
                                class="col-sm-3 col-md-3 balance-due-absolute"
                                *ngIf="
                                    isSalesInvoice ||
                                    isProformaInvoice ||
                                    isEstimateInvoice ||
                                    (voucherApiVersion === 2 &&
                                        isPurchaseInvoice &&
                                        !isCashInvoice &&
                                        !isCashBankAccount)
                                "
                            >
                                <div class="text-right">
                                    <p class="font-16 pb-r1">
                                        <span class="balance-due">{{
                                            isProformaInvoice || isEstimateInvoice
                                                ? commonLocaleData?.app_total_amount
                                                : localeData?.balance_due
                                        }}</span>
                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount"
                                        >
                                            <amount-field
                                                [amount]="
                                                    adjustPaymentData?.totalAdjustedAmount
                                                        ? adjustPaymentBalanceDueData
                                                        : invFormData.voucherDetails.balanceDue
                                                "
                                                [currencySymbol]="invFormData.accountDetails?.currencySymbol"
                                                [currencyCode]="invFormData.accountDetails?.currency?.code"
                                            >
                                            </amount-field>
                                        </span>
                                        <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                        <span
                                            *ngIf="
                                                (voucherApiVersion !== 2 &&
                                                    enableVoucherAdjustmentMultiCurrency &&
                                                    isSalesInvoice &&
                                                    isMulticurrencyAccount &&
                                                    adjustPaymentBalanceDueData === 0 &&
                                                    invFormData.voucherDetails.balanceDue === 0) ||
                                                (voucherApiVersion === 2 &&
                                                    invFormData.voucherDetails.gainLoss &&
                                                    invFormData.voucherDetails.gainLoss !== 0 &&
                                                    invFormData.voucherDetails.balanceDue === 0)
                                            "
                                            class="balance-due"
                                            >{{ localeData?.exchange_label }}
                                            {{
                                                voucherApiVersion === 2
                                                    ? invFormData.voucherDetails.gainLoss >= 0
                                                        ? commonLocaleData?.app_exchange_gain
                                                        : commonLocaleData?.app_exchange_loss
                                                    : getConvertedBalanceDue() <= 0
                                                    ? commonLocaleData?.app_exchange_gain
                                                    : commonLocaleData?.app_exchange_loss
                                            }}:&nbsp;</span
                                        >
                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount && voucherApiVersion !== 2"
                                        >
                                            <amount-field
                                                [amount]="
                                                    isSalesInvoice &&
                                                    adjustPaymentBalanceDueData === 0 &&
                                                    invFormData.voucherDetails.balanceDue === 0
                                                        ? getConvertedBalanceDue(true)
                                                        : invFormData.voucherDetails.convertedBalanceDue
                                                "
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency"
                                            >
                                            </amount-field>
                                        </span>
                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="!isMulticurrencyAccount"
                                        >
                                            <amount-field
                                                [amount]="
                                                    adjustPaymentData?.totalAdjustedAmount
                                                        ? adjustPaymentBalanceDueData
                                                        : invFormData.voucherDetails.balanceDue
                                                "
                                                [currencySymbol]="false"
                                                [currencyCode]="false"
                                            >
                                            </amount-field>
                                        </span>
                                        <span
                                            class="sp-rupees d-flex justify-content-end"
                                            *ngIf="
                                                voucherApiVersion === 2 &&
                                                invFormData.voucherDetails.gainLoss &&
                                                invFormData.voucherDetails.gainLoss !== 0 &&
                                                invFormData.voucherDetails.balanceDue === 0
                                            "
                                        >
                                            <amount-field
                                                [amount]="invFormData.voucherDetails.gainLoss"
                                                [currencySymbol]="baseCurrencySymbol"
                                                [currencyCode]="companyCurrency"
                                            >
                                            </amount-field>
                                        </span>
                                    </p>
                                </div>
                            </div>
                            <!-- endregion -->
                        </div>
                        <!-- endregion -->
                        <!-- region attention to, email, mobile, voucher section -->
                        <div class="customer-invoice-table bg-white pd-b2 pd-t1">
                            <div class="inner-container fields-container">
                                <!-- region attention to -->
                                <div class="row">
                                    <div class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12">
                                        <input-field
                                            [type]="'text'"
                                            [name]="'accountDetails.attention'"
                                            [placeholder]="localeData?.attention_to"
                                            [cssClass]="'attention-to'"
                                            [(ngModel)]="invFormData.accountDetails.attentionTo"
                                        ></input-field>
                                    </div>
                                    <div class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12">
                                        <input-field
                                            [type]="'email'"
                                            [placeholder]="commonLocaleData?.app_email_id"
                                            [name]="'accountDetails.email'"
                                            [cssClass]="'attention-to'"
                                            [(ngModel)]="invFormData.accountDetails.email"
                                        ></input-field>
                                    </div>
                                </div>
                                <!-- endregion-->
                                <!-- region mobile no -->
                                <div class="row mr-t3 mobile-number-wrapper">
                                    <div class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12 mobile-number">
                                        <input-field
                                            [name]="'accountDetails.mobileNumber'"
                                            [type]="'tel'"
                                            #initContactProforma
                                            [id]="'init-contact-proforma'"
                                            (keydown.enter)="$event.preventDefault()"
                                            [placeholder]="commonLocaleData?.app_mobile_number"
                                        >
                                        </input-field>
                                        <span id="init-contact-proforma-valid-msg" class="d-none"></span>
                                        <span id="init-contact-proforma-error-msg" class="d-none"></span>
                                    </div>
                                    <!-- warehouse selection -->
                                    <div
                                        class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12"
                                        *ngIf="shouldShowWarehouse && warehouses && warehouses.length > 1"
                                    >
                                        <dropdown-field
                                            #selectWarehouse
                                            [cssClass]="'multi-select'"
                                            [name]="'warehouse'"
                                            [placeholder]="localeData?.select_warehouse_placeholder"
                                            [options]="warehouses"
                                            (selectedOption)="onSelectWarehouse($event)"
                                            [allowValueReset]="true"
                                            (onClear)="onSelectWarehouse($event)"
                                            [defaultValue]="selectedWarehouseName"
                                        >
                                        </dropdown-field>
                                    </div>
                                    <!-- end warehouse field -->
                                </div>
                                <!-- endregion-->
                                <div class="row mt-1 delivery-from-field" *ngIf="isPurchaseInvoice">
                                    <div class="col-sm-12 col-xl-12 col-lg-12 col-md-12">
                                        <label>{{ localeData?.deliver_to }}<span class="red-text">*</span></label>
                                    </div>
                                    <div class="col-sm-12 col-xl-12 col-lg-12 col-md-12 col-xs-12 select-customer-name">
                                        <section class="form-inline">
                                            <div class="wrap-billing-address w-100 clearfix">
                                                <div class="row">
                                                    <!-- region billing address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group">
                                                            <div class="d-flex align-items-center pb-2">
                                                                <span class="pd-r15">{{
                                                                    localeData?.billing_address
                                                                }}</span>
                                                                <div
                                                                    [attachOutsideOnClick]="true"
                                                                    class="change-address-dropdown"
                                                                    *ngIf="companyAddressList?.length > 1"
                                                                >
                                                                    <a
                                                                        mat-menu-item
                                                                        class="dropdown-toggle cp mat-menu-btn"
                                                                        [matMenuTriggerFor]="
                                                                            companyBillingAddressDropDownWeb
                                                                        "
                                                                    >
                                                                        {{ localeData?.change }}</a
                                                                    >
                                                                    <mat-menu
                                                                        class="billing-company"
                                                                        #companyBillingAddressDropDownWeb="matMenu"
                                                                    >
                                                                        <a
                                                                            mat-menu-item
                                                                            class="
                                                                                d-flex
                                                                                flex-column
                                                                                justify-content-center
                                                                                line-height-initial
                                                                            "
                                                                            *ngFor="let address of companyAddressList"
                                                                            (click)="
                                                                                selectAddress(
                                                                                    purchaseBillCompany.billingDetails,
                                                                                    address,
                                                                                    true
                                                                                )
                                                                            "
                                                                        >
                                                                            <p class="font-12 pl-0 text-indent">
                                                                                {{ address.address }}
                                                                            </p>
                                                                            <p class="font-12 text-indent">
                                                                                {{ address.stateName }}
                                                                            </p>
                                                                            <p
                                                                                class="font-12 text-indent"
                                                                                *ngIf="address.gstNumber"
                                                                            >
                                                                                {{
                                                                                    address.taxNumber
                                                                                        ? (showGSTINNo
                                                                                              ? commonLocaleData?.app_gstin +
                                                                                                ": "
                                                                                              : commonLocaleData?.app_trn +
                                                                                                ": ") +
                                                                                          address.taxNumber
                                                                                        : ""
                                                                                }}
                                                                            </p>
                                                                        </a>
                                                                    </mat-menu>
                                                                </div>
                                                            </div>
                                                            <div class="billing-address clearfix">
                                                                <textarea
                                                                    name="companyBillingDetailsAddress"
                                                                    (keyup)="autoFillCompanyShippingDetails()"
                                                                    [(ngModel)]="
                                                                        purchaseBillCompany.billingDetails.address[0]
                                                                    "
                                                                    class="form-control"
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                    autofocus="off"
                                                                    aria-autocomplete="none"
                                                                ></textarea>
                                                                <div class="row">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <label class="sales-country-label">
                                                                            {{ companyCountryName }}
                                                                        </label>
                                                                    </div>
                                                                    <div
                                                                        class="
                                                                            col-sm-12 col-md-6
                                                                            billing-shipping-value
                                                                        "
                                                                        #billingStateCompany
                                                                    >
                                                                        <select-field
                                                                            #companyBillingState
                                                                            [placeholder]="commonLocaleData?.app_state"
                                                                            [cssClass]="
                                                                                ' select-bdr-bottom form-control input-bill'
                                                                            "
                                                                            (selectedOption)="
                                                                                fillShippingBillingCompanyDetails(
                                                                                    $event,
                                                                                    true
                                                                                );
                                                                                autoFillCompanyShippingDetails()
                                                                            "
                                                                            [allowValueReset]="true"
                                                                            (onClear)="
                                                                                fillShippingBillingCompanyDetails(
                                                                                    $event,
                                                                                    true
                                                                                );
                                                                                autoFillCompanyShippingDetails()
                                                                            "
                                                                            [options]="companyStatesSource"
                                                                            [name]="'companyBillingDetailsStateCode'"
                                                                            [readonly]="
                                                                                purchaseBillCompany.billingDetails
                                                                                    .gstNumber &&
                                                                                purchaseBillCompany.billingDetails
                                                                                    .gstNumber.length >= 2
                                                                                    ? true
                                                                                    : null
                                                                            "
                                                                            [defaultValue]="
                                                                                purchaseBillCompany?.billingDetails
                                                                                    ?.state?.name
                                                                            "
                                                                        >
                                                                        </select-field>
                                                                    </div>
                                                                    <div
                                                                        class="col-sm-6 col-md-6"
                                                                        *ngIf="
                                                                            shouldShowTrnGstField &&
                                                                            (showGSTINNo || showTRNNo)
                                                                        "
                                                                    >
                                                                        <text-field
                                                                            [maxlength]="'15'"
                                                                            autocomplete="none"
                                                                            [type]="'text'"
                                                                            [name]="'companyBillingDetailsTax'"
                                                                            [(ngModel)]="
                                                                                purchaseBillCompany.billingDetails
                                                                                    .gstNumber
                                                                            "
                                                                            [cssClass]="
                                                                                'form-control input-custom billing input-bill'
                                                                            "
                                                                            (change)="
                                                                                getStateCodeCompany('billingDetails');
                                                                                autoFillCompanyShippingDetails()
                                                                            "
                                                                            [placeholder]="
                                                                                showGSTINNo
                                                                                    ? commonLocaleData?.app_gstin
                                                                                    : commonLocaleData?.app_trn
                                                                            "
                                                                        ></text-field>
                                                                    </div>
                                                                    <!-- static pin code  -->
                                                                    <div
                                                                        [ngClass]="{
                                                                            'col-sm-6 col-md-6':
                                                                                showGSTINNo || showTRNNo,
                                                                            'col-sm-12 col-md-12': !(
                                                                                showGSTINNo || showTRNNo
                                                                            )
                                                                        }"
                                                                    >
                                                                        <div class="form-group mr-b05">
                                                                            <text-field
                                                                                [type]="'number'"
                                                                                [cssClass]="
                                                                                    'form-control input-custom input-bill'
                                                                                "
                                                                                autocomplete="false"
                                                                                [name]="'purchaseBillBillingPinCode'"
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_pin_code
                                                                                "
                                                                                [(ngModel)]="
                                                                                    purchaseBillCompany.billingDetails
                                                                                        .pincode
                                                                                "
                                                                                (input)="
                                                                                    autoFillCompanyShippingDetails()
                                                                                "
                                                                                [allowDecimalDigitsOnly]="true"
                                                                            >
                                                                            </text-field>
                                                                        </div>
                                                                    </div>
                                                                    <!-- static pin code end-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                    <!-- region shipping address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                        <div class="form-group p-0 width-100">
                                                            <div class="d-flex align-items-center pb-1">
                                                                <span class="pd-r15">
                                                                    <mat-checkbox
                                                                        (keydown.enter)="$event.preventDefault()"
                                                                        autocomplete="None"
                                                                        color="primary"
                                                                        name="autoFillCompanyShipping"
                                                                        [(ngModel)]="autoFillCompanyShipping"
                                                                        [ngModelOptions]="{ standalone: true }"
                                                                        (change)="autoFillCompanyShippingDetails()"
                                                                    >
                                                                        {{ localeData?.shipping_billing_same }}
                                                                    </mat-checkbox>
                                                                </span>
                                                                <div
                                                                    [attachOutsideOnClick]="true"
                                                                    class="change-address-dropdown"
                                                                    *ngIf="
                                                                        companyAddressList?.length > 1 &&
                                                                        !autoFillCompanyShipping
                                                                    "
                                                                >
                                                                    <a
                                                                        mat-menu-item
                                                                        class="dropdown-toggle cp mat-menu-btn"
                                                                        [matMenuTriggerFor]="
                                                                            companyShippingAddressDropDownWeb
                                                                        "
                                                                    >
                                                                        {{ localeData?.change }}</a
                                                                    >
                                                                    <mat-menu
                                                                        class="billing-company"
                                                                        #companyShippingAddressDropDownWeb="matMenu"
                                                                    >
                                                                        <a
                                                                            mat-menu-item
                                                                            class="
                                                                                d-flex
                                                                                flex-column
                                                                                justify-content-center
                                                                                line-height-initial
                                                                            "
                                                                            *ngFor="let address of companyAddressList"
                                                                            (click)="
                                                                                selectAddress(
                                                                                    purchaseBillCompany.shippingDetails,
                                                                                    address,
                                                                                    true
                                                                                )
                                                                            "
                                                                        >
                                                                            <p class="font-12 pl-0 text-indent">
                                                                                {{ address.address }}
                                                                            </p>
                                                                            <p class="font-12 text-indent">
                                                                                {{ address.stateName }}
                                                                            </p>
                                                                            <p
                                                                                class="font-12 text-indent"
                                                                                *ngIf="address.gstNumber"
                                                                            >
                                                                                {{
                                                                                    address.taxNumber
                                                                                        ? (showGSTINNo
                                                                                              ? commonLocaleData?.app_gstin +
                                                                                                ": "
                                                                                              : commonLocaleData?.app_trn +
                                                                                                ": ") +
                                                                                          address.taxNumber
                                                                                        : ""
                                                                                }}
                                                                            </p>
                                                                        </a>
                                                                    </mat-menu>
                                                                </div>
                                                            </div>
                                                            <div
                                                                [ngClass]="{
                                                                    'billing-address': true,
                                                                    'disabled': autoFillCompanyShipping
                                                                }"
                                                            >
                                                                <textarea
                                                                    name="companyShippingDetailsAddress"
                                                                    [(ngModel)]="
                                                                        purchaseBillCompany.shippingDetails.address[0]
                                                                    "
                                                                    class="form-control"
                                                                    rows="3"
                                                                    autocomplete="off"
                                                                    autofocus="off"
                                                                    aria-autocomplete="none"
                                                                ></textarea>
                                                                <div class="clearfix">
                                                                    <div class="form-group row deliver-same-address">
                                                                        <div class="col-sm-12 col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="sales-country-label">
                                                                                    {{ companyCountryName }}
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div
                                                                            class="
                                                                                col-sm-12 col-md-6
                                                                                billing-shipping-value
                                                                            "
                                                                            #shippingStateCompany
                                                                        >
                                                                            <select-field
                                                                                #companyShippingState
                                                                                [placeholder]="
                                                                                    commonLocaleData?.app_state
                                                                                "
                                                                                [cssClass]="
                                                                                    'select-bdr-bottom form-control input-bill'
                                                                                "
                                                                                [ngClass]="{
                                                                                    'disabled': autoFillCompanyShipping
                                                                                }"
                                                                                (selectedOption)="
                                                                                    fillShippingBillingCompanyDetails(
                                                                                        $event,
                                                                                        false
                                                                                    )
                                                                                "
                                                                                [allowValueReset]="true"
                                                                                (onClear)="
                                                                                    fillShippingBillingCompanyDetails(
                                                                                        $event,
                                                                                        false
                                                                                    )
                                                                                "
                                                                                [options]="companyStatesSource"
                                                                                [name]="
                                                                                    'companyShippingDetailsStateCode'
                                                                                "
                                                                                [readonly]="
                                                                                    autoFillCompanyShipping ||
                                                                                    (purchaseBillCompany.shippingDetails
                                                                                        .gstNumber &&
                                                                                        purchaseBillCompany
                                                                                            .shippingDetails.gstNumber
                                                                                            .length >= 2)
                                                                                        ? true
                                                                                        : null
                                                                                "
                                                                                [defaultValue]="
                                                                                    purchaseBillCompany.shippingDetails
                                                                                        .state?.name
                                                                                "
                                                                            >
                                                                            </select-field>
                                                                        </div>
                                                                        <div
                                                                            class="col-sm-6 col-md-6"
                                                                            *ngIf="
                                                                                shouldShowTrnGstField &&
                                                                                (showGSTINNo || showTRNNo)
                                                                            "
                                                                        >
                                                                            <text-field
                                                                                [maxlength]="'15'"
                                                                                autocomplete="none"
                                                                                [type]="'text'"
                                                                                [name]="'companyShippingDetailsTax'"
                                                                                [(ngModel)]="
                                                                                    purchaseBillCompany.shippingDetails
                                                                                        .gstNumber
                                                                                "
                                                                                [cssClass]="
                                                                                    'form-control input-custom input-bill'
                                                                                "
                                                                                (change)="
                                                                                    getStateCodeCompany(
                                                                                        'shippingDetails'
                                                                                    )
                                                                                "
                                                                                [placeholder]="
                                                                                    showGSTINNo
                                                                                        ? commonLocaleData?.app_gstin
                                                                                        : commonLocaleData?.app_trn
                                                                                "
                                                                            ></text-field>
                                                                        </div>
                                                                        <!-- static pin code  -->
                                                                        <div
                                                                            [ngClass]="{
                                                                                'col-sm-6 col-md-6':
                                                                                    showGSTINNo || showTRNNo,
                                                                                'col-sm-12 col-md-12': !(
                                                                                    showGSTINNo || showTRNNo
                                                                                )
                                                                            }"
                                                                        >
                                                                            <div class="form-group mr-b05">
                                                                                <text-field
                                                                                    [type]="'number'"
                                                                                    [cssClass]="
                                                                                        'form-control input-custom input-bill'
                                                                                    "
                                                                                    autocomplete="false"
                                                                                    [name]="
                                                                                        'purchaseBillShippingPinCode'
                                                                                    "
                                                                                    [placeholder]="
                                                                                        commonLocaleData?.app_pin_code
                                                                                    "
                                                                                    [(ngModel)]="
                                                                                        purchaseBillCompany
                                                                                            .shippingDetails.pincode
                                                                                    "
                                                                                    [allowDecimalDigitsOnly]="true"
                                                                                >
                                                                                </text-field>
                                                                            </div>
                                                                        </div>
                                                                        <!-- static pin code end-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                                <div
                                    class="row mt-3"
                                    *ngIf="isPurchaseInvoice && (!isUpdateMode || (isUpdateMode && poLinkUpdated))"
                                >
                                    <div class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12 purchase-link">
                                        <mat-select
                                            name="linkedPO"
                                            [(ngModel)]="linkedPo"
                                            [multiple]="true"
                                            (selectionChange)="getPurchaseOrder($event?.value, true)"
                                            class="po-mat-salect"
                                            [placeholder]="localeData?.select_order_placeholder"
                                            [disabled]="linkedPo?.length === 0 && fieldFilteredOptions?.length === 0"
                                            [appearance]="'outline'"
                                        >
                                            <mat-select-trigger *ngIf="linkedPo?.length">
                                                <ng-container *ngFor="let poNumber of linkedPo; let i = index"
                                                    >{{ purchaseOrderNumberValueMapping[poNumber]
                                                    }}<ng-container *ngIf="linkedPo[i + 1]">, </ng-container>
                                                </ng-container>
                                            </mat-select-trigger>
                                            <mat-option class="po-options-line">
                                                <ngx-mat-select-search
                                                    [noEntriesFoundLabel]="commonLocaleData?.app_no_result_found"
                                                    [formControl]="linkPoDropdown"
                                                    [placeholderLabel]="localeData?.select_order_placeholder"
                                                >
                                                    <i class="icon-cross" ngxMatSelectSearchClear></i>
                                                </ngx-mat-select-search>
                                            </mat-option>

                                            <mat-option
                                                *ngFor="let option of fieldFilteredOptions"
                                                [value]="option?.value"
                                                class="po-options-line"
                                                [disabled]="showLoader"
                                            >
                                                <span class="po-option-label"> {{ option?.label }}</span>
                                                <span class="po-option-value" *ngIf="option?.additional?.pending">
                                                    {{ localeData?.pending }}: {{ option?.additional?.pending }}</span
                                                >
                                                <span class="po-option-value" *ngIf="option.additional?.grandTotal">
                                                    {{ commonLocaleData?.app_amount }}:
                                                    {{ option?.additional?.grandTotal }}</span
                                                >
                                            </mat-option>
                                        </mat-select>
                                    </div>
                                </div>
                                <!-- end Link purchase order -->
                                <!-- region invoice no, invoice date, Expiry date -->
                                <div class="row mr-t3">
                                    <div class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12">
                                        <!-- Enabled for CR/DR update flow -->
                                        <div>
                                            <input-field
                                                *ngIf="!isCreditNote && !isDebitNote"
                                                [type]="'text'"
                                                [name]="'accountDetails.invoiceNum'"
                                                [cssClass]="'invoice-date attention-to invoice-number-class'"
                                                [ngClass]="{ 'date-invoice': !isPurchaseInvoice }"
                                                [readonly]="
                                                    isUpdateMode && !(isDebitNote || isPurchaseInvoice)
                                                        ? 'disabled'
                                                        : null
                                                "
                                                [(ngModel)]="invFormData.voucherDetails.voucherNumber"
                                                [placeholder]="commonLocaleData?.app_voucher_number"
                                            >
                                            </input-field>
                                            <ng-container *ngIf="isCreditNote || isDebitNote">
                                                <dropdown-field
                                                    #linkingDropdown
                                                    *ngIf="voucherApiVersion === 2"
                                                    [cssClass]="'linking-dropdown'"
                                                    [name]="'invoiceLinking'"
                                                    [placeholder]="commonLocaleData?.app_select_accounts"
                                                    [options]="invoiceList$ | async"
                                                    (selectedOption)="creditNoteInvoiceSelected($event)"
                                                    [defaultValue]="selectedInvoiceLabel"
                                                    [hasMoreValue]="true"
                                                    [enableDynamicSearch]="true"
                                                    (dynamicSearchedQuery)="
                                                        searchReferenceVoucher = $event;
                                                        resetInvoiceList();
                                                        getInvoiceListsForCreditNote()
                                                    "
                                                    [isPaginationEnabled]="true"
                                                    (scrollEnd)="
                                                        !searchReferenceVoucher ? getInvoiceListsForCreditNote() : ''
                                                    "
                                                    [scrollableElementId]="'referenceVoucher'"
                                                    [readonly]="isEinvoiceGenerated"
                                                >
                                                    <ng-template #optionTemplate let-option="option">
                                                        <a
                                                            *ngIf="option"
                                                            href="javascript:void(0)"
                                                            class="linking-item"
                                                        >
                                                            <div class="option-label">{{ option?.label }}</div>
                                                            <div class="option-value">
                                                                ({{ commonLocaleData?.app_dated }}:
                                                                {{ option.additional?.voucherDate }})
                                                            </div>
                                                            <div class="option-value-stock">
                                                                ({{ commonLocaleData?.app_amount }}:
                                                                {{
                                                                    voucherApiVersion === 2
                                                                        ? (option.additional?.unadjustedAmount
                                                                              ?.amountForAccount | giddhCurrency)
                                                                        : (option.additional?.balanceDue
                                                                              ?.amountForAccount | giddhCurrency)
                                                                }})
                                                            </div>
                                                        </a>
                                                    </ng-template>
                                                </dropdown-field>
                                                <dropdown-field
                                                    #invoiceListDropdown
                                                    *ngIf="voucherApiVersion !== 2"
                                                    [name]="'invoiceLinking'"
                                                    [placeholder]="commonLocaleData?.app_select_accounts"
                                                    [options]="invoiceList"
                                                    (selectedOption)="creditNoteInvoiceSelected($event)"
                                                    [defaultValue]="invoiceSelectedLabel"
                                                    [hasMoreValue]="true"
                                                    [readonly]="isEinvoiceGenerated"
                                                >
                                                    <ng-template #optionTemplate let-option="option">
                                                        <a
                                                            *ngIf="option"
                                                            href="javascript:void(0)"
                                                            class="linking-item"
                                                        >
                                                            <div class="option-label">{{ option?.label }}</div>
                                                            <div class="option-value">
                                                                ({{ commonLocaleData?.app_dated }}:
                                                                {{
                                                                    option?.additional?.additional?.voucherDate
                                                                        ? option?.additional?.additional?.voucherDate
                                                                        : option?.additional?.voucherDate
                                                                }})
                                                            </div>
                                                            <div class="option-value-stock">
                                                                ({{ commonLocaleData?.app_amount }}:
                                                                {{
                                                                    option.additional?.additional?.balanceDue
                                                                        ?.amountForAccount
                                                                        ? (option.additional?.additional?.balanceDue
                                                                              ?.amountForAccount | giddhCurrency)
                                                                        : (option.additional?.balanceDue
                                                                              ?.amountForAccount | giddhCurrency)
                                                                }})
                                                            </div>
                                                        </a>
                                                    </ng-template>
                                                </dropdown-field>
                                            </ng-container>
                                        </div>
                                        <div
                                            *ngIf="
                                                (isCreditNote || isDebitNote) && selectedInvoice && !isEinvoiceGenerated
                                            "
                                            class="cp for-mobile-screen remove-invoice"
                                            (click)="removeSelectedInvoice()"
                                        >
                                            <span class="remove-invoice-icon mr-r05"><i class="icon-trash"></i></span>
                                        </div>
                                    </div>
                                    <div
                                        class="col-sm-12 col-xl-6 col-lg-6 col-md-6"
                                        [ngClass]="{ 'date-invoice': isPurchaseInvoice }"
                                    >
                                        <div class="form-inline flex-row flex-nowrap">
                                            <div
                                                *ngIf="
                                                    (isCreditNote || isDebitNote) &&
                                                    selectedInvoice &&
                                                    !isEinvoiceGenerated
                                                "
                                                class="cp remove-invoice"
                                                (click)="removeSelectedInvoice()"
                                            >
                                                <span class="remove-invoice-icon mr-r05"
                                                    ><i class="icon-trash"></i
                                                ></span>
                                            </div>
                                            <div
                                                class="form-group invoice-date-label"
                                                [ngClass]="{
                                                    'date-invoice-parent-form':
                                                        isPurchaseInvoice || isEstimateInvoice || isProformaInvoice,
                                                    'w-100': isCreditNote || isDebitNote
                                                }"
                                            >
                                                <div
                                                    [ngClass]="{ 'date-invoice-formgroup': isPurchaseInvoice }"
                                                    class="w-100"
                                                >
                                                    <giddh-datepicker
                                                        type="text"
                                                        #voucherDate="ngModel"
                                                        (keydown.enter)="$event.preventDefault()"
                                                        [placeholder]="giddhDateFormat"
                                                        name="voucherDate"
                                                        [(ngModel)]="invFormData.voucherDetails.voucherDate"
                                                        [class.invalid-inp]="
                                                            voucherDate.errors &&
                                                            (voucherDate.dirty || voucherDate.touched)
                                                        "
                                                        [disabled]="
                                                            invoiceType !== 'purchase' && isUpdateMode
                                                                ? 'disabled'
                                                                : null
                                                        "
                                                        (datepickerState)="onFocusInvoiceDate()"
                                                        (dateSelected)="
                                                            onVoucherDateChanged(
                                                                $event,
                                                                invFormData.voucherDetails.voucherDate
                                                            );
                                                            onBlurInvoiceDate(0)
                                                        "
                                                        (focusOut)="
                                                            !(
                                                                currentVoucherFormDetails?.dueDate ||
                                                                isSalesInvoice ||
                                                                isPurchaseInvoice ||
                                                                isProformaInvoice ||
                                                                isEstimateInvoice
                                                            )
                                                                ? openFirstEntry()
                                                                : ''
                                                        "
                                                        [appearance]="'outline'"
                                                    >
                                                    </giddh-datepicker>
                                                    <p
                                                        class="text-danger"
                                                        *ngIf="
                                                            voucherDate.errors &&
                                                            (voucherDate.dirty || voucherDate.touched)
                                                        "
                                                    >
                                                        {{ localeData?.invalid_date }}
                                                    </p>
                                                </div>
                                            </div>
                                            <div
                                                class="form-group invoice-due-label"
                                                *ngIf="
                                                    currentVoucherFormDetails?.dueDate ||
                                                    isSalesInvoice ||
                                                    isPurchaseInvoice ||
                                                    isProformaInvoice ||
                                                    isEstimateInvoice
                                                "
                                                [ngClass]="{ 'due-invoice-parent-form': isPurchaseInvoice }"
                                            >
                                                <div
                                                    [ngClass]="{ 'due-invoice-formgroup': isPurchaseInvoice }"
                                                    class="w-100"
                                                >
                                                    <giddh-datepicker
                                                        [placeholder]="giddhDateFormat"
                                                        (keydown.enter)="$event.preventDefault()"
                                                        #dueDate="ngModel"
                                                        name="dueDate"
                                                        [(ngModel)]="invFormData.voucherDetails.dueDate"
                                                        [class.invalid-inp]="
                                                            dueDate.errors && (dueDate.dirty || dueDate.touched)
                                                        "
                                                        (blur)="onBlurDueDate(0)"
                                                        (focusOut)="openFirstEntry()"
                                                        [showToggleIcon]="false"
                                                        [appearance]="'outline'"
                                                    >
                                                    </giddh-datepicker>
                                                    <p
                                                        class="text-danger"
                                                        *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)"
                                                    >
                                                        {{ localeData?.invalid_date }}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mr-t3" *ngIf="voucherApiVersion === 2 && (isCreditNote || isDebitNote)">
                                    <div class="col-sm-12 col-xl-6 col-lg-6 col-md-6">
                                        <div>
                                            <input-field
                                                [type]="'text'"
                                                [name]="'accountDetails.invoiceNum'"
                                                [cssClass]="'invoice-date attention-to invoice-number-class'"
                                                [ngClass]="{ 'date-invoice': !isPurchaseInvoice }"
                                                [readonly]="
                                                    isUpdateMode && !(isDebitNote || isPurchaseInvoice)
                                                        ? 'disabled'
                                                        : null
                                                "
                                                [(ngModel)]="invFormData.voucherDetails.voucherNumber"
                                                [placeholder]="commonLocaleData?.app_voucher_number"
                                            >
                                            </input-field>
                                        </div>
                                    </div>
                                </div>
                                <!-- reverse charge transction start -->
                                <!-- for purchase record start -->
                                <div
                                    class="row mt-3"
                                    *ngIf="
                                        isPurchaseInvoice ||
                                        (currentVoucherFormDetails?.rcmAllowed && companyCountryName === 'India')
                                    "
                                >
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <mat-checkbox
                                            (keydown.enter)="$event.preventDefault()"
                                            #rcmCheckbox
                                            id="reverse-charge"
                                            [(ngModel)]="isRcmEntry"
                                            (change)="changeRcmCheckboxState($event)"
                                            class="mr-r1"
                                            name="rcmEntry"
                                            [disabled]="isEinvoiceGenerated"
                                            color="primary"
                                        >
                                        </mat-checkbox>
                                        <label
                                            class="checkbox-custom-label"
                                            for="reverse-charge"
                                            (click)="
                                                !isEinvoiceGenerated ? toggleRcmCheckbox(rcmCheckbox, 'label') : ''
                                            "
                                            [innerHTML]="localeData?.transaction_reverse_charge"
                                        >
                                        </label>
                                    </div>
                                </div>
                                <!-- for purchase record end -->
                                <!-- reverse charge transction end  -->
                                <!-- For Tourist Scheme start -->
                                <!-- for sales invoice start (ngModelChange)="touristSchemeApplicableToggle($event)"-->
                                <ng-container *ngIf="companyCountryCode === 'AE'">
                                    <div class="row mt-1" *ngIf="isSalesInvoice || isCashInvoice">
                                        <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3" *ngIf="!isMobileView">
                                            <label></label>
                                        </div>
                                        <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                            <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                                <mat-checkbox
                                                    color="primary"
                                                    (keydown.enter)="$event.preventDefault()"
                                                    id="tourist-scheme"
                                                    name="touristSchemeApplicable"
                                                    [(ngModel)]="invFormData.touristSchemeApplicable"
                                                    (ngModelChange)="touristSchemeApplicableToggle()"
                                                    [disabled]="isEinvoiceGenerated"
                                                >
                                                    {{ localeData?.transaction_tourist_scheme }}
                                                </mat-checkbox>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- endregion -->
                                    <div
                                        class="row mr-t15"
                                        *ngIf="(isSalesInvoice || isCashInvoice) && invFormData.touristSchemeApplicable"
                                    >
                                        <div class="col-sm-12 col-xl-6 col-lg-6 col-md-6 col-xs-12">
                                            <input-field
                                                [type]="'text'"
                                                [name]="'passportNumber'"
                                                [placeholder]="localeData?.passport_number"
                                                [cssClass]="'attention-to'"
                                                [(ngModel)]="invFormData.passportNumber"
                                                (keypress)="allowAlphanumericChar()"
                                                (blur)="allowAlphanumericChar()"
                                            ></input-field>
                                        </div>
                                    </div>
                                </ng-container>
                                <!-- For Tourist Scheme end -->
                                <!-- for sales invoice end -->
                                <!-- endregion -->
                            </div>
                        </div>
                        <!-- endregion -->
                    </div>
                </div>
                <!-- region entries table -->
                <ng-container>
                    <!-- region normal view -->
                    <section
                        class="
                            static-invoice-table
                            sales-invoice-table
                            clearfix
                            mr-b2
                            white-bg
                            container-fluid
                            ng-tns-c8-0
                        "
                    >
                        <ng-container>
                            <!-- switch currency on click, remaining functional work , UI is completed -->
                            <div class="switch-currency" *ngIf="isMulticurrencyAccount && !showSwitchedCurr">
                                <span class="left-currency"
                                    >{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrencyName }}</span
                                >
                                <img
                                    class="switch-icon"
                                    src="assets/images/switch-icon.svg"
                                    alt="switch-icon"
                                    (click)="switchCurrencyImg(true)"
                                />
                                <span class="right-currency">
                                    <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                        originalExchangeRate | giddhCurrency
                                    }}</span>
                                    <text-field
                                        [type]="'number'"
                                        [name]="'exchangeRate'"
                                        [(ngModel)]="newExchangeRate"
                                        class="exchange-rate-original"
                                        [cssClass]="'form-control edit-currency '"
                                        *ngIf="showCurrencyValue"
                                        [readonly]="isEinvoiceGenerated"
                                    ></text-field>
                                    {{ companyCurrency }}
                                </span>
                                <span class="edit-icon cp">
                                    <img
                                        src="assets/images/edit-pencilicon.svg"
                                        class="edit-pencil"
                                        *ngIf="!autoSaveIcon && !isEinvoiceGenerated"
                                        (click)="
                                            showCurrencyValue = !showCurrencyValue;
                                            autoSaveIcon = !autoSaveIcon;
                                            newExchangeRate = originalExchangeRate
                                        "
                                    />
                                    <img
                                        src=" assets/images/autosave.svg"
                                        class="edit-pencil"
                                        (click)="
                                            exchangeRate = newExchangeRate;
                                            originalExchangeRate = exchangeRate;
                                            previousExchangeRate = exchangeRate;
                                            autoSaveIcon = !autoSaveIcon;
                                            showCurrencyValue = !showCurrencyValue;
                                            exchangeRateChanged();
                                            calculateGrandTotal()
                                        "
                                        *ngIf="autoSaveIcon && !isEinvoiceGenerated"
                                    />
                                </span>
                            </div>
                            <!-- switch currency on click, remaining functional work , UI is completed -->
                            <div class="switch-currency" *ngIf="isMulticurrencyAccount && showSwitchedCurr">
                                <span class="left-currency"
                                    >{{ commonLocaleData?.app_numbers?.one }} {{ companyCurrency }}</span
                                >
                                <img
                                    class="switch-icon"
                                    src="assets/images/switch-icon.svg"
                                    alt="switch-icon"
                                    (click)="switchCurrencyImg(false)"
                                />
                                <span class="right-currency">
                                    <span class="currency-digits" *ngIf="!showCurrencyValue">{{
                                        originalReverseExchangeRate | giddhCurrency
                                    }}</span>
                                    <text-field
                                        [type]="'number'"
                                        [name]="'exchangeRate'"
                                        class="exchange-rate-original"
                                        [(ngModel)]="reverseExchangeRate"
                                        [cssClass]="'form-control edit-currency'"
                                        *ngIf="showCurrencyValue"
                                        [readonly]="isEinvoiceGenerated"
                                    ></text-field>
                                    {{ companyCurrencyName }}
                                </span>
                                <span class="edit-icon cp">
                                    <img
                                        *ngIf="!autoSaveIcon && !isEinvoiceGenerated"
                                        src="assets/images/edit-pencilicon.svg"
                                        class="edit-pencil"
                                        (click)="saveCancelExcRate(false)"
                                    />
                                    <img
                                        src=" assets/images/autosave.svg"
                                        class="edit-pencil"
                                        (click)="saveCancelExcRate(true)"
                                        *ngIf="autoSaveIcon && !isEinvoiceGenerated"
                                    />
                                </span>
                            </div>
                        </ng-container>
                        <table class="table table-custom-invoice basic">
                            <thead>
                                <tr>
                                    <th
                                        *ngFor="let item of theadArrReadOnly"
                                        [hidden]="!item.display"
                                        class="thead-sales-invoice"
                                        [ngClass]="item?.label"
                                    >
                                        {{ item?.label }}
                                        <span *ngIf="item.label === 'Tax' && isRcmEntry"
                                            >({{ commonLocaleData?.app_rcm }})<sup class="mandatory-asterisk"
                                                >*</sup
                                            ></span
                                        >
                                    </th>
                                </tr>
                            </thead>
                            <tbody
                                [hidden]="showBulkLoader"
                                (clickOutside)="handleOutsideClick($event)"
                                [exclude]="'.entries-tr, .add-line-bulk-item, .mat-option'"
                            >
                                <ng-container #itemsContainer></ng-container>
                            </tbody>
                            <tbody *ngIf="showBulkLoader">
                                <tr>
                                    <td colspan="8">
                                        <giddh-page-loader></giddh-page-loader>
                                    </td>
                                </tr>
                            </tbody>
                            <ng-template #entry let-entry let-entryIdx="entryIdx" let-transaction="transaction">
                                <!-- <ng-container *ngFor="let transaction of entry.transactions;"> -->
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature) -->
                                <!-- region static entries-->
                                <tr
                                    (click)="setActiveIndx(entryIdx); $event.stopPropagation()"
                                    *ngIf="activeIndx !== entryIdx"
                                    class="entries-tr set-active"
                                    [ngClass]="{ 'is-other-tax': entry.isOtherTaxApplicable && isMulticurrencyAccount }"
                                >
                                    <td>{{ entryIdx + 1 }}</td>
                                    <td>
                                        <div class="product-name">
                                            <label *ngIf="!transaction.accountName" class="select-account-label">{{
                                                localeData?.select_account
                                            }}</label>
                                            {{ transaction.accountName }}
                                            <span *ngIf="transaction.stockDetails?.uniqueName"
                                                >({{ transaction.stockDetails?.name }})</span
                                            >
                                        </div>
                                        <div class="sku-number">
                                            <label>{{ commonLocaleData?.app_sku }}:</label
                                            >{{ commonLocaleData?.app_number }}
                                        </div>
                                        <p
                                            *ngIf="
                                                transaction.variant?.name &&
                                                ((stockVariants | async)[entryIdx] | async)?.length > 1
                                            "
                                            class="variant"
                                        >
                                            {{ localeData?.variant + ": " + transaction.variant?.name }}
                                        </p>
                                        <div class="description">
                                            {{ transaction.description }}
                                        </div>
                                        <p
                                            class="small text-muted sku-and-custom-fields"
                                            *ngIf="transaction.sku_and_customfields"
                                        >
                                            {{ transaction.sku_and_customfields }}
                                        </p>
                                        <div class="date-hsn-code">
                                            <div class="row mr-0 ml-0">
                                                <div class="col-6 col-sm-6 pl-0" *ngIf="entry?.entryDate">
                                                    <div class="entry-date">
                                                        <label>{{ localeData?.entry_date }}: </label>
                                                        {{ entry?.entryDate }}
                                                        <span class="edit-icon cp" *ngIf="!isUpdateMode">
                                                            <img src="assets/images/edit-pencilicon.svg" />
                                                        </span>
                                                    </div>
                                                </div>
                                                <div
                                                    class="col-6 col-sm-6 pl-0"
                                                    *ngIf="transaction.hsnNumber || transaction.sacNumber"
                                                >
                                                    <div class="hsn-code text-right">
                                                        <label
                                                            >{{
                                                                transaction.showCodeType === "hsn"
                                                                    ? commonLocaleData?.app_hsn
                                                                    : commonLocaleData?.app_sac
                                                            }}:</label
                                                        >
                                                        <span>
                                                            {{
                                                                transaction.showCodeType === "hsn"
                                                                    ? transaction.hsnNumber
                                                                    : transaction.sacNumber
                                                            }}
                                                            <span class="edit-icon cp">
                                                                <img src="assets/images/edit-pencilicon.svg" />
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td
                                        class="text-right stock-unit"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.quantityAllowed"
                                    >
                                        <div class="wrap-td-data">
                                            {{ transaction.quantity | giddhCurrency }} {{ transaction.stockUnitCode }}
                                        </div>
                                    </td>
                                    <td
                                        class="text-right trans-rate item-rate height-rate"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.rateAllowed"
                                    >
                                        <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                            <div class="td-wrapper flex-grow-1">
                                                <div class="flex-grow-1">
                                                    <div class="wrap-td-data">
                                                        <span class="d-flex justify-content-end">
                                                            <amount-field
                                                                [amount]="transaction.rate"
                                                                [currencySymbol]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails?.currencySymbol
                                                                        : false
                                                                "
                                                                [currencyCode]="
                                                                    isMulticurrencyAccount
                                                                        ? invFormData.accountDetails?.currency?.code
                                                                        : false
                                                                "
                                                                [ratePrecision]="true"
                                                            >
                                                            </amount-field>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="differ-currency d-flex justify-content-end">
                                                <span>
                                                    <amount-field
                                                        *ngIf="isMulticurrencyAccount"
                                                        [amount]="
                                                            transaction.rate * exchangeRate
                                                                ? transaction.rate * exchangeRate
                                                                : 0
                                                        "
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-right item-amount height-rate">
                                        <div class="td-wrapper">
                                            <div class="flex-grow-1">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="transaction.amount ? transaction.amount : '0'"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="differ-currency d-flex justify-content-end">
                                            <span *ngIf="isMulticurrencyAccount">
                                                <amount-field
                                                    [amount]="transaction.convertedAmount"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </td>
                                    <td
                                        class="item-discount"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.discountAllowed"
                                    >
                                        <div class="text-right td-wrapper">
                                            <div class="flex-grow-1">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="entry.discountSum"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div
                                            class="differ-currency d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount"
                                        >
                                            <span>
                                                <amount-field
                                                    [amount]="entry.discountSum * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </td>
                                    <td
                                        [class.error-box]="transaction.requiredTax"
                                        class="text-right item-tax"
                                        (focus)="transaction.requiredTax = false"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.taxesAllowed"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-grow-1">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="
                                                                giddhRoundOff(
                                                                    entry.taxSum + entry.cessSum,
                                                                    giddhBalanceDecimalPlaces
                                                                )
                                                            "
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div
                                            class="differ-currency d-flex justify-content-end"
                                            *ngIf="isMulticurrencyAccount"
                                        >
                                            <span>
                                                <amount-field
                                                    [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                    [currencySymbol]="baseCurrencySymbol"
                                                    [currencyCode]="companyCurrency"
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="text-right item-tax delete-btn-absolute">
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <div class="wrap-td-data">
                                                    <span class="d-flex justify-content-end">
                                                        <amount-field
                                                            [amount]="transaction.total"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                        <br />
                                                    </span>
                                                    <span
                                                        class="d-flex justify-content-end"
                                                        *ngIf="
                                                            entry.isOtherTaxApplicable &&
                                                            entry.otherTaxModal?.appliedOtherTax?.name
                                                        "
                                                    >
                                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                                        <amount-field
                                                            *ngIf="isMulticurrencyAccount"
                                                            [amount]="entry.otherTaxSum"
                                                            [currencySymbol]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currencySymbol
                                                                    : false
                                                            "
                                                            [currencyCode]="
                                                                isMulticurrencyAccount
                                                                    ? invFormData.accountDetails?.currency?.code
                                                                    : false
                                                            "
                                                        >
                                                        </amount-field>
                                                        <amount-field
                                                            *ngIf="!isMulticurrencyAccount"
                                                            [amount]="entry.otherTaxSum"
                                                            [currencySymbol]="false"
                                                            [currencyCode]="false"
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                                <div
                                                    class="tax-in-currency"
                                                    *ngIf="
                                                        entry.isOtherTaxApplicable &&
                                                        isMulticurrencyAccount &&
                                                        entry.otherTaxModal?.appliedOtherTax?.name
                                                    "
                                                >
                                                    <span
                                                        class="differ-currency d-flex justify-content-end"
                                                        *ngIf="isMulticurrencyAccount"
                                                    >
                                                        <amount-field
                                                            [amount]="entry.otherTaxSum * exchangeRate"
                                                            [currencySymbol]="baseCurrencySymbol"
                                                            [currencyCode]="companyCurrency"
                                                        >
                                                        </amount-field>
                                                    </span>
                                                </div>
                                            </div>
                                            <div
                                                class="differ-currency d-flex justify-content-end"
                                                *ngIf="isMulticurrencyAccount"
                                            >
                                                <span>
                                                    <amount-field
                                                        [amount]="transaction.convertedTotal"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                        <div
                                            class="trash-icon-delete"
                                            *ngIf="!isEinvoiceGenerated"
                                            (click)="
                                                removeTransaction(entryIdx);
                                                $event.preventDefault();
                                                $event.stopPropagation()
                                            "
                                        >
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <!-- endregion -->
                                <!-- region dynamic entries-->
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature)-->
                                <tr
                                    *ngIf="activeIndx === entryIdx"
                                    class="entries-tr default-active"
                                    (click)="$event.stopPropagation()"
                                >
                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup()">{{ entryIdx + 1 }}</td>
                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup()">
                                        <div class="product-name">
                                            <div class="ng-select-wrap">
                                                <select-field
                                                    [autofocus]="true"
                                                    #selectAccount
                                                    [isPaginationEnabled]="true"
                                                    (scrollEnd)="handleScrollEnd('item')"
                                                    [scrollableElementId]="'selectAccount'"
                                                    [cssClass]="'form-control mat-field-border'"
                                                    [name]="'transaction.fakeAccForSelect2_' + entryIdx"
                                                    [placeholder]="localeData?.select_acc"
                                                    [options]="salesAccounts$ | async"
                                                    (selectedOption)="
                                                        transaction.fakeAccForSelect2 = $event?.value;
                                                        onSelectSalesAccount(
                                                            $event,
                                                            transaction,
                                                            entry,
                                                            false,
                                                            false,
                                                            entryIdx
                                                        );
                                                        noResultsFoundLabel = localeData?.search_acc
                                                    "
                                                    (createOption)="onNoResultsClicked(entryIdx)"
                                                    [showCreateNew]="true"
                                                    [defaultValue]="
                                                        transaction.stockDetails && transaction.stockDetails.name
                                                            ? transaction.accountName +
                                                              ' (' +
                                                              transaction.stockDetails?.name +
                                                              ')'
                                                            : transaction.accountName
                                                    "
                                                    [enableDynamicSearch]="true"
                                                    (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'item')"
                                                    (onClear)="onClearSalesAccount(transaction)"
                                                    [hasMoreValue]="true"
                                                    [readonly]="isEinvoiceGenerated"
                                                >
                                                    <ng-template #optionTemplate let-option="option">
                                                        <ng-container *ngIf="!option.additional?.stock">
                                                            <a href="javascript:void(0)" class="flex-column">
                                                                <div class="option-label">{{ option?.label }}</div>
                                                                <div class="option-value">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                            </a>
                                                        </ng-container>
                                                        <ng-container *ngIf="option.additional?.stock">
                                                            <a href="javascript:void(0)" class="flex-column">
                                                                <div class="option-label">{{ option?.label }}</div>
                                                                <div class="option-value">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                                <div class="option-value-stock">
                                                                    {{ commonLocaleData?.app_stock }}:
                                                                    {{ option.additional?.stock?.uniqueName }}
                                                                </div>
                                                            </a>
                                                        </ng-container>
                                                    </ng-template>
                                                </select-field>
                                            </div>
                                        </div>
                                        <ng-container
                                            *ngIf="
                                                transaction?.isStockTxn &&
                                                ((stockVariants | async)[entryIdx] | async) as variants
                                            "
                                        >
                                            <div *ngIf="variants?.length > 1" class="variant-name">
                                                <!-- <select-field
                                                    [cssClass]="'form-control mat-field-border'"
                                                    [placeholder]="localeData?.select_variant"
                                                    (selectedOption)="variantChanged($event, transaction, entry)"
                                                    [options]="variants"
                                                    [required]="true"
                                                    [name]="'variant' + entryIdx"
                                                    [(ngModel)]="transaction.variant.uniqueName"
                                                >
                                                </select-field> -->
                                                <sh-select
                                                    [placeholder]="localeData?.select_variant"
                                                    [options]="variants"
                                                    (selected)="variantChanged($event, transaction, entry)"
                                                    [isRequired]="true"
                                                    name="{{ 'variant' + entryIdx }}"
                                                    [(ngModel)]="transaction.variant.uniqueName"
                                                ></sh-select>
                                            </div>
                                        </ng-container>
                                        <div *ngIf="transaction.fakeAccForSelect2">
                                            <div class="sku-number">
                                                <label>{{ commonLocaleData?.app_sku }}:</label
                                                >{{ commonLocaleData?.app_number }}
                                            </div>
                                            <div class="description">
                                                <textarea
                                                    matInput
                                                    type="text"
                                                    rows="3"
                                                    [placeholder]="localeData?.add_description"
                                                    name="transaction.description_'+entryIdx"
                                                    class="form-control"
                                                    [(ngModel)]="transaction.description"
                                                    [maxlength]="entryDescriptionLength"
                                                    #description
                                                ></textarea>
                                                <p class="font-12">
                                                    {{ commonLocaleData?.app_characters_left }}:
                                                    {{ entryDescriptionLength - transaction.description?.length }}
                                                </p>
                                                <p
                                                    class="small text-muted sku-and-custom-fields"
                                                    *ngIf="transaction.sku_and_customfields"
                                                >
                                                    {{ transaction.sku_and_customfields }}
                                                </p>
                                            </div>
                                            <!-- region entry date/ hsncode -->
                                            <div class="date-hsn-code">
                                                <div class="row mr-0 ml-0">
                                                    <div class="col-6 col-sm-6 pl-0">
                                                        <div class="entry-date">
                                                            <label>{{ localeData?.entry_date }}: </label>
                                                            <span *ngIf="!isUpdateMode" class="custom-date-entries">
                                                                <giddh-datepicker
                                                                    [showToggleIcon]="false"
                                                                    #dp="ngModel"
                                                                    (keydown.enter)="$event.preventDefault()"
                                                                    (dateSelected)="onBlurEntryDate(entryIdx, true)"
                                                                    id="transaction.date_'+entryIdx"
                                                                    [disabled]="isUpdateMode"
                                                                    [cssClass]="'entry-custom-date'"
                                                                    [placeholder]="giddhDateFormat"
                                                                    name="transaction.date_'+entryIdx"
                                                                    [(ngModel)]="entry.entryDate"
                                                                >
                                                                </giddh-datepicker>
                                                                <span
                                                                    class="edit-icon-custom-entry-date cp"
                                                                    [attr.aria-expanded]="dp.isOpen"
                                                                >
                                                                    <img src="assets/images/edit-pencilicon.svg" />
                                                                </span>
                                                            </span>
                                                            <span *ngIf="isUpdateMode">
                                                                {{ entry?.entryDate }}
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="col-6 col-sm-6 pl-0">
                                                        <div class="wrap-hsn-box">
                                                            <div
                                                                class="hsn-code text-right"
                                                                (click)="toggleHsnSacDropDown(transaction)"
                                                            >
                                                                <label
                                                                    >{{
                                                                        transaction.showCodeType === "hsn"
                                                                            ? commonLocaleData?.app_hsn
                                                                            : commonLocaleData?.app_sac
                                                                    }}:</label
                                                                >
                                                                <span>
                                                                    {{
                                                                        transaction.showCodeType === "hsn"
                                                                            ? transaction.hsnNumber
                                                                            : transaction.sacNumber
                                                                    }}
                                                                    <span
                                                                        *ngIf="
                                                                            !transaction.hsnNumber &&
                                                                            !transaction.sacNumber &&
                                                                            !isEinvoiceGenerated
                                                                        "
                                                                        class="update-text"
                                                                        >{{ commonLocaleData?.app_update }}
                                                                    </span>
                                                                    <span
                                                                        class="edit-icon cp"
                                                                        *ngIf="!isEinvoiceGenerated"
                                                                    >
                                                                        <img src="assets/images/edit-pencilicon.svg" />
                                                                    </span>
                                                                </span>
                                                            </div>
                                                            <div class="hsn-code-dropdown" *ngIf="hsnDropdownShow">
                                                                <mat-radio-group
                                                                    class="d-flex mb-2"
                                                                    [(ngModel)]="transaction.showCodeType"
                                                                    (change)="onChangeHsnSacType(transaction)"
                                                                    name="showCodeType{{ entryIdx }}"
                                                                    [disabled]="isEinvoiceGenerated"
                                                                >
                                                                    <mat-radio-button
                                                                        color="primary"
                                                                        id="hsnCodeType{{ entryIdx }}"
                                                                        [value]="'hsn'"
                                                                    >
                                                                        {{ commonLocaleData?.app_hsn_code }}
                                                                    </mat-radio-button>
                                                                    <mat-radio-button
                                                                        color="primary"
                                                                        id="sacCodeType{{ entryIdx }}"
                                                                        [value]="'sac'"
                                                                    >
                                                                        {{ commonLocaleData?.app_sac_code }}
                                                                    </mat-radio-button>
                                                                </mat-radio-group>
                                                                <text-field
                                                                    [type]="'text'"
                                                                    maxLength="10"
                                                                    [allowDecimalDigitsOnly]="true"
                                                                    [placeholder]="localeData?.hsn_number"
                                                                    [name]="'transaction.hsnNumber_' + entryIdx"
                                                                    *ngIf="transaction.showCodeType === 'hsn'"
                                                                    [(ngModel)]="transaction.hsnNumber"
                                                                    [readonly]="isEinvoiceGenerated"
                                                                ></text-field>
                                                                <text-field
                                                                    [type]="'text'"
                                                                    maxLength="10"
                                                                    [allowDecimalDigitsOnly]="true"
                                                                    [placeholder]="localeData?.sac_number"
                                                                    [name]="'transaction.hsnNumber_' + entryIdx"
                                                                    *ngIf="transaction.showCodeType === 'sac'"
                                                                    [(ngModel)]="transaction.sacNumber"
                                                                    [readonly]="isEinvoiceGenerated"
                                                                ></text-field>
                                                                <div class="btn-group mt-2 pt-1 d-flex">
                                                                    <button
                                                                        mat-stroked-button
                                                                        color="primary"
                                                                        class="btn-sm"
                                                                        type="button"
                                                                        (click)="hsnDropdownShow = !hsnDropdownShow"
                                                                        [disabled]="isEinvoiceGenerated"
                                                                    >
                                                                        {{ commonLocaleData?.app_save }}
                                                                    </button>
                                                                    <button
                                                                        mat-stroked-button
                                                                        class="mr-0"
                                                                        (click)="hideHsnSacEditPopup(transaction)"
                                                                    >
                                                                        {{ commonLocaleData?.app_cancel }}
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- endregion -->
                                        </div>
                                    </td>
                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.quantityAllowed"
                                        class="text-right stock-unit"
                                    >
                                        <text-field
                                            [placeholder]="commonLocaleData?.app_quantity"
                                            [readonly]="!transaction.isStockTxn || isEinvoiceGenerated"
                                            [type]="'text'"
                                            [cssClass]="'form-control mat-field-border text-right stock1'"
                                            [name]="'transaction.quantity_' + entryIdx"
                                            [mask]="inputMaskFormat"
                                            [useMask]="true"
                                            [(ngModel)]="transaction.quantity"
                                            (change)="handleQuantityBlur(entry, transaction)"
                                            [allowDecimalDigitsOnly]="true"
                                        >
                                        </text-field>
                                        <div class="select-quantity">
                                            <mat-select
                                                class="form-control"
                                                [disabled]="!transaction.isStockTxn || isEinvoiceGenerated"
                                                (selectionChange)="
                                                    onChangeUnit(transaction, $event);
                                                    handlePriceCalculationOnUnitChange(entry, transaction)
                                                "
                                                [value]="transaction.stockUnit"
                                                [(ngModel)]="transaction.stockUnit"
                                                [name]="'transaction.stockUnit_' + entryIdx"
                                            >
                                                <div class="select-quantity-option">
                                                    <mat-option
                                                        *ngFor="let stock of transaction.stockList"
                                                        [value]="stock.id"
                                                    >
                                                        {{ stock.text }}
                                                    </mat-option>
                                                </div>
                                            </mat-select>
                                        </div>
                                    </td>
                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        class="text-right item-rate"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.rateAllowed"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <text-field
                                                    [readonly]="!transaction.isStockTxn || isEinvoiceGenerated"
                                                    [placeholder]="commonLocaleData?.app_rate"
                                                    [type]="'text'"
                                                    [cssClass]="
                                                        'form-control mat-field-border transaction-rate text-right '
                                                    "
                                                    [name]="'transaction.rate_' + entryIdx"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency"
                                                    [mask]="inputMaskFormat"
                                                    [useMask]="true"
                                                    [(ngModel)]="transaction.rate"
                                                    (change)="
                                                        calculateStockEntryAmount(transaction);
                                                        calculateWhenTrxAltered(entry, transaction)
                                                    "
                                                    [customDecimalPlaces]="highPrecisionRate"
                                                ></text-field>
                                            </div>
                                            <!-- please add condition for show and hide -->
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="
                                                            transaction.rate * exchangeRate
                                                                ? transaction.rate * exchangeRate
                                                                : 0
                                                        "
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                        [ratePrecision]="true"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        class="text-right item-amount"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <text-field
                                                    (click)="transactionAmountClicked(transaction)"
                                                    [placeholder]="commonLocaleData?.app_amount"
                                                    [type]="'text'"
                                                    [cssClass]="'form-control mat-field-border text-right '"
                                                    [name]="'transaction.amount_' + entryIdx"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency"
                                                    [mask]="inputMaskFormat"
                                                    [useMask]="true"
                                                    [(ngModel)]="transaction.amount"
                                                    (change)="calculateWhenTrxAltered(entry, transaction, true, $event)"
                                                    [readonly]="isEinvoiceGenerated"
                                                >
                                                </text-field>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="transaction.convertedAmount"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td
                                        (click)="closeTaxControlPopup()"
                                        class="item-discount"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.discountAllowed"
                                    >
                                        <div class="td-wrapper">
                                            <div class="text-right flex-fill">
                                                <discount-control-component
                                                    #discountComponent
                                                    [discountMenu]="false"
                                                    [discountsList]="discountsList"
                                                    [discountAccountsDetails]="entry.discounts"
                                                    [discountSum]="entry.discountSum"
                                                    [showHeaderText]="false"
                                                    (hideOtherPopups)="closeTaxControlPopup()"
                                                    (discountTotalUpdated)="
                                                        calculateWhenTrxAltered(entry, transaction, false, $event)
                                                    "
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency"
                                                    [commonLocaleData]="commonLocaleData"
                                                    [readonly]="isEinvoiceGenerated"
                                                >
                                                </discount-control-component>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="entry.discountSum * exchangeRate"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td
                                        (click)="closeDiscountPopup()"
                                        *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.taxesAllowed"
                                        class="position-relative dropdown-container item-tax"
                                    >
                                        <div class="td-wrapper">
                                            <div class="text-right flex-fill">
                                                <tax-control
                                                    #taxControlComponent
                                                    [taxes]="companyTaxesList"
                                                    [date]="entry?.entryDate"
                                                    [taxRenderData]="entry.taxes"
                                                    [totalForTax]="transaction.taxableValue"
                                                    [applicableTaxes]="transaction.applicableTaxes"
                                                    [exceptTaxTypes]="exceptTaxTypes"
                                                    [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                    [showHeading]="false"
                                                    [rootClass]="'sales-invoice-table'"
                                                    (selectedTaxEvent)="transaction.applicableTaxes = $event"
                                                    (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                                    (hideOtherPopups)="closeDiscountPopup()"
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency"
                                                    [readonly]="isEinvoiceGenerated"
                                                >
                                                </tax-control>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="(entry.taxSum + entry.cessSum) * exchangeRate"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td
                                        (click)="closeDiscountPopup(); closeTaxControlPopup()"
                                        class="text-right item-total delete-btn-absolute"
                                    >
                                        <div class="td-wrapper">
                                            <div class="flex-fill">
                                                <text-field
                                                    [type]="'text'"
                                                    [cssClass]="'form-control mat-field-border text-right '"
                                                    [name]="'transaction.total_' + entryIdx"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency"
                                                    [mask]="inputMaskFormat"
                                                    [useMask]="true"
                                                    [allowDecimalDigitsOnly]="true"
                                                    [(ngModel)]="transaction.total"
                                                    (change)="calculateTransactionValueInclusively(entry, transaction)"
                                                    [readonly]="isEinvoiceGenerated"
                                                >
                                                </text-field>
                                                <div *ngIf="isTcsTdsApplicable" class="wrap-other-tax">
                                                    <mat-checkbox
                                                        (keydown.enter)="$event.preventDefault()"
                                                        *ngIf="!entry.isOtherTaxApplicable"
                                                        [checked]="entry.isOtherTaxApplicable"
                                                        color="primary"
                                                        id="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                        [(ngModel)]="entry.isOtherTaxApplicable"
                                                        (change)="
                                                            toggleOtherTaxesAsidePane(
                                                                entry.isOtherTaxApplicable,
                                                                entryIdx
                                                            )
                                                        "
                                                        class="other-taxes-checkbox"
                                                        name="entry.isOtherTaxApplicable_'+entryIdx"
                                                        [disabled]="isEinvoiceGenerated"
                                                    >
                                                    </mat-checkbox>
                                                    <label
                                                        for="entry.isOtherTaxApplicable_{{ entryIdx }}"
                                                        *ngIf="!entry.isOtherTaxApplicable"
                                                        class="other-tax-label font-15 align-middle"
                                                        (click)="tcsTdsIndex = entryIdx"
                                                        >{{ localeData?.other_tax }}</label
                                                    >
                                                </div>
                                                <div *ngIf="entry.isOtherTaxApplicable" class="mr-t1">
                                                    <span>
                                                        <div class="d-flex align-items-center">
                                                            <span class="mr-r05">
                                                                <a
                                                                    href="javascript:;"
                                                                    *ngIf="!isEinvoiceGenerated"
                                                                    (click)="toggleOtherTaxesAsidePane(true, entryIdx)"
                                                                >
                                                                    <img src="assets/images/edit-pencilicon.svg" />
                                                                </a>
                                                            </span>
                                                            <text-field
                                                                [readonly]="'disabled'"
                                                                [cssClass]="'text-right form-control other-taxes-input'"
                                                                [name]="'entry.otherTaxesSum_' + entryIdx"
                                                                [prefix]="invFormData.accountDetails.currencySymbol"
                                                                [suffix]="selectedSuffixForCurrency"
                                                                [mask]="inputMaskFormat"
                                                                [useMask]="true"
                                                                [(ngModel)]="entry.otherTaxSum"
                                                            ></text-field>
                                                        </div>
                                                        <p class="mr-r05 font-12 text-capitalize mr-b2">
                                                            {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                        </p>
                                                    </span>
                                                </div>
                                            </div>
                                            <div
                                                *ngIf="
                                                    entry.isOtherTaxApplicable &&
                                                    isMulticurrencyAccount &&
                                                    entry.otherTaxModal?.appliedOtherTax?.name
                                                "
                                                class="tax-in-currency"
                                            >
                                                <span>
                                                    <amount-field
                                                        [amount]="entry.otherTaxSum * exchangeRate"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>
                                                    <amount-field
                                                        [amount]="transaction.convertedTotal"
                                                        [currencySymbol]="baseCurrencySymbol"
                                                        [currencyCode]="companyCurrency"
                                                    >
                                                    </amount-field>
                                                </span>
                                            </div>
                                        </div>
                                        <div
                                            class="trash-icon-delete"
                                            *ngIf="!isEinvoiceGenerated"
                                            (click)="
                                                removeTransaction(entryIdx);
                                                $event.preventDefault();
                                                $event.stopPropagation()
                                            "
                                        >
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <!-- endregion -->
                                <!-- </ng-container> -->
                            </ng-template>
                            <!-- region add bulk items -->
                            <div class="p-1 aqua-color add-line-bulk-item width-100" *ngIf="!isEinvoiceGenerated">
                                <a href="javascript:;" (click)="addBlankRow(null)">{{ localeData?.add_new_line }}</a>
                                <span class="font-15 add-bulk-button"> | </span>
                                <a (click)="addBulkItems()" href="javascript:;">{{ localeData?.add_bulk_entries }}</a>
                            </div>
                            <!-- endregion -->
                        </table>
                        <div class="row mr-0 ml-0 other-details-section">
                            <div class="col-md-6 pl-0">
                                <!-- region other details-->
                                <div *ngIf="!currentVoucherFormDetails || currentVoucherFormDetails?.otherDetails">
                                    <div class="collapse-pane clearfix">
                                        <div
                                            class="collapse-pane-heading"
                                            (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed"
                                        >
                                            <div class="ico-box-wrap">
                                                <div class="ico-box">
                                                    <span
                                                        [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                                        aria-hidden="true"
                                                    ></span>
                                                </div>
                                            </div>
                                            <div class="ico-head">{{ commonLocaleData?.app_other_details }}</div>
                                        </div>
                                        <div
                                            [collapse]="isOthrDtlCollapsed"
                                            class="clearfix max-width-600 pd-l3 m-0 other-details-section-list"
                                        >
                                            <div class="row">
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <giddh-datepicker
                                                        [cssClass]="'shipping-date'"
                                                        (keydown.enter)="$event.preventDefault()"
                                                        #shippingDate="ngModel"
                                                        [placeholder]="templatePlaceholder?.shippedDateLabel"
                                                        name="shippingDate"
                                                        [(ngModel)]="invFormData.templateDetails.other.shippingDate"
                                                        [class.invalid-inp]="
                                                            shippingDate.errors &&
                                                            (shippingDate.dirty || shippingDate.touched)
                                                        "
                                                        [appearance]="'fill'"
                                                    >
                                                    </giddh-datepicker>
                                                    <p
                                                        class="text-danger"
                                                        *ngIf="
                                                            shippingDate.errors &&
                                                            (shippingDate.dirty || shippingDate.touched)
                                                        "
                                                    >
                                                        {{ localeData?.invalid_date }}
                                                    </p>
                                                </div>
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        [type]="'text'"
                                                        [name]="'shippedVia'"
                                                        [(ngModel)]="invFormData.templateDetails.other.shippedVia"
                                                        [cssClass]="'form-control mat-field-border'"
                                                        [placeholder]="
                                                            templatePlaceholder?.shippedViaLabel || localeData?.ship_via
                                                        "
                                                    ></text-field>
                                                </div>
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        [type]="'text'"
                                                        [name]="'trackingNumber'"
                                                        [(ngModel)]="invFormData.templateDetails.other.trackingNumber"
                                                        [cssClass]="'form-control mat-field-border'"
                                                        [placeholder]="
                                                            templatePlaceholder?.trackingNumber ||
                                                            localeData?.tracking_number
                                                        "
                                                    ></text-field>
                                                </div>
                                            </div>
                                            <div class="row bottom-other-section">
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        [type]="'text'"
                                                        [name]="'customField1'"
                                                        [(ngModel)]="invFormData.templateDetails.other.customField1"
                                                        [cssClass]="'form-control mat-field-border'"
                                                        [placeholder]="
                                                            templatePlaceholder?.customField1Label || localeData?.field1
                                                        "
                                                    ></text-field>
                                                </div>
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        [type]="'text'"
                                                        [name]="'customField2'"
                                                        [(ngModel)]="invFormData.templateDetails.other.customField2"
                                                        [cssClass]="'form-control mat-field-border'"
                                                        [placeholder]="
                                                            templatePlaceholder?.customField2Label || localeData?.field2
                                                        "
                                                    ></text-field>
                                                </div>
                                                <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                    <text-field
                                                        [type]="'text'"
                                                        [name]="'customField3'"
                                                        [(ngModel)]="invFormData.templateDetails.other.customField3"
                                                        [cssClass]="'form-control mat-field-border'"
                                                        [placeholder]="
                                                            templatePlaceholder?.customField3Label || localeData?.field3
                                                        "
                                                    ></text-field>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- endregion -->
                                <!-- region note/messages -->
                                <div class="pd-t1 pl-0 max-width-600 pd-t3" *ngIf="!isPurchaseInvoice">
                                    <mat-form-field appearance="outline">
                                        <mat-label>{{ commonLocaleData?.app_note }}</mat-label>
                                        <textarea
                                            matInput
                                            class="textarea-height"
                                            hasFocus
                                            #message2="hasFocus"
                                            [class.error-box]="(invoiceForm?.controls)['message2']?.errors?.maxlength"
                                            name="message2"
                                            [maxlength]="
                                                shouldApplyMaxLengthOnNotes && !showNotesAtLastPage ? 200 : null
                                            "
                                            [(ngModel)]="invFormData.templateDetails.other.message2"
                                        >
                                        </textarea>
                                    </mat-form-field>
                                    <ng-container
                                        *ngIf="
                                            shouldApplyMaxLengthOnNotes &&
                                            invFormData?.templateDetails?.other?.message2?.length &&
                                            !showNotesAtLastPage &&
                                            (message2?.isFocused ||
                                                (invoiceForm?.controls)['message2']?.errors?.maxlength)
                                        "
                                    >
                                        <span class="max-character-label"
                                            >{{ commonLocaleData?.app_characters_left }}:&nbsp;</span
                                        ><span class="max-character-value">{{
                                            200 - invFormData?.templateDetails?.other?.message2?.length
                                        }}</span>
                                    </ng-container>
                                </div>
                                <!-- endregion -->
                                <div
                                    class="pd-t1 pl-0 max-width-600 position-relative"
                                    *ngIf="currentVoucherFormDetails?.attachmentAllowed || isPurchaseInvoice"
                                >
                                    <label class="mr-b1"
                                        ><i class="icon-file-path"></i> {{ localeData?.attachment }}</label
                                    >
                                    <label
                                        class="custom-file-label form-control cp position-relative"
                                        for="invoiceFile"
                                    >
                                        <em *ngIf="!selectedFileName && !isFileUploading">{{
                                            localeData?.drag_drop_file
                                        }}</em>
                                        <div
                                            *ngIf="isFileUploading"
                                            class="d-flex justify-content-center align-items-center"
                                        >
                                            <i class="fa fa-spinner rotate"></i>
                                        </div>
                                        <em *ngIf="selectedFileName && !isFileUploading" class="text-success">{{
                                            selectedFileName
                                        }}</em>
                                        <span class="text-success"
                                            ><i class="fa fa-check" *ngIf="selectedFileName && !isFileUploading"></i
                                        ></span>
                                        <input
                                            type="file"
                                            name="invoiceFile"
                                            id="invoiceFile"
                                            [options]="fileUploadOptions"
                                            ngFileSelect
                                            [uploadInput]="uploadInput"
                                            (uploadOutput)="onUploadOutput($event)"
                                            (change)="onFileChange($event.target)"
                                            droppable="true"
                                        />
                                    </label>
                                    <span
                                        class="delete-image"
                                        (click)="deleteAttachementConfirmation()"
                                        *ngIf="voucherApiVersion === 2 && selectedFileName && !isFileUploading"
                                    >
                                        <img src="assets/images/multiply.svg" />
                                    </span>
                                </div>
                                <!-- endregion -->
                            </div>
                            <!-- region total section -->
                            <div class="col-md-6 pr-0">
                                <section class="table-sec form-group">
                                    <div class="table-row">
                                        <div class="table-cell">{{ commonLocaleData?.app_total_amount }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails?.subTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="table-row">
                                        <div class="table-cell">{{ commonLocaleData?.app_discount }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.totalDiscount * -1"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="table-row">
                                        <div class="table-cell">{{ commonLocaleData?.app_taxable_value }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.totalTaxableValue"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="table-row" *ngIf="!excludeTax">
                                        <div class="table-cell">{{ commonLocaleData?.app_tax }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.gstTaxesTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="table-row" *ngIf="!excludeTax">
                                        <div class="table-cell">{{ commonLocaleData?.app_cess }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData?.voucherDetails.cessTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData?.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="table-row" *ngIf="calculatedRoundOff !== 0">
                                        <div class="table-cell">
                                            <strong>{{ commonLocaleData?.app_round_off }}</strong>
                                        </div>
                                        <div class="table-cell figure-cell">
                                            <strong>
                                                <span class="d-flex justify-content-end">
                                                    <amount-field
                                                        [amount]="calculatedRoundOff"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currencySymbol
                                                                : false
                                                        "
                                                        [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData?.accountDetails?.currency?.code
                                                                : false
                                                        "
                                                    >
                                                    </amount-field>
                                                </span>
                                            </strong>
                                        </div>
                                    </div>
                                    <div class="table-row">
                                        <div class="table-cell bigger-dollar">
                                            <strong
                                                >{{ commonLocaleData?.app_total }}
                                                <span *ngIf="isMulticurrencyAccount">{{
                                                    invFormData.accountDetails.currencySymbol
                                                }}</span>
                                            </strong>
                                        </div>
                                        <div class="table-cell figure-cell">
                                            <strong>
                                                <span class="d-flex justify-content-end">
                                                    <amount-field
                                                        [amount]="invFormData.voucherDetails.grandTotal"
                                                        [currencySymbol]="
                                                            isMulticurrencyAccount
                                                                ? invFormData.accountDetails?.currencySymbol
                                                                : false
                                                        "
                                                        [currencyCode]="
                                                            isMulticurrencyAccount
                                                                ? invFormData.accountDetails?.currency?.code
                                                                : false
                                                        "
                                                    >
                                                    </amount-field>
                                                </span>
                                            </strong>
                                        </div>
                                    </div>
                                    <!-- multicurrency feature (editable grand total make it functional) -->
                                    <div class="table-row" *ngIf="isMulticurrencyAccount">
                                        <div class="table-cell bigger-dollar">
                                            <strong
                                                >{{ commonLocaleData?.app_total }}
                                                <span>{{ baseCurrencySymbol }}</span>
                                            </strong>
                                        </div>
                                        <div class="table-cell figure-cell">
                                            <text-field
                                                #grandTotalInr
                                                [type]="'text'"
                                                [cssClass]="'form-control mat-field-border multicurrency-grandtotal'"
                                                [name]="'grandTotalMulDum'"
                                                [prefix]="baseCurrencySymbol"
                                                [suffix]="selectedSuffixForCurrency"
                                                [mask]="inputMaskFormat"
                                                [useMask]="true"
                                                [(ngModel)]="grandTotalMulDum"
                                                (blur)="
                                                    updateExchangeRate(grandTotalInr?.value);
                                                    recalculateConvertedTotal()
                                                "
                                                [readonly]="isEinvoiceGenerated"
                                            ></text-field>
                                        </div>
                                    </div>
                                    <div class="table-row" *ngIf="isTcsPresent">
                                        <div class="table-cell">{{ commonLocaleData?.app_tcs }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.tcsTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="table-row" *ngIf="isTdsPresent">
                                        <div class="table-cell">{{ commonLocaleData?.app_tds }}</div>
                                        <div class="table-cell figure-cell">
                                            <span class="d-flex justify-content-end">
                                                <amount-field
                                                    [amount]="invFormData.voucherDetails.tdsTotal"
                                                    [currencySymbol]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currencySymbol
                                                            : false
                                                    "
                                                    [currencyCode]="
                                                        isMulticurrencyAccount
                                                            ? invFormData.accountDetails?.currency?.code
                                                            : false
                                                    "
                                                >
                                                </amount-field>
                                            </span>
                                        </div>
                                    </div>
                                    <!--region balance due for non-purchase-->
                                    <div
                                        class="table-row"
                                        *ngIf="
                                            !hideDepositSection &&
                                            (isSalesInvoice ||
                                                currentVoucherFormDetails?.depositAllowed ||
                                                (voucherApiVersion === 2 &&
                                                    (isSalesInvoice ||
                                                        isPurchaseInvoice ||
                                                        isCreditNote ||
                                                        isDebitNote ||
                                                        isPendingVoucherType))) &&
                                            !(voucherApiVersion !== 2 && isPendingVoucherType && isCashInvoice)
                                        "
                                    >
                                        <div
                                            class="table-cell deposit-section"
                                            *ngIf="
                                                ((isSalesInvoice || isPurchaseInvoice || isCreditNote || isDebitNote) &&
                                                    (isAccountHaveAdvanceReceipts ||
                                                        isInvoiceAdjustedWithAdvanceReceipts)) ||
                                                (!isUpdateMode &&
                                                    (isSalesInvoice || currentVoucherFormDetails?.depositAllowed))
                                            "
                                        >
                                            <div class="btn-group">
                                                <div
                                                    (click)="clickedInside($event)"
                                                    id="deposit-dropdown"
                                                    class="form-group pd-1"
                                                >
                                                    <strong>{{ localeData?.deposit }}</strong>
                                                    <ul>
                                                        <ng-container
                                                            *ngIf="
                                                                (isSalesInvoice ||
                                                                    isPurchaseInvoice ||
                                                                    isCreditNote ||
                                                                    isDebitNote ||
                                                                    isPendingVoucherType) &&
                                                                (isAccountHaveAdvanceReceipts ||
                                                                    isInvoiceAdjustedWithAdvanceReceipts)
                                                            "
                                                        >
                                                            <li role="menuitem" class="mr-t1">
                                                                <div class="clearfix payment-mode deposit-payment-mode">
                                                                    <div class="balance-due-text">
                                                                        <label class="blnc-label">{{
                                                                            localeData?.adjust_amount
                                                                        }}</label>
                                                                        <div
                                                                            class="clearfix mr-b1 text-left"
                                                                            *ngIf="voucherApiVersion !== 2"
                                                                        >
                                                                            <mat-radio-group
                                                                                class="d-flex mb-2"
                                                                                [(ngModel)]="isAdjustAmount"
                                                                                name="advanceReceipt"
                                                                            >
                                                                                <mat-radio-button
                                                                                    color="primary"
                                                                                    id="adjustAmountNo"
                                                                                    [value]="false"
                                                                                    (click)="clickAdjustAmount(false)"
                                                                                    (change)="clickAdjustAmount($event)"
                                                                                >
                                                                                    {{ commonLocaleData?.app_no }}
                                                                                </mat-radio-button>
                                                                                <mat-radio-button
                                                                                    color="primary"
                                                                                    id="sacCodeType{{ entryIdx }}"
                                                                                    [value]="true"
                                                                                    (click)="clickAdjustAmount(true)"
                                                                                    (change)="clickAdjustAmount($event)"
                                                                                >
                                                                                    {{ commonLocaleData?.app_yes }}
                                                                                </mat-radio-button>
                                                                            </mat-radio-group>
                                                                        </div>
                                                                        <div class="clearfix mr-t05 adjust-amount">
                                                                            <span class="pull-left">
                                                                                <p class="text-light">
                                                                                    <amount-field
                                                                                        [amount]="
                                                                                            adjustPaymentData.totalAdjustedAmount
                                                                                                | replace: '-':''
                                                                                        "
                                                                                        [currencySymbol]="
                                                                                            isMulticurrencyAccount
                                                                                                ? invFormData
                                                                                                      .accountDetails
                                                                                                      ?.currencySymbol
                                                                                                : false
                                                                                        "
                                                                                        [currencyCode]="
                                                                                            isMulticurrencyAccount
                                                                                                ? invFormData
                                                                                                      .accountDetails
                                                                                                      ?.currency?.code
                                                                                                : false
                                                                                        "
                                                                                    >
                                                                                    </amount-field>
                                                                                </p>
                                                                            </span>
                                                                            <a
                                                                                href="javascript:void(0)"
                                                                                (click)="clickAdjustAmount(true)"
                                                                                class="font-12 pl-0 color-primary"
                                                                                ><i class="icon-edit11"></i
                                                                            ></a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        </ng-container>
                                                        <ng-container
                                                            *ngIf="
                                                                !isUpdateMode &&
                                                                (isSalesInvoice ||
                                                                    currentVoucherFormDetails?.depositAllowed)
                                                            "
                                                        >
                                                            <li role="menuitem" class="mr-t1">
                                                                <div class="payment-mode">
                                                                    <dropdown-field
                                                                        #depositDropdown
                                                                        [cssClass]="'pull-right'"
                                                                        [name]="'depositAccountUniqueName'"
                                                                        [options]="bankAccounts$ | async"
                                                                        (selectedOption)="onSelectPaymentMode($event)"
                                                                        [placeholder]="
                                                                            commonLocaleData?.app_select_account
                                                                        "
                                                                        (onClear)="onSelectPaymentMode($event, true)"
                                                                        [defaultValue]="
                                                                            isCashInvoice
                                                                                ? selectedBankAccount
                                                                                : selectPaymentValue
                                                                        "
                                                                        class="w-100"
                                                                    >
                                                                    </dropdown-field>
                                                                </div>
                                                            </li>
                                                            <li
                                                                class="
                                                                    clearfix
                                                                    mr-t15
                                                                    d-flex
                                                                    align-items-center
                                                                    payment-mode-amount
                                                                "
                                                                *ngIf="
                                                                    (isSalesInvoice ||
                                                                        currentVoucherFormDetails?.depositAllowed) &&
                                                                    !isCashInvoice
                                                                "
                                                            >
                                                                <div class="payment-mode">
                                                                    <input-field
                                                                        (change)="
                                                                            calculateBalanceDue();
                                                                            updateDepositAmount($event?.target?.value)
                                                                        "
                                                                        [placeholder]="commonLocaleData?.app_amount"
                                                                        [cssClass]="
                                                                            'amount-field
                                                                        due-amount-field
                                                                        text-right
                                                                        pull-right
                                                                        max-width-100
                                                                        multicurrency-grandtotal'
                                                                        "
                                                                        [name]="'dueAmount'"
                                                                        [prefix]="depositCurrSymbol"
                                                                        [suffix]="selectedSuffixForCurrency"
                                                                        [mask]="inputMaskFormat"
                                                                        [useMask]="true"
                                                                        [(ngModel)]="depositAmount"
                                                                        [required]="
                                                                            depositAccountUniqueName ? true : false
                                                                        "
                                                                        [type]="'text'"
                                                                        [readonly]="isEinvoiceGenerated"
                                                                        class="w-100"
                                                                    ></input-field>
                                                                </div>
                                                            </li>

                                                            <li
                                                                class="clearfix mr-t1 bigger-dollar blnc-due"
                                                                *ngIf="
                                                                    isSalesInvoice ||
                                                                    (voucherApiVersion === 2 &&
                                                                        (isPurchaseInvoice ||
                                                                            isCreditNote ||
                                                                            isDebitNote ||
                                                                            isPendingVoucherType))
                                                                "
                                                            >
                                                                <strong>{{ localeData?.balance_due }}</strong>
                                                                <strong class="blnc-due-num ml-3">
                                                                    <span *ngIf="isMulticurrencyAccount">{{
                                                                        invFormData.accountDetails.currencySymbol
                                                                    }}</span>
                                                                    <ng-container
                                                                        *ngIf="adjustPaymentData?.totalAdjustedAmount"
                                                                    >
                                                                        {{
                                                                            adjustPaymentBalanceDueData | giddhCurrency
                                                                        }}
                                                                    </ng-container>
                                                                    <ng-container
                                                                        *ngIf="!adjustPaymentData?.totalAdjustedAmount"
                                                                    >
                                                                        {{
                                                                            invFormData.voucherDetails.balanceDue
                                                                                | giddhCurrency
                                                                        }}
                                                                    </ng-container>
                                                                </strong>
                                                            </li>
                                                        </ng-container>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--endregion-->
                                    <!-- region balance due for purchase -->
                                    <div class="table-row" *ngIf="isPurchaseInvoice && voucherApiVersion !== 2">
                                        <div class="table-cell">
                                            <strong
                                                >{{ localeData?.balance_due }}
                                                <span *ngIf="isMulticurrencyAccount">{{
                                                    invFormData.accountDetails.currencySymbol
                                                }}</span></strong
                                            >
                                        </div>
                                        <div class="table-cell figure-cell">
                                            <strong>{{ invFormData.voucherDetails.balanceDue | giddhCurrency }}</strong>
                                        </div>
                                    </div>
                                    <!-- endregion -->
                                </section>
                            </div>
                            <!-- endregion -->
                        </div>
                    </section>
                    <!-- endregion -->
                    <!-- endregion -->
                </ng-container>
                <!-- endregion -->
                <!-- endregion -->
                <!-- region submit actions-->
                <section class="clearfix mr-b5">
                    <section
                        id="actionPane"
                        class="text-center mr-b2"
                        [ngClass]="{ 'giddh-overlap-block': invFormData.voucherDetails.customerName }"
                    >
                        <div class="col-12">
                            <!-- region generate mode -->
                            <div class="pull-right pr update-mode" *ngIf="!isUpdateMode">
                                <button
                                    mat-stroked-button
                                    (click)="resetInvoiceForm(invoiceForm)"
                                    class="d-inline-block v-align-middle"
                                >
                                    {{ commonLocaleData?.app_clear }}
                                </button>
                                <!-- region purchase invoice -->
                                <span class="d-inline-block v-align-middle" *ngIf="isPurchaseInvoice">
                                    <button
                                        mat-stroked-button
                                        color="primary"
                                        *ngIf="!isCompany"
                                        [disabled]="
                                            isFileUploading ||
                                            !hasVoucherEntry ||
                                            (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                            isMobileNumberInvalid
                                        "
                                        (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                    >
                                        {{ commonLocaleData?.app_save }}
                                    </button>
                                </span>
                                <!-- endregion -->
                                <!-- region non purchase -->
                                <span
                                    class="d-inline-block v-align-middle"
                                    *ngIf="!isPurchaseInvoice && !isProformaInvoice && !isEstimateInvoice"
                                >
                                    <button
                                        mat-stroked-button
                                        [disabled]="
                                            !hasVoucherEntry ||
                                            (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                            isMobileNumberInvalid
                                        "
                                        (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, true)"
                                        *ngIf="!isCompany && isCustomerSelected && !isPendingVoucherType"
                                    >
                                        {{ generateInvoiceText }}
                                        {{ localeData?.and_update_acc }}
                                    </button>
                                    <div
                                        *ngIf="!isCompany"
                                        class="btn-group"
                                        [isDisabled]="
                                            !hasVoucherEntry ||
                                            (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                            isMobileNumberInvalid
                                        "
                                    >
                                        <button
                                            mat-stroked-button
                                            [disabled]="
                                                !hasVoucherEntry ||
                                                (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                                isMobileNumberInvalid
                                            "
                                            (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                            class="generate-invoice"
                                        >
                                            {{ generateInvoiceText }}
                                        </button>
                                    </div>
                                    <div *ngIf="!isCompany" class="btn-group">
                                        <mat-menu
                                            #dropdownMenu="matMenu"
                                            class="bottom-dropdown-menu"
                                            yPosition="above"
                                        >
                                            <ul id="dropdown-dropup" class="create-send-menu h1">
                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(2); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_send }}</a
                                                    >
                                                </li>
                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(3); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_print }}</a
                                                    >
                                                </li>
                                                <li
                                                    role="menuitem"
                                                    (click)="doAction(4); triggerSubmitInvoiceForm(invoiceForm, false)"
                                                    *ngIf="voucherApiVersion !== 2"
                                                >
                                                    <a class="dropdown-item cp">{{ localeData?.generate_recurring }}</a>
                                                </li>
                                            </ul>
                                        </mat-menu>
                                        <button
                                            [matMenuTriggerFor]="dropdownMenu"
                                            id="button-dropup"
                                            *ngIf="invoiceType === 'sales'"
                                            mat-button
                                            class="btn btn-default dropdown-toggle h2"
                                        >
                                            <span class="caret"></span>
                                        </button>
                                    </div>
                                </span>
                                <!-- endregion -->
                                <!-- region proforma/estimates -->
                                <span
                                    class="d-inline-block v-align-middle"
                                    *ngIf="!isCompany && (isProformaInvoice || isEstimateInvoice)"
                                >
                                    <div
                                        class="btn-group"
                                        [isDisabled]="
                                            !hasVoucherEntry || (invoiceForm?.controls)['message2']?.errors?.maxlength
                                        "
                                    >
                                        <button
                                            *ngIf="!isCompany"
                                            mat-stroked-button
                                            [disabled]="
                                                !hasVoucherEntry ||
                                                (invoiceForm?.controls)['message2']?.errors?.maxlength
                                            "
                                            (click)="doAction(0); triggerSubmitInvoiceForm(invoiceForm, false)"
                                            class="h3"
                                        >
                                            {{ commonLocaleData?.app_create }}
                                        </button>
                                        <button
                                            [matMenuTriggerFor]="dropdownMenu2"
                                            id="button-dropup"
                                            mat-button
                                            class="btn btn-default dropdown-toggle dropdown-toggle-split"
                                        >
                                            <span class="caret"></span>
                                        </button>
                                        <mat-menu
                                            #dropdownMenu2="matMenu"
                                            class="bottom-dropdown-menu"
                                            yPosition="above"
                                        >
                                            <ul id="dropdown-dropup" class="create-send-menu h1" role="menu">
                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(2); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_send }}</a
                                                    >
                                                </li>
                                                <li role="menuitem">
                                                    <a
                                                        class="dropdown-item cp"
                                                        (click)="
                                                            doAction(3); triggerSubmitInvoiceForm(invoiceForm, false)
                                                        "
                                                        >{{ localeData?.create_print }}</a
                                                    >
                                                </li>
                                            </ul>
                                        </mat-menu>
                                    </div>
                                </span>
                                <!-- endregion -->
                            </div>
                            <!-- endregion -->
                            <!-- region update mode -->
                            <div class="pull-right pr" *ngIf="isUpdateMode">
                                <button
                                    mat-button
                                    class="btn btn-danger d-inline-block v-align-middle"
                                    (click)="cancelUpdate()"
                                >
                                    {{ commonLocaleData?.app_cancel }}
                                </button>
                                <button
                                    *ngIf="!isCompany"
                                    mat-button
                                    class="btn btn-default"
                                    [disabled]="
                                        isFileUploading ||
                                        !hasVoucherEntry ||
                                        (invoiceForm?.controls)['message2']?.errors?.maxlength ||
                                        isMobileNumberInvalid
                                    "
                                    (click)="submitUpdateForm(invoiceForm)"
                                >
                                    {{ updateInvoiceText }}
                                </button>
                            </div>
                            <!-- endregion -->
                        </div>
                    </section>
                </section>
                <!-- endregion -->
            </form>
        </div>
        <!-- endregion -->
    </div>
    <!-- region models section -->
    <!-- open account aside -->
    <div
        class="aside-overlay"
        *ngIf="
            accountAsideMenuState === 'in' ||
            asideMenuStateForProductService === 'in' ||
            asideMenuStateForRecurringEntry === 'in' ||
            asideMenuStateForOtherTaxes === 'in'
        "
        (click)="closeAsideMenuStateForOtherTaxes()"
    ></div>
    <generic-aside-menu-account
        [class]="accountAsideMenuState"
        [@slideInOut]="accountAsideMenuState"
        (closeAsideEvent)="toggleAccountAsidePane($event)"
        [selectedGrpUniqueName]="selectedGrpUniqueNameForAddEditAccountModal"
        [keyboardShortcut]="{ 'esc': accountAsideMenuState === 'in' }"
        *ngIf="accountAsideMenuState === 'in'"
        [selectedAccountUniqueName]="selectedCustomerForDetails"
        (onShortcutPress)="toggleAccountAsidePane()"
        (addEvent)="addNewSidebarAccount($event)"
        (updateEvent)="updateSidebarAccount($event)"
    >
    </generic-aside-menu-account>
    <!--&lt;!&ndash; open product service aside &ndash;&gt;-->
    <aside-menu-product-service
        *ngIf="asideMenuStateForProductService === 'in'"
        [class]="asideMenuStateForProductService"
        [selectedVoucherType]="selectedVoucherType"
        [@slideInOut]="asideMenuStateForProductService"
        (closeAsideEvent)="onNoResultsClicked()"
    >
    </aside-menu-product-service>
    <app-aside-recurring-entry
        *ngIf="asideMenuStateForRecurringEntry === 'in'"
        [voucherType]="invoiceType"
        [voucherNumber]="voucherNumber"
        [class]="asideMenuStateForRecurringEntry"
        [@slideInOut]="asideMenuStateForRecurringEntry"
        (closeAsideEvent)="toggleRecurringAsidePane('out')"
    >
    </app-aside-recurring-entry>
    <!-- region send email popup -->
    <ng-template #sendEmailModal>
        <ng-container *ngIf="actionAfterGenerateORUpdate === 2">
            <app-send-email-invoice-component
                [voucherType]="invoiceType"
                (successEvent)="sendEmail($event)"
                [selectedItem]="{
                    voucherNumber: invoiceNo,
                    uniqueName: accountUniqueName,
                    account: customerAccount,
                    voucherUniqueName: newVoucherUniqueName
                }"
                (cancelEvent)="cancelEmailModal()"
            ></app-send-email-invoice-component>
        </ng-container>
    </ng-template>
    <!-- endregion -->
    <div id="top0">
        <app-aside-menu-other-taxes
            *ngIf="asideMenuStateForOtherTaxes === 'in'"
            [class]="asideMenuStateForOtherTaxes"
            [taxes]="companyTaxesList"
            [otherTaxesModal]="activeEntry.otherTaxModal"
            [commonLocaleData]="commonLocaleData"
            [@slideInOut]="asideMenuStateForOtherTaxes"
            (closeModal)="closeAsideMenuStateForOtherTaxes()"
            (applyTaxes)="
                calculateOtherTaxes($event, activeEntry);
                toggleOtherTaxesAsidePane(true, null);
                calculateAffectedThingsFromOtherTaxChanges()
            "
        >
        </app-aside-menu-other-taxes>
    </div>
    <!-- region print voucher popup -->
    <ng-template #printVoucherModal>
        <ng-container *ngIf="actionAfterGenerateORUpdate === 3 && invoiceNo && accountUniqueName">
            <voucher-print-in-place-component
                [voucherType]="invoiceType"
                [localeData]="localeData"
                [commonLocaleData]="commonLocaleData"
                [selectedItem]="{
                    voucherNumber: invoiceNo,
                    uniqueName: accountUniqueName,
                    voucherUniqueName: newVoucherUniqueName
                }"
                (cancelEvent)="cancelPrintModal()"
            ></voucher-print-in-place-component>
        </ng-container>
    </ng-template>
    <!-- common template ref for displaying invoice type with first letter capital -->
    <ng-template #invoiceTypeDisplayRef>
        {{ getInvoiceType() | titlecase }}
    </ng-template>
    <!-- region purchase  order  popup -->
    <ng-template #purchaseRecordConfirmationPopup>
        <div class="modal-dialog">
            <div class="modal-content">
                <confirmation-modal
                    [configuration]="purchaseRecordConfirmationConfiguration"
                    (buttonClicked)="handlePurchaseRecordConfirmation($event)"
                ></confirmation-modal>
            </div>
        </div>
    </ng-template>
    <!-- region bulk items -->
    <ng-template #bulkItemsModal>
        <voucher-add-bulk-items-component
            [invoiceType]="invoiceType"
            (saveItemsEvent)="addBulkStockItems($event)"
            (closeEvent)="cancelBulkItemsModal()"
        ></voucher-add-bulk-items-component>
    </ng-template>
    <!-- region  adjust payment  popup -->
    <ng-template #adjustPaymentModal>
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <advance-receipt-adjustment-component
                    *ngIf="showAdvanceReceiptAdjust"
                    #advanceReceiptComponent
                    [adjustedVoucherType]="
                        voucherApiVersion === 2 && isPendingVoucherType ? invoiceType : selectedVoucherType
                    "
                    [isUpdateMode]="isUpdateMode"
                    [depositAmount]="depositAmount"
                    [invoiceFormDetails]="invFormData"
                    [isVoucherModule]="true && voucherApiVersion !== 2"
                    [advanceReceiptAdjustmentUpdatedData]="advanceReceiptAdjustmentData"
                    (closeModelEvent)="closeAdvanceReceiptModal()"
                    (submitClicked)="getAdvanceReceiptAdjustData($event)"
                    [voucherForAdjustment]="voucherForAdjustment"
                >
                </advance-receipt-adjustment-component>
            </div>
        </div>
    </ng-template>
    <!-- region  date change confirmation popup -->
    <ng-template #dateChangeConfirmationModel>
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <confirmation-modal
                    [configuration]="dateChangeConfiguration"
                    (buttonClicked)="handleDateChangeConfirmation($event)"
                ></confirmation-modal>
            </div>
        </div>
    </ng-template>
    <!-- region delete attachment confirmation popup -->
    <ng-template #attachmentDeleteConfirmationModel>
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <confirmation-modal
                    (buttonClicked)="handleAttachmentDelete($event)"
                    [configuration]="attachmentDeleteConfiguration"
                ></confirmation-modal>
            </div>
        </div>
    </ng-template>
</ng-container>
