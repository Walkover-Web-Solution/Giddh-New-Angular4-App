<form #invoiceForm="ngForm" (ngSubmit)="onSubmitInvoiceForm()" novalidate class="clearfix mr-b2"
    *ngIf="invoiceDataFound && templateHeader" autocomplete="off">
    <div class="clearfix ">
        <div class="clearfix wrapper-customer-table ">
            <table class="table customer-invoice-table">
                <tr>
                    <td width="150px">
                        <label>Customers Name </label>
                    </td>
                    <td width="65%">
                        <div class="clearfix">
                            <input type="text" name="customerName" class="form-control float-left input-width-name"
                                [(ngModel)]="invFormData.voucherDetails.customerName" />
                        </div>
                        <!-- flex row child end -->
                    </td>
                    <td>
                        <div class=" text-right">
                            <p class="font-20 b">
                                <span class="balance-due">Balance Due: </span>
                                <span class="sp-rupees">Rs
                                    {{invFormData.voucherDetails.grandTotal |giddhCurrency }}</span>
                            </p>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <ng-container>
                            <section class="form-inline  ">
                                <div class=" wrap-billing-address clearfix">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label>Billing Address</label>
                                                <div class="billing-address clearfix">
                                                    <textarea name="billingDetails.address" class="form-control"
                                                        [(ngModel)]="invFormData.accountDetails.billingDetails.address"
                                                        rows="3" autocomplete="off" autofocus="off"
                                                        aria-autocomplete="none"></textarea>
                                                    <div class="row">
                                                        <div class="col-sm-6 pd mr-b1">

                                                            <sales-sh-select [placeholder]="'Country'" [disabled]="true"
                                                                [showBottomBorderOnly]="true" [width]="'100%'"
                                                                class="select-bdr-bottom"></sales-sh-select>

                                                        </div>
                                                        <div class="col-sm-6 pd mr-b1">

                                                            <sales-sh-select [placeholder]="'State'"
                                                                class="select-bdr-bottom"
                                                                (selected)="autoFillShippingDetails()" #statesBilling
                                                                [showBottomBorderOnly]="true"
                                                                [options]="statesSource$ | async"
                                                                name="billingDetails.stateCode"
                                                                [(ngModel)]="invFormData.accountDetails.billingDetails.stateCode">
                                                            </sales-sh-select>

                                                        </div>
                                                        <div class="col-sm-6 pd mr-b1">
                                                            <input maxLength="15" type="text" name="gstNumber"
                                                                class="form-control input-custom"
                                                                [(ngModel)]="invFormData.accountDetails.billingDetails.gstNumber"
                                                                (keyup)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()"
                                                                placeholder="GSTIN" />
                                                        </div>
                                                        <!-- static pin code  -->
                                                        <div class="col-sm-6 pd mr-b1">
                                                            <div class="form-group mr-b05">
                                                                <input type="number" class="form-control input-custom"
                                                                    autocomplete="false" name="pinCodeNum"
                                                                    placeholder="PIN Code" />
                                                            </div>
                                                        </div>
                                                        <!-- static pin code end-->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group p-0 width-100">
                                                <label class="d-flex justify-content-center align-items-center">
                                                    <input type="checkbox" (change)="autoFillShippingDetails()"
                                                        name="autoFillShipping" [attr.checked]="true"
                                                        [(ngModel)]="autoFillShipping" class="shipping-checkbox">
                                                    Shipping Address Same as Billing
                                                    Address</label>
                                                <div class="billing-address" [ngClass]="{'disabled': autoFillShipping}">
                                                    <textarea [readonly]="autoFillShipping"
                                                        name="shippingDetails.address" class="form-control"
                                                        [(ngModel)]="invFormData.accountDetails.shippingDetails.address"
                                                        rows="3" autocomplete="off"></textarea>
                                                    <div class="clearfix">
                                                        <div class="form-group row">
                                                            <div class="col-sm-6 pd mr-b1">
                                                                <div class="form-group">

                                                                    <sales-sh-select [disabled]="true"
                                                                        [placeholder]="'Country'"
                                                                        [showBottomBorderOnly]="true" [width]="'100%'"
                                                                        class="select-bdr-bottom"></sales-sh-select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-6 pd mr-b1">

                                                                <sales-sh-select [disabled]="autoFillShipping"
                                                                    [placeholder]="'State'" class="select-bdr-bottom"
                                                                    #statesShipping [showBottomBorderOnly]="true"
                                                                    [options]="statesSource$ | async"
                                                                    name="shippingDetails.stateCode"
                                                                    [(ngModel)]="invFormData.accountDetails.shippingDetails.stateCode">
                                                                </sales-sh-select>
                                                            </div>
                                                            <div class="col-sm-6 pd mr-b1">
                                                                <input [readonly]="autoFillShipping" maxLength="15"
                                                                    type="text" name="shippingDetails.gstNumber"
                                                                    class="form-control input-custom"
                                                                    [(ngModel)]="invFormData.accountDetails.shippingDetails.gstNumber"
                                                                    (keyup)="getStateCode('shippingDetails', statesShipping)"
                                                                    placeholder="GSTIN" />
                                                            </div>
                                                            <!-- static pin code  -->
                                                            <div class="col-sm-6 pd mr-b1">
                                                                <div class="form-group mr-b05">
                                                                    <input type="text" class="form-control input-custom"
                                                                        autocomplete="false" name="pinCodeNum"
                                                                        placeholder="Pincode" />
                                                                </div>
                                                            </div>
                                                            <!-- static pin code end-->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>

                            </section>
                        </ng-container>
                    </td>
                    <td></td>
                </tr>



            </table>
            <table class="inner-table table  customer-invoice-table bg-white">
                <tr>
                    <td>
                        <label>Attention to</label>
                    </td>
                    <td width="65%">
                        <div class="col-xs-6 pl-0">
                            <input type="text" name="attention" placeholder="Attention to"
                                class="form-control attention-to"
                                [(ngModel)]="invFormData.accountDetails.attentionTo" />
                        </div>

                    </td>
                    <td>
                    </td>

                </tr>
                <tr>
                    <td width="150px">
                        <label>Email Id</label>
                    </td>
                    <td width="65%">
                        <div class="col-xs-6 pl-0">
                            <input type="email" placeholder="someone@example.com" name="accountDetails.email"
                                class="form-control attention-to" [(ngModel)]="invFormData.accountDetails.email"
                                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" #customeremail="ngModel"
                                [class.invalid-inp]="customeremail.errors && (customeremail.dirty || customeremail.touched)" />
                        </div>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td>
                        <label>Mobile Number</label>
                    </td>
                    <td>
                        <div class="col-xs-6 pl-0">
                            <input digitsOnlyDirective placeholder="9198XXXXXXXX" type="text"
                                name="accountDetails.mobileNumber" class="form-control attention-to"
                                [(ngModel)]="invFormData.accountDetails.mobileNumber" />

                        </div>

                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td>
                        <label> Invoice #</label>
                    </td>
                    <td class="position-relative row">
                        <div class="col-6 pl-0">
                            <input type="text" [disabled]="updateMode" name="invoiceNumber" class="form-control"
                                [(ngModel)]="invFormData.voucherDetails.voucherNumber" />
                        </div>
                        <div class="col-6 invoice-date-due-date">
                            <div class="form-inline ">
                                <div class="form-group mr-r15">

                                    <label>Invoice Date</label>

                                    <input type="text" [placeholder]="giddhDateFormat" #voucherDate="ngModel"
                                        class="form-control date-invoice" bsDatepicker
                                        [bsConfig]="{ dateInputFormat: giddhDateFormat }" name="invoiceDate"
                                        [(ngModel)]="invFormData.voucherDetails.voucherDate" />
                                </div>
                                <div class="form-group mr-l1 mr-r15">
                                    <label>{{templateHeader?.dueDate?.label}}</label>
                                    <input type="text" [placeholder]="giddhDateFormat" name="dueDate"
                                        [(ngModel)]="invFormData.voucherDetails.dueDate" [minDate]="maxDueDate"
                                        class="form-control" bsDatepicker
                                        [bsConfig]="{ dateInputFormat: giddhDateFormat }" #dueDate="ngModel"
                                        [class.invalid-inp]="dueDate.errors && (dueDate.dirty || dueDate.touched)" />


                                </div>
                            </div>
                        </div>


                    </td>

                </tr>
            </table>



        </div>

    </div>

    <section class="static-invoice-table sales-invoice-table clearfix mr-b2 white-bg container-fluid ng-tns-c8-0 ">
        <table class="table  table-custom-invoice  basic cursor-pointer">
            <thead class="thead-background1" (click)="setActiveIndxs(1000)">
                <tr>
                    <th *ngFor="let item of tthead" attr.data-field="{{item.label}}" [hidden]="!item.display">
                        {{item.label}}

                    </th>
                </tr>
            </thead>
            <tbody *ngFor="let entry of invFormData.entries; let entryIdx = index;">
                <ng-container *ngFor="let transaction of entry.transactions; let transIndex = index;">
                    <tr (click)="setActiveIndxs(entryIdx)" [hidden]="activeIndx === entryIdx">
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="product-name">
                                <label *ngIf="!transaction.accountName" class="select-account-label">Click to Select
                                    Account </label>{{transaction.accountName}}
                                <span
                                    *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}})</span>

                            </div>
                            <div class="sku-number">
                                <label>SKU:</label>Number
                            </div>
                            <div class="description">
                                {{transaction.description}}

                            </div>
                            <div class="date-hsn-code">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="entryDate">
                                            <label>Entry Date: </label> {{moment(entry.entryDate) | date: 'MM-dd-yyyy'}}
                                            <span class="edit-icon">
                                                <img src="assets/images/edit-pencilicon.svg">
                                            </span>




                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="hsn-code text-right">
                                            <label>HSN Code:</label>
                                            <span>
                                                {{transaction?.hsnNumber}}


                                                <span class="edit-icon">
                                                    <img src="assets/images/edit-pencilicon.svg">
                                                </span>
                                            </span>

                                        </div>

                                    </div>
                                </div>
                            </div>

                        </td>
                        <td class="text-right">
                            {{transaction.quantity}} {{transaction.stockUnit}}
                        </td>
                        <td class="text-right">
                            {{transaction.rate |giddhCurrency }}
                        </td>
                        <td class="text-right">
                            {{transaction.amount |giddhCurrency }}
                        </td>
                        <td *ngIf="transaction.category === 'income'">

                            <div class=" text-right">
                                {{ getEntryTotalDiscount(entry.discounts) |giddhCurrency }}
                            </div>


                        </td>
                        <td class="text-right">{{ getTransactionTotalTax(entry.taxes) |giddhCurrency }}</td>

                        <td *ngIf="transaction.category === 'income'" class="align-top" class="text-right">{{
                            getEntryTotal(entry, transIndex) |giddhCurrency }}</td>
                        <td *ngIf="transaction.category !== 'income'" class="align-top" class="text-right">{{
                            transaction.amount |giddhCurrency }}</td>
                    </tr>
                    <tr [hidden]="activeIndx !== entryIdx" class="row-active">
                        <td>{{ entryIdx + 1 }}</td>
                        <td>
                            <div class="product-name">
                                <div class="ng-select-wrap">
                                    <input type="text" [(ngModel)]="transaction.accountName" [disabled]="true"
                                        name="transaction.accountName" [placeholder]="'Select A/c'" />

                                </div>

                            </div>
                            <div class="">
                                <div class="sku-number">
                                    <label>SKU:</label>Number
                                </div>
                                <div class="description">
                                    <textarea type="text" placeholder="Add Description"
                                        name="transaction.description_{{entryIdx}}" class="form-control"
                                        [(ngModel)]="transaction.description"></textarea>

                                </div>
                                <div class="date-hsn-code">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="entryDate">
                                                <label>Entry Date: </label>
                                                <span>
                                                    <input type="text" [placeholder]="giddhDateFormat" bsDatepicker
                                                        name="transaction.date_{{entryIdx}}"
                                                        class="form-control text-left" [(ngModel)]="entry.entryDate"
                                                        [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                        #dp="bsDatepicker" />
                                                    <span class="edit-icon" (click)="dp.toggle()"
                                                        [attr.aria-expanded]="dp.isOpen">
                                                        <img src="assets/images/edit-pencilicon.svg">
                                                    </span>


                                                </span>

                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="wrap-hsn-box">
                                                <div class="hsn-code text-right"
                                                    (click)="hsnDropdownShow=!hsnDropdownShow">
                                                    <label>HSN Code:</label>
                                                    <span>
                                                        {{transaction?.hsnNumber }} <span *ngIf="!transaction.hsnNumber"
                                                            class="update-text">Update</span>
                                                        <span class="edit-icon">
                                                            <img src="assets/images/edit-pencilicon.svg">
                                                        </span>
                                                    </span>

                                                </div>


                                                <div class="hsn-code-dropdown" *ngIf="hsnDropdownShow">
                                                    <label>HSN Code</label>
                                                    <input type="text" maxLength="10" placeholder="HSN Number"
                                                        name="transaction.hsnNumber_{{entryIdx}}" class=""
                                                        [(ngModel)]="transaction.hsnNumber" /> <a><i
                                                            class="fa fa-search"></i> </a>
                                                    <div class="btn-group">
                                                        <button class="btn btn-sm btn-success" type="button"
                                                            (click)="hsnDropdownShow=!hsnDropdownShow">Save</button>
                                                        <button class="btn btn-sm btn-primary" type="button"
                                                            (click)="hsnDropdownShow=!hsnDropdownShow">Cancel</button>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-right">
                            <input type="number" [disabled]="true" placeholder="Quantity"
                                name="transaction.quantity_{{entryIdx}}" class="form-control text-right"
                                [(ngModel)]="transaction.quantity" />

                            <select class="form-control stock-list-dropdown" [disabled]="true"
                                name="transaction.stockUnit_{{entryIdx}}" [(ngModel)]="transaction.stockUnit"
                                (ngModelChange)="transaction.setAmount(entry)">
                                <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">{{stock.text}}
                                </option>
                            </select>
                        </td>
                        <td class="text-right">
                            <input type="number" [disabled]="true" placeholder="Rate"
                                name="transaction.rate_{{entryIdx}}" class="form-control transaction-rate text-right"
                                [(ngModel)]="transaction.rate" />

                        </td>
                        <td class="text-right">
                            <input type="text" [disabled]="true" placeholder="Amount"
                                name="transaction.amount_{{entryIdx}}" class="form-control text-right"
                                [(ngModel)]="transaction.amount" decimalDigitsDirective [DecimalPlaces]="2" />
                        </td>
                        <td *ngIf="transaction.category === 'income'">

                            <div class=" text-right">
                                <input type="text" [disabled]="true" placeholder="Discount" [value]="tx_discount"
                                    class="form-control text-right" decimalDigitsDirective [DecimalPlaces]="2" />
                            </div>


                        </td>
                        <td *ngIf="transaction.category !== 'income'">&nbsp;</td>

                        <td *ngIf="transaction.category === 'income'" class="text-right">
                            <input type="text" [disabled]="true" placeholder="Tax" [value]="totalTax"
                                class="form-control text-right" decimalDigitsDirective [DecimalPlaces]="2" />
                        </td>
                        <td *ngIf="transaction.category !== 'income'">&nbsp;</td>

                        <td *ngIf="transaction.category === 'income'" class="text-right align-top">
                            <input type="text" name="transaction.total_{{entryIdx}}" placeholder="Total"
                                class="form-control text-right" [value]="tx_total" readonly decimalDigitsDirective
                                [DecimalPlaces]="2" />
                        </td>
                        <td *ngIf="transaction.category !== 'income'" class="text-right align-top">
                            <input type="text" name="transaction.total_{{entryIdx}}" placeholder="Total"
                                class="form-control text-right" [value]="transaction.amount" readonly
                                decimalDigitsDirective [DecimalPlaces]="2" />
                        </td>
                    </tr>
                </ng-container>
            </tbody>
        </table>

        <table class="table">

            <tr>
                <td>
                    <div class="">
                        <div class="collapse-pane clearfix" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                            <div class="collapse-pane-heading">
                                <div class="ico-box-wrap">
                                    <div class="ico-box">
                                        <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                            aria-hidden="true"></span>
                                    </div>
                                </div>
                                <div class="ico-head">Other Details</div>
                            </div>
                            <div [collapse]="isOthrDtlCollapsed" class="clearfix max-width-600 pd-l3 mr-0">
                                <div class="row">
                                    <div class="form-group col-4">
                                        <giddh-datepicker #shippingDate="ngModel" placeholder="Ship Date"
                                            name="shippingDate"
                                            [(ngModel)]="invFormData.templateDetails.other.shippingDate"
                                            [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                        </giddh-datepicker>

                                        <p class="text-danger"
                                            *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                            Invalid Date</p>
                                    </div>
                                    <div class="form-group col-4">
                                        <input type="text" name="shippedVia"
                                            [(ngModel)]="invFormData.templateDetails.other.shippedVia"
                                            class="form-control" placeholder="Ship Via" />
                                    </div>
                                    <div class="form-group col-4">
                                        <input type="text" name="trackingNumber"
                                            [(ngModel)]="invFormData.templateDetails.other.trackingNumber"
                                            class="form-control" placeholder="Tracking No." />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-4">
                                        <input type="text" name="customField1"
                                            [(ngModel)]="invFormData.templateDetails.other.customField1"
                                            class="form-control" placeholder="Field 1" />
                                    </div>
                                    <div class="form-group col-4">
                                        <input type="text" name="customField2"
                                            [(ngModel)]="invFormData.templateDetails.other.customField2"
                                            class="form-control" placeholder="Field 2" />
                                    </div>
                                    <div class="form-group col-4">
                                        <input type="text" name="customField3"
                                            [(ngModel)]="invFormData.templateDetails.other.customField3"
                                            class="form-control" placeholder="Field 3" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pd-t1 pl-0 max-width-600">
                        <label class="mr-b1">Message</label>
                        <textarea rows="3" class="form-control" name="message2"
                            [(ngModel)]="invFormData.templateDetails.other.message2"></textarea>

                    </div>
                </td>
                <td class="text-danger text-center d-none">Note:To edit current invoice amount or rate <a
                        class="cursor-pointer" (click)="goToLeger();">Click here</a></td>
                <td>
                    <section class="table-sec form-group">
                        <div class="table-row">
                            <div class="table-cell">Total Amount</div>
                            <div class="table-cell figure-cell">{{invFormData.voucherDetails.subTotal |giddhCurrency }}
                            </div>
                        </div>
                        <div class="table-row">
                            <div class="table-cell">Discount</div>
                            <div class="table-cell figure-cell">
                                -{{invFormData.voucherDetails.totalDiscount |giddhCurrency }}</div>
                        </div>
                        <div class="table-row">
                            <div class="table-cell">Taxable Value</div>
                            <div class="table-cell figure-cell">
                                {{invFormData.voucherDetails.totalTaxableValue |giddhCurrency }}
                            </div>
                        </div>
                        <div class="table-row">
                            <div class="table-cell">Tax</div>
                            <div class="table-cell figure-cell">
                                {{invFormData.voucherDetails.gstTaxesTotal |giddhCurrency }}</div>
                        </div>
                        <div class="table-row">
                            <div class="table-cell">
                                <strong>Total</strong>
                            </div>
                            <div class="table-cell figure-cell">
                                <strong>{{invFormData.voucherDetails.grandTotal |giddhCurrency }}</strong>
                            </div>
                        </div>
                    </section>
                </td>

            </tr>



        </table>

    </section>





    <section class="clearfix mr-b2 white-bg container-fluid">


    </section>
    <section>
        <section id="actionPane" class="text-center mr-b4 row">
            <div class="col-12">
                <div class="pull-right position-relative">
                    <button *ngIf="showCloseButton" type="button" class="btn btn-default mr-r1"
                        (click)="closePopupEvent({ action: 'closed' })">Close
                    </button>
                    <button type="submit" class="btn btn-default" [disabled]="invoiceForm.invalid">
                        <span>Update Voucher</span>
                    </button>
                </div>
            </div>
        </section>
    </section>
</form>
