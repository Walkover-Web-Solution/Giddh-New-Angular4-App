<ng-container>
  <form #invoiceForm="ngForm" (ngSubmit)="getVoucherByFilters(invoiceForm)" novalidate
        class="form-inline input-grp-dateRangePicker pr">

    <div class="d-flex">

      <div class="form-group mrR1 d-flex" style="flex: 1 1 auto;">

        <div class="input-group">
          <input type="text" name="dateRange" #dateRangePickerCmp daterangepicker [options]="datePickerOptions"
                 (applyDaterangepicker)="bsValueChange($event)" class="form-control"/>
          <!-- <input name="dateRange" placeholder="Daterangepicker" type="text" class="form-control" [ngModel]="invoiceSearchRequest.dateRange" (bsValueChange)="bsValueChange($event)" bsDaterangepicker [bsConfig]="bsConfig" required /> -->
        </div>
        <div class="d-flex" style="align-items: center">
          <a href="javascript:void(0);" class="btn btn-link-2" (click)="toggleAdvanceSearchPopup()"
             style="margin: 0px;padding-right: 8px">Advance search</a>
          <a class="cp" href="javascript: void 0" (click)="resetAdvanceSearch()" *ngIf="showAdvanceSearchIcon">
            <i aria-hidden="true" class="glyphicon glyphicon-refresh" style="color: #333333" tooltip="Reset Filter"></i>
          </a>
        </div>
      </div>

      <div class="d-flex">


        <div *ngIf="selectedItems.length === 1" style="height: 30px; margin-right: 75px;">

          <div class="btn-group" dropdown triggers="mouseover" #dp="bs-dropdown" (mouseleave)="dp.hide()"
               style="margin-bottom: 10px;display: inline-block !important;">

            <button dropdownToggle type="button" class="btn spcl_dropdown dropdown-toggle"
                    aria-controls="dropdown-basic">
              More
              <span class="caret"></span>
            </button>

            <ul *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-basic">

              <!-- <li role="menuitem">
                  <a class="dropdown-item cp" href="javascript:void(0)" (click)="toggleBulkUpdatePopup()">Bulk Note</a>
              </li>

              <li role="menuitem">
                  <a class="dropdown-item cp" href="javascript:void(0)">Send Email</a>
              </li>

              <li role="menuitem">
                  <a class="dropdown-item cp" href="javascript:void(0)">Print</a>
              </li>

              <li role="menuitem">
                  <a class="dropdown-item cp" href="javascript:void(0)">Export Pdf</a>
              </li>

              <li role="menuitem">
                  <a class="dropdown-item cp" href="javascript:void(0)">Create Credit Note</a>
              </li> -->

              <li role="menuitem" *ngIf="selectedItems.length === 1">
                <a class="dropdown-item cp" href="javascript:void(0)"
                   (click)="toggleEwayBillPopup(); validateInvoiceForEway();" *ngIf="selectedVoucher === 'sales'">
                  Generate E-way Bill</a>
              </li>

              <li role="menuitem" *ngIf="selectedItems.length === 1">
                <a class="dropdown-item cp" href="javascript:void(0)" (click)="onDeleteBtnClick()">Delete</a>
              </li>

            </ul>
          </div>
        </div>

        <!-- <div *ngIf="selectedVoucher === 'sales'">
            <button class="btn btn-orange mr-1" *ngIf="showExportButton">Export</button>
            <button class="btn btn-blue" style="margin: 0 !important;">+ New Invoice</button>
        </div>

        <div *ngIf="selectedVoucher === 'credit note'">
            <button class="btn btn-blue" style="margin: 0 !important;">+ New Cr. Note</button>
        </div>

        <div *ngIf="selectedVoucher === 'debit note'">
            <button class="btn btn-blue" style="margin: 0 !important;">+ New Dr. Note</button>
        </div> -->

      </div>
    </div>
  </form>

  <table class="table basic table-bordered mrT2 invoice-table">

    <!--sales-->
    <thead class="t-h-bg1" *ngIf="selectedVoucher === 'sales'">
    <tr>

      <th width="4%" *ngIf="selectedItems.length > 0">

        <div class="mh18_img" style="justify-content: center;display: flex">
          <img src="assets/images/unchecked.png" *ngIf="!allItemsSelected" (click)="toggleAllItems(true)">
          <img src="assets/images/checked.png" *ngIf="allItemsSelected" (click)="toggleAllItems(false)">
        </div>

      </th>

      <th *ngIf="selectedItems.length === 0">
        <div class="mh18_img" style="justify-content: center;display: flex">
          #
        </div>
      </th>

      <th width="13%" class="td_in_searchBox" #searchInvoiceContainer
          (clickOutside)="clickedOutside($event, searchInvoiceContainer, 'invoiceNumber')">

        <ng-container
          *ngTemplateOutlet="searchTemplate;context:{ $implicit: showInvoiceNoSearch, title: 'Invoice No.', fieldName: 'invoiceNumber',
           formControl: voucherNumberInput}"
        ></ng-container>

      </th>

      <!-- <th width="11%" class="td_in_searchBox" #searchPerfomaContainer (clickOutside)="clickedOutside($event, searchPerfomaContainer, 'ProformaPurchaseOrder')">
          <div [hidden]="showProformaSearch">
              <span> Proforma/<br>Purchase Order #</span>
              <i class="icon-search" (click)="toggleSearch('ProformaPurchaseOrder');"></i>
          </div>

          <div class="input-container" [hidden]="!showProformaSearch">
              <input type="text" placeholder="Search Order" class="w100" #perfomaSearch [formControl]="ProformaPurchaseOrder" />
          </div>

      </th> -->

      <th width="19%" class="td_in_searchBox" #searchCustomerContainer
          (clickOutside)="clickedOutside($event, searchCustomerContainer, 'accountUniqueName')">

        <ng-container
          *ngTemplateOutlet="searchTemplate;context:{ $implicit: showCustomerSearch, title: 'Customer', fieldName: 'accountUniqueName',
           formControl: accountUniqueNameInput}"
        ></ng-container>

      </th>

      <th width="10%">
        <div class="d-flex">
          <div class="flex-fill">Invoice Date</div>

          <div class="icon-pointer">

            <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'voucherDate'}"></ng-container>
          </div>
        </div>
      </th>

      <th width="12%">

        <div class="d-flex">
          <div class="flex-fill text-right pr-1"> Total Amt.</div>

          <div class="icon-pointer">
            <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'grandTotal'}"></ng-container>
          </div>
        </div>
      </th>

      <th width="12%">
        <div class="d-flex">
          <div class="flex-fill text-right pr-1"> Balance Due</div>

          <div class="icon-pointer">
            <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'balanceDue'}"></ng-container>
          </div>
        </div>
      </th>

      <th width="10%">
        <div class="d-flex">

          <div class="flex-fill">Due Date</div>
          <div class="icon-pointer">
            <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'dueDate'}"></ng-container>
          </div>
        </div>
      </th>

      <th width="10%">
        <div class="d-flex">
          <div class="flex-fill">Status</div>
        </div>
      </th>

    </tr>
    </thead>

    <!--non sales-->
    <thead class="t-h-bg1 input-h" *ngIf="selectedVoucher !== 'sales'">
    <tr>

      <th width="4%" *ngIf="selectedItems.length > 0">

        <div class="mh18_img" style="display: flex;justify-content: center">
          <img src="assets/images/unchecked.png" *ngIf="!allItemsSelected" (click)="toggleAllItems(true)">
          <img src="assets/images/checked.png" *ngIf="allItemsSelected" (click)="toggleAllItems(false)">
        </div>

      </th>

      <th *ngIf="selectedItems.length === 0" width="4%">
        <div class="mh18_img" style="display: flex;justify-content: center">
          #
        </div>
      </th>

      <th width="25%" class="td_in_searchBox" #searchInvoiceContainer
          (clickOutside)="clickedOutside($event, searchInvoiceContainer, 'invoiceNumber')">

        <ng-container
          *ngTemplateOutlet="searchTemplate;context:{ $implicit: showInvoiceNoSearch, fieldName: 'invoiceNumber',formControl: voucherNumberInput,
          title: selectedVoucher === 'credit note' ? 'Cr Note No.' : 'Dr Note No.'}"
        ></ng-container>

      </th>

      <th width="25%" class="td_in_searchBox" #searchCustomerContainer
          (clickOutside)="clickedOutside($event, searchCustomerContainer, 'accountUniqueName')">

        <ng-container
          *ngTemplateOutlet="searchTemplate;context:{ $implicit: showCustomerSearch, fieldName: 'accountUniqueName',formControl: accountUniqueNameInput,
          title: 'Customer'}"
        ></ng-container>

      </th>

      <th>
        <div class="d-flex">
          <div class="flex-fill">Date</div>

          <div class="icon-pointer">
            <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'voucherDate'}"></ng-container>
          </div>
        </div>
      </th>

      <th>
        <div class="d-flex">
          <div class="flex-fill text-right pr-1">Total amount</div>

          <div class="icon-pointer">
            <ng-container *ngTemplateOutlet="sortTemplate;context: { column: 'grandTotal'}"></ng-container>
          </div>
        </div>
      </th>

    </tr>
    </thead>

    <tfoot *ngIf="voucherData && voucherData?.totalItems > 20">
    <tr>
      <td colspan="100%">
        <div class="alC">

          <pagination [totalItems]="voucherData.totalItems" [(ngModel)]="voucherData.page" [maxSize]="5"
                      class="pagination-sm" [boundaryLinks]="true" [itemsPerPage]="20" [rotate]="false"
                      previousText="&#9668;" nextText="&#9658;" (pageChanged)="pageChanged($event)"></pagination>
        </div>
      </td>
    </tr>
    </tfoot>

    <!--sales-->
    <tbody (clickOutside)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''"
           (mouseleave)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''"
           *ngIf="voucherData && voucherData.items.length > 0 && !(isGetAllRequestInProcess$ | async) && selectedVoucher === 'sales'">

    <tr *ngFor="let item of voucherData.items; let i = index" (mouseover)="hoveredItemForAction = item.uniqueName">

      <td class="mh18_img"
          *ngIf="hoveredItemForAction === item.uniqueName || item.isSelected || selectedItems.length > 0">
        <div class="mh18_img" style="justify-content: center;display: flex">
          <img *ngIf="!item.isSelected" src="assets/images/unchecked.png" (click)="toggleItem(item, true)"/>
          <img *ngIf="item.isSelected" src="assets/images/checked.png" (click)="toggleItem(item, false)"/>
        </div>
        <!--<div *ngIf="item.hasGenerationErr">-->
        <!--<i class='fa fa-info-circle' placement="right" [tooltip]="item.errMsg"></i>-->
        <!--</div>-->
      </td>

      <td *ngIf="!item.isSelected && hoveredItemForAction !== item.uniqueName && selectedItems.length === 0">
        <div style="justify-content: center;display: flex">{{ i + 1}} </div>
      </td>

      <td>
        <div style="position: relative" class="d-flex">
          <a href="javascript:void(0);" class="btn-link-2" (click)="onSelectInvoice(item)">{{item.voucherNumber}}</a>
          <img style="position: absolute;right: 0px;top: 5px;" class="cp mb-2" src="assets/icon/vol.svg"
               tooltip="Invoice sent" placement="left"/>
        </div>

        <span *ngIf="item.dueDays !== null">

          <small class="text-danger" *ngIf="item.dueDays > 0">
            Overdue by {{ item.dueDays }} Days
          </small>

          <small class="text-danger" *ngIf="item.dueDays === 0">
            Overdue by Today
          </small>


        </span>

      </td>

      <!-- <td><a href="javascript:void(0);" class="btn-link-2">13643131</a></td> -->

      <td (dblclick)="modalUniqueName = item.uniqueName" class="cp no-dbl-click-select"
          (clickOutside)="modalUniqueName = ''">
        {{item.account.name}}
        <div *ngIf="modalUniqueName === item.uniqueName" account-detail-modal-component
             [accountUniqueName]="item.account.uniqueName" [from]="this.invoiceSearchRequest.from"
             [to]="this.invoiceSearchRequest.to" [isModalOpen]="modalUniqueName === item.uniqueName">
        </div>
      </td>

      <td>{{item.voucherDate}}</td>
      <td class="text-right">{{item.grandTotal | giddhCurrency}}</td>
      <td class="text-right">{{item.balanceDue | giddhCurrency}}</td>
      <td>{{item.dueDate ? item.dueDate : '-' }}</td>

      <!--for not cancelled status-->
      <td (click)="clickedHoveredItemForAction = item.uniqueName" class="cp" *ngIf="item.balanceStatus !== 'cancel'">
        <div class="d-flex" style="align-items: center">
          <div class="flex-fill">
            <span
              [ngClass]="{'text-light-2': !item.balanceStatus}">{{ item.balanceStatus ? item.balanceStatus : 'Select Action' }}</span>
          </div>

          <div class="click-dropdwon">

            <i class="fa fa-ellipsis-v"
               *ngIf="hoveredItemForAction === item.uniqueName || clickedHoveredItemForAction === item.uniqueName"></i>

            <ul *ngIf="clickedHoveredItemForAction === item.uniqueName">

              <li (click)="onPerformAction(item, 'paid')">
                <a class="cp" href="javascript:void(0)">paid</a>
              </li>

              <li (click)="onPerformAction(item, 'unpaid')">
                <a class="cp" href="javascript:void(0)">unpaid</a>
              </li>

              <li (click)="onPerformAction(item, 'hold')">
                <a class="cp" href="javascript:void(0)">Hold</a>
              </li>

              <li (click)="onPerformAction(item, 'cancel')">
                <a class="cp" href="javascript:void(0)">Cancel</a>
              </li>

            </ul>
          </div>
        </div>

      </td>

      <!--for cancelled status-->
      <td *ngIf="item.balanceStatus === 'cancel'">
        <span>{{ item.balanceStatus}}</span>
      </td>

    </tr>
    </tbody>

    <!--non sales-->
    <tbody
      *ngIf="voucherData && voucherData.items.length > 0 && !(isGetAllRequestInProcess$ | async) && selectedVoucher !== 'sales'"
      (clickOutside)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''"
      (mouseleave)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''">

    <tr *ngFor="let item of voucherData.items; let i = index" (mouseover)="hoveredItemForAction = item.uniqueName">

      <td class="mh18_img"
          *ngIf="hoveredItemForAction === item.uniqueName || item.isSelected || selectedItems.length > 0">
        <div class="mh18_img" style="justify-content: center;display: flex">
          <img *ngIf="!item.isSelected" src="assets/images/unchecked.png" (click)="toggleItem(item, true)"/>
          <img *ngIf="item.isSelected" src="assets/images/checked.png" (click)="toggleItem(item, false)"/>
        </div>
        <!--<div *ngIf="item.hasGenerationErr">-->
        <!--<i class='fa fa-info-circle' placement="right" [tooltip]="item.errMsg"></i>-->
        <!--</div>-->
      </td>

      <td *ngIf="!item.isSelected && hoveredItemForAction !== item.uniqueName && selectedItems.length === 0">
        <div style="justify-content: center;display: flex"> {{ i + 1}}</div>
      </td>

      <td><a style="cursor: pointer" (click)="onSelectInvoice(item)">
        {{item.voucherNumber }}</a></td>
      <td>{{item.account.name}}</td>
      <td>{{item.voucherDate}}</td>
      <td class="text-right">{{item.grandTotal | giddhCurrency}}</td>

    </tr>

    </tbody>

    <tbody *ngIf="(isGetAllRequestInProcess$ | async)">
    <tr>
      <td colspan="8">
        <!--loading-->
        <div class="no-data mrT2 d-flex"
             style="justify-content: center;align-items: center;margin-top:125px;margin-bottom: 105px;">
          <div class="giddh-spinner vertical-center-spinner"></div>
        </div>
      </td>
    </tr>
    </tbody>

  </table>

  <!--No Entry-->
  <div class="no-data mrT2" *ngIf="!voucherData && !(isGetAllRequestInProcess$ | async)">
    <h1>No Entry found in sales!</h1>
    <h1>Have to do some sales before creating invoice</h1>
  </div>

  <!--no data-->
  <div class="no-data" *ngIf="voucherData && voucherData.items.length === 0 && !(isGetAllRequestInProcess$ | async)">
    <h1>No entries found within given criteria.</h1>
    <h1>Do search with some other dates</h1>
  </div>


  <!-- Delete invoice confirmation model -->
  <div bsModal #invoiceConfirmationModel="bs-modal" class="modal fade" role="dialog" [config]="{keyboard:true}"
       tabindex="-1">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <delete-role-confirmation-model [selectedInvoiceForDelete]="selectedInvoice"
                                        (confirmDeleteEvent)="deleteConfirmedInvoice()"
                                        (closeModelEvent)="closeConfirmationPopup()"></delete-role-confirmation-model>
      </div>
    </div>
  </div>

  <!-- Perform action on invoice model -->
  <div bsModal #performActionOnInvoiceModel="bs-modal" class="modal fade" role="dialog" [config]="{keyboard:true}"
       tabindex="-1">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <perform-action-on-invoice-model
          (closeModelEvent)="closePerformActionPopup($event)"></perform-action-on-invoice-model>
      </div>
    </div>
  </div>

  <!-- Download or Send Invoice on mail -->
  <div bsModal #downloadOrSendMailModel="bs-modal" class="modal fade" role="dialog" [config]="modalConfig"
       tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div element-view-container-ref #downloadOrSendMailComponent=elementviewcontainerref>
        </div>
      </div>
    </div>
  </div>

  <!-- modal dialog -->
  <div bsModal #invoiceGenerateModel="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
    <div class="modal-dialog gray modal-liquid">
      <div class="modal-content">
        <invoice-generate-model *ngIf="showInvoiceGenerateModal"
                                (closeEvent)="closeInvoiceModel($event)"></invoice-generate-model>
      </div>
    </div>
  </div>

  <!--advance_seearch Modal-->
  <div bsModal #advanceSearch="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <invoice-advance-search-component #advanceSearchComponent
                                          [type]="selectedVoucher === 'debit note' || selectedVoucher === 'credit note' ? 'drcr' : 'invoice'"
                                          [request]="advanceSearchFilter"
                                          (applyFilterEvent)="applyAdvanceSearch($event)"
                                          (closeModelEvent)="toggleAdvanceSearchPopup()">
        </invoice-advance-search-component>
      </div>
    </div>
  </div>

  <!--bulk update modal-->
  <div bsModal #bulkUpdate="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <invoice-bulk-update-modal-component
          (closeModelEvent)="toggleBulkUpdatePopup()"></invoice-bulk-update-modal-component>
      </div>
    </div>
  </div>

  <!--EwayBill-->
  <div bsModal #eWayBill="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <app-generate-ewaybill-modal (closeModelEvent)="toggleEwayBillPopup()">
        </app-generate-ewaybill-modal>
      </div>
    </div>
  </div>

  <!--total sale & Total Due-->

  <!-- <div clas="row mt-5" style="display: flex;padding: 40px;background: white;margin-top: 60px">
      <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 d-flex">

          <div style="width: 50%">
              <h3 class="font-xxlarge text-light-2">Total Invoice Amount</h3>
              <h1 class="" style="font-size: 41px;margin-top: 6px;">{{ totalSale | giddhCurrency }}/-</h1>
          </div>

          <div style="width: 50%">
              <h3 class="color-giddh font-xxlarge">Total Due</h3>
              <h1 style="font-size: 41px;margin-top: 6px;">{{ totalDue | giddhCurrency }}/-</h1>
          </div>

      </div>
  </div> -->

  <!-- region invoice-preview-details -->
  <div *ngIf="selectedInvoice">
    <invoice-preview-details-component
      [selectedItem]="selectedInvoiceForDetails"
      [items]="itemsListForDetails"
      [invoiceSetting]="invoiceSetting"
      (closeEvent)="selectedInvoice = null;toggleBodyClass()"
      [appSideMenubarIsOpen]="appSideMenubarIsOpen"
    ></invoice-preview-details-component>
  </div>
  <!-- endregion -->

</ng-container>

<!-- region search template -->
<ng-template #searchTemplate let-show let-title="title" let-fieldName="fieldName" let-formControl="formControl">

  <div [hidden]="show">
    <span> {{ title }}</span>
    <i class="icon-search" (click)="toggleSearch(fieldName, searchBox);"></i>
  </div>

  <div class="input-container" [hidden]="!show">
    <input type="text" placeholder="Search {{ title }}" class="w100" #searchBox
           [formControl]="formControl"/>
  </div>

</ng-template>
<!-- endregion -->

<!-- region sort icon template -->
<ng-template #sortTemplate let-column="column">

  <div class="fa fa-long-arrow-up"
       *ngIf="sortRequestForUi.sortBy !== column"
       (click)="sortButtonClicked('asc', column)"
       [ngClass]="{'activeTextColor': sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'asc'}"></div>

  <div class="fa fa-long-arrow-up"
       *ngIf="sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'asc'"
       (click)="sortButtonClicked('desc', column)"
       [ngClass]="{'activeTextColor': sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'asc'}"></div>

  <div class="fa fa-long-arrow-down"
       *ngIf="sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'desc'"
       (click)="sortButtonClicked('asc', column)"
       [ngClass]="{'activeTextColor': sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'desc'}"></div>

</ng-template>
<!-- endregion -->
