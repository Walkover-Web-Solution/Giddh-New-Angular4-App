<ng-container>
    <div class="invoice-container w-100">
        <!-- For desktop screen sizes -->
        <div class="d-flex date-advance-search" id="dateRangePickerParent">
            <!-- Invoice filter section -->
            <form #invoiceForm="ngForm" (ngSubmit)="getVoucherByFilters(invoiceForm)" novalidate
                class="form-inline input-grp-dateRangePicker pr">
                <div class="form-group mrR1 d-flex" style="flex: 1 1 auto;">
                    <div class="input-group">
                        <span class="input-wrapper">
                            <input type="text" name="dateRange" daterangepicker [options]="datePickerOptions"
                                (applyDaterangepicker)="bsValueChange($event)" class="form-control" />
                        </span>
                    </div>
                    <div class="advance-icon align-items-center" tooltip="Advance Search"
                    (click)="toggleAdvanceSearchPopup(false)">
                        <span class="icon-advance-filter"></span>
                    </div>

                    <div class="search-icon-block" (click)="openModal(template)">
                        <i class="icon-search"></i>
                    </div>
                </div>
            </form>


            <!-- Invoice filter section ends -->
            <div class="clear-filter visible-on-desktop" *ngIf="showAdvanceSearchIcon" (click)="resetAdvanceSearch()">
                <button class="btn btn-default">
                    <span class="icon-cross"></span> Clear Filter
                </button>
            </div>
            <div class="d-flex add-invoice">


                <!-- E-way bill generation and export to excel for a single selected item in invoice sizes -->
                <div
                    *ngIf="(selectedVoucher !== 'purchase' && selectedItems.length > 0) || (selectedItems.length === 1 && selectedVoucher === 'purchase')">
                    <div class="btn-group" dropdown #dp="bs-dropdown">
                        <button dropdownToggle type="button"
                            class="btn more-btn-dropdown desktop-view-btn dropdown-toggle"
                            aria-controls="dropdown-basic">
                            More
                            <span class="caret"></span>
                        </button>
                        <ul *dropdownMenu class="dropdown-menu fixed-dropdown-plus" role="menu"
                            aria-labelledby="button-basic">
                            <li role="menuitem" *ngIf="selectedVoucher !== 'purchase' && selectedInvoicesList?.length">
                                <a class="dropdown-item cp" href="javascript:void(0)"
                                    (click)="toggleBulkUpdatePopup(false);">Bulk Update</a>
                            </li>
                            <li role="menuitem" *ngIf="selectedItems.length === 1">
                                <a class="dropdown-item cp" href="javascript:void(0)" (click)="toggleEwayBillPopup()"
                                    *ngIf="selectedVoucher === 'sales'">
                                    Generate E-way Bill</a>
                            </li>
                            <li role="menuitem"
                                *ngIf="selectedVoucher !== 'purchase' || (selectedItems.length === 1 && selectedVoucher === 'purchase')">
                                <a class="dropdown-item cp" href="javascript:void(0)"
                                    (click)="onDeleteBtnClick()">Delete</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-default desktop-view-btn mr-15" tooltip="Export" (click)="exportCsvDownload()"
                    [ladda]="exportInvoiceRequestInProcess$ | async"
                    *ngIf="selectedVoucher === 'sales' && selectedInvoicesList.length && isExported"
                    data-spinner-size="20px">
                    <span class="icon-export-icon"></span>
                </button>
                <!-- E-way bill generation and export to excel for a single selected item in invoice ends sizes -->

                <!-- Section to create New Sales Invoice, Cash Invoice, Credit Note and Debit Note -->
                <div class="btn-group desktop-view-btn" dropdown *ngIf="selectedVoucher === 'sales'" [autoClose]="true">
                    <button id="ddl-newinv" dropdownToggle type="button"
                        class="btn btn-sky-blue dropdown-toggle dropdown-btn-new mr-0" aria-controls="dropdown-ddl-newinv">
                        + New Invoice
                        <span class="caret"></span>
                    </button>
                    <ul id="dropdown-ddl-newinv" *dropdownMenu class="dropdown-menu" role="menu"
                        aria-labelledby="ddl-newinv">
                        <li role="menuitem">
                            <a class="dropdown-item" href="javascript: void 0" (click)="goToInvoice('cash')">Cash
                                Invoice</a>
                        </li>
                        <li role="menuitem">
                            <a class="dropdown-item" href="javascript: void 0" (click)="goToInvoice('sales')">Sales
                                Invoice</a>
                        </li>
                    </ul>
                </div>
                <div *ngIf="selectedVoucher === 'purchase'" class="btn-wrapper">
                    <button class="btn btn-sky-blue desktop-view-btn mr-0" (click)="goToInvoice('purchase')">+
                        New Bill
                    </button>
                </div>
                <div *ngIf="selectedVoucher === 'credit note'" class="btn-wrapper">
                    <button class="btn btn-sky-blue desktop-view-btn mr-0" (click)="goToInvoice('credit note')">+
                        New Cr. Note
                    </button>
                </div>
                <div *ngIf="selectedVoucher === 'debit note'" class="btn-wrapper">
                    <button class="btn btn-sky-blue desktop-view-btn mr-0" (click)="goToInvoice('debit note')">+ New
                        Dr. Note
                    </button>
                </div>
                <!-- Section to create New Sales Invoice, Cash Invoice, Credit Note and Debit Note  ends -->
            </div>
        </div>
        <!-- For desktop screen sizes ends -->
        <div class="mobile-search">
            <!-- Invoice E-way bill, export to excel for a single selected item along with
                New Sales Invoice, Cash Invoice, Credit Note and Debit Note -->
            <div class="row">
                <div class="col-12">
                    <div class="more-export-btn d-flex mt-1">
                        <div class="clear-filter visible-on-mobile" *ngIf="showAdvanceSearchIcon"
                            (click)="resetAdvanceSearch()">
                            <button class="btn btn-default">
                                <span class="icon-cross"></span> Clear Filter
                            </button>
                        </div>
                    </div>
                    <div *ngIf="selectedItems.length === 1">
                        <div class="btn-group" dropdown triggers="mouseover" #dp="bs-dropdown" (mouseleave)="dp.hide()"
                            style="margin-bottom: 10px;display: inline-block !important;">
                            <button dropdownToggle type="button"
                                class="btn mr-15 more-btn-dropdown btn-default dropdown-toggle"
                                aria-controls="dropdown-basic">
                                More
                                <span class="caret"></span>
                            </button>
                            <ul *dropdownMenu class="dropdown-menu fixed-dropdown-plus" role="menu"
                                aria-labelledby="button-basic">
                                <li role="menuitem">
                                    <a class="dropdown-item cp" href="javascript:void(0)"
                                        (click)="toggleEwayBillPopup()"
                                        *ngIf="selectedVoucher === 'sales' && !isMobileView">
                                        Generate E-way Bill</a>
                                </li>
                                <li role="menuitem">
                                    <a class="dropdown-item cp" href="javascript:void(0)"
                                        (click)="onDeleteBtnClick()">Delete</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <button class="btn btn-default mr-15" tooltip="Export" (click)="exportCsvDownload()"
                        [ladda]="exportInvoiceRequestInProcess$ | async"
                        *ngIf="selectedVoucher === 'sales' && selectedInvoicesList.length && isExported"
                        data-spinner-size="20px">
                        <span class="icon-export-icon"></span>
                    </button>

                    <div class="btn-group" dropdown *ngIf="selectedVoucher === 'sales'" [autoClose]="true">
                        <button id="ddl-newinv" dropdownToggle type="button"
                            class="btn btn-sky-blue dropdown-toggle dropdown-btn-new" aria-controls="dropdown-ddl-newinv">
                            + New Invoice
                            <span class="caret"></span>
                        </button>
                        <ul id="dropdown-ddl-newinv" *dropdownMenu class="dropdown-menu" role="menu"
                            aria-labelledby="ddl-newinv">
                            <li role="menuitem">
                                <a class="dropdown-item" href="javascript: void 0" (click)="goToInvoice('cash')">Cash
                                    Invoice</a>
                            </li>
                            <li role="menuitem">
                                <a class="dropdown-item" href="javascript: void 0" (click)="goToInvoice('sales')">Sales
                                    Invoice</a>
                            </li>
                        </ul>


                    </div>
                    <div *ngIf="selectedVoucher === 'credit note'" class="btn-wrapper">
                        <button class="btn btn-sky-blue" style="margin: 0 !important;"
                            (click)="goToInvoice('credit note')">+ New Cr.
                            Note
                        </button>
                    </div>
                    <div *ngIf="selectedVoucher === 'debit note'" class="btn-wrapper">
                        <button class="btn btn-sky-blue" style="margin: 0 !important;" (click)="goToInvoice('debit note')">+
                            New Dr.
                            Note
                        </button>
                    </div>

                </div>

            </div>
        </div>
        <!-- Invoice E-way bill, export to excel for a single selected item along with
            New Sales Invoice, Cash Invoice, Credit Note and Debit Note ends -->

        <!-- For mobile screen sizes -->


        <ng-template #template>
            <div class="modal-header">
                <h4 class="modal-title bg pull-left">Search here...</h4>
                <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-6 col-md-6 full-width-on-mobile">
                        <div class="input-container">
                            <input type="text" placeholder="Search Invoice No." class=" form-control" #searchBox
                                name="voucherNumberInput" [formControl]="voucherNumberInput" />
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-6 full-width-on-mobile">
                        <div class="input-container">
                            <input type="text" placeholder="Search Customer Name" class=" form-control" #searchBox
                                name="accountUniqueNameInput" [formControl]="accountUniqueNameInput" />
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-6 mt-2">
                        <button class="btn btn-sky-blue">Submit</button>
                    </div>

                </div>

            </div>
        </ng-template>

        <!-- For mobile screen sizes ends -->

        <div class="invoice-preview  table-responsive">
            <table class="table basic table-bordered mt-15 invoice-table desktop-table  giddh-table">

                <!--sales-->
                <thead class="t-h-bg1" *ngIf="selectedVoucher === 'sales' || selectedVoucher === 'purchase'">
                    <tr>
                        <th style="width: 4%" *ngIf="selectedItems.length > 0" class="min-wd-20">
                            <div class="mh18_img" style="justify-content: center;display: flex">
                                <img src="assets/images/unchecked.png" *ngIf="!allItemsSelected"
                                    (click)="toggleAllItems(true)">
                                <img src="assets/images/checked.png" *ngIf="allItemsSelected"
                                    (click)="toggleAllItems(false)">
                            </div>
                        </th>

                        <th *ngIf="selectedItems.length === 0" style="width: 4%" class="min-wd-20">
                            <div class="mh18_img" style="justify-content: center;display: flex">
                                #
                            </div>
                        </th>

                        <th width="13%" class="td-search-box" #searchInvoiceContainer
                            (clickOutside)="clickedOutside($event, searchInvoiceContainer, 'invoiceNumber')">
                            <ng-container *ngTemplateOutlet="searchTemplate;context:{ $implicit: showInvoiceNoSearch, title: ((selectedVoucher === 'purchase') ? 'Bill No.' : 'Invoice No.'), fieldName: 'invoiceNumber', formControl: voucherNumberInput}"></ng-container>
                        </th>

                        <th width="19%" class="td-search-box" #searchCustomerContainer
                            (clickOutside)="clickedOutside($event, searchCustomerContainer, 'accountUniqueName')">
                            <ng-container *ngTemplateOutlet="searchTemplate;context:{ $implicit: showCustomerSearch, fieldName: 'accountUniqueName',formControl: accountUniqueNameInput, title: (selectedVoucher === 'purchase') ? 'Vendor' : 'Customer'}"></ng-container>
                        </th>

                        <th width="10%">
                            <div class="d-flex">
                                <div>{{(selectedVoucher === 'purchase') ? "Bill Date" : "Invoice Date"}}</div>
                                <div class="icon-pointer">
                                    <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'voucherDate'}">
                                    </ng-container>
                                </div>
                            </div>
                        </th>

                        <th width="12%" *ngIf="selectedVoucher === 'purchase'" class="td-search-box" #searchPurchaseOrderContainer
                        (clickOutside)="clickedOutside($event, searchPurchaseOrderContainer, 'purchaseOrderNumbers')">
                            <ng-container *ngTemplateOutlet="searchTemplate;context:{ $implicit: showPurchaseOrderSearch, fieldName: 'purchaseOrderNumbers', formControl: purchaseOrderNumbersInput, title: 'Purchase Order #'}"></ng-container>
                        </th>

                        <th width="12%" class="mw-th-170">
                            <div class="d-flex">
                                <div> Amount</div>
                                <div class="icon-pointer">
                                    <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'grandTotal'}">
                                    </ng-container>
                                </div>
                            </div>
                        </th>

                        <th width="12%" *ngIf="selectedVoucher !== 'purchase'">
                            <div class="d-flex">
                                <div> Balance Due</div>
                                <div class="icon-pointer">
                                    <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'balanceDue'}">
                                    </ng-container>
                                </div>
                            </div>
                        </th>

                        <th width="10%">
                            <div class="d-flex">
                                <div class="">Due Date</div>
                                <div class="icon-pointer">
                                    <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'dueDate'}">
                                    </ng-container>
                                </div>
                            </div>
                        </th>

                        <th width="10%">
                            <div class="d-flex">
                                <div class="flex-fill">Status</div>
                            </div>
                        </th>
                    </tr>
                </thead>

                <!--non sales-->
                <thead class="t-h-bg1 input-h" *ngIf="selectedVoucher !== 'sales' && selectedVoucher !== 'purchase'">
                    <tr>
                        <th style="width: 4%" *ngIf="selectedItems.length > 0" class="min-wd-20">
                            <div class="mh18_img" style="display: flex;justify-content: center">
                                <img src="assets/images/unchecked.png" *ngIf="!allItemsSelected"
                                    (click)="toggleAllItems(true)">
                                <img src="assets/images/checked.png" *ngIf="allItemsSelected"
                                    (click)="toggleAllItems(false)">
                            </div>
                        </th>

                        <th *ngIf="selectedItems.length === 0" style="width: 4%" class="min-wd-20">
                            <div class="mh18_img" style="display: flex;justify-content: center">
                                #
                            </div>
                        </th>

                        <th width="25%" class="td-search-box" #searchInvoiceContainer
                            (clickOutside)="clickedOutside($event, searchInvoiceContainer, 'invoiceNumber')">
                            <ng-container *ngTemplateOutlet="searchTemplate;context:{ $implicit: showInvoiceNoSearch, fieldName: 'invoiceNumber',formControl: voucherNumberInput,
            title: selectedVoucher === 'credit note' ? 'Cr Note No.' : 'Dr Note No.'}"></ng-container>
                        </th>

                        <th width="25%" class="td-search-box" #searchCustomerContainer
                            (clickOutside)="clickedOutside($event, searchCustomerContainer, 'accountUniqueName')">
                            <ng-container *ngTemplateOutlet="searchTemplate;context:{ $implicit: showCustomerSearch, fieldName: 'accountUniqueName',formControl: accountUniqueNameInput,
            title: 'Customer'}"></ng-container>
                        </th>

                        <th>
                            <div class="d-flex">
                                <div class="">Date</div>
                                <div class="icon-pointer">
                                    <ng-container *ngTemplateOutlet="sortTemplate;context: {column: 'voucherDate'}">
                                    </ng-container>
                                </div>
                            </div>
                        </th>

                        <!-- Linked invoices -->
                        <th *ngIf="selectedVoucher === 'credit note'">
                            <div class="d-flex">
                                <div>Linked Invoice</div>
                            </div>
                        </th>
                        <th *ngIf="selectedVoucher === 'debit note'">
                            <div class="d-flex">
                                <div>Linked Voucher</div>
                            </div>
                        </th>

                        <th>
                            <div class="d-flex">
                                <div class="flex-fill ">Total amount</div>
                                <div class="icon-pointer">
                                    <ng-container *ngTemplateOutlet="sortTemplate;context: { column: 'grandTotal'}">
                                    </ng-container>
                                </div>
                            </div>
                        </th>

                    </tr>
                </thead>

                <!--sales-->
                <tbody (clickOutside)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''"
                    (mouseleave)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''"
                    *ngIf="voucherData && voucherData.items.length > 0 && !(isGetAllRequestInProcess$ | async) && (selectedVoucher === 'sales' || selectedVoucher === 'purchase')">

                    <tr *ngFor="let item of voucherData.items; let i = index"
                        (mouseover)="hoveredItemForAction = item.uniqueName">

                        <td class="mh18_img"
                            *ngIf="hoveredItemForAction === item.uniqueName || item.isSelected || selectedItems.length > 0">
                            <div class="mh18_img" style="justify-content: center;display: flex">
                                <img *ngIf="!item.isSelected" src="assets/images/unchecked.png"
                                    (click)="toggleItem(item, true)" />
                                <img *ngIf="item.isSelected" src="assets/images/checked.png"
                                    (click)="toggleItem(item, false)" />
                            </div>
                        </td>

                        <!-- Serial No. -->
                        <td
                            *ngIf="!item.isSelected && hoveredItemForAction !== item.uniqueName && selectedItems.length === 0">
                            <div style="justify-content: center;display: flex">{{ i + 1}} </div>
                        </td>

                        <!-- Invoice No. -->
                        <td>
                            <div (click)="(selectedVoucher === 'purchase' && !item.voucherNumber) ? onSelectInvoice(item) : ''"
                                [ngClass]="{'remove-capitalize': selectedVoucher === 'purchase', 'cp': selectedVoucher === 'purchase' && !item.voucherNumber}"
                                style="position: relative" class="d-flex">
                                <a href="javascript:void(0);" class="btn-link-2"
                                    (click)="onSelectInvoice(item)">{{item.voucherNumber ?  item.voucherNumber : '-'}}</a>
                            </div>

                            <span *ngIf="item.dueDays !== null && selectedVoucher !== 'purchase'">
                                <small class="text-danger" *ngIf="item.dueDays > 0">
                                    Overdue by {{ item.dueDays }} Days
                                </small>
                                <small class="text-danger" *ngIf="item.dueDays === 0">
                                    Overdue by Today
                                </small>
                            </span>
                        </td>
                        <!-- <td>PO82479</td> -->
                        <!-- Customer -->
                        <td [ngClass]="{'cp': selectedVoucher !== 'purchase'}"
                            (dblclick)="(selectedVoucher !== 'purchase') ? modalUniqueName = item.uniqueName : ''"
                            class="no-dbl-click-select" (clickOutside)="modalUniqueName = ''">

                            <div dropdown container="body">
                                {{item?.account?.customerName || item?.account?.name}}
                                <div *ngIf="modalUniqueName === item.uniqueName" account-detail-modal-component
                                    [voucherType]="selectedVoucher" [accountUniqueName]="item.account.uniqueName"
                                    [from]="invoiceSearchRequest.from" [to]="invoiceSearchRequest.to"
                                    [isModalOpen]="modalUniqueName === item.uniqueName">
                                </div>
                            </div>
                        </td>
                        <!-- Invoice Date -->
                        <td>{{item.voucherDate}}</td>

                        <td *ngIf="(selectedVoucher === 'purchase')">{{item.purchaseOrderNumbers}}</td>

                        <!-- Total Amt. -->
                        <td
                            [tooltip]="(selectedVoucher !== 'purchase') ? grandTotalPopupTemplate : ''" container="body"
                            containerClass="invoice-preview">{{item.accountCurrencySymbol}}
                            {{item.grandTotal?.amountForAccount | giddhCurrency}}
                        </td>
                        <ng-template #grandTotalPopupTemplate><span [innerHTML]="item.grandTotalTooltipText"></span>
                        </ng-template>

                        <!-- Balance Due -->

                        <td *ngIf="(selectedVoucher !== 'purchase')" [tooltip]="balanceDuePopupTemplate" container="body" containerClass="invoice-preview">
                            {{item.accountCurrencySymbol}} {{item?.totalBalance?.amountForAccount | giddhCurrency}}
                        </td>
                        <ng-template #balanceDuePopupTemplate><span [innerHTML]="item.balanceDueTooltipText"></span>
                        </ng-template>

                        <!-- Due Date -->
                        <td>{{item.dueDate ? item.dueDate : '-' }}</td>

                        <!-- Status -->
                        <!--for not cancelled status-->
                        <td  class="cp" *ngIf="(selectedVoucher !== 'purchase') && item.balanceStatus !== 'cancel'">
                            <div class="d-flex" style="align-items: center">
                                <div class="flex-fill selectAction">
                                    <span
                                        [ngClass]="{'text-light-2': !item.balanceStatus}">{{ item.balanceStatus ? item.balanceStatus : 'Select Action' }}</span>
                                </div>

                                <div>
                                    <div dropdown container="body" class="icon-ellipse selectAction">
                                        <a id="edit-model-basic" dropdownToggle
                                            class="dropdown-toggle icon-dots-three-vertical pull-right"
                                            aria-controls="dropdown-basic"></a>
                                        <div id="dropdown-basic" *dropdownMenu
                                            class="dropdown-menu dropdown-menu-right width-150" role="menu"
                                            aria-labelledby="edit-model-basic">
                                            <ul class="selectActionDropdown">
                                                <li (click)="onPerformAction(item, 'paid')">
                                                    <a class="cp" href="javascript:void(0)">Paid</a>
                                                </li>
                                                <li *ngIf="selectedVoucher === 'sales'"
                                                    (click)="onPerformAdjustPaymentAction(item)">
                                                    <a class="cp" href="javascript:void(0)">Adjust Amount</a>
                                                </li>
                                                <li (click)="onPerformAction(item, 'unpaid')">
                                                    <a class="cp" href="javascript:void(0)">Unpaid</a>
                                                </li>
                                                <li (click)="onPerformAction(item, 'hold')">
                                                    <a class="cp" href="javascript:void(0)">Hold</a>
                                                </li>
                                                <li (click)="onPerformAction(item, 'cancel')">
                                                    <a class="cp" href="javascript:void(0)">Cancel</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>

                        <!--for cancelled status-->
                        <td *ngIf="(selectedVoucher !== 'purchase') && item.balanceStatus === 'cancel'">
                            <span>{{ item.balanceStatus}}</span>
                        </td>

                        <td *ngIf="selectedVoucher === 'purchase'" class="d-flex align-items-center status-mobile pt-0 pb-0 mw-th-260">
                            
                                    <span class="d-flex">{{ item.balanceStatus}}</span>
                                    <div class="action-icon ml-auto" [ngClass]="{'item-selected': hoveredItemForAction === item.uniqueName || item.isSelected}" *ngIf="hoveredItemForAction === item.uniqueName || item.isSelected">
                                            <a tooltip="Send Email"
                                            (click)="openSendMailModal(sendEmailModal, item)">
                                                <span class="icon-envelope font-12"></span>
                                            </a>
                                            <a tooltip="Copy" [routerLink]="['/pages/proforma-invoice/invoice/purchase/'+item.account.uniqueName+'/'+item.uniqueName+'/copy']">
                                                <span class="icon-copy-small font-14"></span>
                                            </a>
                                            <a tooltip="Delete" (click)="deletePurchaseBill(item.uniqueName);">
                                                <i class="icon-trash"></i>
                                            </a>
                                        </div>
                                    <!--<span *ngIf="item.dueDays !== null">
                                            <small class="text-danger" *ngIf="item.dueDays > 0">
                                                Overdue by {{ item.dueDays }} Days
                                            </small>
                                            <small class="text-danger" *ngIf="item.dueDays === 0">
                                                Overdue by Today
                                            </small>
                                        </span>-->
                        </td>
                    </tr>
                </tbody>

                <!--non sales-->
                <tbody
                    *ngIf="voucherData && voucherData.items.length > 0 && !(isGetAllRequestInProcess$ | async) && (selectedVoucher !== 'sales' && selectedVoucher !== 'purchase')"
                    (clickOutside)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''"
                    (mouseleave)="hoveredItemForAction = ''; clickedHoveredItemForAction = ''">

                    <tr *ngFor="let item of voucherData.items; let i = index"
                        (mouseover)="hoveredItemForAction = item.uniqueName">

                        <td class="mh18_img"
                            *ngIf="hoveredItemForAction === item.uniqueName || item.isSelected || selectedItems.length > 0">
                            <div class="mh18_img" style="justify-content: center;display: flex">
                                <img *ngIf="!item.isSelected" src="assets/images/unchecked.png"
                                    (click)="toggleItem(item, true)" />
                                <img *ngIf="item.isSelected" src="assets/images/checked.png"
                                    (click)="toggleItem(item, false)" />
                            </div>
                        </td>

                        <!-- Serial No. -->
                        <td
                            *ngIf="!item.isSelected && hoveredItemForAction !== item.uniqueName && selectedItems.length === 0">
                            <div style="justify-content: center;display: flex"> {{ i + 1}}</div>
                        </td>

                        <!-- CR Note No. / DR Note No. -->
                        <td>
                            <a style="cursor: pointer" (click)="onSelectInvoice(item)">
                                {{item.voucherNumber }}</a>
                        </td>

                        <!-- open account details on double click on customer name -->
                        <td (dblclick)="modalUniqueName = item.uniqueName" class="cp no-dbl-click-select"
                            (clickOutside)="modalUniqueName = ''">
                            <!-- Customer -->
                            {{item?.account?.customerName || item?.account?.name}}
                            <div *ngIf="modalUniqueName === item.uniqueName" account-detail-modal-component
                                [voucherType]="selectedVoucher" [accountUniqueName]="item.account.uniqueName"
                                [from]="invoiceSearchRequest.from" [to]="invoiceSearchRequest.to"
                                [isModalOpen]="modalUniqueName === item.uniqueName">
                            </div>
                        </td>
                        <!-- Date -->
                        <td>{{item.voucherDate}}</td>

                        <!-- Linked invoices -->
                        <td *ngIf="selectedVoucher === 'credit note' || selectedVoucher === 'debit note'">{{item.invoiceLinkingRequest?.linkedInvoices?.length ? item.invoiceLinkingRequest?.linkedInvoices[0].invoiceNumber : '-'}}</td>

                        <!-- Total Amount with multicurrency for CR/DR note -->
                        <td *ngIf="(selectedVoucher === 'credit note' || selectedVoucher === 'debit note')"
                            [tooltip]="grandTotalPopupTemplate" class="text-right">{{item.accountCurrencySymbol}}
                            {{item.grandTotal?.amountForAccount | giddhCurrency}}</td>
                        <ng-template #grandTotalPopupTemplate><span [innerHTML]="item.grandTotalTooltipText"></span>
                        </ng-template>

                        <!-- Total Amount without multicurrency -->
                        <td *ngIf="!(selectedVoucher === 'credit note' || selectedVoucher === 'debit note')"
                            class="text-right">{{item.grandTotal?.amountForAccount | giddhCurrency}}</td>
                    </tr>
                </tbody>

                <tbody *ngIf="(isGetAllRequestInProcess$ | async)">
                    <tr>
                        <td colspan="8">
                            <!--loading-->
                            <div class="no-data mr-t2 loader-main">
                                <div class="spinner2">
                                    <div class="cube1"></div>
                                    <div class="cube2"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <ng-container *ngIf="voucherData && voucherData.items.length > 0 && !(isGetAllRequestInProcess$ | async) && (selectedVoucher === 'sales' || selectedVoucher === 'purchase') && isMobileView">
            <div class="card mobileTable mt-15" *ngFor="let item of voucherData?.items; let i = index">
                <table class="table basic table-bordered invoice-table" *ngIf="selectedVoucher === 'sales' || selectedVoucher === 'purchase'">
                    <tbody>
                    <tr>
                        <td class="card-header clearfix row mr-0 ml-0">
                            <div class="col-4 p-0">
                                <div class="mh18_img pull-left" style="justify-content: center;">
                                    <img src="assets/images/unchecked.png" *ngIf="!item.isSelected"
                                        (click)="toggleItem(item, true)">
                                    <img src="assets/images/checked.png" *ngIf="item.isSelected"
                                        (click)="toggleItem(item, false)">
                                </div>
                                <div style="justify-content: left;display: flex">#{{ i + 1}} </div>
                            </div>
                            <div class="col-8 p-0">
                                <div class="d-flex">
                                    <div class="flex-fill text-right dueDate">
                                        <strong>Due Date</strong>
                                    </div>
                                    <div>{{item.dueDate ? item.dueDate : '-' }}</div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td id="inovice_td" class="row mr-0 ml-0">
                            <div class="col-6 p-0">
                                <strong> Invoice No.</strong>
                            </div>
                            <div class="col-6 p-0">
                                <div class="invoice-name-download">
                                    <a class="invoiceNumberA">
                                        {{item.voucherNumber ?  item.voucherNumber : '-'}}</a>
                                    <span class="icon-download"></span>
                                </div>
                                <span *ngIf="item.dueDate && selectedVoucher !== 'purchase'" class="overDueDate">
                                    <small class="text-danger" *ngIf="item.dueDays > 0">
                                        Overdue by {{ item.dueDays }} Days
                                    </small>
                                    <small class="text-danger" *ngIf="item.dueDays === 0">
                                        Overdue by Today
                                    </small>
                                </span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="td-search-box" #searchCustomerContainer
                                (clickOutside)="clickedOutside($event, searchCustomerContainer, 'accountUniqueName')">
                                <div [hidden]="showCustomerSearch">
                                    <strong> Customer</strong>
                                </div>
                            </div>
                            <div (dblclick)="modalUniqueName = item.uniqueName" class="cp no-dbl-click-select"
                                (clickOutside)="modalUniqueName = ''">
                                {{item?.account?.customerName || item?.account?.name}}
                                <div *ngIf="modalUniqueName === item.uniqueName" account-detail-modal-component
                                    [accountUniqueName]="item.account.uniqueName" [voucherType]="selectedVoucher"
                                    [from]="invoiceSearchRequest.from" [to]="invoiceSearchRequest.to"
                                    [isModalOpen]="modalUniqueName === item.uniqueName">
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="row mr-0 ml-0">
                            <div class="col-6 p-0">
                                <div class="d-flex">
                                    <div class="flex-fill">
                                        <strong>Invoice Date</strong>
                                    </div>
                                </div>
                                <div>
                                    {{item.voucherDate}}
                                </div>
                            </div>

                            <div *ngIf="selectedVoucher !== 'purchase'" class="col-6 p-0">
                                <div class="d-flex">
                                    <div class="flex-fill">
                                        <strong>Status</strong>
                                    </div>
                                </div>

                                <div class="cp" *ngIf="item.balanceStatus !== 'cancel'">
                                    <div class="d-flex" style="align-items: center">
                                        <div class="flex-fill selectAction">
                                            <span
                                                [ngClass]="{'text-light-2': !item.balanceStatus}">{{ item.balanceStatus ? item.balanceStatus : 'Select Action' }}</span>

                                            <span *ngIf="item.dueDate && selectedVoucher === 'purchase'" class="overDueDate">
                                                <small class="text-danger" *ngIf="item.dueDays > 0">
                                                    Overdue by {{ item.dueDays }} Days
                                                </small>
                                                <small class="text-danger" *ngIf="item.dueDays === 0">
                                                    Overdue by Today
                                                </small>
                                            </span>
                                        </div>
                                        <div class="click-dropdwon" [attachOutsideOnClick]="true"
                                            (clickOutside)="showMoreBtn = false" [exclude]="'.dropdown-menu'">
                                            <i class="fa fa-ellipsis-v"
                                                (click)="showMoreBtn=!showMoreBtn;selectedItemForMoreBtn = item.voucherNumber"></i>
                                            <ul class="dropdown-menu displayBlock"
                                                *ngIf="showMoreBtn && selectedItemForMoreBtn === item.voucherNumber">
                                                <li (click)="onPerformAction(item, 'paid')">
                                                    <a class="cp" href="javascript:void(0)">Paid</a>
                                                </li>
                                                <li (click)="onPerformAction(item, 'unpaid')">
                                                    <a class="cp" href="javascript:void(0)">Unpaid</a>
                                                </li>
                                                <li (click)="onPerformAction(item, 'hold')">
                                                    <a class="cp" href="javascript:void(0)">Hold</a>
                                                </li>
                                                <li (click)="onPerformAction(item, 'cancel')">
                                                    <a class="cp" href="javascript:void(0)">Cancel</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div *ngIf="item.balanceStatus === 'cancel'">
                                    <span>{{ item.balanceStatus}}</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="row mr-0 ml-0">
                            <div class="col-6 p-0">
                                <div class="d-flex">
                                    <div class="flex-fill">
                                        <strong>Total Amt.</strong>
                                    </div>
                                </div>
                                <div>
                                    {{item.accountCurrencySymbol}} {{item.grandTotal?.amountForAccount | giddhCurrency}}
                                </div>
                            </div>
                            <div *ngIf="selectedVoucher !== 'purchase'" class="col-6 p-0">
                                <div class="d-flex">
                                    <div class="flex-fill">
                                        <strong> Balance Due </strong>
                                    </div>
                                </div>

                                <div>{{item.accountCurrencySymbol}} {{item?.totalBalance?.amountForAccount | giddhCurrency}}</div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </ng-container>
        <div *ngIf="voucherData && voucherData?.totalItems > paginationLimit" class="paginationWrapper">
            <pagination [totalItems]="voucherData.totalItems" [(ngModel)]="voucherData.page" [maxSize]="5"
                class="pagination-sm" [boundaryLinks]="true" [itemsPerPage]="paginationLimit" [rotate]="false"
                previousText="&#9668;" nextText="&#9658;" (pageChanged)="pageChanged($event)"></pagination>
        </div>


        <!--No Entry-->
        <div class="no-data mr-t2" *ngIf="!voucherData && !(isGetAllRequestInProcess$ | async)">
            <h1>No Entry found in sales!</h1>
            <h1>Have to do some sales before creating invoice</h1>
        </div>

        <!--no data-->
        <div class="no-data"
            *ngIf="voucherData && voucherData.items.length === 0 && !(isGetAllRequestInProcess$ | async)">
            <h1>No entries found within given criteria.</h1>
            <h1>Do search with some other dates</h1>
        </div>

        <!-- Delete invoice confirmation model -->
        <div bsModal #invoiceConfirmationModel="bs-modal" class="modal fade" role="dialog" [config]="{keyboard:true}"
            tabindex="-1">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <delete-role-confirmation-model
                        [module]="(selectedVoucher !== 'purchase') ? selectedVoucher : 'purchaselist'"
                        [selectedInvoiceForDelete]="selectedInvoice" (confirmDeleteEvent)="deleteConfirmedInvoice()"
                        (closeModelEvent)="closeConfirmationPopup()">
                    </delete-role-confirmation-model>
                </div>
            </div>
        </div>

    <!-- Perform action on invoice model -->
        <div bsModal #performActionOnInvoiceModel="bs-modal" class="modal fade" role="dialog" [config]="{keyboard:true}"
            tabindex="-1">
            <div class="modal-dialog modal-md perform-payment">
                <div class="modal-content">
                    <invoice-payment-model *ngIf="performActionOnInvoiceModel.isShown"
                        [selectedInvoiceForPayment]="selectedInvoice"
                        (closeModelEvent)="closePerformActionPopup($event)">
                    </invoice-payment-model>
                </div>
            </div>
        </div>
    <!-- Download or Send Invoice on mail -->
    <div bsModal #downloadOrSendMailModel="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div element-view-container-ref #downloadOrSendMailComponent=elementviewcontainerref>
                </div>
            </div>
        </div>
    </div>
        <!-- modal dialog -->
        <div bsModal #invoiceGenerateModel="bs-modal" class="modal fade" role="dialog" [config]="modalConfig"
            tabindex="-1">
            <div class="modal-dialog gray modal-liquid">
                <div class="modal-content">
                    <invoice-generate-model *ngIf="showInvoiceGenerateModal" (closeEvent)="closeInvoiceModel($event)">
                    </invoice-generate-model>
                </div>
            </div>
        </div>

        <!--advance_seearch Modal-->
        <div bsModal #advanceSearch="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <invoice-advance-search-component #advanceSearchComponent
                        [type]="selectedVoucher === 'debit note' || selectedVoucher === 'credit note' ? 'drcr' : (selectedVoucher === 'purchase') ? selectedVoucher : 'invoice'"
                        [request]="advanceSearchFilter" (applyFilterEvent)="applyAdvanceSearch($event)"
                        (closeModelEvent)="toggleAdvanceSearchPopup(true)">
                    </invoice-advance-search-component>
                </div>
            </div>
        </div>

        <!--bulk update modal-->
        <div bsModal #bulkUpdate="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <invoice-bulk-update-modal-component (closeModelEvent)="toggleBulkUpdatePopup(true)"
                        [voucherType]="selectedVoucher" [selectedInvoices]="selectedInvoicesList">
                    </invoice-bulk-update-modal-component>
                </div>
            </div>
        </div>

        <!--EwayBill-->
        <div bsModal #eWayBill="bs-modal" class="modal fade" role="dialog" [config]="modalConfig" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <app-generate-ewaybill-modal (closeModelEvent)="toggleEwayBillPopup()">
                    </app-generate-ewaybill-modal>
                </div>
            </div>
        </div>

        <!--total sale & Total Due-->
        <div class=" mt-5 invoice-footer" *ngIf="!selectedInvoiceForDetails">
            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 d-flex total-due-sale-wrap">
                <div class="col-sm-6 totalDueSale">
                    <h3>
                        Total
                        {{!(selectedVoucher === 'credit note' || selectedVoucher === 'debit note') ? (selectedVoucher === 'purchase') ? ' Purchases:' : ' Sale:' : ':' }}
                    </h3>
                    <h1>{{baseCurrencySymbol}}{{ totalSale | giddhCurrency }}<span
                            *ngIf="baseCurrency==='INR'">/-</span>
                    </h1>
                </div>
                <div *ngIf="!(selectedVoucher === 'credit note' || selectedVoucher === 'debit note' || selectedVoucher === 'purchase')"
                    class="col-sm-6 totalDueSale">
                    <h3>Total Due:</h3>
                    <h1>{{baseCurrencySymbol}}{{ totalDue | giddhCurrency }}<span *ngIf="baseCurrency==='INR'">/-</span>
                    </h1>
                </div>
            </div>
        </div>

        <!-- region invoice-preview-details -->
        <div *ngIf="selectedInvoiceForDetails">
            <invoice-preview-details-component [selectedItem]="selectedInvoiceForDetails" [items]="itemsListForDetails"
                [invoiceSetting]="invoiceSetting" (deleteVoucher)="deleteConfirmedInvoice($event)"
                (sendEmail)="sendEmail($event)" (closeEvent)="invoicePreviewClosed()"
                (onOpenAdvanceReceiptModal)="openAdvanceReceiptModal($event)"
                (processPaymentEvent)="closePerformActionPopup($event)" [voucherType]="selectedVoucher"
                (updateVoucherAction)="onPerformAction(null, $event)" [appSideMenubarIsOpen]="appSideMenubarIsOpen"
                (refreshDataAfterVoucherUpdate)="getVoucher(isUniversalDateApplicable)">
            </invoice-preview-details-component>
        </div>
        <!-- endregion -->
    </div>
</ng-container>

<!-- region search template -->
<ng-template #searchTemplate let-show let-title="title" let-fieldName="fieldName" let-formControl="formControl">
    <div [hidden]="show">
        <span> {{ title }}</span>
        <i class="icon-search" (click)="toggleSearch(fieldName, searchBox);"></i>
    </div>
    <div class="input-container" [hidden]="!show">
        <input type="text" placeholder="Search {{ title }}" class="w100" #searchBox [formControl]="formControl" />
    </div>
</ng-template>
<!-- endregion -->

<!-- region sort icon template -->
<ng-template #sortTemplate let-column="column">
    <div class="icon-sort-asc" *ngIf="sortRequestForUi.sortBy !== column" (click)="sortButtonClicked('asc', column)"
        [ngClass]="{'activeTextColor': sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'asc'}"></div>
    <div class="icon-sort-asc" *ngIf="sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'asc'"
        (click)="sortButtonClicked('desc', column)"
        [ngClass]="{'activeTextColor': sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'asc'}"></div>
    <div class="icon-sort-dsc" *ngIf="sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'desc'"
        (click)="sortButtonClicked('asc', column)"
        [ngClass]="{'activeTextColor': sortRequestForUi.sortBy === column && sortRequestForUi.sort === 'desc'}"></div>
</ng-template>
<!-- endregion -->

<!-- Advance receipt adjust modal start -->
<div class="modal fade purchase-record-confirmation-modal" tabindex="-1" #adjustPaymentModal="bs-modal" [config]="{ animated: true, ignoreBackdropClick: true }" bsModal role="dialog">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <advance-receipt-adjustment-component *ngIf="showAdvanceReceiptAdjust" #advanceReceiptComponent [isUpdateMode]="isUpdateMode" [depositAmount]="depositAmount" [invoiceFormDetails]="invFormData" [advanceReceiptAdjustmentUpdatedData]="advanceReceiptAdjustmentData"
                (closeModelEvent)="closeAdvanceReceiptModal()" (submitClicked)="getAdvanceReceiptAdjustData($event)" [isVoucherModule]="true">
            </advance-receipt-adjustment-component>
        </div>
    </div>
</div>
<!-- end -->
<ng-template #sendEmailModal>
    <purchase-send-email-modal [module]="'purchase-bill'" [sendEmailRequest]="sendEmailRequest" (closeModelEvent)="closeSendMailPopup($event)"></purchase-send-email-modal>
</ng-template>

