<ng-container appTranslate (commonLocaleData)="commonLocaleData = $event">
    <div [ngClass]="{ 'readonly-field': readonly }">
        <mat-form-field [ngClass]="{ 'mat-form-field-invalid': showError }" [appearance]="appearance" (click)="!readonly ? trigger?.openPanel() : trigger?.closePanel()">
            <mat-label>{{ label ? label : placeholder }}</mat-label>
            <input
                type="text"
                [ngClass]="cssClass"
                class="select-field-input"
                [placeholder]="placeholder"
                matInput
                [matAutocomplete]="auto"
                (blur)="onBlur()"
                [name]="name"
                [formControl]="searchFormControl"
                [readonly]="readonly"
                [autocomplete]="autocomplete"
                #trigger="matAutocompleteTrigger"
                #selectField
                (keydown.enter)="$event.preventDefault()"
                matAutocompletePosition="auto"
                [required]="required"
                [attr.aria-expanded]="readonly ? false : true"
                (focusout)="
                    closeOnFocusOut &&
                    $event?.relatedTarget?.nodeName !== 'MAT-OPTION' &&
                    $event?.relatedTarget?.nodeName !== 'A'
                        ? trigger.closePanel()
                        : null
                "
            />
            <mat-autocomplete
                autoActiveFirstOption
                [displayWith]="displayLabel"
                (optionSelected)="optionSelected($event)"
                #auto="matAutocomplete"
                [ngClass]="customPanelClass"
            >
                <a href="javascript:;" *ngIf="createNewText" (click)="createNewRecord()" class="custom-class-create" aria-label="create new" role="list">
                    <div class="item create-new">{{ createNewText }}</div>
                    <div class="item create-new-command">
                        {{ commonLocaleData?.app_alt_c }}
                    </div>
                </a>
                <ng-container *ngIf="fieldFilteredOptions?.length <= 5; else scrollData">
                    <mat-option
                        *ngFor="let option of fieldFilteredOptions"
                        [value]="option"
                        [ngClass]="hasMoreValue ? 'options-line-value' : 'options-line'"
                        [matTooltip]="option?.label"
                        [disabled]="option?.additional?.isDisabled"
                        matTooltipPosition="right"
                    >
                        <ng-template
                            [ngTemplateOutletContext]="{ option: option }"
                            [ngTemplateOutlet]="optionTemplate"
                        ></ng-template>
                        <ng-container *ngIf="!optionTemplate">
                            <span class="option-label"> {{ option?.label }}</span>
                            <span class="option-value" *ngIf="showValueInLabel">{{
                                option.additional?.uniqueName
                            }}</span>
                        </ng-container>
                    </mat-option>
                    <mat-option disabled *ngIf="fieldFilteredOptions?.length === 0">{{
                        noResultsFoundMessage ? noResultsFoundMessage : commonLocaleData?.app_no_result_found
                    }}</mat-option>
                    <mat-option
                        value=""
                        *ngIf="showCreateNew"
                        (click)="createNewRecord()"
                        [matTooltip]="option?.label"
                        [disabled]="option?.additional?.isDisabled"
                        matTooltipPosition="right"
                    >
                        <a href="javascript:;" class="options-class-create">
                            {{ commonLocaleData?.app_create_new }}
                        </a></mat-option
                    >
                </ng-container>

                <ng-template #scrollData>
                    <app-cdk-scroll
                        (fetchNextPage)="isPaginationEnabled ? scrollEndEvent($event) : ''"
                        [scrollableElementId]="scrollableElementId"
                    >
                        <cdk-virtual-scroll-viewport
                            class="virtual-group-list overflow-x-hidden"
                            [itemSize]="33"
                            [minBufferPx]="300"
                            [maxBufferPx]="300"
                            [id]="scrollableElementId"
                            tabindex="0"
                            [ngStyle]="{
                                'height':
                                    (fieldFilteredOptions?.length * 51 > 193
                                        ? 193
                                        : showCreateNew
                                        ? 51
                                        : fieldFilteredOptions?.length * 51
                                        ? fieldFilteredOptions?.length * 51
                                        : 51) + 'px'
                            }"
                        >
                            <mat-option
                                *ngFor="let option of fieldFilteredOptions"
                                [value]="option"
                                [ngClass]="hasMoreValue ? 'options-line-value' : 'options-line'"
                                [matTooltip]="option?.label"
                                [disabled]="option?.additional?.isDisabled"
                                matTooltipPosition="right"
                            >
                                <ng-template
                                    [ngTemplateOutletContext]="{ option: option }"
                                    [ngTemplateOutlet]="optionTemplate"
                                ></ng-template>
                                <ng-container *ngIf="!optionTemplate">
                                    <span class="option-label"> {{ option?.label }}</span>
                                    <span class="option-value" *ngIf="showValueInLabel">{{
                                        option.additional?.uniqueName
                                    }}</span>
                                </ng-container>
                            </mat-option>
                            <mat-option disabled *ngIf="fieldFilteredOptions?.length === 0">{{
                                noResultsFoundMessage ? noResultsFoundMessage : commonLocaleData?.app_no_result_found
                            }}</mat-option>
                            <mat-option
                                value=""
                                *ngIf="showCreateNew"
                                (click)="createNewRecord()"
                            >
                                <a href="javascript:;" class="options-class-create">
                                    {{ commonLocaleData?.app_create_new }}
                                </a></mat-option
                            >
                        </cdk-virtual-scroll-viewport>
                    </app-cdk-scroll>
                </ng-template>
            </mat-autocomplete>
            <div class="dropdown-bg" (click)="!readonly ? openDropdownPanel() : $event.stopPropagation()">
                <span class="arrow-dropdown"></span>
            </div>
        </mat-form-field>
    </div>
</ng-container>
