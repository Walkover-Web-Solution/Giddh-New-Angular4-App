<ng-container
    appTranslate
    [file]="'custom-fields'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
    (translationComplete)="translationComplete($event)"
>
    <div class="custom-filed-list-wrapper" *ngIf="!isGetCustomInProgress">
        <form [formGroup]="customFieldForm">
            <ng-container formArrayName="customField">
                <ng-container
                    *ngFor="
                        let item of customFieldForm.get('customField')['controls'];
                        let index = index;
                        let first = first
                    "
                >
                    <div class="row mr-b15" [formGroupName]="index">
                        <div class="col-lg-3 col-sm-3 col-xs-12">
                            <label *ngIf="first || isMobileScreen">{{ localeData?.name }}</label>
                            <input
                                type="text"
                                class="form-control"
                                [placeholder]="localeData?.name_placeholder"
                                [maxlength]="100"
                                (blur)="checkValidation('name', index)"
                                formControlName="fieldName"
                                name="fieldName"
                                autocomplete="off"
                                [attr.disabled]="item.get('uniqueName').value && isEnabledIndex !== index ? '' : null"
                            />
                        </div>
                        <div class="col-lg-3 col-sm-3 col-xs-12" formGroupName="fieldType">
                            <label *ngIf="first || isMobileScreen">{{ localeData?.type }}</label>
                            <sh-select
                                [placeholder]="localeData?.field_type_placeholder"
                                [options]="fieldTypes"
                                [defaultValue]="item.get('fieldType')?.value?.type | titlecase"
                                formControlName="type"
                                name="fieldType"
                                (selected)="customFieldTypeSelected($event, index)"
                                [disabled]="item.get('uniqueName').value && isEnabledIndex !== index"
                            >
                            </sh-select>
                        </div>
                        <div class="col-lg-3 col-sm-3 col-xs-12" formGroupName="dataRange">
                            <label *ngIf="first || isMobileScreen">{{ localeData?.length }}</label>
                            <input
                                *ngIf="
                                    item.get('fieldType').value.type === availableFieldTypes.Boolean ||
                                    item.get('fieldType').value.type === availableFieldTypes.Number ||
                                    !item.get('fieldType').value.type
                                "
                                type="number"
                                [max]="30"
                                [maxLength]="2"
                                class="form-control"
                                formControlName="max"
                                name="dataRange"
                                [attr.disabled]="
                                    (item.get('uniqueName').value && isEnabledIndex !== index) ||
                                    item.get('fieldType').value.type === availableFieldTypes.Boolean
                                        ? ''
                                        : null
                                "
                                (blur)="checkValidation('length', index)"
                                autocomplete="off"
                            />
                            <input
                                *ngIf="
                                    item.get('fieldType').value.type === availableFieldTypes.String ||
                                    item.get('fieldType').value.type === availableFieldTypes.Barcode
                                "
                                type="number"
                                class="form-control"
                                [max]="150"
                                [maxLength]="3"
                                formControlName="max"
                                name="dataRange"
                                [attr.disabled]="
                                    (item.get('uniqueName').value && isEnabledIndex !== index) ||
                                    item.get('fieldType').value.type === availableFieldTypes.Boolean
                                        ? ''
                                        : null
                                "
                                (blur)="checkValidation('length', index)"
                                autocomplete="off"
                            />
                        </div>
                        <div class="col-lg-3 col-sm-3 col-xs-12 edit-close-btn">
                            <label *ngIf="first || isMobileScreen" class="d-block">&nbsp;</label>
                            <button
                                type="button"
                                *ngIf="item.get('uniqueName').value"
                                class="btn btn-default close-button"
                                (click)="openModal(template, index)"
                            >
                                <i class="icon-trash"></i>
                            </button>
                            <button
                                type="button"
                                *ngIf="!item.get('uniqueName').value"
                                class="btn btn-default close-button"
                                (click)="removeCustomFieldRow(index, false)"
                            >
                                <i class="icon-trash"></i>
                            </button>
                            <button
                                type="button"
                                *ngIf="item.get('uniqueName').value && index !== isEnabledIndex"
                                class="btn btn-default"
                                (click)="editCustomfield(index)"
                            >
                                <i class="icon-edit"></i>
                            </button>
                            <button
                                type="submit"
                                *ngIf="item.get('uniqueName').value && index === isEnabledIndex"
                                class="btn btn-default"
                                [disabled]="!isCustomFormValid"
                                [ladda]="isSaveCustomInProgress"
                                (click)="updateCustomFields(customFieldForm.value)"
                            >
                                <i class="icon-save"></i>
                            </button>
                        </div>
                    </div>
                </ng-container>
            </ng-container>
            <div class="row">
                <div class="col-lg-3 col-sm-3 col-xs-12">
                    <a href="javascript:void(0)" (click)="addNewCustomFieldRow()" class="btn btn-link pl-0">{{
                        localeData?.add_new_row
                    }}</a>
                </div>
                <div class="col-lg-3 col-sm-3 col-xs-12" *ngIf="!isEnabledIndex">
                    <label *ngIf="isMobileScreen" class="d-block">&nbsp;</label>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        [disabled]="!isCustomFormValid || customFieldForm.invalid || isEnabledIndex !== null"
                        [ladda]="isSaveCustomInProgress"
                        (click)="saveCustomFields(customFieldForm.value)"
                    >
                        {{ commonLocaleData?.app_save }}
                    </button>
                </div>
            </div>
        </form>
        <div class="custom-fields-pagination">
            <pagination
                *ngIf="customFieldsList?.results?.length && customFieldsList?.totalItems > customFieldsRequest?.count"
                [totalItems]="customFieldsList?.totalItems"
                [maxSize]="5"
                [itemsPerPage]="customFieldsList?.count"
                [boundaryLinks]="true"
                [rotate]="true"
                (pageChanged)="pageChanged($event)"
                [firstText]="commonLocaleData?.app_first"
                [previousText]="commonLocaleData?.app_previous"
                [nextText]="commonLocaleData?.app_next"
                [lastText]="commonLocaleData?.app_last"
            ></pagination>
        </div>
    </div>
    <div class="search-loading" *ngIf="isGetCustomInProgress">
        <div class="vertical-center"><span class="spinner small"></span> {{ commonLocaleData?.app_loading }}</div>
    </div>
    <ng-template #template>
        <div class="modal-header">
            <h4 class="modal-title pull-left">{{ localeData?.delete_custom_field_title }}</h4>
            <button
                type="button"
                class="close pull-right"
                [attr.aria-label]="commonLocaleData?.app_close"
                (click)="modalRef.hide()"
            >
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <p>{{ localeData?.delete_custom_field_alert }}</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" (click)="removeCustomFieldRow(selectedRowIndex, true)">
                {{ commonLocaleData?.app_yes }}
            </button>
            <button class="btn btn-danger" (click)="modalRef.hide(); selectedRowIndex = null">
                {{ commonLocaleData?.app_no }}
            </button>
        </div>
    </ng-template>
</ng-container>
