<ng-container
    appTranslate
    [file]="'custom-fields'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
    (translationComplete)="translationComplete($event)"
>
    <div class="custom-filed-list-wrapper" *ngIf="!isGetCustomInProgress">
        <form [formGroup]="customFieldForm">
            <ng-container formArrayName="customField">
                <ng-container
                    *ngFor="
                        let item of customFieldForm.get('customField')['controls'];
                        let index = index;
                        let first = first
                    "
                >
                    <div class="row mr-b15" [formGroupName]="index">
                        <div class="col-lg-3 col-sm-3 col-xs-12">
                            <label *ngIf="first || isMobileScreen">{{ localeData?.name }}</label>
                            <input
                                type="text"
                                class="form-control"
                                [placeholder]="localeData?.name_placeholder"
                                [maxlength]="50"
                                (blur)="checkValidation('name', index)"
                                formControlName="key"
                                name="key"
                                autocomplete="off"
                                [attr.disabled]="item.get('uniqueName').value && isEnabledIndex !== index ? '' : null"
                            />
                        </div>
                        <div class="col-lg-3 col-sm-3 col-xs-12">
                            <label *ngIf="first || isMobileScreen">{{ localeData?.type }}</label>
                            <sh-select
                                [placeholder]="localeData?.field_type_placeholder"
                                [options]="dataTypeList"
                                formControlName="dataType"
                                name="dataType"
                                (selected)="customFieldTypeSelected($event, index)"
                                [disabled]="item.get('uniqueName').value && isEnabledIndex !== index"
                            >
                            </sh-select>
                        </div>
                        <div class="col-lg-3 col-sm-3 col-xs-12">
                            <label *ngIf="first || isMobileScreen">{{ localeData?.length }}</label>
                            <input
                                *ngIf="
                                    item.get('dataType').value === 'BOOLEAN' ||
                                    item.get('dataType').value === 'NUMERIC' ||
                                    !item.get('dataType').value
                                "
                                type="number"
                                [max]="30"
                                [maxLength]="2"
                                class="form-control"
                                formControlName="valueLength"
                                name="valueLength"
                                [attr.disabled]="
                                    (item.get('uniqueName').value && isEnabledIndex !== index) ||
                                    item.get('dataType').value === 'BOOLEAN'
                                        ? ''
                                        : null
                                "
                                (blur)="checkValidation('length', index)"
                                autocomplete="off"
                            />
                            <input
                                *ngIf="item.get('dataType').value === 'STRING'"
                                type="text"
                                class="form-control"
                                [max]="150"
                                [maxLength]="3"
                                formControlName="valueLength"
                                name="valueLength"
                                [attr.disabled]="
                                    (item.get('uniqueName').value && isEnabledIndex !== index) ||
                                    item.get('dataType').value === 'BOOLEAN'
                                        ? ''
                                        : null
                                "
                                (blur)="checkValidation('length', index)"
                                autocomplete="off"
                            />
                        </div>
                        <div class="col-lg-3 col-sm-3 col-xs-12 edit-close-btn">
                            <label *ngIf="first || isMobileScreen" class="d-block">&nbsp;</label>
                            <button
                                type="button"
                                *ngIf="item.get('uniqueName').value"
                                class="btn btn-default close-button"
                                (click)="openModal(template, index)"
                            >
                                <i class="icon-trash"></i>
                            </button>
                            <button
                                type="button"
                                *ngIf="!item.get('uniqueName').value"
                                class="btn btn-default close-button"
                                (click)="removeCustomFieldRow(index, false)"
                            >
                                <i class="icon-trash"></i>
                            </button>
                            <button
                                type="button"
                                *ngIf="item.get('uniqueName').value"
                                class="btn btn-default"
                                (click)="editCustomfield(index)"
                            >
                                <i class="icon-edit"></i>
                            </button>
                        </div>
                    </div>
                </ng-container>
            </ng-container>
            <div class="row">
                <div class="col-lg-3 col-sm-3 col-xs-12">
                    <a href="javascript:void(0)" (click)="addNewCustomFieldRow()" class="btn btn-link pl-0">{{
                        localeData?.add_new_row
                    }}</a>
                </div>
                <div class="col-lg-3 col-sm-3 col-xs-12" *ngIf="updateModeLength">
                    <label *ngIf="isMobileScreen" class="d-block">&nbsp;</label>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        [disabled]="customFieldForm.invalid || !isCustomFormValid"
                        [ladda]="isSaveCustomInProgress"
                        (click)="submitCustomFields(customFieldForm.value, 'update')"
                    >
                        {{ commonLocaleData?.app_update }}
                    </button>
                </div>
                <div class="col-lg-3 col-sm-3 col-xs-12" *ngIf="!updateModeLength">
                    <label *ngIf="isMobileScreen" class="d-block">&nbsp;</label>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        [disabled]="customFieldForm.invalid"
                        [ladda]="isSaveCustomInProgress"
                        (click)="submitCustomFields(customFieldForm.value, 'create')"
                    >
                        {{ commonLocaleData?.app_save }}
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div class="search-loading" *ngIf="isGetCustomInProgress">
        <div class="vertical-center"><span class="spinner small"></span> {{ commonLocaleData?.app_loading }}</div>
    </div>

    <ng-template #template>
        <div class="modal-header">
            <h4 class="modal-title pull-left">{{ localeData?.delete_custom_field_title }}</h4>
            <button
                type="button"
                class="close pull-right"
                [attr.aria-label]="commonLocaleData?.app_close"
                (click)="modalRef.hide()"
            >
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <p>{{ localeData?.delete_custom_field_alert }}</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" (click)="removeCustomFieldRow(selectedRowIndex, true)">
                {{ commonLocaleData?.app_yes }}
            </button>
            <button class="btn btn-danger" (click)="modalRef.hide(); selectedRowIndex = null">
                {{ commonLocaleData?.app_no }}
            </button>
        </div>
    </ng-template>
</ng-container>
