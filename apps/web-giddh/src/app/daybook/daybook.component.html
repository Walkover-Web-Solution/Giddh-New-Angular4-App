<hamburger-menu [pageHeading]="'Daybook'"></hamburger-menu>
<div class="no-data mr-t2 loader-main" *ngIf="showLoader">
    <div class="spinner2">
        <div class="cube1"></div>
        <div class="cube2"></div>
    </div>
</div>

<section class="container p-0"></section>
<!-- <div class="top-bar col-xs-12 bd-rb">
  <h1 class="section-title">DayBook</h1>
</div> -->
<div class="container-fluid">

</div>

<ng-container *ngIf="!showLoader">
<div class="transactions-page pt-15 position-relative clearfix">

    <!-- ledger header -->
    <div class="col-md-12">
        <div>

            <div class="form-inline d-block flex-row flex-nowrap">
                <div class="form-group">

                    <span class="input-wrapper"> <input type="text" #dateRangePickerCmp name="daterangeInput"
                            daterangepicker [options]="datePickerOptions"
                            (applyDaterangepicker)="selectedDate($event)" class="form-control date-range-picker cursor-pointer" />
                    </span>

                </div>
                <div class="form-group cursor-pointer">


                    <div class="advance-icon align-items-center" tooltip="Advance Search" (click)="onOpenAdvanceSearch()">
                        <span class="icon-advance-filter"></span>
                    </div>


                </div>
                <div class="form-group expand-collapse-btn">

                    <button type="button" class="btn btn-default" (click)="toggleExpand()">{{ isAllExpanded ? 'Collapse All' :
                              'Expand All'}}
                    </button>

                </div>
                <div class="clear-filter form-group" *ngIf="showAdvanceSearchIcon">
                    <button class="btn btn-filter" (click)="initialRequest();">
                        <span class="icon-cross"></span> Clear Filter
                    </button>
                </div>
                <div class="expand-export">
                    <button type="button" class="btn btn-default expand-btn-hide-desktop" (click)="toggleExpand()">{{ isAllExpanded ? 'Collapse All' :'Expand All'}}
                    </button>
                    <button type="button" class="btn btn-default export-btn pull-right"
                        (click)="exportDaybook()">Export</button>
                </div>

            </div>


        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="box clearfix mt-15">
        <div class="text-center mr-b2 transaction-report">
            <p>Transaction Report</p>
            <p>{{daybookQueryRequest.from }} - {{ daybookQueryRequest.to}}</p>
        </div>

        <div class="clearfix trial-balance table-responsive">

            <table class="tb-head table-bordered table basic on-mobile-view">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Particular</th>
                        <th>Vch. Name</th>
                        <th class="text-right">Vch. No.</th>
                        <th class="text-right">Debit Amt</th>
                        <th class="text-right">Credit Amt</th>

                        <ng-container *ngIf="isEntryExpanded">
                            <th>Product/Service
                            </th>
                            <th class="text-right">Qty.
                            </th>
                            <th>Unit
                            </th>
                            <th class="text-right">Rate
                            </th>
                            <th>HSN/SAC
                            </th>
                            <th>SKU
                            </th>
                            <th>Warehouse
                            </th>
                        </ng-container>
                    </tr>
                </thead>

                <tbody *ngFor="let entry of (daybookData$ | async)?.entries" (click)="expandEntry(entry);"
                    class="daybook-table-tbody">
                    <tr>
                        <td data-title="Date">{{ entry.entryDate }}</td>
                        <td data-title="Particular">{{ entry.particular.name }}</td>
                        <td data-title="Vch. Name">{{ entry.voucherName }}</td>
                        <td class="text-right" data-title="Vch. No.">{{ entry.voucherNo }}</td>
                        <td class="text-right" data-title="Debit Amt">{{ entry.debitAmount || 0 |giddhCurrency }}</td>
                        <td class="text-right" data-title="Credit Amt">{{ entry.creditAmount || 0 |giddhCurrency}}</td>
                        <td *ngIf="isEntryExpanded" colspan="7"> </td>
                    </tr>
                    <ng-container *ngIf="entry !== undefined && entry.isExpanded">
                        <tr *ngFor="let details of entry.otherTransactions">
                            <td class="hide-td"></td>
                            <td data-title="Particular">{{ details.particular.name }}</td>
                            <td class="hide-td"></td>
                            <td class="hide-td"></td>
                            <td class="text-right" data-title="Debit Amt">
                                <span *ngIf="details.type === 'DEBIT'">{{ details.amount || 0 |giddhCurrency}}</span>
                                <span *ngIf="details.type !== 'DEBIT'">-</span>

                            </td>
                            <td class="text-right" data-title="Credit Amt">
                                <span *ngIf="details.type === 'CREDIT'">{{ details.amount|| 0  |giddhCurrency}}</span>
                                <span *ngIf="details.type !== 'CREDIT'">-</span>
                            </td>
                            <ng-container *ngIf="isEntryExpanded">
                                <td>{{details.inventory?details.inventory.stock.name:''}}
                                </td>
                                <td *ngIf="details.inventory" class=" text-right">{{details.inventory.quantity |giddhCurrency}}
                                </td>
                                <td *ngIf="!details.inventory" class=" text-right">{{'-'}}
                                </td>
                                <td>{{details.inventory?details.inventory.unit.name:''}}
                                </td>
                                <td *ngIf="details.inventory" class=" text-right">{{details.inventory.rate |giddhCurrency}}
                                </td>
                                <td *ngIf="!details.inventory" class=" text-right">{{'-'}}
                                </td>
                                <td>{{details.inventory?details.inventory.hsnNumber? details.inventory.hsnNumber: details.inventory.sacNumber:''}}
                                </td>
                                <td>{{details.inventory?details.inventory.skuCode:''}}
                                </td>
                                <td class="warehouse-name">{{details.inventory?details.inventory.warehouse.name:''}}
                                </td>
                            </ng-container>
                        </tr>
                    </ng-container>
                </tbody>

            </table>



            <div>
            </div>
        </div>

        <div class="mr-t2 text-center">
            <small class="grey" *ngIf="(daybookData$ | async)?.totalItems">{{(daybookData$ | async)?.totalItems  |giddhCurrency}}
                Transactions
                | {{(daybookData$ | async)?.totalPages  |giddhCurrency}} Pages
            </small>
            <small class="grey" *ngIf="!((daybookData$ | async)?.totalItems)">0 Transactions | 0 Pages</small>
        </div>

        <!-- pagination -->
        <div class="mt-1">
            <div id="pagination" element-view-container-ref #paginationChild=elementviewcontainerref></div>
        </div>
        <!-- pagination -->

    </div>
</div>
</ng-container>

<!-- Advance search popup -->
<div bsModal #advanceSearchModel="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <daybook-advance-search-model #daybookAdvanceSearch [startDate]="daybookQueryRequest.from"
                [endDate]="daybookQueryRequest.to" (closeModelEvent)="closeAdvanceSearchPopup($event)">
            </daybook-advance-search-model>
        </div>
    </div>
</div>
<!-- ./Advance  search popup -->

<!-- export ladger popup -->
<div bsModal #exportDaybookModal="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <export-daybook (closeExportDaybookModal)="hideExportDaybookModal($event)"></export-daybook>
        </div>
    </div>
</div>
<!-- ./ export ladger popup -->
