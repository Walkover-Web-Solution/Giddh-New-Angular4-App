<hamburger-menu [pageHeading]="'Reports > Reverse Charge'"></hamburger-menu>
<div class="reverse-table-report">
    <div class="container-fluid">
        <div class="mr-t15 mr-b15 input-grp-date-range-picker d-flex">
            <div class="input-group">
                <div class="form-group linked-entities mr-r15" *ngIf="currentCompanyBranches?.length > 2">
                    <sh-select [options]="currentCompanyBranches" [(ngModel)]="currentBranch.uniqueName" [showClear]="false"
                        [ItemHeight]="33" width="100%" (selected)="handleBranchChange($event)" [isFilterEnabled]="true"
                        placeholder="Select Entity" [fixedValue]="currentBranch?.alias" class="entity-dropdown">
                        <ng-template #optionTemplate let-option="option">
                            <ng-container>
                                <a href="javascript:void(0)" class="list-item d-flex">
                                    <span class="entity-icon">
                                        <i class="icon-branch-icon pull-right" *ngIf="!option.isCompany" tooltip="Branch"></i>
                                        <i class="icon-company-profile pull-right" *ngIf="option.isCompany" tooltip="Company"></i>
                                    </span>
                                    <span class="entity-details">
                                        <div class="item giddh-limit single-line-clamp">{{ option.label || '-' }}</div>
                                        <div class="item-unique giddh-limit single-line-clamp">
                                            {{ option.name || '-' }}
                                        </div>
                                    </span>
                                </a>
                            </ng-container>
                        </ng-template>
                    </sh-select>
                </div>
                <div class="input-grp-date-range-picker d-flex">
                    <div class="custom-datepicker" (click)="showGiddhDatepicker($event)">
                        <i><img src="assets/images/custom-calender.svg"></i>
                        <input type="text" name="selectedDateRange" [value]="(selectedDateRangeUi) ? selectedDateRangeUi : ''" class="giddh-datepicker date-range-picker" />
                    </div>
                </div>
            </div>
            <div class="clear-filter width-100 align-items-baseline d-flex justify-content-end"
                *ngIf="checkIfFiltersApplied()">
                <button class="btn btn-filter" (click)="resetFilters()"><span class="icon-cross"></span> Clear
                    Filter</button>
            </div>
        </div>
        <div class="invoice-preview  table-responsive">
            <table class="table basic giddh-table on-mobile-view">
                <thead class="thead-background1">
                    <tr (clickOutside)="inlineSearch = null">
                        <th class="text-center" width="4%">#</th>
                        <th (click)="sortReverseChargeList('entryDate')">Entry Date <span
                                [ngClass]="{'sortingIcon icon-pointer': true, 'active-text-color' : reverseChargeReportGetRequest.sortBy === 'entryDate', 'icon-sort-asc': !reverseChargeReportGetRequest.sort || reverseChargeReportGetRequest.sortBy !== 'entryDate' || (reverseChargeReportGetRequest.sort === 'asc' && reverseChargeReportGetRequest.sortBy === 'entryDate'), 'icon-sort-dsc': (reverseChargeReportGetRequest.sort === 'desc' && reverseChargeReportGetRequest.sortBy === 'entryDate')}"></span>
                        </th>
                        <th width="13%" class="bd-rr bd-rb td-search-box">
                            <div [hidden]="inlineSearch == 'suppliersName'">
                                <span>Supplier's Name</span>
                                <i class="icon-search" (click)="focusOnColumnSearch('suppliersName');"></i>
                            </div>
                            <div class="input-container" [hidden]="inlineSearch !== 'suppliersName'">
                                <input type="text" placeholder="Suppliers Name" class="w100" #suppliersNameField
                                    name="suppliersName" (keypress)="columnSearch()" (keydown)="columnSearch()"
                                    [(ngModel)]="reverseChargeReportPostRequest.supplierName" />
                            </div>
                        </th>
                        <th width="15%">
                            Voucher Type
                            <div class="voucher-type-dropdown">
                                <div class="btn-group d-inline-block" dropdown container="body"
                                    placement="bottom right">
                                    <a href="javascript:void(0)" id="button-basic" dropdownToggle
                                        class="btn dropdown-toggle text-light-2" aria-controls="dropdown-alignment">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </a>
                                    <ul id="dropdown-alignment" *dropdownMenu class="dropdown-menu dropdown-menu-right"
                                        role="menu" aria-labelledby="button-alignment">
                                        <li role="menuitem"><a class="dropdown-item" href="javascript:;"
                                                (click)="changeVoucherType('Journal');">Journal</a></li>
                                        <li role="menuitem"><a class="dropdown-item" href="javascript:;"
                                                (click)="changeVoucherType('Purchase');">Purchase</a></li>
                                        <li role="menuitem"><a class="dropdown-item" href="javascript:;"
                                                (click)="changeVoucherType('Debit Note');">Debit Note</a></li>
                                    </ul>
                                </div>
                            </div>
                        </th>
                        <th width="13%" class="bd-rr bd-rb td-search-box">
                            <div [hidden]="inlineSearch == 'invoiceNumber'">
                                <span>Invoice No.</span>
                                <i class="icon-search" (click)="focusOnColumnSearch('invoiceNumber');"></i>
                            </div>
                            <div class="input-container" [hidden]="inlineSearch !== 'invoiceNumber'">
                                <input type="text" placeholder="Invoice No." class="w100" #invoiceNumberField
                                    name="invoiceNumber" (keypress)="columnSearch()" (keydown)="columnSearch()"
                                    [(ngModel)]="reverseChargeReportPostRequest.invoiceNumber" />
                            </div>
                        </th>
                        <th class="td-search-box" (click)="sortReverseChargeList('supplierInvoiceDate')">Supplier's
                            Invoice Date <span
                                [ngClass]="{'sortingIcon icon-pointer': true, 'active-text-color' : reverseChargeReportGetRequest.sortBy === 'supplierInvoiceDate', 'icon-sort-asc': !reverseChargeReportGetRequest.sort || reverseChargeReportGetRequest.sortBy !== 'supplierInvoiceDate' || (reverseChargeReportGetRequest.sort === 'asc' && reverseChargeReportGetRequest.sortBy === 'supplierInvoiceDate'), 'icon-sort-dsc': (reverseChargeReportGetRequest.sort === 'desc' && reverseChargeReportGetRequest.sortBy === 'supplierInvoiceDate')}"></span>
                        </th>
                        <th width="13%" class="bd-rr bd-rb td-search-box">
                            <div [hidden]="inlineSearch == 'supplierCountry'">
                                <span>Supplier's Country</span>
                                <i class="icon-search" (click)="focusOnColumnSearch('supplierCountry');"></i>
                            </div>
                            <div class="input-container" [hidden]="inlineSearch !== 'supplierCountry'">
                                <input type="text" placeholder="Supplier Country" class="w100" #supplierCountryField
                                    name="supplierCountry" (keypress)="columnSearch()" (keydown)="columnSearch()"
                                    [(ngModel)]="reverseChargeReportPostRequest.supplierCountry" />
                            </div>
                        </th>
                        <th (click)="sortReverseChargeList('taxableValue')">Taxable Value <span
                                [ngClass]="{'sortingIcon icon-pointer': true, 'active-text-color' : reverseChargeReportGetRequest.sortBy === 'taxableValue', 'icon-sort-asc': !reverseChargeReportGetRequest.sort || reverseChargeReportGetRequest.sortBy !== 'taxableValue' || (reverseChargeReportGetRequest.sort === 'asc' && reverseChargeReportGetRequest.sortBy === 'taxableValue'), 'icon-sort-dsc': (reverseChargeReportGetRequest.sort === 'desc' && reverseChargeReportGetRequest.sortBy === 'taxableValue')}"></span>
                        </th>
                        <th>Tax Rate</th>
                        <th (click)="sortReverseChargeList('taxAmount')">Tax Amount <span
                                [ngClass]="{'sortingIcon icon-pointer': true, 'active-text-color' : reverseChargeReportGetRequest.sortBy === 'taxAmount', 'icon-sort-asc': !reverseChargeReportGetRequest.sort || reverseChargeReportGetRequest.sortBy !== 'taxAmount' || (reverseChargeReportGetRequest.sort === 'asc' && reverseChargeReportGetRequest.sortBy === 'taxAmount'), 'icon-sort-dsc': (reverseChargeReportGetRequest.sort === 'desc' && reverseChargeReportGetRequest.sortBy === 'taxAmount')}"></span>
                        </th>
                    </tr>
                </thead>
                <tbody
                    *ngIf="reverseChargeReportResults && reverseChargeReportResults.items && reverseChargeReportResults.items.length > 0">
                    <tr *ngFor="let reverseCharge of reverseChargeReportResults.items; let i = index;">
                        <td data-title="#" class="text-center">
                            {{ ((reverseChargeReportGetRequest.page - 1) * paginationLimit) + (i + 1) }} </td>
                        <td data-title="Entry Date">{{ reverseCharge.entryDate }}</td>
                        <td data-title="Supplier's Name">{{ reverseCharge.supplierName }}</td>
                        <td data-title="Voucher Type">{{ reverseCharge.voucherType }}</td>
                        <td data-title="Invoice No.">
                            {{ (reverseCharge.invoiceNumber) ? reverseCharge.invoiceNumber : '-' }}</td>
                        <td data-title="Supplier's Invoice Date">
                            {{ (reverseCharge.supplierInvoiceDate) ? reverseCharge.supplierInvoiceDate : '-' }}</td>
                        <td data-title="Supplier's Country">{{ reverseCharge.suppliersCountry }}</td>
                        <td data-title="Taxable Value">{{activeCompany.baseCurrencySymbol}}
                            {{ reverseCharge.taxableValue | giddhCurrency }}</td>
                        <td data-title="Tax Rate">{{ reverseCharge.taxRate }}%</td>
                        <td data-title="Tax Amount">{{activeCompany.baseCurrencySymbol}}
                            {{ reverseCharge.taxAmount | giddhCurrency }}</td>
                    </tr>
                </tbody>
                <tbody
                    *ngIf="!reverseChargeReportResults || !reverseChargeReportResults.items || reverseChargeReportResults.items.length === 0">
                    <tr>
                        <td *ngIf="!isLoading" colspan="10" align="center">No records found.</td>
                        <td *ngIf="isLoading" colspan="10">&nbsp;</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="pagination-wrapper" *ngIf="reverseChargeReportResults.totalPages > 1">
            <pagination [totalItems]="reverseChargeReportResults.totalItems"
                [(ngModel)]="reverseChargeReportResults.page" [maxSize]="6" class="pagination-sm" [boundaryLinks]="true"
                [itemsPerPage]="paginationLimit" [rotate]="false" (pageChanged)="pageChanged($event)"></pagination>
        </div>
    </div>
    <div class="mt-5 invoice-footer">
        <div class="col-lg-6 col-md-12 col-sm-12 col-12 d-flex total-due-sale-wrap pl-0">
            <div class="col-sm-6 total-due-sale pl-0">
                <h3>Total Taxable Value: </h3>
                <h1>{{activeCompany?.baseCurrencySymbol}}
                    {{reverseChargeReportResults?.totalTaxableValue | giddhCurrency }}<span>/-</span></h1>
            </div>
            <div class="col-sm-6 total-due-sale">
                <h3>Total Tax Amount:</h3>
                <h1>{{activeCompany?.baseCurrencySymbol}} {{reverseChargeReportResults?.totalTaxAmount | giddhCurrency}}<span>/-</span>
                </h1>
            </div>
        </div>
    </div>
</div>
<ng-template #datepickerTemplate>
    <div class="datepicker-modal">
        <div class="modal-body">
            <app-datepicker-wrapper [inputStartDate]="selectedDateRange?.startDate" [inputEndDate]="selectedDateRange?.endDate" [alwaysShowCalendars]="true" [ranges]="datePickerOption" [selectedRangeLabel]="selectedRangeLabel" [showCustomRangeLabel]="true" [showClearButton]="false"
                                    [showCancel]="true" [linkedCalendars]="true" [showDropdowns]="true" [locale]="{applyLabel: 'Done'}" (rangeClicked)="dateSelectedCallback($event)" (datesUpdated)="dateSelectedCallback($event)" [keepCalendarOpeningWithRange]="false" [showRangeLabelOnInput]="false"
                                    [dateFieldPosition]="dateFieldPosition"></app-datepicker-wrapper>
        </div>
    </div>
</ng-template>
