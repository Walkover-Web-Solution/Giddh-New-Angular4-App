<div class="add-company-wrapper">
    <ng-container
        appTranslate
        [file]="'create-company'"
        (localeData)="localeData = $event"
        (commonLocaleData)="commonLocaleData = $event"
    >
        <hamburger-menu></hamburger-menu>
        <div>
            <p class="text-center p-3">{{ localeData?.create_company_note }}</p>
        </div>
        <mat-stepper
            linear
            #stepper
            [formGroup]="companyForm"
            name="companyForm"
            [selectedIndex]="selectedStep"
            (selectionChange)="onSelectedTab($event)"
            [disableRipple]="firstStepForm.invalid"
        >
            <mat-step [stepControl]="firstStepForm">
                <form [formGroup]="firstStepForm" name="firstStepForm" autocomplete="off" novalidate>
                    <ng-template matStepLabel>{{ commonLocaleData?.app_company_name }}</ng-template>
                    <div class="row row-gap">
                        <div class="col-lg-12">
                            <input-field
                                [name]="'name'"
                                [label]="commonLocaleData?.app_company_name + '*'"
                                [placeholder]="localeData?.enter_company_name"
                                [type]="'text'"
                                formControlName="name"
                                [showError]="isFormSubmitted && !firstStepForm.get('name')?.value"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-6 country-space">
                            <dropdown-field
                                [name]="'country'"
                                [label]="commonLocaleData?.app_country + '*'"
                                [placeholder]="localeData?.enter_country_name"
                                [options]="countries"
                                (selectedOption)="selectCountry($event)"
                                [showError]="isFormSubmitted && !firstStepForm.get('country')?.value"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-6 currency-space">
                            <dropdown-field
                                [name]="'currency'"
                                [label]="commonLocaleData?.app_currency + '*'"
                                [placeholder]="localeData?.enter_currency_name"
                                [options]="currencies"
                                [showError]="isFormSubmitted && !firstStepForm.get('currency')?.value"
                                [defaultValue]="company.baseCurrency"
                                (selectedOption)="selectCurrency($event)"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12 mobile-number mobile-number-wrapper pb-3 pt-1">
                            <input-field
                                [name]="'mobile'"
                                [type]="'tel'"
                                #mobileNo
                                [id]="'init-contact-proforma'"
                                (keydown.enter)="$event.preventDefault()"
                                [label]="commonLocaleData?.app_mobile_number + '*'"
                                [placeholder]="localeData?.enter_mobile_number"
                                [floatLabel]="intl?.getNumber() ? 'always' : 'auto'"
                                (onChange)="firstStepForm.controls['mobile'].setValue(intl?.getNumber())"
                                [showError]="
                                    (isFormSubmitted && !firstStepForm.get('mobile')?.value) || isMobileNumberInvalid
                                "
                            >
                            </input-field>
                            <span id="init-contact-proforma-valid-msg" class="d-none"></span>
                            <span id="init-contact-proforma-error-msg" class="d-none"></span>
                        </div>
                    </div>
                    <div>
                        <button mat-stroked-button color="primary" (click)="nextStepForm()">
                            {{ commonLocaleData?.app_next }}
                        </button>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="secondStepForm" name="secondStepForm">
                <form [formGroup]="secondStepForm" autocomplete="off" novalidate>
                    <ng-template matStepLabel>{{ localeData?.company_address }}</ng-template>
                    <div class="row row-gap">
                        <div class="col-lg-12 fill-form">
                            <input-field
                                [placeholder]="firstStepForm.get('name')?.value"
                                [label]="commonLocaleData?.app_company_name + '*'"
                                [type]="'text'"
                                [readonly]="true"
                                [floatLabel]="'always'"
                                [ngClass]="{ 'readonly-field-color': firstStepForm.get('name')?.value }"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-6 country-space">
                            <dropdown-field
                                [readonly]="true"
                                [label]="commonLocaleData?.app_country + '*'"
                                [defaultValue]="firstStepForm.get('country')?.value?.label"
                                [ngClass]="{ 'readonly-field-color': firstStepForm.get('country')?.value?.label }"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-6 currency-space">
                            <dropdown-field
                                [readonly]="true"
                                [label]="commonLocaleData?.app_currency + '*'"
                                [defaultValue]="firstStepForm.get('currency')?.value?.value"
                                [ngClass]="{ 'readonly-field-color': firstStepForm.get('currency')?.value?.value }"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12 mobile-number fill-form">
                            <img
                                class="country-flag"
                                *ngIf="currentFlag"
                                src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@master/svg/{{
                                    currentFlag
                                }}.svg"
                                width="27"
                            />
                            <input-field
                                [name]="'mobile'"
                                [type]="'tel'"
                                [label]="commonLocaleData?.app_mobile_number + '*'"
                                [placeholder]="firstStepForm.controls['mobile'].value"
                                [floatLabel]="'always'"
                                [readonly]="true"
                                [ngClass]="{ 'readonly-field-color': firstStepForm.get('mobile')?.value }"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-12">
                            <dropdown-field
                                [name]="'businessType'"
                                [label]="localeData?.business_type"
                                [placeholder]="localeData?.select_business_type"
                                [options]="businessTypeList"
                                (selectedOption)="selectBusinessType($event)"
                                [defaultValue]="isOtherCountry ? businessTypeList[0].label : ''"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12">
                            <dropdown-field
                                [name]="'businessNature'"
                                [label]="localeData?.business_nature"
                                [placeholder]="localeData?.select_business_nature"
                                [options]="businessNatureList"
                                (selectedOption)="selectBusinessNature($event)"
                            >
                            </dropdown-field>
                        </div>
                        <ng-container
                            *ngIf="secondStepForm.controls['businessType']?.value === businessTypes.Registered"
                        >
                            <div class="col-lg-12">
                                <input-field
                                    [name]="'gstin'"
                                    [placeholder]="getEnterTaxText()"
                                    [type]="'text'"
                                    formControlName="gstin"
                                    [showError]="
                                        isFormSubmitted && (!secondStepForm.get('gstin')?.value || !isGstinValid)
                                    "
                                    [label]="formFields['taxName']?.label + '*'"
                                    [maxlength]="15"
                                    (change)="validateGstNumber($event)"
                                >
                                </input-field>
                            </div>
                        </ng-container>
                        <div class="col-lg-12" *ngIf="!countyList?.length">
                            <dropdown-field
                                [name]="'state'"
                                [label]="
                                    secondStepForm.controls['businessType']?.value === businessTypes.Registered
                                        ? commonLocaleData?.app_state + '*'
                                        : commonLocaleData?.app_state
                                "
                                [placeholder]="localeData?.select_state"
                                [options]="states"
                                [showError]="isFormSubmitted && !secondStepForm.get('state')?.value"
                                [readonly]="disabledState"
                                [defaultValue]="selectedState"
                                (selectedOption)="selectState($event)"
                                [ngClass]="{ 'readonly-field': disabledState }"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12" *ngIf="countyList?.length">
                            <dropdown-field
                                [name]="'county'"
                                [label]="
                                    secondStepForm.controls['businessType']?.value === businessTypes.Registered
                                        ? commonLocaleData?.app_region + '*'
                                        : commonLocaleData?.app_region
                                "
                                [placeholder]="commonLocaleData?.app_select_region"
                                [options]="countyList"
                                [showError]="isFormSubmitted && !secondStepForm.get('county')?.value"
                                [defaultValue]="secondStepForm.get('county')?.value?.label"
                                (selectedOption)="secondStepForm.get('county')?.patchValue($event)"
                            >
                            </dropdown-field>
                        </div>
                        <ng-container
                            *ngIf="secondStepForm.controls['businessType']?.value === businessTypes.Registered"
                        >
                            <div class="col-lg-12">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>{{ localeData?.applicable_tax }}</mat-label>
                                    <mat-select
                                        [placeholder]="commonLocaleData?.app_select_tax"
                                        [formControlName]="'taxes'"
                                        multiple
                                    >
                                        <mat-option *ngFor="let tax of taxesList" [value]="tax?.value">{{
                                            tax?.label
                                        }}</mat-option>
                                        <mat-option
                                            class="create-update-no-data"
                                            [disabled]="true"
                                            *ngIf="!taxesList?.length"
                                            >{{ commonLocaleData?.app_no_result_found }}</mat-option
                                        >
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </ng-container>
                        <div class="col-lg-12">
                            <input-field
                                [name]="'pincode'"
                                [label]="commonLocaleData?.app_pin_code"
                                [placeholder]="commonLocaleData?.app_enter_pin_code"
                                [type]="'text'"
                                formControlName="pincode"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-12">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>{{
                                    secondStepForm.controls["businessType"]?.value === businessTypes.Registered
                                        ? localeData?.company_address + "*"
                                        : localeData?.company_address
                                }}</mat-label>
                                <textarea
                                    matInput
                                    rows="3"
                                    [name]="'address'"
                                    formControlName="address"
                                    [placeholder]="localeData?.type_your_address"
                                    [required]="
                                        isFormSubmitted &&
                                        secondStepForm.controls['businessType']?.value === businessTypes.Registered &&
                                        !secondStepForm.get('address')?.value
                                            ? 'true'
                                            : 'false'
                                    "
                                ></textarea>
                            </mat-form-field>
                        </div>
                        <div class="col-lg-12">
                            <p class="pb-2">{{ localeData?.onboarding_note }}</p>
                            <p
                                class="taxation-not-supported"
                                [innerHTML]="localeData?.tax_reports_note"
                                *ngIf="isOtherCountry"
                            ></p>
                        </div>
                    </div>
                    <div class="pt-2">
                        <button mat-stroked-button matStepperPrevious class="mr-3" (click)="selectedStep = 0">
                            {{ commonLocaleData?.app_back }}
                        </button>
                        <button mat-stroked-button color="primary" (click)="onSubmit()">
                            {{ commonLocaleData?.app_submit }}
                        </button>
                    </div>
                </form>
            </mat-step>
        </mat-stepper>
    </ng-container>
</div>
