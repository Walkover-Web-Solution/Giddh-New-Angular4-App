<div class="add-company-wrapper">
    <ng-container
        appTranslate
        [file]="'create-company'"
        (localeData)="localeData = $event"
        (commonLocaleData)="commonLocaleData = $event"
    >
        <div>
            <p class="text-center p-3">Enter your company information to start hassle free accounting with Giddh.</p>
        </div>
        <mat-stepper linear #stepper [formGroup]="companyForm" name="companyForm" autocomplete="off" novalidate>
            <mat-step [stepControl]="firstStepForm">
                <form [formGroup]="firstStepForm" name="firstStepForm" autocomplete="off" novalidate>
                    <ng-template matStepLabel>Company Name</ng-template>
                    <div class="row row-gap">
                        <div class="col-lg-12">
                            <input-field
                                [name]="'name'"
                                [placeholder]="'Company Name'"
                                [type]="'text'"
                                formControlName="name"
                                [showError]="isFormSubmitted && !firstStepForm.get('name')?.value"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-6 currency-space">
                            <dropdown-field
                                [name]="'country'"
                                [placeholder]="'Country'"
                                [options]="countries"
                                (selectedOption)="selectCountry($event)"
                                [showError]="isFormSubmitted && !firstStepForm.get('country')?.value"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-6 country-space">
                            <dropdown-field
                                [name]="'currency'"
                                [placeholder]="'Currency'"
                                [options]="currencies"
                                [showError]="isFormSubmitted && !firstStepForm.get('currency')?.value"
                                [defaultValue]="firstStepForm.get('currency')?.value?.value"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12 mobile-number pb-3 pt-1">
                            <input-field
                                [name]="'mobile'"
                                [type]="'tel'"
                                #mobileNo
                                [id]="'init-contact-proforma'"
                                (keydown.enter)="$event.preventDefault()"
                                [label]="commonLocaleData?.app_mobile_number"
                                [placeholder]="'98XXXXXXXX'"
                                [floatLabel]="intl?.getNumber() ? 'always' : 'auto'"
                                (onChange)="firstStepForm.controls['mobile'].setValue(intl?.getNumber())"
                                [showError]="
                                    isFormSubmitted && !firstStepForm.get('mobile')?.value && isMobileNumberInvalid
                                "
                            >
                            </input-field>
                            <span id="init-contact-proforma-valid-msg" class="d-none"></span>
                            <span id="init-contact-proforma-error-msg" class="d-none"></span>
                        </div>
                    </div>
                    <div>
                        <button mat-stroked-button color="primary" matStepperNext (click)="nextStepForm()">Next</button>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="secondStepForm" name="secondStepForm" autocomplete="off" novalidate>
                <form [formGroup]="secondStepForm">
                    <ng-template matStepLabel>Company Address</ng-template>
                    <div class="row row-gap">
                        <div class="col-lg-12">
                            <input-field
                                [placeholder]="firstStepForm.get('name')?.value"
                                [label]="'Company Name'"
                                [type]="'text'"
                                [readonly]="true"
                                [floatLabel]="'always'"
                                [required]="true"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-6 country-space">
                            <dropdown-field
                                [appearance]="'fill'"
                                [readonly]="true"
                                [label]="'Country'"
                                [defaultValue]="firstStepForm.get('country')?.value.label"
                                [required]="true"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-6 currency-space">
                            <dropdown-field
                                [appearance]="'fill'"
                                [readonly]="true"
                                [label]="'Currency'"
                                [defaultValue]="firstStepForm.get('currency')?.value.value"
                                [required]="true"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12 mobile-number">
                            <img
                                class="country-flag"
                                *ngIf="firstStepForm.get('country')?.value.value"
                                src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags@master/svg/{{
                                    firstStepForm.get('country')?.value.value?.toLowerCase()
                                }}.svg"
                                width="27"
                            />
                            <input-field
                                [name]="'mobile'"
                                [type]="'tel'"
                                [label]="'Mobile Number'"
                                [placeholder]="firstStepForm.controls['mobile'].value"
                                [floatLabel]="'always'"
                                [readonly]="true"
                                [required]="true"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-12">
                            <dropdown-field
                                [name]="'businessType'"
                                [placeholder]="'Select Business Type'"
                                [options]="businessTypeList"
                                (selectedOption)="selectBusinessType($event)"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12" *ngIf="!isWarehouse">
                            <dropdown-field
                                [name]="'bussinessNature'"
                                [placeholder]="'Select Business Nature'"
                                [options]="businessNatureList"
                                (selectedOption)="selectBusinessNature($event)"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12" *ngIf="secondStepForm.controls['businessType']?.value === 'Registered'">
                            {{ isGstinValid }}
                            <input-field
                                [name]="'gstin'"
                                [placeholder]="'GSTIN'"
                                [type]="'text'"
                                formControlName="gstin"
                                [showError]="isGstinValid && !secondStepForm.get('gstin')?.value"
                                [required]="true"
                                [label]="formFields['taxName']?.label"
                                [maxlength]="15"
                            >
                            </input-field>
                        </div>
                        <div class="col-lg-12" *ngIf="secondStepForm.controls['businessType']?.value === 'Registered'">
                            <dropdown-field
                                [appearance]="'fill'"
                                [name]="'state'"
                                [placeholder]="'State'"
                                [options]="states"
                                [showError]="isFormSubmitted && !secondStepForm.get('state')?.value"
                                [required]="true"
                                [readonly]="isGstinValid"
                                [label]="isGstinValid ? 'State' : ''"
                                [defaultValue]="selectedState"
                            >
                            </dropdown-field>
                        </div>
                        <div class="col-lg-12" *ngIf="secondStepForm.controls['businessType']?.value === 'Registered'">
                            <mat-form-field class="w-100" appearance="outline">
                                <mat-label>Applicable Tax</mat-label>
                                <mat-select
                                    [placeholder]="commonLocaleData?.app_select_tax"
                                    [formControlName]="'taxes'"
                                    multiple
                                >
                                    <mat-option *ngFor="let tax of taxesList" [value]="tax?.value">{{
                                        tax?.label
                                    }}</mat-option>
                                    <mat-option
                                        class="create-update-no-data"
                                        [disabled]="true"
                                        *ngIf="!taxesList?.length"
                                        >{{ commonLocaleData?.app_no_result_found }}</mat-option
                                    >
                                </mat-select>
                                <!-- <mat-select
                                    name="taxes"
                                    [placeholder]="commonLocaleData?.app_select_tax"
                                    formControlName="taxes"
                                    multiple
                                    [value]="selectedTaxes"
                                >
                                    <mat-option
                                        *ngFor="let tax of taxesList"
                                        [value]="tax?.value"
                                        (onSelectionChange)="selectTax($event, tax)"
                                        >{{ tax.label }}</mat-option
                                    >
                                    <mat-option
                                        class="create-update-no-data"
                                        [disabled]="true"
                                        *ngIf="!taxesList?.length"
                                        >{{ commonLocaleData?.app_no_result_found }}</mat-option
                                    >
                                </mat-select> -->
                                <!-- <mat-select
                                    [value]="selectedTaxes"
                                    name="tax"
                                    formControlName="tax"
                                    [placeholder]="'Applicable Tax'"
                                      (selectionChange)="selectTax($event?.value)"
                                    multiple
                                >
                                    <div class="select-quantity-option">
                                        <mat-option *ngFor="let tax of taxesList" [value]="tax?.value">
                                            {{ tax?.label }}
                                        </mat-option>
                                    </div>
                                </mat-select> -->
                            </mat-form-field>
                        </div>
                        <div
                            class="col-lg-12"
                            *ngIf="
                                secondStepForm.controls['businessType']?.value === 'Unregistered' ||
                                secondStepForm.controls['businessType']?.value === 'Registered'
                            "
                        >
                            <input-field
                                [name]="'pincode'"
                                [placeholder]="'PIN Code'"
                                [type]="'text'"
                                formControlName="pincode"
                            >
                            </input-field>
                        </div>
                        <div
                            class="col-lg-12"
                            *ngIf="
                                secondStepForm.controls['businessType']?.value === 'Unregistered' ||
                                secondStepForm.controls['businessType']?.value === 'Registered'
                            "
                        >
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Company Address</mat-label>
                                <textarea matInput rows="3" [name]="'address'" formControlName="address"></textarea>
                            </mat-form-field>
                        </div>
                        <div class="col-lg-12">
                            <p class="pb-4">Note: You can always change your preferences later in Settings.</p>
                            <p>
                                Create and apply taxes on all types of transactions! To get tax reports, contact
                                <a href="mailto:sales@giddh.com">sales@giddh.com</a> !
                            </p>
                        </div>
                    </div>
                    <div class="pt-4">
                        <button mat-stroked-button matStepperPrevious class="mr-3">Back</button>
                        <button mat-stroked-button color="primary" (click)="onSubmit()">Submit</button>
                    </div>
                </form>
            </mat-step>
        </mat-stepper>
    </ng-container>
</div>
