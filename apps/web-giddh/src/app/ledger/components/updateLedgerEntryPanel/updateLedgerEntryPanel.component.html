<div id="entryModal">

    <!-- region header -->
    <div class="modal-header" *ngIf="!isPettyCash">
        <span aria-hidden="true" class="close hover-orange" data-dismiss="modal" (click)="closeUpdateLedgerModal.emit()"
            aria-label="Close">×</span>

        <h3 *ngIf="!openDropDown" (dblclick)="openHeaderDropDown()" class="d-inline-block mr-1">
            {{(baseAccount$ | async)?.name}} A/c</h3>

        <sh-select id="update-ledger-select-account" *ngIf="openDropDown" class="d-inline-block" [disabled]="false" placeholder="Select Group"
            filterPlaceholder="Type to filter.." name="accountUniqueName" [(ngModel)]="baseAccountName$"
            [useInBuiltFilterForFlattenAc]="true" [showClear]="false" [options]="vm.flatternAccountList4BaseAccount"
            style="width:30%">
            <ng-template #optionTemplate let-option="option">
                <ng-container *ngIf="!option.additional?.stock">
                    <a href="javascript:void(0)" (click)="changeBaseAccount(option)"
                        style="border-bottom: 1px solid #ccc;">
                        <div class="item">{{option?.label}}</div>
                        <div class="item_unq fs12">{{option.additional?.uniqueName}}</div>
                    </a>
                </ng-container>
                <ng-container *ngIf="option.additional?.stock">
                    <a href="javascript:void(0)" (click)="changeBaseAccount(option)"
                        style="border-bottom: 1px solid #ccc;">
                        <div class="item">{{option?.label}}</div>
                        <div class="item_unq fs12">{{option.additional?.uniqueName}}</div>
                        <div class="item_stock">Stock: {{option.additional?.stock.name}}</div>
                    </a>
                </ng-container>
            </ng-template>
        </sh-select>
    </div>
    <!-- endregion -->

    <!-- region main body -->
    <div class="modal-body" [hidden]="isChangeAcc">

        <!-- region transactions -->
        <div class="ledg-head entry-popup">

            <table class="col-xs-12 ledger-head mrT1 hidden-xs">
                <thead>
                    <tr>
                        <th [ngClass]="Shown ? 'active' : ''" class="col-xs-6 hidden-xs">

                            {{vm.ledgerUnderStandingObj.text.dr}}
                            <span class="dr-cr-category pull-right text-gray">Dr</span>
                        </th>
                        <th class="col-xs-6 hidden-xs">{{vm.ledgerUnderStandingObj.text.cr}}
                            <span class="dr-cr-category pull-right text-gray">Cr</span>
                        </th>
                    </tr>
                </thead>
            </table>

            <div class="custom-tabs mb-2">
                <ul class="nav nav-tabs pt-0">
                    <li role="presentation" [className]="condition ? 'active' : ''">
                        <a href="javascript:void(0)" (click)="toggleShow()">Debit</a>
                    </li>
                    <li role="presentation" [className]="condition2 ? 'active' : ''">
                        <a href="javascript:void(0)" (click)="toggleShow()">Credit</a>
                    </li>
                </ul>
            </div>

            <div class="ledger-book">
                <!-- region debit transaction -->
                <div class="left-col-new bdrR" [ngClass]="Shown ? 'active' : ''">

                    <!-- region debit transaction header -->
                    <table class="width100 card-table">

                        <thead class="hidden-xs">
                            <tr class="t-h-bg1">

                                <th class="col-xs-2" style="border-top:none">
                                    <span class="cursor-pointer">
                                        Date
                                    </span>
                                </th>
                                <th class="col-xs-6" style="border-top:none">Particular</th>

                                <th class="col-xs-2 text-right" style="border-top:none">
                                    Amount
                                </th>
                            </tr>
                        </thead>

                        <tbody class="ledger-main">
                            <tr class="debit-blank-row"
                                *ngFor="let txn of vm.selectedLedger.transactions; let i = index; ">
                                <ng-container *ngIf="txn.type === 'DEBIT'">

                                    <td class="col-xs-2" data-title="Date">
                                        <input id="giddh-datepicker" type="text" autocomplete="off" name="datess" #dbs='bsDatepicker'
                                            [(ngModel)]="vm.selectedLedger.entryDate" class="form-control" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            (click)="addBlankTrx('DEBIT', txn, $event)" placeholder="date"
                                            (ngModelChange)="getInvoiceListsForCreditNote()">
                                    </td>

                                    <td data-title="Particular" id="DbtTd"
                                        [ngClass]="{ 'otherAccountEntry': txn.particular.uniqueName === 'others' }"
                                        class="col-xs-6 pos-rel select2-parent select2-ledger">


                                        <ng-template [ngIf]="!txn.isDiscount">
                                            <div class="d-flex update-ledger-account">
                                                <span *ngIf="(
                                                        (!dbtSelect.isOpen && txn.particular.uniqueName) ||
                                                        (dbtSelect.isOpen && dbtSelect.filter))">To</span>
                                                <sh-select id="dbtID" [notFoundLink]="true"
                                                    (noResultsClicked)="showQuickAccountModal()"
                                                    (keydown)="keydownPressed($event)"
                                                    [options]="vm.flatternAccountList4Select | async" #dbtSelect
                                                    (click)="addBlankTrx('DEBIT', txn, $event)"
                                                    (selected)="selectAccount($event,txn, dbtSelect)"
                                                    [showClear]="false" [(ngModel)]="txn.particular.uniqueName"
                                                    [ItemHeight]="67" (onShow)="dbs.hide()"
                                                    [useInBuiltFilterForFlattenAc]="true"
                                                    [fixedValue]="txn.particular.name"
                                                    [defaultValue]="txn.particular.name"
                                                    [placeholder]="'To Select Accounts'">

                                                    <ng-template #optionTemplate let-option="option">

                                                        <ng-container *ngIf="!option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item"
                                                                style="border-bottom: 1px solid #ccc;">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item_unq">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                            </a>
                                                        </ng-container>

                                                        <ng-container *ngIf="option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item"
                                                                style="border-bottom: 1px solid #ccc;">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item_unq">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                                <div class="item_stock">
                                                                    Stock: {{ option.additional?.stock.name }}</div>
                                                            </a>
                                                        </ng-container>

                                                    </ng-template>

                                                    <ng-template #notFoundLinkTemplate>

                                                        <a id="createNewId" [ngClass]="{'active': keydownClassAdded}"
                                                            class="notfound-option" [keyboardShortcut]="'alt+c'"
                                                            (onShortcutPress)="toggleAsidePaneOpen()">
                                                            <span [ngClass]="{'active': keydownClassAdded}">Create
                                                                New</span>
                                                            <span [ngClass]="{'active': keydownClassAdded}"
                                                                class="pull-right">Alt+C</span>
                                                        </a>
                                                    </ng-template>

                                                </sh-select>
                                            </div>
                                        </ng-template>

                                        <ng-template [ngIf]="txn.isDiscount">
                                            To
                                            <input [disabled]="true" [(ngModel)]="txn.particular.name"
                                                class="trxFakeInput" />
                                        </ng-template>

                                        <span class="download-invoice-ledger"
                                            *ngIf="vm.selectedLedger.attachedFile && vm.selectedLedger.attachedFile.length > 0 && (txn?.particular?.name || txn?.particular?.uniqueName)"
                                            (click)="downloadAttachedFile(vm.selectedLedger.attachedFile, $event)"
                                            [placement]="'left'" [containerClass]="'col-xs-3'"
                                            tooltip="Download file : {{vm.selectedLedger.attachedFileName}}">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>

                                        <span class="download-invoice-ledger "
                                            *ngIf="vm.selectedLedger.voucherNumber && vm.selectedLedger.voucherNumber.length> 0 && (txn?.particular?.name || txn?.particular?.uniqueName)"
                                            [placement]="'left'" [containerClass]="'col-xs-3'"
                                            tooltip="Download {{vm.selectedLedger.voucherGeneratedType === 'sales' ? 'Invoice': 'Voucher'}} : {{vm.selectedLedger.voucherNumber}}"
                                            (click)="downloadInvoice(vm.selectedLedger.voucherNumber, vm.selectedLedger.voucherGeneratedType ? vm.selectedLedger.voucherGeneratedType : vm.selectedLedger.voucher.name, $event)">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>

                                    </td>

                                    <td class="col-xs-2 text-right" data-title="Amount">

                                        <input id="update-ledger-amount" type="text" [(ngModel)]="txn.amount" class="form-control text-right"
                                            name="{{txn[i]}}.amount" [mask]="vm.inputMaskFormat"
                                            [rawInputValue]="txn.amount" [prefix]="vm.selectedPrefixForCurrency"
                                            [suffix]="vm.selectedSuffixForCurrency"
                                            (click)="addBlankTrx('DEBIT', txn, $event)" (blur)="onTxnAmountChange(txn)">

                                        <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                            <ng-container
                                                *ngTemplateOutlet="totalWithCurrencySymbol;context:{ $implicit: txn.convertedAmount }">
                                            </ng-container>
                                        </p>

                                    </td>

                                </ng-container>

                            </tr>
                        </tbody>
                    </table>
                    <!-- endregion -->

                    <!-- region debit transaction footer -->
                    <table class="ledger-footer-1">

                        <tbody>
                            <tr class="total_col">

                                <td colspan="12" class="col-xs-12 text-right h32">
                                    <span *ngIf="vm.entryTotal.crTotal > vm.entryTotal.drTotal" class="pd2"
                                        [tooltip]="vm.ledgerUnderStandingObj.balanceText.cr" [placement]="'top'">
                                        C/F: CR {{ vm.baseCurrencyDetails.symbol}} {{ vm.compoundTotal | giddhCurrency}}
                                    </span>
                                </td>

                            </tr>

                            <tr class="total_col">
                                <!-- reckoning -->
                                <td colspan="12" class="col-xs-12 text-right h32">

                                    <span class="bdrT pr-1 pl-1 width-200">
                                        {{ vm.baseCurrencyDetails?.symbol}} {{ (vm.entryTotal.drTotal > vm.entryTotal.crTotal ? vm.entryTotal.drTotal : vm.entryTotal.crTotal)
                                        | giddhCurrency}}
                                    </span>

                                    <p class="mb-0 amnt-total pr-1" *ngIf="vm.isMultiCurrencyAvailable">
                                        <ng-container *ngTemplateOutlet="totalWithCurrencySymbol;context: {
                      $implicit: (vm.convertedEntryTotal.drTotal > vm.convertedEntryTotal.crTotal ? vm.convertedEntryTotal.drTotal : vm.convertedEntryTotal.crTotal)
                    }"></ng-container>
                                    </p>

                                </td>
                            </tr>

                        </tbody>

                    </table>
                    <!-- endregion -->

                </div>
                <!-- endregion -->

                <!-- region credit transaction-->
                <div class="right-col-new" [ngClass]="isHide ? 'active' : 'right-col-new'">

                    <!-- region credit transaction header -->
                    <table class="width100 card-table">
                        <thead class="xs-hidden">
                            <tr class="t-h-bg1">
                                <th class="col-xs-2" style="border-top:none">
                                    <span class="cursor-pointer">
                                        Date
                                    </span>

                                </th>
                                <th class="col-xs-6" style="border-top:none">Particular</th>
                                <th class="col-xs-2 text-right" style="border-top:none">Amount</th>
                            </tr>
                        </thead>

                        <tbody class="ledger-main">

                            <tr *ngFor="let txn of vm.selectedLedger.transactions;" class="credit-blank-row">
                                <ng-container *ngIf="txn.type == 'CREDIT'">

                                    <td data-title="Date" class="col-xs-2">
                                        <input id="giddh-datepicker" class="form-control" autocomplete="off" name="datepic" type="text"
                                            [(ngModel)]="vm.selectedLedger.entryDate"
                                            (click)="addBlankTrx('CREDIT', txn, $event)" #cbs='bsDatepicker'
                                            bsDatepicker [bsConfig]="{ dateInputFormat: giddhDateFormat }">
                                    </td>

                                    <td data-title="Particular" id="crdIDTd"
                                        class="pos-rel col-xs-6 select2-parent select2-ledger"
                                        [ngClass]="{ otherAccountEntry: txn.particular.uniqueName === 'others' }">

                                        <ng-template [ngIf]="!txn?.isDiscount">
                                            <div class="d-flex update-ledger-account">
                                                <span *ngIf="(
                                                        (!crdSelect.isOpen && txn.particular.uniqueName) ||
                                                        (crdSelect.isOpen && crdSelect.filter))">By</span>
                                                <sh-select id="crdID" [notFoundLink]="true"
                                                    (noResultsClicked)="showQuickAccountModal()"
                                                    (keydown)="keydownPressed($event)"
                                                    [options]="vm.flatternAccountList4Select | async" #crdSelect
                                                    (click)="addBlankTrx('CREDIT', txn, $event)"
                                                    (selected)="selectAccount($event,txn, crdSelect)"
                                                    (onShow)="cbs.hide()" [showClear]="false"
                                                    [(ngModel)]="txn.particular.uniqueName" [ItemHeight]="67"
                                                    [useInBuiltFilterForFlattenAc]="true"
                                                    [defaultValue]="txn.particular.name"
                                                    [fixedValue]="txn.particular.name"
                                                    [placeholder]="'By Select Accounts'">

                                                    <ng-template #optionTemplate let-option="option">
                                                        <ng-container *ngIf="!option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item"
                                                                style="border-bottom: 1px solid #ccc;">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item_unq">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                            </a>
                                                        </ng-container>

                                                        <ng-container *ngIf="option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item"
                                                                style="border-bottom: 1px solid #ccc;">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item_unq">
                                                                    {{ option.additional?.uniqueName }}
                                                                </div>
                                                                <div class="item_stock">
                                                                    Stock: {{ option.additional?.stock.name }}</div>
                                                            </a>
                                                        </ng-container>

                                                    </ng-template>

                                                    <ng-template #notFoundLinkTemplate>
                                                        <a id="createNewId2" [ngClass]="{'active': keydownClassAdded}"
                                                            class="notfound-option" [keyboardShortcut]="'alt+c'"
                                                            (onShortcutPress)="toggleAsidePaneOpen()">
                                                            <span [ngClass]="{'active': keydownClassAdded}">Create
                                                                New</span>
                                                            <span [ngClass]="{'active': keydownClassAdded}"
                                                                class="pull-right">Alt+C</span>
                                                        </a>
                                                    </ng-template>
                                                </sh-select>
                                            </div>
                                        </ng-template>

                                        <ng-template [ngIf]="txn?.isDiscount">
                                            <input id="update-ledger-discount" [disabled]="true" [(ngModel)]="txn.particular.name"
                                                class="trxFakeInput" />
                                        </ng-template>

                                        <span class="download-invoice-ledger"
                                            *ngIf="vm.selectedLedger.attachedFile.length > 0 && (txn?.particular?.name || txn?.particular?.uniqueName)"
                                            [placement]="'left'" [containerClass]="'col-xs-3'"
                                            tooltip="Download file : {{vm.selectedLedger.attachedFileName}}"
                                            (click)="downloadAttachedFile(vm.selectedLedger.attachedFile, $event)">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>

                                        <span class="download-invoice-ledger"
                                            *ngIf="vm.selectedLedger.voucherNumber && vm.selectedLedger.voucherNumber.length > 0 && (txn?.particular?.name || txn?.particular?.uniqueName)"
                                            [placement]="'left'" [containerClass]="'col-xs-3'"
                                            tooltip="Download {{vm.selectedLedger.voucherGeneratedType === 'sales' ? 'Invoice': 'Voucher'}} : {{vm.selectedLedger.voucherNumber}}"
                                            (click)="downloadInvoice(vm.selectedLedger.voucherNumber, vm.selectedLedger.voucherGeneratedType ? vm.selectedLedger.voucherGeneratedType : vm.selectedLedger.voucher.name, $event)">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>
                                    </td>

                                    <td data-title="Amount" class="col-xs-2 text-right">
                                        <input id="update-ledger-bank-amount" class="form-control text-right" type="text" [(ngModel)]="txn.amount"
                                            [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency"
                                            [suffix]="vm.selectedSuffixForCurrency" [rawInputValue]="txn.amount"
                                            (click)="addBlankTrx('CREDIT', txn, $event)"
                                            (blur)="onTxnAmountChange(txn)">
                                        <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                            <ng-container
                                                *ngTemplateOutlet="totalWithCurrencySymbol;context:{ $implicit: txn.convertedAmount}">
                                            </ng-container>
                                        </p>
                                    </td>

                                </ng-container>
                            </tr>

                        </tbody>
                    </table>
                    <!-- endregion -->

                    <!-- region credit transaction footer -->
                    <table class="ledger-footer-1">
                        <tbody>
                            <tr class="total_col">
                                <td colspan="12" class="col-xs-12  text-right h32">
                                    <span *ngIf="vm.entryTotal.drTotal > vm.entryTotal.crTotal">C/F: Dr
                                        <span class="primary_clr pd2"
                                            [tooltip]="vm.ledgerUnderStandingObj.balanceText.dr" [placement]="'top'">
                                            {{ vm.baseCurrencyDetails.symbol }}
                                            {{ vm.compoundTotal | giddhCurrency}}</span>
                                    </span>
                                </td>
                            </tr>
                            <tr class="total_col">
                                <!-- reckoning -->
                                <td colspan="12" class="col-xs-12 text-right h32"
                                    style="padding-right:10px !important;">
                                    <span class="bdrT">
                                        {{ vm.baseCurrencyDetails?.symbol }} {{ (vm.entryTotal.crTotal > vm.entryTotal.drTotal ? vm.entryTotal.crTotal : vm.entryTotal.drTotal)
                                        | giddhCurrency }}
                                    </span>

                                    <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                        <ng-container *ngTemplateOutlet="totalWithCurrencySymbol;context: {
                      $implicit: (vm.convertedEntryTotal.crTotal > vm.convertedEntryTotal.drTotal ? vm.convertedEntryTotal.crTotal : vm.convertedEntryTotal.drTotal)
                    }"></ng-container>
                                    </p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- endregion -->
                </div>
                <!-- endregion -->
            </div>
        </div>
        <!-- endregion -->

        <!-- region new entry -->
        <div class="entrypanel width100 pt-2">
            <!-- reverse charge transction start -->
            <div *ngIf="shouldShowRcmEntry" class="pdB1 mTB1">
                <input id="tourist-scheme-1" class="checkbox-custom" type="checkbox" [ngModel]="isRcmEntry"
                    (click)="toggleRcmCheckbox($event)">
                <label for="tourist-scheme-1" class="checkbox-custom-label" #rcmPopup="bs-popover"
                    [popover]="rcmTemplate" placement="right" containerClass="update-ledger-rcm">
                    Is this transaction applicable for <strong> Reverse Charge?</strong>
                </label>
                <span class="text-light font-12"> (Tax is compulsory)</span>
            </div>
            <ng-template #rcmTemplate>
                <confirmation-modal [configuration]="rcmConfiguration" (buttonClicked)="handleRcmChange($event)">
                </confirmation-modal>
            </ng-template>
            <!-- reverse charge transction end  -->
            <!--  tourist scheme template start      -->
            <ng-container *ngTemplateOutlet="touristSchemeTemplate"></ng-container>
            <!--        tourist scheme template end-->
            <!-- region amount and discount container -->
            <div class="clearfix">
                <ng-container *ngIf="vm.showNewEntryPanel || shouldShowAdvanceReceiptMandatoryFields">
                    <div class="width100 total-detail-table"
                        [ngClass]="{'add-multicurrency': vm.isMultiCurrencyAvailable}">
                        <!-- <div *ngIf="vm.stockTrxEntry" class="table-amount">
                          <table>
                            <tbody>
                              <tr>
                                <ng-template [ngIf]="vm.stockTrxEntry">
                                  <td [ngClass]="{width40: vm.stockTrxEntry}" class="text-right pr-1">
                                    <label class="font-12">Quantity</label>
                                    <input type="text" name="" class="form-control text-right" [(ngModel)]="vm.stockTrxEntry.inventory.quantity" decimalDigitsDirective
                                      [DecimalPlaces]="4" (paste)="vm.inventoryQuantityChanged($event)" (change)="vm.inventoryQuantityChanged($event.target.value)"
                                    />
                                  </td>
                                  <td class="text-right" style="width: 115px;">
                                    <label class="font-12">Unit</label>
                                    <select class="form-control text-right no-padding" [(ngModel)]="vm.stockTrxEntry.inventory.unit.code" (change)="vm.unitChanged($event.target.value)">
                                      <option *ngFor="let item of vm.stockTrxEntry.unitRate" [value]="item.stockUnitCode">
                                        {{item.stockUnitCode}}
                                      </option>
                                    </select>
                                  </td>
                                </ng-template>
                              </tr>
                            </tbody>
                          </table>
                        </div> -->

                        <ng-template [ngIf]="(vm.showNewEntryPanel && vm.stockTrxEntry)">
                            <div [ngClass]="{width40: vm.stockTrxEntry}" class="table-amount text-right pr-1 width-80">
                                <label class="font-12">Quantity</label>
                                <input id="update-ledger-quantity" type="text" name="" class="form-control text-right"
                                    [(ngModel)]="vm.stockTrxEntry.inventory.quantity" decimalDigitsDirective
                                    [DecimalPlaces]="4" (paste)="vm.inventoryQuantityChanged($event)"
                                    (change)="handleQuantityChange($event?.target?.value);" />
                            </div>

                            <div class="text-right table-amount width-80">
                                <label class="font-12">Unit</label>
                                <select id="update-ledger-unit" class="form-control text-right no-padding"
                                    [(ngModel)]="vm.stockTrxEntry.inventory.unit.code"
                                    (change)="vm.unitChanged($event.target.value)">
                                    <option *ngFor="let item of vm.stockTrxEntry.unitRate" [value]="item.code">
                                        {{item.stockUnitCode}}
                                    </option>
                                </select>
                            </div>
                        </ng-template>


                        <div class="icon-box" *ngIf="(vm.showNewEntryPanel && vm.stockTrxEntry)">
                            <label class="icon-cross"></label>
                        </div>

                        <ng-template [ngIf]="(vm.showNewEntryPanel && vm.stockTrxEntry)">
                            <div class="text-right table-amount">
                                <label class="font-12">Price</label>
                                <input id="update-ledger-price" type="text" name="unitPrice"
                                    (blur)="vm.inventoryPriceChanged(vm.stockTrxEntry.inventory.rate)"
                                    [mask]="vm.inputMaskFormat" [customDecimalPlaces]="ratePrecision"
                                    [prefix]="vm.selectedPrefixForCurrency" [suffix]="vm.selectedSuffixForCurrency"
                                    [rawInputValue]="vm.stockTrxEntry.inventory.rate"
                                    [(ngModel)]="vm.stockTrxEntry.inventory.rate" class="form-control text-right" />
                                <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                    <span>
                                        {{ vm.selectedCurrency === 0 ? vm.foreignCurrencyDetails?.symbol : vm.baseCurrencyDetails?.symbol }} {{ vm.convertedRate |
                                        giddhCurrency: ratePrecision:true }}
                                    </span>
                                </p>
                            </div>
                        </ng-template>

                        <div class="icon-box" *ngIf="(vm.showNewEntryPanel && vm.stockTrxEntry)">
                            <label class="fs20">=</label>
                        </div>

                        <div *ngIf="vm.showNewEntryPanel || shouldShowAdvanceReceiptMandatoryFields"
                            class="text-right table-amount">
                            <label class="font-12">Amount</label>
                            <input id="update-ledger-amount-receipt" *ngIf="isAdvanceReceipt" type="text" name="advanceAmount"
                                class="form-control text-right" [mask]="vm.inputMaskFormat"
                                [rawInputValue]="vm.advanceReceiptAmount" [prefix]="vm.selectedPrefixForCurrency"
                                [suffix]="vm.selectedSuffixForCurrency" [(ngModel)]="vm.advanceReceiptAmount"
                                disabled />
                            <input id="update-ledger-amount" *ngIf="!isAdvanceReceipt" type="text" name="amount" class="form-control text-right"
                                [mask]="vm.inputMaskFormat" [rawInputValue]="vm.totalAmount"
                                [prefix]="vm.selectedPrefixForCurrency" [suffix]="vm.selectedSuffixForCurrency"
                                (focus)="hideDiscountTax()" (blur)="vm.inventoryAmountChanged()"
                                [(ngModel)]="vm.totalAmount" />
                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedTotalAmount }">
                                </ng-container>
                            </p>
                        </div>

                        <div *ngIf="vm.showNewEntryPanel && !shouldShowAdvanceReceiptMandatoryFields" class="icon-box">
                            <label class="icon-minus font-12"></label>
                        </div>

                        <div *ngIf="vm.showNewEntryPanel && !shouldShowAdvanceReceiptMandatoryFields"
                            class="text-right table-amount">
                            <span auto-close="outsideClick">
                                <update-ledger-discount id="update-ledger-discount-amount" #discount [discountAccountsDetails]="vm.discountArray"
                                    [ledgerAmount]="vm.selectedLedger.actualAmount"
                                    [prefixInput]="vm.selectedPrefixForCurrency" [maskInput]="vm.inputMaskFormat"
                                    [suffixInput]="vm.selectedSuffixForCurrency"
                                    (discountTotalUpdated)="vm.handleDiscountEntry($event); vm.generateGrandTotal();"
                                    (hideOtherPopups)="hideTax()">
                                </update-ledger-discount>
                            </span>

                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedDiscountTrxTotal }">
                                </ng-container>
                            </p>
                        </div>

                        <div class="text-center icon-box"
                            *ngIf="(vm.showNewEntryPanel || shouldShowAdvanceReceiptMandatoryFields) && (vm.companyTaxesList$ | async)?.length">
                            <label class="icon-plus font-12"></label>
                        </div>

                        <div class="text-center icon-box"
                            *ngIf="(vm.showNewEntryPanel || shouldShowAdvanceReceiptMandatoryFields) && !(vm.companyTaxesList$ | async)?.length">
                            <label class="fs20">=</label>
                        </div>

                        <div class="dropdown-container dropdown-left text-right table-amount"
                            *ngIf="(vm.showNewEntryPanel || shouldShowAdvanceReceiptMandatoryFields) && (vm.companyTaxesList$ | async)?.length">
                            <span auto-close="outsideClick">
                                <update-ledger-tax-control id="update-ledger-tax-amount" #tax [taxes]="vm.companyTaxesList$ | async"
                                    [customHeading]="shouldShowAdvanceReceiptMandatoryFields ? 'Tax on Advance' : isRcmEntry ? 'Tax (RCM)' : ''"
                                    [isMandatory]="isRcmEntry" [date]="vm.selectedLedger.entryDate"
                                    [taxRenderData]="vm.taxRenderData" [totalForTax]="vm.totalForTax"
                                    [prefixInput]="vm.selectedPrefixForCurrency" [maskInput]="vm.inputMaskFormat"
                                    [suffixInput]="vm.selectedSuffixForCurrency"
                                    [exceptTaxTypes]="['tdsrc', 'tdspay','tcspay', 'tcsrc']"
                                    [isAdvanceReceipt]="isAdvanceReceipt"
                                    [allowedSelectionOfAType]="allowedSelectionOfAType"
                                    [applicableTaxes]="vm.selectedLedger.taxes" (hideOtherPopups)="hideDiscount()"
                                    (selectedTaxEvent)="vm.taxTrxUpdated($event)">
                                </update-ledger-tax-control>
                                <!-- TODO: After design finalization
                                    <span class="eligible-ITC">Eligible for ITC <span class="icon-edit"></span> </span> -->
                            </span>

                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedTaxTrxTotal }">
                                </ng-container>
                            </p>
                        </div>

                        <div class="text-center icon-box"
                            *ngIf="(vm.showNewEntryPanel || shouldShowAdvanceReceiptMandatoryFields) && (vm.companyTaxesList$ | async)?.length">
                            <label class="fs20">=</label>
                        </div>

                        <div *ngIf="(vm.showNewEntryPanel || shouldShowAdvanceReceiptMandatoryFields)"
                            class="text-right table-amount" (resized)="onResized($event)">
                            <label class="font-12">Total Amt.</label>
                            <input type="text" id="update-ledger-total-amount" name="" class="form-control text-right" [(ngModel)]="vm.grandTotal"
                                [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency"
                                [rawInputValue]="vm.grandTotal" [suffix]="vm.selectedSuffixForCurrency"
                                (blur)="vm.inventoryTotalChanged()" />
                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedGrandTotal }">
                                </ng-container>
                            </p>
                        </div>

                        <div *ngIf="vm.showNewEntryPanel && isTcsTdsApplicable"
                            class="text-right table-amount last-ttable-amount">
                            <div class="text-right">

                                <div *ngIf="!vm.selectedLedger.isOtherTaxesApplicable" class="other-tax">
                                    <input type="checkbox" id="update-ledger-other-tax" [(ngModel)]="vm.selectedLedger.isOtherTaxesApplicable"
                                        *ngIf="!vm.selectedLedger.isOtherTaxesApplicable"
                                        (ngModelChange)="toggleOtherTaxesAsideMenu.emit(vm)" />
                                    <p class="font-14 nowrap" *ngIf="!vm.selectedLedger.isOtherTaxesApplicable">Other
                                        Tax ?</p>
                                </div>

                                <div *ngIf="vm.selectedLedger.isOtherTaxesApplicable" class="pl-1">
                                    <label>Other Tax <a href="javascript: void(0)" class="text-gray"
                                            (click)="toggleOtherTaxesAsideMenu.emit(vm)">
                                            <i class="icon-edit11 font-12 ml-05"></i>
                                        </a>
                                    </label>

                                    <input id="update-ledger-other-tax-disabled" class="text-right form-control" disabled="disabled"
                                        [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency"
                                        [suffix]="vm.selectedSuffixForCurrency"
                                        [rawInputValue]="vm.selectedLedger.otherTaxesSum"
                                        [(ngModel)]="vm.selectedLedger.otherTaxesSum" name="entry.otherTaxesSum" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="cearfix pd1 text-right bb-1 pr-0">
                        <span class="inWords font-14">{{vm.grandTotal | myNumberToWordsPipe | lowercase}}</span>
                    </div>
                </ng-container>
            </div>
            <!-- endregion -->

            <!-- region more details and total section -->

            <div class="row ledger-bottom">
                <div class="col-md-6 pt-1">
                    <!-- make it functional (Developer end) -->
                    <div *ngIf="shouldShowWarehouse" class="row mrB1">
                        <div class="col-sm-6 pdR1">
                            <div class="selectWarehouse">
                                <label class="font-12">Select Warehouse</label>
                                <sh-select id="update-ledger-select-warehouse" [(ngModel)]="selectedWarehouse" [placeholder]="'Select Warehouse'"
                                    [options]="warehouses">
                                </sh-select>
                            </div>
                        </div>

                        <!-- TODO: Add multiple warehouse feature
                            <ng-template [ngIf]="vm.stockTrxEntry">
                            <div class="col-sm-3 pdL1 pdR1">
                                <div class="table-amount text-right ">
                                    <label class="font-12">Quantity</label>
                                    <input type="text" name="" class="form-control text-right"
                                        [(ngModel)]="vm.stockTrxEntry.inventory.quantity" decimalDigitsDirective
                                        [DecimalPlaces]="4" (paste)="vm.inventoryQuantityChanged($event)"
                                        (change)="vm.inventoryQuantityChanged($event.target.value)" />
                                </div>
                            </div>
                            <div class="col-sm-3 pdL1">
                                <div class="text-right table-amount">
                                    <label class="font-12">Unit</label>
                                    <select class="form-control text-right no-padding"
                                        [(ngModel)]="vm.stockTrxEntry.inventory.unit.code"
                                        (change)="vm.unitChanged($event.target.value)">
                                        <option *ngFor="let item of vm.stockTrxEntry.unitRate"
                                            [value]="item.stockUnitCode">
                                            {{item.stockUnitCode}}
                                        </option>
                                    </select>
                                </div>
                            </div>
                        </ng-template> -->

                    </div>

                    <ng-container *ngIf="shouldShowRcmTaxableAmount">
                        <div class="taxable-amount-section">
                            <label class="primary_clr">Taxable Amount</label>
                            <input id="update-ledger-taxable-amount" type="text" name="taxable-amount" class="form-control text-right"
                                [prefix]="vm.selectedPrefixForCurrency" [suffix]="vm.selectedSuffixForCurrency"
                                [mask]="vm.inputMaskFormat"
                                [(ngModel)]="vm.selectedLedger.reverseChargeTaxableAmount" />
                        </div>
                    </ng-container>
                    <ng-container *ngIf="shouldShowItcSection">
                        <div class="taxable-amount-section">
                            <label class="primary_clr itc-label">ITC Type</label>
                            <sh-select id="update-ledger-itc-type" [(ngModel)]="vm.selectedLedger.itcAvailable" [placeholder]="'ITC Type'"
                                [options]="availableItcList">
                            </sh-select>
                        </div>
                    </ng-container>

                    <div class="row">
                        <div class="col-xs-12">
                            <textarea id="update-ledger-description" rows="3" cols="" [(ngModel)]="vm.selectedLedger.description" class="form-control"
                                placeholder="Description"></textarea>
                        </div>
                    </div>

                    <!-- Advance receipts adjusted Invoice -->
                    <div class="clearfix adjust-receipt font-14" *ngIf="vm.selectedLedger?.voucherAdjustments?.adjustments?.length &&
                        (isAdjustVoucherSelected || isAdjustAdvanceReceiptSelected || isAdjustReceiptSelected)">
                        <p class="bold">
                            Adjusted Amount
                            <a href="javascript:void(0)" *ngIf="!selectedAdvanceReceiptAdjustInvoiceEditMode" (click)="openAdjustInvoiceEditMode();$event.stopPropagation();">
                                <i class="edit-adjustment icon-edit11 font-10"></i>
                            </a>
                            <i class="icon-info" [popover]="adjustmentPopOverTemplate" [outsideClick]="true" containerClass="adjustment-popover" placement="bottom right"></i>
                        </p>
                        <ng-template #adjustmentPopOverTemplate>
                            <div class="adjusted-info">
                                <p class="mb-1"><strong>Adjustment</strong></p>
                                <p class="info-text">The selected entry is a part of {{vm.selectedLedger?.voucherNumber}}. All the
                                    adjustment will reflect
                                    to subsequent entries as well. Here we
                                    are adjusting the Invoice not just the selected entry. Please note that linked entries cannot be updated from here.</p>
                            </div>
                        </ng-template>
                        <p class="font-12 text-light mb-1">
                            {{ vm.baseCurrencyDetails?.symbol}}{{vm.selectedLedger?.voucherAdjustments?.totalAdjustmentAmount | giddhCurrency}}
                        </p>
                        <div class="clearfix adjustment-field">
                            <div class="row" *ngFor="let item of vm.selectedLedger?.voucherAdjustments?.adjustments; let entryIdx = index;">
                                <div class="col-md-4 col-sm-5 pr-05">
                                    <div class="form-group">
                                        <label>Adjustment Vouchers
                                            <span class="text-danger">*</span>
                                        </label>
                                        <input id="update-ledger-adjust-vouchar" type="text" class="form-control mb-1" [(ngModel)]="item.voucherNumber" disabled>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-5 pl-05 pr-05">
                                    <div class="form-group">
                                        <label>Amount<span class="text-danger">*</span> <span *ngIf="item.voucherType === 'receipt' && isAdvanceReceipt" class="text-light font-12 ml-05">(Inclusive
                            Tax)</span></label>
                                        <input id="update-ledger-inclusive-tax" type="text" class="form-control mb-1" *ngIf="!selectedAdvanceReceiptAdjustInvoiceEditMode" [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency" decimalDigitsDirective [(ngModel)]="item.adjustmentAmount.amountForAccount" disabled>
                                        <input id="update-ledger-inclusive-tax" type="text" class="form-control mb-1" decimalDigitsDirective [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency" (blur)="adjustedInvoiceAmountChange()" *ngIf="selectedAdvanceReceiptAdjustInvoiceEditMode" [(ngModel)]="item.adjustmentAmount.amountForAccount">
                                    </div>
                                </div>
                                <div *ngIf="item.voucherType === 'receipt' && item.subVoucher === 'ADVANCE_RECEIPT'" class="col-sm-2 pl-05">
                                    <div class="form-group">
                                        <label>Tax</label>
                                        <input type="text" id="update-ledger-vouchar-tax" class="form-control mb-1" decimalDigitsDirective [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency" [(ngModel)]="item.calculatedTaxAmount" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p *ngIf="isAdjustedAmountExcess" class="font-12 text-light">Excess
                            amount:{{ vm.baseCurrencyDetails?.symbol}}{{adjustedExcessAmount | giddhCurrency}} <i
                                class="icon-info pointer" tooltip="Adjustment amount is more than receipts."></i></p>
                    </div>
                    <!-- End advance receipts adjusted Invoice -->
                    <!--Adjusted advance receipts list  -->
                    <!-- <div class="clearfix adjust-receipt font-14" *ngIf="isAdjustedWithAdvanceReceipt && (isAdjustAdvanceReceiptSelected)">
                        <p class="bold">Adjusted Vouchers
                            <a href="javascript:void(0)" *ngIf="!selectedAdvanceReceiptAdjustInvoiceEditMode" (click)="openAdjustInvoiceEditMode();$event.stopPropagation();">
                                <i class="icon-edit11 font-10"></i>
                                <i class="icon-info"></i>
                                <div class="adjusted-info">
                                    <p class="mb-1"><strong>Adjustment</strong></p>
                                    <p class="info-text">The selected entry is a part of Invoice# 43242. All the
                                        adjustment will reflect
                                        to subsequent entries as well. Here we
                                        are adjusting the Invoice not just the selected entry.</p>
                                </div>
                                <i class="icon-edit11 font-10"></i>
                            </a>
                        </p>
                        <p class="font-12 text-light mb-1">
                            {{ vm.baseCurrencyDetails?.symbol}}{{totalAdjustedAmount | giddhCurrency}}
                        </p>
                        <div class="clearfix adjustment-field">
                            <div class="row" *ngFor="let item of vm.selectedLedger?.voucherAdjustments?.adjustments; let entryIdx = index;">
                                <div class="col-md-4 col-sm-5 pr-05">
                                    <div class="form-group">
                                        <label>Adjustment Voucher<span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control mb-1" name="voucherNumber"
                                            [(ngModel)]="item.voucherNumber" disabled>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-5 pl-05 pr-05">
                                    <div class="form-group">
                                        <label>Amount<span class="text-danger">*</span> <span class="text-light font-12 ml-05">(Inclusive
                            Tax)</span></label>
                                        <input type="text" class="form-control mb-1" name="amountForAccount" *ngIf="!selectedAdvanceReceiptAdjustInvoiceEditMode" [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency" decimalDigitsDirective [(ngModel)]="item.adjustmentAmount.amountForAccount"
                                            disabled>
                                        <input type="text" class="form-control mb-1" name="amountForAccount" decimalDigitsDirective [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency" (blur)="adjustedReceiptsAmountChange()" *ngIf="selectedAdvanceReceiptAdjustInvoiceEditMode"
                                            [(ngModel)]="item.adjustmentAmount.amountForAccount">
                                    </div>
                                </div>
                                <div class="col-sm-2 pl-05">
                                    <div class="form-group">
                                        <label>Tax</label>
                                        <input type="text" class="form-control mb-1" name="calculatedTaxAmount"
                                            decimalDigitsDirective [mask]="vm.inputMaskFormat"
                                            [prefix]="vm.selectedPrefixForCurrency"
                                            [(ngModel)]="item.calculatedTaxAmount" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p *ngIf="isAdjustedAmountExcess" class="font-12 text-light">Excess
                            amount:{{ vm.baseCurrencyDetails?.symbol}}{{adjustedExcessAmount | giddhCurrency}} <i
                                class="icon-info pointer" tooltip="Adjustment amount is more than receipts."></i></p>
                    </div> -->
                    <!--End adjusted advance receipts list  -->

                </div>

                <div class="col-md-6 font-14 pt-1 bl-1 remove-border-left-onmo">
                    <table class="width100">
                        <tbody>
                            <tr>
                                <td class="primary_clr" (click)="getInvoiveLists(); showAdvanced = !showAdvanced">
                                    <i class="fa cp"
                                        [ngClass]="{'fa-minus-square-o':showAdvanced, 'fa-plus-square-o': !showAdvanced}"></i>
                                    <button class="no-btn pdL0">&nbsp; More Details</button>
                                </td>
                                <td class="text-right">
                                    <span class="primary_clr" *ngIf="vm.isMultiCurrencyAvailable">
                                        Total in {{ vm.baseCurrencyDetails?.code }}:
                                        <span>{{ vm.baseCurrencyDetails?.symbol }}</span>
                                        {{vm.compoundTotal | giddhCurrency}}
                                    </span>
                                </td>

                            </tr>

                        </tbody>
                    </table>
                    <div class="pd1 mrB mrT advanced" style="background: #F1F5F8;" *ngIf="showAdvanced">
                        <table class="xs-table-block">
                            <tr>
                                <td class="select2-parent pdR1">
                                    <div class="form-group">
                                        <label class="default_clr">Voucher Type</label>
                                        <sh-select id="update-ledger-vouchar-type" [options]="vm.voucherTypeList" [isFilterEnabled]="true"
                                            [(ngModel)]="vm.selectedLedger.voucher.shortCode" [showClear]="false"
                                            (selected)="getInvoiceListsData($event)" [ItemHeight]="'auto'"
                                            [width]="'161px'">
                                        </sh-select>
                                    </div>
                                </td>

                                <td class="pdR1" *ngIf="(vm.selectedLedger.voucher.shortCode === 'sal' || vm.selectedLedger.voucher.shortCode == 'pur' || vm.selectedLedger.voucher.shortCode == 'pay')">
                                    <div class="form-group">
                                        <label class="default_clr">Invoice No.</label>
                                        <input id="update-ledger-invoice-number" type="text" placeholder="Invoice no." class="form-control"
                                            [(ngModel)]="vm.selectedLedger.invoiceNumberAgainstVoucher" />
                                    </div>
                                </td>

                                <!-- <td class="pdR1" *ngIf="vm.selectedLedger.voucher.shortCode == 'rcpt'">

                                    <div class="form-group">

                                        <label class="default_clr">Invoice No.</label>
                                        <div class="btn-group btn-block invoice-btn" dropdown>
                                            <button dropdownToggle type="button"
                                                class="form-control text-left btn-block dropdown-toggle">
                                                Select Invoices
                                                <span class="select_drop pull-right mrT1">
                                                    <i class="fa fa-caret-down"></i>
                                                </span>
                                            </button>
                                            <ul *dropdownMenu class="dropdown-menu dropdown-menu-2 width100"
                                                role="menu">
                                                <li *ngIf="invoiceList.length==0">No results found</li>
                                                <li *ngFor="let invoice of invoiceList">

                                                    <input type="checkbox" [checked]="invoice.isSelected"
                                                        (click)="selectInvoice (invoice, $event)" /> {{invoice.label}}
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                </td> -->

                                <td class="pdR1" *ngIf="vm.selectedLedger.voucher.shortCode == 'credit note' || vm.selectedLedger.voucher.shortCode == 'debit note'">
                                    <div class="form-group">
                                        <label class="default_clr">{{vm.selectedLedger.voucher.shortCode == 'debit note' ? 'Voucher' : 'Invoice'}} No.</label>

                                        <sh-select id="update-ledger-invoice-number" [options]="invoiceList" placeholder="Select Accounts"
                                            [(ngModel)]="selectedInvoice" [notFoundLink]="false" [forceClearReactive]="forceClear$ | async"
                                            (selected)="creditNoteInvoiceSelected($event)" [multiple]="false"
                                            [ItemHeight]="67" [showClear]="false">
                                            <ng-template #optionTemplate let-option="option">
                                                <a href="javascript:void(0)" class="list-item sh-template">
                                                    <div class="item">{{ option.label }}
                                                    </div>
                                                    <div class="item_unq">
                                                        (Dated: {{ option.additional?.voucherDate}})
                                                    </div>
                                                    <div class="item_unq">
                                                        (Due:
                                                        {{ option.additional?.balanceDue?.amountForAccount | giddhCurrency }})
                                                    </div>
                                                </a>
                                            </ng-template>
                                        </sh-select>
                                    </div>
                                </td>
                                <td *ngIf="(vm.selectedLedger.voucher.shortCode === 'credit note' || vm.selectedLedger.voucher.shortCode === 'debit note') && selectedInvoice" class="cp remove-invoice pdR2 hidden-xs" (click)="removeSelectedInvoice()">
                                    <span class=“remove-invoice-icon”>×</span>
                                    <span class="remove-invoice-label">Remove</span>
                                </td>
                                <td class="pdR1">
                                    <div class="form-group">
                                        <label class="default_clr">Voucher No.</label>
                                        <input id="update-ledger-vouchar-number" type="text" placeholder="Voucher no." class="form-control"
                                            [ngModel]="vm.selectedLedger.voucherNo" [disabled]="true"
                                            [style.width.px]="80" />
                                    </div>
                                </td>
                            </tr>

                        </table>

                        <table>
                            <tr>
                                <td *ngIf="(vm.selectedLedger.voucher.shortCode !== 'jr' && vm.selectedLedger.voucher.shortCode !== 'cntr' && vm.selectedLedger.voucher.shortCode !== 'rcpt'
                                && vm.selectedLedger.voucher.shortCode !== 'advance-receipt')" class="pdR1 pb-1">
                                    <input type="checkbox" id="update-ledger-sale" name="advanceReceipt" [(ngModel)]="isAdjustVoucherSelected" (change)="handleVoucherAdjustment()">
                                    Adjust {{
                                        vm.selectedLedger.voucher.shortCode === 'sal' ? 'Sales' :
                                        vm.selectedLedger.voucher.shortCode === 'pur' ? 'Purchase' :
                                        vm.selectedLedger.voucher.shortCode === 'credit note' ? 'Credit Note' :
                                        vm.selectedLedger.voucher.shortCode === 'debit note' ? 'Debit Note' :
                                        vm.selectedLedger.voucher.shortCode === 'pay' ? 'Payment' : ''
                                    }}
                                </td>
                                <td *ngIf="vm.selectedLedger.voucher.shortCode == 'advance-receipt' && isAdvanceReceipt" class="pdR1 pb-1">
                                    <input type="checkbox" id="update-ledger-advance-receipt" name="advanceReceipt" [(ngModel)]="isAdjustAdvanceReceiptSelected" (change)="handleVoucherAdjustment()">Adjust Advance Receipt
                                </td>
                                <td *ngIf="vm.selectedLedger.voucher.shortCode == 'rcpt' && !isAdvanceReceipt" class="pdR1 pb-1">
                                    <input type="checkbox" id="update-ledger-adjust-receipt" name="advanceReceipt" [(ngModel)]="isAdjustReceiptSelected" (change)="handleVoucherAdjustment()">Adjust Receipt
                                </td>
                            </tr>
                        </table>



                        <table class="xs-table-block">

                            <tbody>
                                <tr>
                                    <td class="pdR1">
                                        <label class="default_clr">Cheque Number</label>
                                        <input type="text" id="update-ledger-cheque-number" placeholder="XXXX2619" class="form-control"
                                            [(ngModel)]="vm.selectedLedger.chequeNumber" />
                                    </td>

                                    <td>
                                        <label class="default_clr">Cheque Clearance Date</label>
                                        <input id="update-ledger-cheque-clearance" type="text" autocomplete="off" class="form-control"
                                            [(ngModel)]="vm.selectedLedger.chequeClearanceDate" bsDatepicker
                                            #chbs='bsDatepicker' [bsConfig]="{ dateInputFormat: giddhDateFormat }" />
                                    </td>

                                </tr>

                            </tbody>

                        </table>

                        <table class="mrT1">

                            <tbody>

                                <tr>
                                    <td class="pdR1">
                                        <label class="default_clr">Assign Tag</label>
                                        <sh-select id="update-ledger-assign-tag" [options]="tags$ | async" [isFilterEnabled]="true"
                                            [placeholder]="'Select Tag'" [showClear]="false" [multiple]="true"
                                            name="tagNames" [(ngModel)]="vm.selectedLedger.tagNames"
                                            [ItemHeight]="'auto'"></sh-select>
                                    </td>
                                </tr>

                            </tbody>

                        </table>

                    </div>

                    <div class="row">

                        <div class="col-xs-12 clearfix mrT1">

                            <div class="mrR1 form-group pull-left cp">
                                <label class="pull-left cp fs16">
                                    <input id="update-ledger-generate-voucher" class="pull-left" type="checkbox" name="generateInvoice"
                                        [(ngModel)]="vm.selectedLedger.generateInvoice"
                                        [disabled]="(vm.isInvoiceGeneratedAlready || (isAdvanceReceipt && vm.selectedLedger.generateInvoice)) ? 'disabled': null">
                                    Generate Voucher
                                </label>
                            </div>


                            <div class="pull-right">

                                <span class="primary_clr" *ngIf="!vm.isMultiCurrencyAvailable">
                                    Compound Total:
                                    {{ vm.baseCurrencyDetails?.symbol}}{{vm.compoundTotal | giddhCurrency}}
                                </span>

                                <span *ngIf="vm.isMultiCurrencyAvailable" class="primary_clr">
                                    Total in {{ vm.foreignCurrencyDetails?.code }}
                                    : {{ vm.foreignCurrencyDetails?.symbol }} {{ vm.convertedCompoundTotal | giddhCurrency
                                    }}
                                </span>

                            </div>

                        </div>

                        <div class="clearfix mb-2">

                            <div class="pull-left pl-15" *ngIf="vm.isMultiCurrencyAvailable">

                                <ul class="list-inline font-14 currency-convertor">

                                    <li>
                                        1
                                        {{ vm.selectedCurrencyForDisplay === 0 ? vm.baseCurrencyDetails?.code : vm.foreignCurrencyDetails?.code }}
                                    </li>

                                    <li>
                                        <a href="javascript:void(0)" class="text-light">
                                            <i class="icon-switch-icon"></i>
                                        </a>
                                    </li>

                                    <li>
                                        <input type="text" id="update-ledger-price-input" class="price-input"
                                            [(ngModel)]="vm.selectedLedger.exchangeRateForDisplay"
                                            (blur)="exchangeRateChanged()"> {{ vm.selectedCurrencyForDisplay === 0 ? vm.foreignCurrencyDetails?.code : vm.baseCurrencyDetails?.code
                                        }}
                                    </li>

                                </ul>
                            </div>

                            <div class="pull-right pr-15" *ngIf="!isPettyCash">
                                <div class="file_attached pull-right text-right"
                                    *ngIf="(vm.selectedLedger)?.attachedFile?.length > 0">
                                    <span>{{ (vm.selectedLedger)?.attachedFileName }}</span>
                                    <label class="remove cp pl-1 text-danger"
                                        (click)="showDeleteAttachedFileModal()">(remove)</label>
                                </div>

                                <label class="upload_div" [ngClass]="{hide:vm.selectedLedger.attachedFile}">
                                    <input id="update-ledger-upload-file" type="file" name="invoiceFile" #fileInputUpdate id="invoiceFile" ngFileSelect
                                        [uploadInput]="uploadInput" (uploadOutput)="onUploadOutputUpdate($event)">
                                    <label for="invoiceFile" class="cp fs16">
                                        <i [ngClass]="!isFileUploading ? 'glyphicon glyphicon-paperclip' : 'fa fa-spinner rotate'"></i> Attach file</label>
                                </label>
                            </div>

                        </div>

                        <div class="col-xs-12 pdT1 d-flex align-items-center xs-d-block" *ngIf="!isPettyCash">
                            <!--                            <div class="width-100 mb-05">-->
                            <!--                                    <p *ngIf="isAdjustedAmountExcess">Note: The adjusted amount of the linked invoice/s is more than the receipt;-->
                            <!--                                        update them first and try again.</p>-->
                            <!--                            </div>-->

                            <div class="d-flex">
                                <button class="btn btn-danger" id="update-ledger-delete-button" (click)="showDeleteEntryModal()">Delete</button>
                                <button class="btn btn-success" id="update-ledger-update-button" [disabled]="isFileUploading" [ladda]="(isTxnUpdateInProcess$ | async)"
                                    (click)="saveLedgerTransaction()">Update
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>
<!-- endregion -->


<!-- region modals -->
<!--deleteAttachedFile  -->
<div bsModal #deleteAttachedFileModal="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <confirm-modal [title]="'Delete'" [body]="'Are you sure you want to delete the attached file?'"
                (cancelCallBack)="hideDeleteAttachedFileModal()" (successCallBack)="deleteAttachedFile()">
            </confirm-modal>
        </div>
    </div>
</div>

<!--delete entry  -->
<div bsModal #deleteEntryModal="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <confirm-modal [title]="'Delete'" [body]="'Are you sure you want to delete this entry?'"
                (cancelCallBack)="hideDeleteEntryModal()" (successCallBack)="deleteTrxEntry()">
            </confirm-modal>
        </div>
    </div>
</div>

<!-- update base account popup -->
<div bsModal #updateBaseAccount="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <base-account #baseAccount [accountUniqueName]="(baseAccount$ | async)?.uniqueName"
                (closeBaseAccountModal)="hideBaseAccountModal()"
                [flattenAccountList]="vm.flatternAccountList4Select | async"
                (updateBaseAccount)="changeBaseAccount($event)"></base-account>
        </div>
    </div>
</div>

<!-- endregion -->

<!-- region totalWithCurrencySymbol template -->
<ng-template #totalWithCurrencySymbol let-amountToDispaly>

    <span>
        {{ vm.selectedCurrency === 0 ? vm.foreignCurrencyDetails?.symbol : vm.baseCurrencyDetails?.symbol }} {{ amountToDispaly |
        giddhCurrency }}
    </span>

</ng-template>
<!-- endregion -->
<!-- Tourist scheme template block-->
<ng-template #touristSchemeTemplate>
    <div class="font-14 mb-1 d-flex align-items-center xs-d-block" *ngIf="isTouristSchemeApplicable">
        <div class="mr-3 xs-mr-0 mb-1">
            <div class="d-flex align-items-center">
                <span class="pull-left">
                    <input id="tourist-scheme" type="checkbox" name="touristSchemeApplicable"
                        [(ngModel)]="vm.selectedLedger.touristSchemeApplicable"
                        (ngModelChange)="touristSchemeApplicableToggle($event)">

                </span>
                <span>Is this transaction applicable for Tourist Scheme?</span>
            </div>
        </div>

        <div *ngIf="vm.selectedLedger.touristSchemeApplicable">
            <div class="d-flex align-items-center justify-content-end ml-1 xs-justify-content-start">
                <span class="nowrap">Passport Number </span>
                <input id="update-ledger-passport-number" type="text" name="selectedLedger.passportNumber" placeholder="Passport Number" #passportNumber
                    (blur)="allowAlphanumericChar(passportNumber)" (keypress)="allowAlphanumericChar(passportNumber)"
                    class="form-control width-115 ml-1" [(ngModel)]="vm.selectedLedger.passportNumber" />
            </div>
        </div>
    </div>
</ng-template>
<!-- Tourist scheme template block end-->
<!--Advance receipt adjusted remove confirmation modal -->
<div bsModal #advanceReceiptRemoveConfirmationModal="bs-modal" class="modal fade" role="dialog"
    [config]="{keyboard:true}" tabindex="-1">
    <div class="modal-dialog modal-md">
        <!-- modal-liq90 class is removed for now-->
        <div class="modal-content">
            <delete-template-confirmation-modal *ngIf="advanceReceiptRemoveConfirmationModal.isShown"
                [message]='removeAdvanceReceiptConfirmationMessage' [flag]="confirmationFlag"
                (closeModelEvent)="onAdvanceReceiptRemoveCloseConfirmationModal($event)">
            </delete-template-confirmation-modal>
        </div>
    </div>
</div>

<div class="modal fade purchase-record-confirmation-modal" tabindex="-1" #adjustPaymentModal="bs-modal" [config]="{ animated: true, ignoreBackdropClick: true, keyboard: false }" bsModal role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <advance-receipt-adjustment-component *ngIf="adjustPaymentModal.isShown"
                #advanceReceiptComponent [adjustedVoucherType]="vm.selectedLedger.voucher.shortCode"
                [invoiceFormDetails]="adjustVoucherConfiguration"
                [advanceReceiptAdjustmentUpdatedData]="vm.selectedLedger.voucherAdjustments" (closeModelEvent)="closeAdjustmentModal($event)"
                (submitClicked)="getAdjustedPaymentData($event)">
            </advance-receipt-adjustment-component>
        </div>
    </div>
</div>
