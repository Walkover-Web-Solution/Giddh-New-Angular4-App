<div id="entryModal">

    <!-- region header -->
    <div class="modal-header" *ngIf="!isPettyCash">
        <span aria-hidden="true" class="close hover-orange" data-dismiss="modal" (click)="closeUpdateLedgerModal.emit()"
            aria-label="Close">Ã—</span>

        <h3 *ngIf="!openDropDown" (dblclick)="openHeaderDropDown()" class="d-inline-block mr-1">
            {{(baseAccount$ | async)?.name}} A/c</h3>

        <sh-select *ngIf="openDropDown" class="d-inline-block" [disabled]="false" placeholder="Select Group"
            filterPlaceholder="Type to filter.." name="accountUniqueName" [(ngModel)]="baseAccountName$"
            [useInBuiltFilterForFlattenAc]="true" [showClear]="false" [options]="vm.flatternAccountList4BaseAccount"
            style="width:30%">
            <ng-template #optionTemplate let-option="option">
                <ng-container *ngIf="!option.additional?.stock">
                    <a href="javascript:void(0)" (click)="changeBaseAccount(option)"
                        style="border-bottom: 1px solid #ccc;">
                        <div class="item">{{option?.label}}</div>
                        <div class="item_unq fs12">{{option.additional?.uniqueName}}</div>
                    </a>
                </ng-container>
                <ng-container *ngIf="option.additional?.stock">
                    <a href="javascript:void(0)" (click)="changeBaseAccount(option)"
                        style="border-bottom: 1px solid #ccc;">
                        <div class="item">{{option?.label}}</div>
                        <div class="item_unq fs12">{{option.additional?.uniqueName}}</div>
                        <div class="item_stock">Stock: {{option.additional?.stock.name}}</div>
                    </a>
                </ng-container>
            </ng-template>
        </sh-select>
    </div>
    <!-- endregion -->

    <!-- region main body -->
    <div class="modal-body" [hidden]="isChangeAcc" *ngIf="!(isTxnUpdateInProcess$ | async)">

        <!-- region transactions -->
        <div class="ledgHead entry-popup">

            <table class="col-xs-12 ledger-head mrT1 hidden-xs">
                <thead>
                    <tr>
                        <th [ngClass]="Shown ? 'active' : ''" class="col-xs-6 hidden-xs">
                            {{vm.ledgerUnderStandingObj.text.dr}}</th>
                        <th class="col-xs-6 hidden-xs">{{vm.ledgerUnderStandingObj.text.cr}}</th>
                    </tr>
                </thead>
            </table>

            <div class="custom-tabs mb-2">
                <ul class="nav nav-tabs pt-0">
                    <li role="presentation" [className]="condition ? 'active' : ''">
                        <a href="javascript:void(0)" (click)="toggleShow()">Debit</a>
                    </li>
                    <li role="presentation" [className]="condition2 ? 'active' : ''">
                        <a href="javascript:void(0)" (click)="toggleShow()">Credit</a>
                    </li>
                </ul>
            </div>

            <div class="ledger_book">
                <!-- region debit transaction -->
                <div class="left-col-new bdrR" [ngClass]="Shown ? 'active' : ''">

                    <!-- region debit transaction header -->
                    <table class="width100 card-table">

                        <thead class="hidden-xs">
                            <tr class="t-h-bg1">

                                <th class="col-xs-2" style="border-top:none">
                                    <span class="cursor-pointer">
                                        Date
                                    </span>
                                </th>
                                <th class="col-xs-6" style="border-top:none">Particular</th>

                                <th class="col-xs-2 text-right" style="border-top:none">
                                    Amount
                                </th>
                            </tr>
                        </thead>

                        <tbody class="ledger-main">
                            <tr class="debit-blank-row"
                                *ngFor="let txn of vm.selectedLedger.transactions; let i = index">
                                <ng-container *ngIf="txn.type === 'DEBIT'">

                                    <td class="col-xs-2" data-title="Date">
                                        <input type="text" autocomplete="off" name="datess" #dbs='bsDatepicker'
                                            [(ngModel)]="vm.selectedLedger.entryDate" class="form-control" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            (click)="addBlankTrx('DEBIT', txn, $event)" placeholder="date">
                                    </td>

                                    <td data-title="Particular" id="DbtTd"
                                        [ngClass]="{ 'otherAccountEntry': txn.particular.uniqueName === 'others' }"
                                        class="col-xs-6 pos-rel select2-parent select2-ledger">

                                        <ng-template [ngIf]="!txn.isDiscount">
                                            <sh-select id="dbtID" [notFoundLink]="true"
                                                (noResultsClicked)="showQuickAccountModal()"
                                                (keydown)="keydownPressed($event)"
                                                [options]="vm.flatternAccountList4Select | async" #dbtSelect
                                                (click)="addBlankTrx('DEBIT', txn, $event)"
                                                (selected)="selectAccount($event,txn, dbtSelect)" [showClear]="false"
                                                [(ngModel)]="txn.particular.uniqueName" [ItemHeight]="67"
                                                (onShow)="dbs.hide()" [useInBuiltFilterForFlattenAc]="true">

                                                <ng-template #optionTemplate let-option="option">

                                                    <ng-container *ngIf="!option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item"
                                                            style="border-bottom: 1px solid #ccc;">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item_unq">{{ option.additional?.uniqueName }}
                                                            </div>
                                                        </a>
                                                    </ng-container>

                                                    <ng-container *ngIf="option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item"
                                                            style="border-bottom: 1px solid #ccc;">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item_unq">{{ option.additional?.uniqueName }}
                                                            </div>
                                                            <div class="item_stock">
                                                                Stock: {{ option.additional?.stock.name }}</div>
                                                        </a>
                                                    </ng-container>

                                                </ng-template>

                                                <ng-template #notFoundLinkTemplate>

                                                    <a id="createNewId" [ngClass]="{'active': keydownClassAdded}"
                                                        class="notfound-option" [keyboardShortcut]="'alt+c'"
                                                        (onShortcutPress)="toggleAsidePaneOpen()">
                                                        <span [ngClass]="{'active': keydownClassAdded}">Create
                                                            New</span>
                                                        <span [ngClass]="{'active': keydownClassAdded}"
                                                            class="pull-right">Alt+C</span>
                                                    </a>
                                                </ng-template>

                                            </sh-select>

                                        </ng-template>

                                        <ng-template [ngIf]="txn.isDiscount">
                                            <input [disabled]="true" [(ngModel)]="txn.particular.name"
                                                class="trxFakeInput" />
                                        </ng-template>

                                        <span class="download-invoice-ledger"
                                            *ngIf="vm.selectedLedger.attachedFile && vm.selectedLedger.attachedFile.length > 0"
                                            (click)="downloadAttachedFile(vm.selectedLedger.attachedFile, $event)"
                                            [placement]="'left'" [containerClass]="'col-xs-3'"
                                            tooltip="Download file : {{vm.selectedLedger.attachedFileName}}">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>

                                        <span class="download-invoice-ledger "
                                            *ngIf="vm.selectedLedger.voucherNumber && vm.selectedLedger.voucherNumber.length> 0"
                                            [placement]="'left'" [containerClass]="'col-xs-3'"
                                            tooltip="Download Invoice : {{vm.selectedLedger.voucherNumber}}"
                                            (click)="downloadInvoice(vm.selectedLedger.voucherNumber, vm.selectedLedger.voucherGeneratedType ? vm.selectedLedger.voucherGeneratedType : vm.selectedLedger.voucher.name, $event)">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>

                                    </td>

                                    <td class="col-xs-2 text-right" data-title="Amount">

                                        <input type="text" [(ngModel)]="txn.amount" class="form-control text-right"
                                            name="{{txn[i]}}.amount" [mask]="vm.inputMaskFormat"
                                            [prefix]="vm.selectedPrefixForCurrency"
                                            [suffix]="vm.selectedSuffixForCurrency"
                                            (click)="addBlankTrx('DEBIT', txn, $event)" (blur)="onTxnAmountChange(txn)">

                                        <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                            <ng-container
                                                *ngTemplateOutlet="totalWithCurrencySymbol;context:{ $implicit: txn.convertedAmount }">
                                            </ng-container>
                                        </p>

                                    </td>

                                </ng-container>

                            </tr>
                        </tbody>
                    </table>
                    <!-- endregion -->

                    <!-- region debit transaction footer -->
                    <table class="ledger-footer-1">

                        <tbody>
                            <tr class="total_col">

                                <td colspan="12" class="col-xs-12 text-right h32">
                                    <span *ngIf="vm.entryTotal.crTotal > vm.entryTotal.drTotal" class="pd2"
                                        [tooltip]="vm.ledgerUnderStandingObj.balanceText.cr" [placement]="'top'">
                                        C/F: CR {{ vm.baseCurrencyDetails.symbol}} {{ vm.compoundTotal | giddhCurrency}}
                                    </span>
                                </td>

                            </tr>

                            <tr class="total_col">
                                <!-- reckoning -->
                                <td colspan="12" class="col-xs-12 text-right h32">

                                    <span class="bdrT pr-1 pl-1 width-200">
                                        {{ vm.baseCurrencyDetails?.symbol}} {{ (vm.entryTotal.drTotal > vm.entryTotal.crTotal ? vm.entryTotal.drTotal : vm.entryTotal.crTotal)
                      | giddhCurrency}}
                                    </span>

                                    <p class="mb-0 amnt-total pr-1" *ngIf="vm.isMultiCurrencyAvailable">
                                        <ng-container *ngTemplateOutlet="totalWithCurrencySymbol;context: {
                      $implicit: (vm.convertedEntryTotal.drTotal > vm.convertedEntryTotal.crTotal ? vm.convertedEntryTotal.drTotal : vm.convertedEntryTotal.crTotal)
                    }"></ng-container>
                                    </p>

                                </td>
                            </tr>

                        </tbody>

                    </table>
                    <!-- endregion -->

                </div>
                <!-- endregion -->

                <!-- region credit transaction-->
                <div class="right-col-new" [ngClass]="isHide ? 'active' : 'right-col-new'">

                    <!-- region credit transaction header -->
                    <table class="width100 card-table">
                        <thead class="xs-hidden">
                            <tr class="t-h-bg1">
                                <th class="col-xs-2" style="border-top:none">
                                    <span class="cursor-pointer">
                                        Date
                                    </span>

                                </th>
                                <th class="col-xs-6" style="border-top:none">Particular</th>
                                <th class="col-xs-2 text-right" style="border-top:none">Amount</th>
                            </tr>
                        </thead>

                        <tbody class="ledger-main">

                            <tr *ngFor="let txn of vm.selectedLedger.transactions" class="credit-blank-row">
                                <ng-container *ngIf="txn.type == 'CREDIT'">

                                    <td data-title="Date" class="col-xs-2">
                                        <input class="form-control" autocomplete="off" name="datepic" type="text"
                                            [(ngModel)]="vm.selectedLedger.entryDate"
                                            (click)="addBlankTrx('CREDIT', txn, $event)" #cbs='bsDatepicker'
                                            bsDatepicker [bsConfig]="{ dateInputFormat: giddhDateFormat }">
                                    </td>

                                    <td data-title="Particular" id="crdIDTd"
                                        class="pos-rel col-xs-6 select2-parent select2-ledger"
                                        [ngClass]="{ otherAccountEntry: txn.particular.uniqueName === 'others' }">

                                        <ng-template [ngIf]="!txn?.isDiscount">
                                            <sh-select id="crdID" [notFoundLink]="true"
                                                (noResultsClicked)="showQuickAccountModal()"
                                                (keydown)="keydownPressed($event)"
                                                [options]="vm.flatternAccountList4Select | async" #crdSelect
                                                (click)="addBlankTrx('CREDIT', txn, $event)"
                                                (selected)="selectAccount($event,txn, crdSelect)" (onShow)="cbs.hide()"
                                                [showClear]="false" [(ngModel)]="txn.particular.uniqueName"
                                                [ItemHeight]="67" [useInBuiltFilterForFlattenAc]="true">

                                                <ng-template #optionTemplate let-option="option">
                                                    <ng-container *ngIf="!option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item"
                                                            style="border-bottom: 1px solid #ccc;">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item_unq">{{ option.additional?.uniqueName }}
                                                            </div>
                                                        </a>
                                                    </ng-container>

                                                    <ng-container *ngIf="option.additional?.stock">
                                                        <a href="javascript:void(0)" class="list-item"
                                                            style="border-bottom: 1px solid #ccc;">
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item_unq">{{ option.additional?.uniqueName }}
                                                            </div>
                                                            <div class="item_stock">
                                                                Stock: {{ option.additional?.stock.name }}</div>
                                                        </a>
                                                    </ng-container>

                                                </ng-template>

                                                <ng-template #notFoundLinkTemplate>
                                                    <a id="createNewId2" [ngClass]="{'active': keydownClassAdded}"
                                                        class="notfound-option" [keyboardShortcut]="'alt+c'"
                                                        (onShortcutPress)="toggleAsidePaneOpen()">
                                                        <span [ngClass]="{'active': keydownClassAdded}">Create
                                                            New</span>
                                                        <span [ngClass]="{'active': keydownClassAdded}"
                                                            class="pull-right">Alt+C</span>
                                                    </a>
                                                </ng-template>
                                            </sh-select>
                                        </ng-template>

                                        <ng-template [ngIf]="txn?.isDiscount">
                                            <input [disabled]="true" [(ngModel)]="txn.particular.name"
                                                class="trxFakeInput" />
                                        </ng-template>

                                        <span class="download-invoice-ledger"
                                            *ngIf="vm.selectedLedger.attachedFile.length > 0" [placement]="'left'"
                                            [containerClass]="'col-xs-3'"
                                            tooltip="Download file : {{vm.selectedLedger.attachedFileName}}"
                                            (click)="downloadAttachedFile(vm.selectedLedger.attachedFile, $event)">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>

                                        <span class="download-invoice-ledger"
                                            *ngIf="vm.selectedLedger.voucherNumber && vm.selectedLedger.voucherNumber.length > 0"
                                            [placement]="'left'" [containerClass]="'col-xs-3'"
                                            tooltip="Download Invoice : {{vm.selectedLedger.voucherNumber}}"
                                            (click)="downloadInvoice(vm.selectedLedger.voucherNumber, vm.selectedLedger.voucherGeneratedType ? vm.selectedLedger.voucherGeneratedType : vm.selectedLedger.voucher.name, $event)">
                                            <i class="glyphicon glyphicon-download pull-left"
                                                style="font-size:15px;"></i>
                                        </span>
                                    </td>

                                    <td data-title="Amount" class="col-xs-2 text-right">
                                        <input class="form-control text-right" type="text" [(ngModel)]="txn.amount"
                                            [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency"
                                            [suffix]="vm.selectedSuffixForCurrency"
                                            (click)="addBlankTrx('CREDIT', txn, $event)"
                                            (blur)="onTxnAmountChange(txn)">
                                        <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                            <ng-container
                                                *ngTemplateOutlet="totalWithCurrencySymbol;context:{ $implicit: txn.convertedAmount}">
                                            </ng-container>
                                        </p>
                                    </td>

                                </ng-container>
                            </tr>

                        </tbody>
                    </table>
                    <!-- endregion -->

                    <!-- region credit transaction footer -->
                    <table class="ledger-footer-1">
                        <tbody>
                            <tr class="total_col">
                                <td colspan="12" class="col-xs-12  text-right h32">
                                    <span *ngIf="vm.entryTotal.drTotal > vm.entryTotal.crTotal">C/F: Dr
                                        <span class="primary_clr pd2"
                                            [tooltip]="vm.ledgerUnderStandingObj.balanceText.dr" [placement]="'top'">
                                            {{ vm.baseCurrencyDetails.symbol }}
                                            {{ vm.compoundTotal | giddhCurrency}}</span>
                                    </span>
                                </td>
                            </tr>
                            <tr class="total_col">
                                <!-- reckoning -->
                                <td colspan="12" class="col-xs-12 text-right h32"
                                    style="padding-right:10px !important;">
                                    <span class="bdrT">
                                        {{ vm.baseCurrencyDetails?.symbol }} {{ (vm.entryTotal.crTotal > vm.entryTotal.drTotal ? vm.entryTotal.crTotal : vm.entryTotal.drTotal)
                      | giddhCurrency }}
                                    </span>

                                    <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                        <ng-container *ngTemplateOutlet="totalWithCurrencySymbol;context: {
                      $implicit: (vm.convertedEntryTotal.crTotal > vm.convertedEntryTotal.drTotal ? vm.convertedEntryTotal.crTotal : vm.convertedEntryTotal.drTotal)
                    }"></ng-container>
                                    </p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- endregion -->
                </div>
                <!-- endregion -->
            </div>
        </div>
        <!-- endregion -->

        <!-- region new entry -->
        <div class="entrypanel width100 pt-2">
            <!-- region amount and discount container -->
            <div class="clearfix">
                <ng-container *ngIf="vm.showNewEntryPanel">
                    <div class="width100 total-detail-table"
                        [ngClass]="{'add-multicurrency': vm.isMultiCurrencyAvailable}">
                        <!-- <div *ngIf="vm.stockTrxEntry" class="table-amount">
                          <table>
                            <tbody>
                              <tr>
                                <ng-template [ngIf]="vm.stockTrxEntry">
                                  <td [ngClass]="{width40: vm.stockTrxEntry}" class="text-right pr-1">
                                    <label class="font-12">Quantity</label>
                                    <input type="text" name="" class="form-control text-right" [(ngModel)]="vm.stockTrxEntry.inventory.quantity" decimalDigitsDirective
                                      [DecimalPlaces]="4" (paste)="vm.inventoryQuantityChanged($event)" (change)="vm.inventoryQuantityChanged($event.target.value)"
                                    />
                                  </td>

                                  <td class="text-right" style="width: 115px;">
                                    <label class="font-12">Unit</label>
                                    <select class="form-control text-right no-padding" [(ngModel)]="vm.stockTrxEntry.inventory.unit.code" (change)="vm.unitChanged($event.target.value)">
                                      <option *ngFor="let item of vm.stockTrxEntry.unitRate" [value]="item.stockUnitCode">
                                        {{item.stockUnitCode}}
                                      </option>
                                    </select>
                                  </td>
                                </ng-template>
                              </tr>
                            </tbody>
                          </table>
                        </div> -->

                        <ng-template [ngIf]="vm.stockTrxEntry">
                            <div [ngClass]="{width40: vm.stockTrxEntry}" class="table-amount text-right pr-1 width-80">
                                <label class="font-12">Quantity</label>
                                <input type="text" name="" class="form-control text-right"
                                    [(ngModel)]="vm.stockTrxEntry.inventory.quantity" decimalDigitsDirective
                                    [DecimalPlaces]="4" (paste)="vm.inventoryQuantityChanged($event)"
                                    (change)="vm.inventoryQuantityChanged($event.target.value)" />
                            </div>

                            <div class="text-right table-amount width-80">
                                <label class="font-12">Unit</label>
                                <select class="form-control text-right no-padding"
                                    [(ngModel)]="vm.stockTrxEntry.inventory.unit.code"
                                    (change)="vm.unitChanged($event.target.value)">
                                    <option *ngFor="let item of vm.stockTrxEntry.unitRate" [value]="item.code">
                                        {{item.stockUnitCode}}
                                    </option>
                                </select>
                            </div>
                        </ng-template>


                        <div class="icon-box" *ngIf="vm.stockTrxEntry">
                            <label class="icon-cross"></label>
                        </div>

                        <ng-template [ngIf]="vm.stockTrxEntry">
                            <div class="text-right table-amount">
                                <label class="font-12">Price</label>
                                <input type="text" name=""
                                    (blur)="vm.inventoryPriceChanged(vm.stockTrxEntry.inventory.rate)"
                                    [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency"
                                    [suffix]="vm.selectedSuffixForCurrency"
                                    [(ngModel)]="vm.stockTrxEntry.inventory.rate" class="form-control text-right" />
                                <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                    <ng-container
                                        *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedRate }">
                                    </ng-container>
                                </p>
                            </div>
                        </ng-template>

                        <div class="icon-box" *ngIf="vm.stockTrxEntry">
                            <label class="fs20">=</label>
                        </div>

                        <div class="text-right table-amount">
                            <label class="font-12">Amount</label>
                            <input type="text" name="" class="form-control text-right" [mask]="vm.inputMaskFormat"
                                [prefix]="vm.selectedPrefixForCurrency" [suffix]="vm.selectedSuffixForCurrency"
                                (focus)="hideDiscountTax()" (blur)="vm.inventoryAmountChanged()"
                                [(ngModel)]="vm.totalAmount" />

                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedTotalAmount }">
                                </ng-container>
                            </p>
                        </div>

                        <div class="icon-box">
                            <label class="icon-minus font-12"></label>
                        </div>

                        <div class="text-right table-amount">
                            <span auto-close="outsideClick">
                                <update-ledger-discount #discount [discountAccountsDetails]="vm.discountArray"
                                    [ledgerAmount]="vm.selectedLedger.actualAmount"
                                    [prefixInput]="vm.selectedPrefixForCurrency" [maskInput]="vm.inputMaskFormat"
                                    [suffixInput]="vm.selectedSuffixForCurrency"
                                    (discountTotalUpdated)="vm.handleDiscountEntry($event); vm.generateGrandTotal();"
                                    (hideOtherPopups)="hideTax()">
                                </update-ledger-discount>
                            </span>

                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedDiscountTrxTotal }">
                                </ng-container>
                            </p>
                        </div>

                        <div class="text-center icon-box" *ngIf="(vm.companyTaxesList$ | async)?.length">
                            <label class="icon-plus font-12"></label>
                        </div>

                        <div class="text-center icon-box" *ngIf="!(vm.companyTaxesList$ | async)?.length">
                            <label class="fs20">=</label>
                        </div>

                        <div class="dropdown-container dropdown-left text-right table-amount"
                            *ngIf="(vm.companyTaxesList$ | async)?.length">
                            <span auto-close="outsideClick">
                                <update-ledger-tax-control #tax [taxes]="vm.companyTaxesList$ | async"
                                    [date]="vm.selectedLedger.entryDate" [taxRenderData]="vm.taxRenderData"
                                    [totalForTax]="vm.totalForTax" [prefixInput]="vm.selectedPrefixForCurrency"
                                    [maskInput]="vm.inputMaskFormat" [suffixInput]="vm.selectedSuffixForCurrency"
                                    [exceptTaxTypes]="['tdsrc', 'tdspay','tcspay', 'tcsrc']"
                                    [applicableTaxes]="currentAccountApplicableTaxes.length ? currentAccountApplicableTaxes : vm.selectedLedger.taxes"
                                    (hideOtherPopups)="hideDiscount()" (selectedTaxEvent)="vm.taxTrxUpdated($event)">
                                </update-ledger-tax-control>
                            </span>

                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedTaxTrxTotal }">
                                </ng-container>
                            </p>
                        </div>

                        <div class="text-center icon-box" *ngIf="(vm.companyTaxesList$ | async)?.length">
                            <label class="fs20">=</label>
                        </div>

                        <div class="text-right table-amount" (resized)="onResized($event)">
                            <label class="font-12">Total Amt.</label>
                            <input type="text" name="" class="form-control text-right" [(ngModel)]="vm.grandTotal"
                                [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency"
                                [suffix]="vm.selectedSuffixForCurrency" (blur)="vm.inventoryTotalChanged()" />
                            <p class="mb-0 amnt-total" *ngIf="vm.isMultiCurrencyAvailable">
                                <ng-container
                                    *ngTemplateOutlet="totalWithCurrencySymbol;context: { $implicit: vm.convertedGrandTotal }">
                                </ng-container>
                            </p>
                        </div>

                        <div class="text-right table-amount last-ttable-amount">
                            <div class="text-right">

                                <div *ngIf="!vm.selectedLedger.isOtherTaxesApplicable" class="other-tax">
                                    <input type="checkbox" [(ngModel)]="vm.selectedLedger.isOtherTaxesApplicable"
                                        *ngIf="!vm.selectedLedger.isOtherTaxesApplicable"
                                        (ngModelChange)="toggleOtherTaxesAsideMenu.emit(vm)" />
                                    <p class="font-14 nowrap" *ngIf="!vm.selectedLedger.isOtherTaxesApplicable">Other
                                        Tax ?</p>
                                </div>

                                <div *ngIf="vm.selectedLedger.isOtherTaxesApplicable" class="pl-1">
                                    <label>Other Tax <a href="javascript: void(0)" class="text-gray"
                                            (click)="toggleOtherTaxesAsideMenu.emit(vm)">
                                            <i class="icon-edit11 font-12 ml-05"></i>
                                        </a>
                                    </label>

                                    <input class="text-right form-control" disabled="disabled"
                                        [mask]="vm.inputMaskFormat" [prefix]="vm.selectedPrefixForCurrency"
                                        [suffix]="vm.selectedSuffixForCurrency"
                                        [(ngModel)]="vm.selectedLedger.otherTaxesSum" name="entry.otherTaxesSum" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="cearfix pd1 text-right bb-1 pr-0">
                        <span class="inWords font-14">{{vm.grandTotal | myNumberToWordsPipe | lowercase}}</span>
                    </div>
                </ng-container>
            </div>
            <!-- endregion -->

            <!-- region more details and total section -->

            <div class="row d-flex d-sm-block">
                <div class="col-md-6 pt-1">
                    <!-- make it functional (Developer end) -->
                    <div class="row mrB1">
                        <!-- Warehouse name can be empty therefore check specifically with falsy values -->
                        <div *ngIf="shouldShowWarehouse" class="col-sm-6 pdR1">
                            <div class="selectWarehouse">
                                <label class="font-12">Select Warehouse</label>
                                <sh-select [(ngModel)]="selectedWarehouse" [placeholder]="'Select Warehouse'"
                                    [options]="warehouses">
                                </sh-select>
                            </div>
                        </div>

                        <!-- TODO: Add multiple warehouse feature
                            <ng-template [ngIf]="vm.stockTrxEntry">
                            <div class="col-sm-3 pdL1 pdR1">
                                <div class="table-amount text-right ">
                                    <label class="font-12">Quantity</label>
                                    <input type="text" name="" class="form-control text-right"
                                        [(ngModel)]="vm.stockTrxEntry.inventory.quantity" decimalDigitsDirective
                                        [DecimalPlaces]="4" (paste)="vm.inventoryQuantityChanged($event)"
                                        (change)="vm.inventoryQuantityChanged($event.target.value)" />
                                </div>
                            </div>

                            <div class="col-sm-3 pdL1">
                                <div class="text-right table-amount">
                                    <label class="font-12">Unit</label>
                                    <select class="form-control text-right no-padding"
                                        [(ngModel)]="vm.stockTrxEntry.inventory.unit.code"
                                        (change)="vm.unitChanged($event.target.value)">
                                        <option *ngFor="let item of vm.stockTrxEntry.unitRate"
                                            [value]="item.stockUnitCode">
                                            {{item.stockUnitCode}}
                                        </option>
                                    </select>
                                </div>
                            </div>
                        </ng-template> -->

                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <textarea rows="3" cols="" [(ngModel)]="vm.selectedLedger.description" class="form-control"
                                placeholder="Description"></textarea>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 font-14 pt-1 bl-1 remove-border-left-onmo">
                    <table class="width100">
                        <tbody>
                            <tr>
                                <td class="primary_clr" (click)="getInvoiveLists(); showAdvanced = !showAdvanced">
                                    <i class="fa cp"
                                        [ngClass]="{'fa-minus-square-o':showAdvanced, 'fa-plus-square-o': !showAdvanced}"></i>
                                    <button class="no-btn pdL0">&nbsp; More Details</button>
                                </td>
                                <td class="text-right">
                                    <span class="primary_clr" *ngIf="vm.isMultiCurrencyAvailable">
                                        Total in {{ vm.baseCurrencyDetails?.code }}:
                                        <span>{{ vm.baseCurrencyDetails?.symbol }}</span>
                                        {{vm.compoundTotal | giddhCurrency}}
                                    </span>
                                </td>

                            </tr>

                        </tbody>
                    </table>
                    <div class="pd1 mrB mrT advanced" style="background: #F1F5F8;" *ngIf="showAdvanced">
                        <table class="xs-table-block">
                            <tr>
                                <td class="select2-parent pdR1">
                                    <div class="form-group">
                                        <label class="default_clr">Voucher Type</label>
                                        <sh-select [options]="vm.voucherTypeList" [isFilterEnabled]="true"
                                            [(ngModel)]="vm.selectedLedger.voucher.shortCode" [showClear]="false"
                                            (selected)="getInvoiveListsData($event)" [ItemHeight]="'auto'"
                                            [width]="'161px'">
                                        </sh-select>
                                    </div>
                                </td>

                                <td class="pdR1"
                                    *ngIf="(vm.selectedLedger.voucher.shortCode === 'sal' || vm.selectedLedger.voucher.shortCode === 'pur'      ||     vm.selectedLedger.voucher.shortCode == 'debit note' || vm.selectedLedger.voucher.shortCode == 'credit note'  || vm.selectedLedger.voucher.shortCode == 'pay')">
                                    <div class="form-group">
                                        <label class="default_clr">Invoice No.</label>
                                        <input type="text" placeholder="Invoice no." class="form-control"
                                            [(ngModel)]="vm.selectedLedger.invoiceNumberAgainstVoucher" />
                                    </div>
                                </td>

                                <td class="pdR1" *ngIf="vm.selectedLedger.voucher.shortCode == 'rcpt'">

                                    <div class="form-group">

                                        <label class="default_clr">Invoice No.</label>
                                        <div class="btn-group btn-block invoice-btn" dropdown>
                                            <button dropdownToggle type="button"
                                                class="form-control text-left btn-block dropdown-toggle">
                                                Select Invoices
                                                <span class="select_drop pull-right mrT1">
                                                    <i class="fa fa-caret-down"></i>
                                                </span>
                                            </button>
                                            <ul *dropdownMenu class="dropdown-menu dropdown-menu-2 width100"
                                                role="menu">
                                                <li *ngIf="invoiceList.length==0">No results found</li>
                                                <li *ngFor="let invoice of invoiceList">

                                                    <input type="checkbox" [checked]="invoice.isSelected"
                                                        (click)="selectInvoice (invoice, $event)" /> {{invoice.label}}
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                </td>

                                <td>
                                    <div class="form-group">
                                        <label class="default_clr">Voucher No.</label>
                                        <input type="text" placeholder="Voucher no." class="form-control"
                                            [ngModel]="vm.selectedLedger.voucherNo" [disabled]="true"
                                            [style.width.px]="80" />
                                    </div>
                                </td>

                            </tr>

                        </table>

                        <table class="mrT1 xs-table-block">

                            <tbody>
                                <tr>
                                    <td class="pdR1">
                                        <label class="default_clr">Cheque Number</label>
                                        <input type="text" placeholder="XXXX2619" class="form-control"
                                            [(ngModel)]="vm.selectedLedger.chequeNumber" />
                                    </td>

                                    <td>
                                        <label class="default_clr">Cheque Clearance Date</label>
                                        <input type="text" autocomplete="off" class="form-control"
                                            [(ngModel)]="vm.selectedLedger.chequeClearanceDate" bsDatepicker
                                            #chbs='bsDatepicker' [bsConfig]="{ dateInputFormat: giddhDateFormat }" />
                                    </td>

                                </tr>

                            </tbody>

                        </table>

                        <table class="mrT1">

                            <tbody>

                                <tr>
                                    <td class="pdR1">
                                        <label class="default_clr">Assign Tag</label>
                                        <sh-select [options]="tags$ | async" [isFilterEnabled]="true"
                                            [placeholder]="'Select Tag'" [showClear]="false" [multiple]="true"
                                            name="tagNames" [(ngModel)]="vm.selectedLedger.tagNames"
                                            [ItemHeight]="'auto'"></sh-select>
                                    </td>
                                </tr>

                            </tbody>

                        </table>

                    </div>

                    <div class="row">

                        <div class="col-xs-12 clearfix mrT1">

                            <div class="mrR1 form-group pull-left cp">
                                <label class="pull-left cp fs16">
                                    <input class="pull-left" type="checkbox" name="generateInvoice"
                                        [(ngModel)]="vm.selectedLedger.generateInvoice"
                                        [disabled]="vm.isInvoiceGeneratedAlready">
                                    Generate Invoice
                                </label>
                            </div>


                            <div class="pull-right">

                                <span class="primary_clr" *ngIf="!vm.isMultiCurrencyAvailable">
                                    Compound Total:
                                    {{ vm.baseCurrencyDetails?.symbol}}{{vm.compoundTotal | giddhCurrency}}
                                </span>

                                <span *ngIf="vm.isMultiCurrencyAvailable" class="primary_clr">
                                    Total in {{ vm.foreignCurrencyDetails?.code }}
                                    : {{ vm.foreignCurrencyDetails?.symbol }} {{ vm.convertedCompoundTotal | giddhCurrency
                                    }}
                                </span>

                            </div>

                        </div>

                        <div class="clearfix mb-2">

                            <div class="pull-left pl-15" *ngIf="vm.isMultiCurrencyAvailable">

                                <ul class="list-inline font-14 currency-convertor">

                                    <li>
                                        1
                                        {{ vm.selectedCurrencyForDisplay === 0 ? vm.baseCurrencyDetails?.code : vm.foreignCurrencyDetails?.code }}
                                    </li>

                                    <li>
                                        <a href="javascript:void(0)" class="text-light" (click)="toggleCurrency()">
                                            <i class="icon-switch-icon"></i>
                                        </a>
                                    </li>

                                    <li>
                                        <input type="text" class="price-input"
                                            [(ngModel)]="vm.selectedLedger.exchangeRateForDisplay"
                                            (blur)="exchangeRateChanged()"> {{ vm.selectedCurrencyForDisplay === 0 ? vm.foreignCurrencyDetails?.code : vm.baseCurrencyDetails?.code
                                        }}
                                    </li>

                                </ul>
                            </div>

                            <div class="pull-right pr-15" *ngIf="!isPettyCash">
                                <div class="file_attached pull-right text-right"
                                    *ngIf="(vm.selectedLedger)?.attachedFile?.length > 0">
                                    <span>{{ (vm.selectedLedger)?.attachedFileName }}</span>
                                    <label class="remove cp pl-1 text-danger"
                                        (click)="showDeleteAttachedFileModal()">(remove)</label>
                                </div>

                                <label class="upload_div" [ngClass]="{hide:vm.selectedLedger.attachedFile}">
                                    <input type="file" name="invoiceFile" id="invoiceFile" ngFileSelect
                                        [uploadInput]="uploadInput" (uploadOutput)="onUploadOutputUpdate($event)">
                                    <label for="invoiceFile" class="cp fs16">
                                        <i class="glyphicon glyphicon-paperclip"></i> Attach file</label>
                                </label>
                            </div>

                        </div>

                        <div class="col-xs-12 pdT1" *ngIf="!isPettyCash">
                            <div class="pull-right">
                                <button class="btn btn-danger" (click)="showDeleteEntryModal()">Delete</button>
                                <button class="btn btn-success" [ladda]="isTxnUpdateInProcess$ | async"
                                    (click)="saveLedgerTransaction()">Update
                                </button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>
<!-- endregion -->


<!-- region modals -->
<!--deleteAttachedFile  -->
<div bsModal #deleteAttachedFileModal="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <confirm-modal [title]="'Delete'" [body]="'Are you sure you want to delete the attached file?'"
                (cancelCallBack)="hideDeleteAttachedFileModal()" (successCallBack)="deleteAttachedFile()">
            </confirm-modal>
        </div>
    </div>
</div>

<!--delete entry  -->
<div bsModal #deleteEntryModal="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <confirm-modal [title]="'Delete'" [body]="'Are you sure you want to delete this entry?'"
                (cancelCallBack)="hideDeleteEntryModal()" (successCallBack)="deleteTrxEntry()">
            </confirm-modal>
        </div>
    </div>
</div>

<!-- update base account popup -->
<div bsModal #updateBaseAccount="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <base-account #baseAccount [accountUniqueName]="(baseAccount$ | async)?.uniqueName"
                (closeBaseAccountModal)="hideBaseAccountModal()"
                [flattenAccountList]="vm.flatternAccountList4Select | async"
                (updateBaseAccount)="changeBaseAccount($event)"></base-account>
        </div>
    </div>
</div>

<!-- endregion -->

<!-- region totalWithCurrencySymbol template -->
<ng-template #totalWithCurrencySymbol let-amountToDispaly>

    <span>
        {{ vm.selectedCurrency === 0 ? vm.foreignCurrencyDetails?.symbol : vm.baseCurrencyDetails?.symbol }} {{ amountToDispaly |
      giddhCurrency }}
    </span>

</ng-template>
<!-- endregion -->

<!--loading-->
<div *ngIf="(isTxnUpdateInProcess$ | async)" class="no-data mrT2 loader-main">
    <!-- <div class="giddh-spinner vertical-center-spinner"></div> -->
    <div class="spinner2">
        <div class="cube1"></div>
        <div class="cube2"></div>
    </div>
</div>
