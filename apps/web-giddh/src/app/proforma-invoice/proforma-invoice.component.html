<div class="no-data mrT2 loader-main" *ngIf="showLoader">
    <!-- <div class="giddh-spinner vertical-center-spinner"></div> -->
    <div class="spinner2">
        <div class="cube1"></div>
        <div class="cube2"></div>
    </div>
</div>

<div *ngIf="!showLoader">
    <!-- region page change menu -->
    <div class="form-group mrB mrT2 clearfix">

        <div class="col-xs-12 clearfix">

            <div class="btn-group proformaSalesTime" dropdown>

                <button id="button1-basic" dropdownToggle type="button" class="btn spcl_dropdown dropdown-toggle"
                    aria-controls="dropdown-basic">
                    {{invoiceType | titlecase}} <small *ngIf="invoiceType==='estimates'">(Beta)</small>
                    <span class="caret" *ngIf="!isUpdateMode"></span>
                </button>

                <ng-container *ngIf="!isUpdateMode">
                    <ul id="dropdown1-basic" *dropdownMenu class="dropdown-menu" role="menu"
                        aria-labelledby="button-basic">
                        <li role="menuitem" (click)="pageChanged(item.value, item.additional.label)"
                            *ngFor="let item of pageList">
                            <a class="dropdown-item cp">{{ item.additional?.label }}</a>
                        </li>
                    </ul>
                </ng-container>
            </div>

        </div>

    </div>
    <!-- endregion -->

    <!-- region update mode loader-->
    <ng-container *ngIf="isUpdateDataInProcess">

        <div class="loaderClass">
            <div class="no-data mrT2 loader-main">
                <!-- <div class="giddh-spinner vertical-center-spinner"></div> -->
                <div class="spinner2">
                    <div class="cube1"></div>
                    <div class="cube2"></div>
                </div>
            </div>
        </div>



    </ng-container>
    <!--endregion-->

    <!-- region main form -->
    <div [hidden]="(isUpdateMode && isUpdateDataInProcess) || (isLastInvoiceCopied && isUpdateDataInProcess)">
        <form #invoiceForm="ngForm" novalidate autocomplete="off"
            [ngClass]="{ 'customerInvoiceForm' : !invFormData.voucherDetails.customerName, 'cusomerInvoiceFormPurchase': isPurchaseInvoice , 'slaesPrEsti':isSalesInvoice || isProformaInvoice || isEstimateInvoice , 'forMultiCurrency' : isMulticurrencyAccount  } ">

            <div class="clearfix" [keyboardShortcut]="'alt+c'" (onShortcutPress)="addAccountFromShortcut()">

                <div class="clearfix wrapperCustomerTable  pdT2">
                    <!-- region customer and address section -->
                    <div class=" customerInvoiceTable">

                        <div class="inner-container">

                            <div class=" showforSmall-screen"
                                *ngIf="isSalesInvoice || isProformaInvoice || isEstimateInvoice">

                                <div class="text-right">
                                    <p class="fs20 b pbR1">
                                        <span
                                            class="balance-due">{{isProformaInvoice || isEstimateInvoice ? 'Total Amount' : 'Balance Due'}}</span>
                                        <span class="sp-rupees"
                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                            <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong></span>
                                        <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                        <span class="sp-rupees" *ngIf='isMulticurrencyAccount'>
                                            <span *ngIf="isMulticurrencyAccount">{{baseCurrencySymbol}}</span>
                                            <span>{{invFormData.voucherDetails.balanceDue * exchangeRate | giddhCurrency}}</span>
                                        </span>
                                        <span class="sp-rupees"
                                            *ngIf='!isMulticurrencyAccount'>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</span>
                                    </p>
                                </div>

                            </div>

                            <!-- region customer section -->
                            <div class="clearfix">

                                <div class="row">
                                    <!-- region customer name -->
                                    <div class=" col-sm-2">
                                        <label>{{!isPurchaseInvoice ? 'Customer' : 'Vendor'}} Name<span
                                                class="red-text">*</span></label>
                                    </div>
                                    <!-- endregion -->

                                    <!-- region customer dropdown -->
                                    <div class="col-sm-7 selectCustomerName">

                                        <div class="clearfix d-flex" style="flex-direction: column">
                                            <div class="d-flex">
                                                <!-- region if not cashinvoice show customer dropdown -->
                                                <ng-container *ngIf="!isCashInvoice">
                                                    <sales-sh-select style="width:62.7%; float: left;"
                                                        name="voucherDetails.customerName" #customerNameDropDown
                                                        [options]="customerAcList$ | async"
                                                        [(ngModel)]="invFormData.voucherDetails.customerUniquename"
                                                        [customFilter]="customMoveGroupFilter"
                                                        (noOptionsFound)="noResultsForCustomer($event)"
                                                        (selected)="onSelectCustomer($event);"
                                                        [placeholder]="customerPlaceHolder" [notFoundLink]="true"
                                                        [doNotReset]="true" [forceClearReactive]="forceClear$ | async"
                                                        [isFilterEnabled]="true" (noResultsClicked)="addNewAccount()"
                                                        [multiple]="false" [ItemHeight]="67"
                                                        [notFoundLinkText]="customerNotFoundText"
                                                        (keyup)="resetCustomerName($event)"
                                                        (onClear)="resetCustomerName(null)" [disabled]="isUpdateMode">

                                                        <ng-template #optionTemplate let-option="option">
                                                            <a href="javascript:void(0)" class="list-item"
                                                                style="border-bottom: 1px solid #ccc;">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item_unq">{{ option.value }}</div>
                                                            </a>
                                                        </ng-template>

                                                        <ng-template #notFoundLinkTemplate>
                                                            <a href="javascript:void(0)" class="list-item"
                                                                [keyboardShortcut]="'alt+c'"
                                                                style="width:100%; display: flex;justify-content: space-between;">
                                                                <div class="item">{{ customerNotFoundText }}</div>
                                                                <div class="item">Alt+C</div>
                                                            </a>
                                                        </ng-template>

                                                    </sales-sh-select>
                                                </ng-container>
                                                <!-- endregion -->
                                                <!-- region if not cashinvoice show customer dropdown -->
                                                <ng-container *ngIf="isCashInvoice">
                                                    <input type="text" name="voucherDetails.customerName"
                                                        #inputCustomerName class="form-control cashInvoiceInput"
                                                        [(ngModel)]="invFormData.voucherDetails.customerName"
                                                        (blur)='selectDefaultbank()' [readOnly]="isUpdateMode">
                                                </ng-container>
                                                <!-- endregion -->

                                                <!-- region previous details commented for multicurrency changes-->
                                                <!--<div class="d-flex cp aquaColor" #copyPreviousEstimate
                          *ngIf="invFormData.voucherDetails.customerName && lastInvoices.length && !isMulticurrencyAccount"
                          style="align-items: center;margin-left: 2%">
                          <a href="javascript: void 0" (click)="showLastEstimateModal = !showLastEstimateModal">
                            <i class="fa fa-files-o"></i>
                            Copy Previous {{ invoiceType | voucherTypeToNamePipe | titlecase}} Invoices
                          </a>

                          <ng-container
                            *ngTemplateOutlet="lastEstimateModal;context:{ $implicit: showLastEstimateModal}">
                          </ng-container>

                        </div>-->
                                                <!-- endregion -->
                                            </div>

                                            <!-- region Unregistered Business / customer details -->
                                            <div class="d-flex aquaColor"
                                                *ngIf="invFormData.voucherDetails.customerName">

                                                <!--                      <span style="margin-right: 5px" class="cp aquaColor" #unregisteredBusiness>-->
                                                <!--                        <a href="javascript:void 0" (click)="showGstTreatmentModal = !showGstTreatmentModal">-->
                                                <!--                          Unregistered Business-->
                                                <!--                        </a>-->
                                                <!--                      </span>-->

                                                <ng-container
                                                    *ngTemplateOutlet="gstTreatmentModal;context:{ $implicit: showGstTreatmentModal}">
                                                </ng-container>

                                                <!--                      <p style="margin-right: 5px; color: #A9A9A9;">|</p>-->

                                                <span style="margin-right: 5px" class="cp aquaColor"
                                                    *ngIf="!isCashInvoice && !isUpdateMode">
                                                    <a href="javascript:void(0)" (click)="getCustomerDetails()">{{!isPurchaseInvoice ? 'Customer' : 'Vendor'}} Details</a>
                                                </span>
                                            </div>
                                            <!-- endregion -->
                                        </div>

                                    </div>
                                    <!-- endregion -->

                                </div>
                            </div>
                            <!-- endregion -->

                            <!-- region customer address section -->
                            <div class="row">

                                <div class="col-sm-9 col-sm-offset-2">
                                    <ng-container>

                                        <section class="form-inline"
                                            [ngClass]="{' billing-addressWrap' : !invFormData.voucherDetails.customerName }">

                                            <div class=" wrap-billing-address clearfix">

                                                <div class="row">
                                                    <!-- region billing address -->
                                                    <div class="col-sm-6 bill-add">

                                                        <div class="form-group">
                                                            <label>Billing Address</label>

                                                            <div class="billing-address clearfix">
                                                                <textarea name="billingDetails.address"
                                                                    class="form-control"
                                                                    (keyup)="autoFillShippingDetails()" rows="3"
                                                                    autocomplete="off"
                                                                    [(ngModel)]="invFormData.accountDetails.billingDetails.address[0]"
                                                                    autofocus="off" aria-autocomplete="none"
                                                                    #customerBillingAddress></textarea>

                                                                <div class="">
                                                                    <div class="col-sm-6 pd ">
                                                                        <label class="salesCountryLabel">
                                                                            {{ customerCountryName }}
                                                                        </label>
                                                                    </div>

                                                                    <div class="col-sm-6 pd ">
                                                                        <sales-sh-select [placeholder]="'State'"
                                                                            class="select-bdr-bottom"
                                                                            (selected)="fillShippingBillingDetails($event, true); autoFillShippingDetails()"
                                                                            #statesBilling [showBottomBorderOnly]="true"
                                                                            [options]="statesSource"
                                                                            name="billingDetails.stateCode"
                                                                            [(ngModel)]="invFormData.accountDetails.billingDetails.state.code">
                                                                        </sales-sh-select>
                                                                    </div>

                                                                    <div class="col-sm-12 pd ">
                                                                        <!-- <label>GSTIN</label> -->
                                                                        <input maxLength="15" autocomplete="None"
                                                                            type="text" name="billingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            *ngIf="showGSTINNo"
                                                                            [(ngModel)]="invFormData.accountDetails.billingDetails.gstNumber"
                                                                            (keyup)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()"
                                                                            placeholder="GSTIN" />
                                                                        <input maxLength="15" autocomplete="None"
                                                                            type="text" name="billingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            *ngIf="showTRNNo"
                                                                            [(ngModel)]="invFormData.accountDetails.billingDetails.gstNumber"
                                                                            (keyup)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()"
                                                                            placeholder="TRN" />
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>

                                                    </div>
                                                    <!-- endregion -->

                                                    <!-- region shipping address -->
                                                    <div class="col-sm-6 bill-add">

                                                        <div class="form-group p0 width100">
                                                            <label>
                                                                <input type="checkbox" autocomplete="None"
                                                                    (change)="autoFillShippingDetails()"
                                                                    name="autoFillShipping"
                                                                    [(ngModel)]="autoFillShipping"> Shipping Address
                                                                Same as
                                                                Billing
                                                                Address
                                                            </label>

                                                            <div class="billing-address"
                                                                [ngClass]="{'disabled': autoFillShipping}">

                                                                <textarea [readonly]="autoFillShipping"
                                                                    name="shippingDetails.address" class="form-control"
                                                                    [(ngModel)]="invFormData.accountDetails.shippingDetails.address[0]"
                                                                    rows="3" autocomplete="off"></textarea>

                                                                <div class="clearfix">

                                                                    <div class="form-group">

                                                                        <div class="col-sm-6 pd ">
                                                                            <div class="form-group">

                                                                                <label class="salesCountryLabel">
                                                                                    {{ customerCountryName }}
                                                                                </label>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-sm-6 pd ">

                                                                            <sales-sh-select
                                                                                [disabled]="autoFillShipping"
                                                                                [placeholder]="'State'"
                                                                                class="select-bdr-bottom"
                                                                                #statesShipping
                                                                                [showBottomBorderOnly]="true"
                                                                                (selected)="fillShippingBillingDetails($event, false)"
                                                                                [options]="statesSource"
                                                                                name="shippingDetails.stateCode"
                                                                                [(ngModel)]="invFormData.accountDetails.shippingDetails.state.code">
                                                                            </sales-sh-select>
                                                                        </div>

                                                                        <div class="col-sm-12 pd ">

                                                                            <input [readonly]="autoFillShipping"
                                                                                autocomplete="None" maxLength="15"
                                                                                type="text"
                                                                                name="shippingDetails.gstNumber"
                                                                                *ngIf="showGSTINNo"
                                                                                class="form-control input-custom"
                                                                                [(ngModel)]="invFormData.accountDetails.shippingDetails.gstNumber"
                                                                                (keyup)="getStateCode('shippingDetails', statesShipping)"
                                                                                placeholder="GSTIN" />
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                </div>

                                            </div>

                                        </section>
                                    </ng-container>
                                </div>
                            </div>
                            <!-- endregion -->
                        </div>

                        <!-- region balance due -->
                        <div class="col-sm-3 balanceDueAbs"
                            *ngIf="isSalesInvoice || isProformaInvoice || isEstimateInvoice">

                            <div class="text-right">
                                <p class="fs20 b pbR1">
                                    <span
                                        class="balance-due">{{isProformaInvoice || isEstimateInvoice ? 'Total Amount' : 'Balance Due'}}</span>
                                    <span class="sp-rupees"
                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                        <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong></span>
                                    <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                    <span class="sp-rupees" *ngIf='isMulticurrencyAccount'>
                                        <span *ngIf="isMulticurrencyAccount">{{baseCurrencySymbol}}</span>
                                        <span>{{invFormData.voucherDetails.balanceDue * exchangeRate | giddhCurrency}}</span>
                                    </span>
                                    <span class="sp-rupees"
                                        *ngIf='!isMulticurrencyAccount'>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</span>
                                </p>
                            </div>

                        </div>
                        <!-- endregion -->
                    </div>
                    <!-- endregion -->

                    <!-- region attention to, email, mobile, voucher section -->
                    <div class="customerInvoiceTable bg-white pdB2 pdT2">
                        <div class="inner-container">

                            <!-- region attention to -->
                            <div class="row">

                                <div class="col-sm-2">
                                    <label>Attention to</label>
                                </div>

                                <div class="col-sm-9">
                                    <div class=" pl0  col-sm-6">

                                        <input type="text" name="accountDetails.attention" placeholder="Attention to"
                                            class="form-control attentionTo"
                                            [(ngModel)]="invFormData.accountDetails.attentionTo" />
                                    </div>
                                </div>

                            </div>
                            <!-- endregion-->

                            <!-- region email -->
                            <div class="row mTB1">
                                <div class="col-sm-2">
                                    <label>Email Id</label>
                                </div>
                                <div class="col-sm-9">
                                    <div class="col-sm-6 pl-0">
                                        <input type="email" placeholder="someone@example.com"
                                            name="accountDetails.email" class="form-control attentionTo"
                                            [(ngModel)]="invFormData.accountDetails.email" />
                                    </div>
                                </div>
                            </div>

                            <!-- endregion-->

                            <!-- region mobile no -->
                            <div class="row mTB1">

                                <div class="col-sm-2">
                                    <label>Mobile Number</label>
                                </div>

                                <div class="col-sm-9">
                                    <div class="col-sm-6 pl-0">
                                        <input digitsOnlyDirective placeholder="9198XXXXXXXX" type="text"
                                            name="accountDetails.mobileNumber" class="form-control attentionTo"
                                            [(ngModel)]="invFormData.accountDetails.mobileNumber" />
                                    </div>
                                </div>
                            </div>
                            <!-- endregion-->
                            <!-- warehouse selection -->
                            <!-- make it dynamic by ( Developer end ) -->
                            <div class="row mTB1">
                                <div class="col-sm-2">
                                    <label>Warehouse <span class="red-text">*</span> </label>
                                </div>
                                <div class="col-sm-9">
                                    <div class="col-sm-6 pl-0">
                                        <sh-select [options]="selectWarehouse">
                                        </sh-select>
                                    </div>
                                </div>
                            </div>
                            <!-- end warehouse field -->
                            <!-- region invoice no, invoice date, Expiry date -->
                            <div class="row mTB1">

                                <div class="col-sm-2">
                                    <label> {{ invoiceNoLabel }}</label>
                                </div>

                                <div class="col-sm-9">

                                    <div class="col-sm-6 pl-0">
                                        <input type="text" name="accountDetails.invoiceNum"
                                            class="form-control invoiceDate attentionTo"
                                            [ngClass]="{'dateinvoice': !isPurchaseInvoice }" [disabled]="isUpdateMode"
                                            [(ngModel)]="invFormData.voucherDetails.voucherNumber" />
                                    </div>

                                    <div class="col-sm-6 invoiceDateDueDate">
                                        <div class="form-inline">

                                            <div class="form-group">
                                                <label>{{ invoiceDateLabel }}</label>

                                                <input type="text" [placeholder]="giddhDateFormat"
                                                    #voucherDate="ngModel" name="voucherDate"
                                                    class="form-control dateinvoice" bsDatepicker
                                                    [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                    [(ngModel)]="invFormData.voucherDetails.voucherDate"
                                                    [disabled]="isUpdateMode"
                                                    [class.invalid-inp]="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)"
                                                    (blur)="onBlurInvoiceDate(0)" />
                                                <p class="text-danger"
                                                    *ngIf="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)">
                                                    Invalid Date
                                                </p>

                                            </div>

                                            <div class="form-group m-l-10"
                                                *ngIf="isSalesInvoice || isPurchaseInvoice || isProformaInvoice || isEstimateInvoice">
                                                <label>{{ invoiceDueDateLabel }}</label>

                                                <input type="text" [placeholder]="giddhDateFormat" #dueDate="ngModel"
                                                    name="dueDate" class="form-control dateinvoice" bsDatepicker
                                                    [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                    [(ngModel)]="invFormData.voucherDetails.dueDate"
                                                    [class.invalid-inp]="dueDate.errors && (dueDate.dirty || dueDate.touched)"
                                                    (blur)="onBlurDueDate(0)" />
                                                <p class="text-danger"
                                                    *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)">Invalid
                                                    Date
                                                </p>

                                            </div>

                                        </div>
                                    </div>


                                </div>

                            </div>

                            <div class="row mTB1 showOnsmall-screen">
                                <div class="col-sm-2">
                                    <label>{{ invoiceDateLabel }}</label>
                                </div>
                                <div class="col-sm-9">
                                    <div class="col-sm-6 pl-0">
                                        <input type="text" [placeholder]="giddhDateFormat" #voucherDate="ngModel"
                                            name="voucherDate" class="form-control dateinvoice" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            [(ngModel)]="invFormData.voucherDetails.voucherDate"
                                            [disabled]="isUpdateMode"
                                            [class.invalid-inp]="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)" />
                                        <p class="text-danger"
                                            *ngIf="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)">
                                            Invalid Date
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="row mTB1 showOnsmall-screen"
                                *ngIf="isSalesInvoice || isPurchaseInvoice || isProformaInvoice || isEstimateInvoice">
                                <div class="col-sm-2">
                                    <label>{{ invoiceDueDateLabel }}</label>
                                </div>
                                <div class="col-sm-9">
                                    <div class="col-sm-6 pl-0">
                                        <input type="text" [placeholder]="giddhDateFormat" #dueDate="ngModel"
                                            name="dueDate" class="form-control dateinvoice" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            [(ngModel)]="invFormData.voucherDetails.dueDate"
                                            [class.invalid-inp]="dueDate.errors && (dueDate.dirty || dueDate.touched)" />
                                        <p class="text-danger"
                                            *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)">Invalid Date
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <!-- endregion -->

                        </div>
                    </div>
                    <!-- endregion -->

                </div>
            </div>

            <!-- region search_customer image -->
            <ng-container *ngIf="isSalesInvoice && !isCashInvoice">
                <img src="assets/images/new/search_customer.svg" class="img-responsive tip_img "
                    *ngIf="!invFormData.voucherDetails.customerName" />
            </ng-container>

            <!-- need to show this image on purchase invoice module -->
            <ng-container *ngIf="isPurchaseInvoice">
                <img src="assets/images/new/search-vendor.svg" class="img-responsive tip_img "
                    *ngIf="!invFormData.voucherDetails.customerName" />
            </ng-container>

            <ng-container *ngIf="isCashInvoice">
                <img src="assets/images/new/search_customer_Cash Invoice.svg"
                    class="img-responsive  cashinvoice_tipImg tip_img "
                    *ngIf="!invFormData.voucherDetails.customerName" />
            </ng-container>
            <!-- endregion -->

            <!-- region entries table -->
            <ng-container>

                <!-- region normal view -->
                <section class="staticInvoiceTable salseInvoicetable clearfix mrB2 whiteBg container-fluid ng-tns-c8-0"
                    *ngIf="!isMobileView">

                    <ng-container *ngIf="isSalesInvoice || isCashInvoice">
                        <!-- switch currency on click, remaining functional work , UI is completed -->
                        <div class="switch-currency" *ngIf="isMulticurrencyAccount && !showSwitchedCurr">
                            <span class="left-currency">1 {{companyCurrencyName}}</span>
                            <img class="switchIcon" src="assets/images/switch-icon.svg" alt="switch-icon"
                                (click)="switchCurrencyImg(true)">
                            <span class="right-currency">
                                <span class="currency-digits"
                                    *ngIf="!showCurrencyValue">{{originalExchangeRate | giddhCurrency}}</span>
                                <input type="number" name="exchangeRate" [(ngModel)]="exchangeRate"
                                    *ngIf="showCurrencyValue" class="form-control edit-currency"> {{companyCurrency}}
                            </span>

                            <span class="edit-icon cp">
                                <img src="assets/images/edit-pencilicon.svg" class="edit-pencil" *ngIf="!autoSaveIcon"
                                    (click)="showCurrencyValue = !showCurrencyValue ; autoSaveIcon = !autoSaveIcon; exchangeRate = originalExchangeRate">
                                <img src=" assets/images/autosave.svg" class="edit-pencil"
                                    (click)="originalExchangeRate = exchangeRate; autoSaveIcon = !autoSaveIcon; showCurrencyValue= !showCurrencyValue; calculateGrandTotal()"
                                    *ngIf="autoSaveIcon">
                            </span>


                        </div>
                        <!-- switch currency on click, remaining functional work , UI is completed -->
                        <div class="switch-currency" *ngIf="isMulticurrencyAccount && showSwitchedCurr">
                            <span class="left-currency">1 {{companyCurrency}}</span>
                            <img class="switchIcon" src="assets/images/switch-icon.svg" alt="switch-icon"
                                (click)="switchCurrencyImg(false)">
                            <span class="right-currency">
                                <span class="currency-digits"
                                    *ngIf="!showCurrencyValue">{{originalReverseExchangeRate | giddhCurrency}}</span>
                                <input type="number" name="exchangeRate" [(ngModel)]="reverseExchangeRate"
                                    *ngIf="showCurrencyValue" class="form-control edit-currency">
                                {{companyCurrencyName}}
                            </span>

                            <span class="edit-icon cp">
                                <img *ngIf="!autoSaveIcon" src="assets/images/edit-pencilicon.svg" class="edit-pencil"
                                    (click)="saveCancelExcRate(false)">
                                <img src=" assets/images/autosave.svg" class="edit-pencil"
                                    (click)="saveCancelExcRate(true)" *ngIf="autoSaveIcon">
                            </span>


                        </div>
                    </ng-container>
                    <table class="table table-custom-invoice  basic">
                        <thead>

                            <tr>

                                <th *ngFor="let item of theadArrReadOnly;" [hidden]="!item.display"
                                    class="theadOfSalesInvoice" [ngClass]="item.label">
                                    {{item.label}}
                                </th>

                            </tr>
                        </thead>
                        <tbody
                            *ngFor="let entry of invFormData.entries; let entryIdx = index; let first = first; let last = last"
                            (clickOutside)="activeIndx = null" [exclude]="'.entriesTr'">

                            <ng-container *ngFor="let transaction of entry.transactions;">
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature) -->
                                <!-- region static entries-->
                                <tr (click)="setActiveIndx(entryIdx);$event.stopPropagation()"
                                    [hidden]="activeIndx === entryIdx" class="entriesTr setActive"
                                    [ngClass]="{'isOtherTax' : entry.isOtherTaxApplicable && isMulticurrencyAccount}">

                                    <td>{{ entryIdx + 1 }}</td>

                                    <td>
                                        <div class="productName">
                                            <label *ngIf="!transaction.accountName" class="selectAccountLabel">Click to
                                                Select
                                                Account</label> {{transaction.accountName}}
                                            <span
                                                *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}}
                                                )</span>

                                        </div>

                                        <div class="skuNumber">
                                            <label>SKU:</label>Number
                                        </div>

                                        <div class="discription">
                                            {{transaction.description}}

                                        </div>
                                        <p class="small text-muted sku_and_customfields"
                                            *ngIf="transaction.sku_and_customfields">
                                            {{transaction.sku_and_customfields}}</p>
                                        <div class="dateHsnCode">

                                            <div class="row">

                                                <div class="col-xs-6 pdR0" *ngIf="entry.entryDate">
                                                    <div class="entryDate">
                                                        <label>Entry Date: </label>
                                                        {{entry.entryDate | date: 'dd-MM-yyyy'}}
                                                        <span class="edit-icon cp" *ngIf="!isUpdateMode">
                                                            <img src="assets/images/edit-pencilicon.svg">
                                                        </span>

                                                    </div>
                                                </div>

                                                <div class="col-xs-6 pdL0" *ngIf="transaction.hsnNumber">
                                                    <div class="hsnCode text-right">
                                                        <label>HSN/SAC:</label>
                                                        <span>
                                                            {{transaction.hsnNumber}}
                                                            <span class="edit-icon cp">
                                                                <img src="assets/images/edit-pencilicon.svg">
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </td>
                                    <td class="text-right stockUnit">
                                        <div class="wrap-td-data">
                                            {{transaction.quantity}} {{transaction.stockUnit}}
                                        </div>
                                    </td>
                                    <td class="text-right tra-rate item-rate " style="height:1px;">
                                        <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                            <div class="td_Wrapper">
                                                <div style="flex: 1;">
                                                    <div class="wrap-td-data"> <span *ngIf="isMulticurrencyAccount">
                                                            {{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{transaction.rate | giddhCurrency}}
                                                    </div>
                                                </div>
                                            </div>

                                            <div *ngIf="isMulticurrencyAccount" class="differ-currency">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{transaction.rate * exchangeRate | giddhCurrency}}</span>

                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-right  item-amount" style="height:1px;">
                                        <div class="td_Wrapper">
                                            <div style="flex: 1;">
                                                <div class="wrap-td-data"><span
                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{transaction.amount | giddhCurrency}}</div>
                                            </div>
                                        </div>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>{{baseCurrencySymbol}}</span>
                                            <span>{{transaction.amount * exchangeRate | giddhCurrency}}</span>
                                        </div>
                                    </td>
                                    <td class="item-discount" style="height:1px;">
                                        <div class=" text-right td_Wrapper">

                                            <div style="flex: 1;">
                                                <div class="wrap-td-data"> <span
                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{ entry.discountSum | giddhCurrency}}</div>
                                            </div>
                                        </div>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>{{baseCurrencySymbol}}</span>
                                            <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>

                                        </div>


                                    </td>
                                    <td class="text-right item-tax" style="height:1px;">
                                        <div class="td_Wrapper">
                                            <div style="flex:1;">
                                                <div class="wrap-td-data"><span
                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{(entry.taxSum + entry.cessSum) | giddhCurrency}}</div>
                                            </div>
                                        </div>
                                        <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                            <span>{{baseCurrencySymbol}}</span>
                                            <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                        </div>
                                    </td>
                                    <td class="text-right item-tax dlt-abs" style="height:1px;">
                                        <div class="td_Wrapper">
                                            <div style="flex:1;">
                                                <div class="wrap-td-data">
                                                    <span><span
                                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                                        </span>{{transaction.total | giddhCurrency}}</span>
                                                    <br>
                                                    <span *ngIf="entry.isOtherTaxApplicable">
                                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }} : <span
                                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                                        </span>{{ entry.otherTaxSum }}
                                                    </span>
                                                </div>
                                                <div class="texIncurrency"
                                                    *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount">
                                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>


                                                </div>

                                            </div>

                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                            </div>

                                        </div>

                                        <div class="trashIconDlt"
                                            *ngIf="!isUpdateMode || (isUpdateMode && entry.isNewEntryInUpdateMode)"
                                            (click)="removeTransaction(entryIdx)">
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                    <!-- <td class="text-center" style="width:3%;">

        <span class="cp" (click)="removeTransaction(entryIdx)"
          *ngIf="!isUpdateMode || (isUpdateMode && entry.isNewEntryInUpdateMode)">
          <i class="icon-trash" aria-hidden="true"></i>
        </span>
      </td> -->
                                </tr>

                                <!-- endregion -->

                                <!-- region dynamic entries-->
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature)-->
                                <tr [hidden]="activeIndx !== entryIdx" class="entriesTr defaultActive"
                                    (click)="$event.stopPropagation();">
                                    <td>{{ entryIdx + 1 }}</td>
                                    <td>

                                        <div class="productName">
                                            <div class="ng-select-wrap">
                                                <sh-select [options]="salesAccounts$ | async" #selectAccount
                                                    [(ngModel)]="transaction.fakeAccForSelect2"
                                                    name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                                    (selected)="onSelectSalesAccount($event,transaction, entry)"
                                                    [placeholder]="'Select A/cc'" [notFoundLink]="true"
                                                    [forceClearReactive]="forceClear$ | async"
                                                    (noResultsClicked)="onNoResultsClicked(entryIdx)" [multiple]="false"
                                                    [ItemHeight]="67" (onClear)="onClearSalesAccount(transaction)"
                                                    [useInBuiltFilterForFlattenAc]="true">

                                                    <ng-template #optionTemplate let-option="option">
                                                        <ng-container *ngIf="!option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item"
                                                                style="border-bottom: 1px solid #ccc;">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item_unq">
                                                                    {{ option.additional?.uniqueName }}</div>
                                                            </a>
                                                        </ng-container>
                                                        <ng-container *ngIf="option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item"
                                                                style="border-bottom: 1px solid #ccc;">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item_unq">
                                                                    {{ option.additional?.uniqueName }}</div>
                                                                <div class="item_stock">Stock:
                                                                    {{ option.additional?.stock.uniqueName }}</div>
                                                            </a>
                                                        </ng-container>
                                                    </ng-template>
                                                </sh-select>
                                            </div>
                                        </div>

                                        <div class="" *ngIf="transaction.fakeAccForSelect2">
                                            <div class="skuNumber">
                                                <label>SKU:</label>Number
                                            </div>

                                            <div class="discription">
                                                <textarea type="text" placeholder="Add Description"
                                                    name="transaction.description_{{entryIdx}}" class="form-control"
                                                    [(ngModel)]="transaction.description" #description>
                  </textarea>
                                                <p class="small text-muted sku_and_customfields"
                                                    *ngIf="transaction.sku_and_customfields">
                                                    {{transaction.sku_and_customfields}}</p>
                                            </div>

                                            <!-- region entry date/ hsncode -->
                                            <div class="dateHsnCode">

                                                <div class="row">
                                                    <div class="col-xs-6 pdR0">
                                                        <div class="entryDate">
                                                            <label>Entry Date: </label>

                                                            <span *ngIf="!isUpdateMode">
                                                                <input type="text" [placeholder]="giddhDateFormat"
                                                                    bsDatepicker name="transaction.date_{{entryIdx}}"
                                                                    class="form-control text-left"
                                                                    [(ngModel)]="entry.entryDate"
                                                                    [disabled]="isUpdateMode"
                                                                    [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                                    #dp="bsDatepicker" />
                                                                <span class="edit-icon cp" (click)="dp.toggle()"
                                                                    [attr.aria-expanded]="dp.isOpen">
                                                                    <img src="assets/images/edit-pencilicon.svg">
                                                                </span>
                                                            </span>

                                                            <span *ngIf="isUpdateMode">
                                                                {{ entry.entryDate | date: 'dd-MM-yyyy'}}
                                                            </span>

                                                        </div>
                                                    </div>

                                                    <div class="col-xs-6 pdL0">
                                                        <div class="wrap-hsnBox">
                                                            <div class="hsnCode text-right"
                                                                (click)="hsnDropdownShow=!hsnDropdownShow">
                                                                <label>HSN/SAC:</label>
                                                                <span>
                                                                    {{transaction.hsnNumber }}
                                                                    <span *ngIf="!transaction.hsnNumber"
                                                                        class="updateText">Update
                                                                    </span>
                                                                    <span class="edit-icon cp">
                                                                        <img src="assets/images/edit-pencilicon.svg">
                                                                    </span>
                                                                </span>
                                                            </div>


                                                            <div class="hsnCodeDropdown" *ngIf="hsnDropdownShow">
                                                                <label>HSN/SAC</label>
                                                                <input type="text" maxLength="10"
                                                                    placeholder="HSN/SAC Number"
                                                                    name="transaction.hsnNumber_{{entryIdx}}" class=""
                                                                    [(ngModel)]="transaction.hsnNumber" />
                                                                <a>
                                                                    <!--                            <i class="fa fa-search"></i> -->
                                                                </a>
                                                                <div class="btngroup m-t-10">
                                                                    <button class="btn btn-sm btn-success" type="button"
                                                                        (click)="hsnDropdownShow=!hsnDropdownShow">Save
                                                                    </button>
                                                                    <button class="btn btn-sm btn-primary" type="button"
                                                                        (click)="hsnDropdownShow=!hsnDropdownShow">
                                                                        Cancel
                                                                    </button>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <!-- endregion -->
                                        </div>
                                    </td>

                                    <td class="text-right stockUnit">
                                        <input type="text" [disabled]="!transaction.isStockTxn"
                                            (blur)="calculateStockEntryAmount(transaction); calculateWhenTrxAltered(entry, transaction);"
                                            placeholder="Quantity" decimalDigitsDirective
                                            name="transaction.quantity_{{entryIdx}}" class="form-control text-right"
                                            [(ngModel)]="transaction.quantity" />

                                        <select class="form-control" [disabled]="!transaction.isStockTxn"
                                            name="transaction.stockUnit_{{entryIdx}}"
                                            [(ngModel)]="transaction.stockUnit"
                                            (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                            <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">
                                                {{stock.text}}
                                            </option>
                                        </select>
                                    </td>

                                    <td class="text-right item-rate" style="
                      height: 1px;">
                                        <div class="td_Wrapper">

                                            <div style="flex: 1;">
                                                <input type="text" [disabled]="!transaction.isStockTxn"
                                                    (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                                    placeholder="Rate" decimalDigitsDirective
                                                    name="transaction.rate_{{entryIdx}}"
                                                    class="form-control transaction-rate text-right"
                                                    [(ngModel)]="transaction.rate"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                            </div>
                                            <!-- please add condition for show and hide -->
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{transaction.rate * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                        </div>

                                    </td>


                                    <td class="text-right item-amount" style="height:1px;">
                                        <div class="td_Wrapper">
                                            <div style="flex: 1;">
                                                <input type="text" [disabled]="transaction.isStockTxn"
                                                    (blur)="calculateWhenTrxAltered(entry, transaction)"
                                                    placeholder="Amount" name="transaction.amount_{{entryIdx}}"
                                                    class="form-control text-right" [(ngModel)]="transaction.amount"
                                                    decimalDigitsDirective
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{transaction.amount * exchangeRate | giddhCurrency}}</span>
                                            </div>

                                        </div>
                                    </td>

                                    <td class="item-discount" style="height:1px;">
                                        <div class="td_Wrapper">
                                            <div class="text-right" style="flex:1;">

                                                <discount-control-component #discountComponent [discountMenu]="false"
                                                    [discountAccountsDetails]="entry.discounts"
                                                    [discountSum]="entry.discountSum" [showHeaderText]="false"
                                                    (hideOtherPopups)="closeTaxControlPopup()"
                                                    (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency">
                                                </discount-control-component>

                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                        </div>
                                    </td>

                                    <td class="pos-rel dropdown-container item-tax" style="height:1px;">
                                        <div class="td_Wrapper">
                                            <div class="text-right" style="flex:1;">
                                                <tax-control [taxes]="companyTaxesList" [date]="entry.entryDate"
                                                    [taxRenderData]="entry.taxes"
                                                    [totalForTax]="transaction.taxableValue"
                                                    [applicableTaxes]="transaction.applicableTaxes"
                                                    [exceptTaxTypes]="exceptTaxTypes"
                                                    [allowedSelectionOfAType]="[{ type: ['GST', 'commongst', 'InputGST'], count:1 }]"
                                                    [showHeading]="false" [rootClass]="'salseInvoicetable'"
                                                    (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                                    (hideOtherPopups)="closeDiscountPopup()"
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency">
                                                </tax-control>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                        </div>
                                    </td>

                                    <td class="text-right item-total dlt-abs" style="height:1px;">
                                        <div class="td_Wrapper">

                                            <div style="flex:1;">
                                                <input type="text" name="transaction.total_{{entryIdx}}"
                                                    class="form-control text-right" [(ngModel)]="transaction.total"
                                                    readonly decimalDigitsDirective
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />

                                                <div class="wrap-otherTax">
                                                    <input type="checkbox" class="other-taxes-checkobx"
                                                        [(ngModel)]="entry.isOtherTaxApplicable"
                                                        *ngIf="!entry.isOtherTaxApplicable"
                                                        name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                        id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                        (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                                    <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                        *ngIf="!entry.isOtherTaxApplicable" class="otherTaxLable"
                                                        style="font-size:13px;vertical-align: middle">Other Tax?</label>
                                                </div>
                                                <div *ngIf="entry.isOtherTaxApplicable" class="mrT1">

                                                    <span>

                                                        <div style="display: flex;align-items: center">
                                                            <span style="margin-right: 5px">
                                                                <a href="javascript: void 0"
                                                                    (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                                    <img src="assets/images/edit-pencilicon.svg">
                                                                </a>
                                                            </span>

                                                            <input class="text-right otherTaxsinput" disabled="disabled"
                                                                [(ngModel)]="entry.otherTaxSum"
                                                                [prefix]="invFormData.accountDetails.currencySymbol"
                                                                [suffix]="selectedSuffixForCurrency"
                                                                [mask]="inputMaskFormat" name="entry.otherTaxesSum" />
                                                        </div>

                                                        <p
                                                            style="margin-top: 5px; font-size: 12px; text-transform: capitalize; margin-bottom: 20px;">
                                                            {{ entry.otherTaxModal?.appliedOtherTax?.name}}</p>
                                                    </span>

                                                </div>
                                            </div>
                                            <div *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount"
                                                class="texIncurrency" style="color:#999;">
                                                {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                <span>{{baseCurrencySymbol}}</span> :
                                                <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                            <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                            </div>


                                            <ng-container
                                                *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                            </ng-container>

                                        </div>

                                        <div class="trashIconDlt"
                                            *ngIf="!isUpdateMode || (isUpdateMode && entry.isNewEntryInUpdateMode)"
                                            (click)="removeTransaction(entryIdx)">
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                    <!-- <td class="action-panel-td text-center" style="width:3%;">

        <span class="cp" (click)="removeTransaction(entryIdx)"
          *ngIf="!isUpdateMode || (isUpdateMode && entry.isNewEntryInUpdateMode)">
          <i class="icon-trash" aria-hidden="true"></i>
        </span>
      </td> -->
                                </tr>
                                <!-- endregion -->

                            </ng-container>

                        </tbody>

                        <!-- region add bulk items -->
                        <div class="p-4 aquaColor add-line-bulk-item" style="width: max-content;">
                            <a class="" href="javascript:void 0" (click)="addBlankRow(null)">+ Add New Line</a>
                            <span style="font-size:14px; color: #c5c5c5;"> | </span>
                            <a class="" (click)="showBulkItemModal = true; bulkItemsModal.show()"
                                href="javascript:void 0">+ Add
                                Bulk
                                Entries</a>
                        </div>
                        <!-- endregion -->

                        <tfoot>

                            <tr>

                                <td colspan="4">

                                    <!-- region other details-->
                                    <div class="">

                                        <div class="collapse-pane clearfix">

                                            <div class="collapse-pane-heading"
                                                (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">

                                                <div class="ico-box-wrap">
                                                    <div class="ico-box">
                                                        <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                                            aria-hidden="true"></span>
                                                    </div>
                                                </div>

                                                <div class="ico-head">Other Details</div>
                                            </div>

                                            <div [collapse]="isOthrDtlCollapsed" class="clearfix max-600 pdL3 mr0">

                                                <div class="row">

                                                    <div class="form-group col-xs-4">
                                                        <input type="text" #shippingDate="ngModel"
                                                            [placeholder]="giddhDateFormat" bsDatepicker
                                                            name="shippingDate"
                                                            [(ngModel)]="invFormData.templateDetails.other.shippingDate"
                                                            class="form-control"
                                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                            placeholder="Ship Date"
                                                            [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)" />
                                                        <p class="text-danger"
                                                            *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                            Invalid Date
                                                        </p>
                                                    </div>

                                                    <div class="form-group col-xs-4">
                                                        <input type="text" name="shippedVia"
                                                            [(ngModel)]="invFormData.templateDetails.other.shippedVia"
                                                            class="form-control" placeholder="Ship Via" />
                                                    </div>

                                                    <div class="form-group col-xs-4">
                                                        <input type="text" name="trackingNumber"
                                                            [(ngModel)]="invFormData.templateDetails.other.trackingNumber"
                                                            class="form-control" placeholder="Tracking No." />
                                                    </div>

                                                </div>

                                                <div class="row">

                                                    <div class="form-group col-xs-4">
                                                        <input type="text" name="customField1"
                                                            [(ngModel)]="invFormData.templateDetails.other.customField1"
                                                            class="form-control" placeholder="Field 1" />
                                                    </div>

                                                    <div class="form-group col-xs-4">
                                                        <input type="text" name="customField2"
                                                            [(ngModel)]="invFormData.templateDetails.other.customField2"
                                                            class="form-control" placeholder="Field 2" />
                                                    </div>

                                                    <div class="form-group col-xs-4">
                                                        <input type="text" name="customField3"
                                                            [(ngModel)]="invFormData.templateDetails.other.customField3"
                                                            class="form-control" placeholder="Field 3" />
                                                    </div>

                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                    <!-- endregion -->

                                    <!-- region note/messages -->
                                    <div class="pdT1 pl0 max-600" *ngIf="!isPurchaseInvoice">

                                        <label class="mrB1">Note</label>
                                        <textarea style="height:120px !important" class="form-control" name="message2"
                                            [(ngModel)]="invFormData.templateDetails.other.message2">
                </textarea>
                                    </div>
                                    <!-- endregion -->

                                    <!-- region attachment -->
                                    <div class="pdT1 pl0 max-600 pos-rel" *ngIf="isPurchaseInvoice">

                                        <label class="mrB1"><i class="glyphicon glyphicon-paperclip"></i>
                                            Attachment</label>

                                        <label class="custom-file-label form-control cp pos-rel" for="invoiceFile">
                                            <em *ngIf="!selectedFileName">Drag/Drop file or click here</em>
                                            <em *ngIf="selectedFileName" class="text-success">{{selectedFileName}}</em>
                                            <span class="text-success"><i class="fa fa-check"
                                                    *ngIf="selectedFileName"></i></span>
                                            <input type="file" name="invoiceFile" id="invoiceFile"
                                                [options]="fileUploadOptions" ngFileSelect [uploadInput]="uploadInput"
                                                (uploadOutput)="onUploadOutput($event)"
                                                (change)="onFileChange($event.target)" droppable="true">
                                        </label>

                                    </div>
                                    <!-- endregion -->

                                </td>
                                <!-- region total section -->
                                <td colspan="4">

                                    <section class="tableSec form-group">

                                        <div class="tableRow">
                                            <div class="tableCell">Total Amount</div>
                                            <div class="tableCell figureCell">
                                                <span
                                                    *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.subTotal | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow">
                                            <div class="tableCell">Discount</div>
                                            <div class="tableCell figureCell">
                                                - <span
                                                    *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.totalDiscount | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow">
                                            <div class="tableCell">Taxable Value</div>
                                            <div class="tableCell figureCell">
                                                <span
                                                    *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.totalTaxableValue | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow">
                                            <div class="tableCell">Tax</div>
                                            <div class="tableCell figureCell">
                                                <span
                                                    *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.gstTaxesTotal | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow">
                                            <div class="tableCell">CESS</div>
                                            <div class="tableCell figureCell"><span
                                                    *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.cessTotal | giddhCurrency}}
                                            </div>
                                        </div>
                                        <div class="tableRow" *ngIf="calculatedRoundOff > 0 || calculatedRoundOff < 0">

                                            <div class="tableCell">
                                                <strong>Round Off</strong>
                                                <!-- {{invFormData.voucherDetails.roundOff && invFormData.voucherDetails.roundOff.balanceType && invFormData.voucherDetails.roundOff.balanceType === 'CREDIT' ? '(-)' : '(+)'}} -->
                                            </div>

                                            <div class="tableCell figureCell">
                                                <strong> <span
                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                    {{calculatedRoundOff | giddhCurrency}}</strong>
                                            </div>

                                        </div>

                                        <div class="tableRow ">

                                            <div class="tableCell biggerDollar">
                                                <strong>Total <span
                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span></strong>
                                            </div>

                                            <div class="tableCell figureCell">
                                                <strong><span
                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.grandTotal | giddhCurrency}}
                                                </strong>
                                            </div>

                                        </div>
                                        <!-- multicurrency feature (editable grand total make it functional) -->
                                        <div class="tableRow" *ngIf="isMulticurrencyAccount">
                                            <div class="tableCell biggerDollar">
                                                <strong>Total <span>{{baseCurrencySymbol}}</span>
                                                </strong>
                                            </div>

                                            <div class="tableCell figureCell">
                                                <input #grandTotalInr type="text" class="form-control"
                                                    name="grandTotalMulDum" [prefix]="baseCurrencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                    [(ngModel)]="grandTotalMulDum"
                                                    (blur)="updateExchangeRate(grandTotalInr.value)">

                                            </div>
                                        </div>

                                        <div class="tableRow" *ngIf="invFormData.voucherDetails.tcsTotal > 0">
                                            <div class="tableCell">TCS</div>
                                            <div class="tableCell figureCell"><span
                                                    *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                {{invFormData.voucherDetails.tcsTotal | giddhCurrency}}</div>
                                        </div>

                                        <div class="tableRow" *ngIf="invFormData.voucherDetails.tdsTotal > 0">
                                            <div class="tableCell">TDS</div>
                                            <div class="tableCell figureCell"><span
                                                    *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.tdsTotal | giddhCurrency}}
                                            </div>
                                        </div>

                                        <!--region balance due for non-purchase-->
                                        <div class="tableRow"
                                            *ngIf="((isSalesInvoice || isCashInvoice) && !isUpdateMode)">

                                            <div class="tableCell depositeSection">

                                                <div class="btn-group">

                                                    <div (click)="clickedInside($event)" id="deposit-dropdown"
                                                        class="form-group pd1">
                                                        <p>Deposit</p>
                                                        <ul>
                                                            <!--                          <li role="menuitem">-->
                                                            <li role="menuitem" class="mrT1 ">
                                                                <div class="clearfix paymentMode">

                                                                    <sh-select class="pull-right "
                                                                        name="depositAccountUniqueName"
                                                                        [options]="bankAccounts$ | async"
                                                                        [(ngModel)]="depositAccountUniqueName"
                                                                        (selected)="onSelectPaymentMode($event)"
                                                                        [placeholder]="'Select Account'"
                                                                        [notFoundLink]="false"
                                                                        [forceClearReactive]="forceClear$ | async"
                                                                        [multiple]="false" [ItemHeight]="33"
                                                                        [useInBuiltFilterForIOptionTypeItems]="true"
                                                                        class="text-left">
                                                                        <ng-template #optionTemplate1
                                                                            let-option="option">
                                                                            <a href="javascript:void(0)"
                                                                                class="list-item"
                                                                                style="border-bottom: 1px solid #ccc;">
                                                                                <div class="item">{{ option.label }}
                                                                                </div>
                                                                                <div class="item_unq">{{ option.value }}
                                                                                </div>
                                                                            </a>
                                                                        </ng-template>
                                                                    </sh-select>
                                                                    <label class="pull-right">Payment Mode</label>
                                                                </div>
                                                            </li>

                                                            <li class="clearfix mrT1" *ngIf="isSalesInvoice">
                                                                <input type="text" (blur)="calculateBalanceDue()"
                                                                    placeholder="Amount" name="dueAmount"
                                                                    class="form-control amountField text-right pull-right max100"
                                                                    [(ngModel)]="depositAmount"
                                                                    [prefix]="depositCurrSymbol"
                                                                    [suffix]="selectedSuffixForCurrency"
                                                                    [mask]="inputMaskFormat" />
                                                                <label class="pull-right">Amount</label>
                                                            </li>

                                                            <li class="clearfix mrT1" *ngIf="isCashInvoice">
                                                                <span
                                                                    class="amountField pull-right max100 amountFiledCash">
                                                                    <span
                                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                                    {{invFormData.voucherDetails.balanceDue | giddhCurrency}}</span>
                                                                <label class="pull-right">Amount</label>
                                                            </li>

                                                            <li class="clearfix mrT1 biggerDollar"
                                                                *ngIf="isSalesInvoice ">
                                                                <strong class="pull-right balanceDueText"> <span
                                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                                    {{invFormData.voucherDetails.balanceDue | giddhCurrency}}
                                                                </strong>
                                                                <strong class="pull-right">Balance Due</strong>
                                                            </li>

                                                        </ul>
                                                    </div>

                                                </div>
                                            </div>

                                            <!--                  <div class="tableCell figureCell">-->
                                            <!--                    {{depositAmount | giddhCurrency}}-->
                                            <!--                  </div>-->
                                        </div>
                                        <!--endregion-->

                                        <!-- region balance due for purchase -->
                                        <div class="tableRow" *ngIf="isPurchaseInvoice">
                                            <div class="tableCell">
                                                <strong>Balance Due</strong>
                                            </div>
                                            <div class="tableCell figureCell">
                                                <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong>
                                            </div>
                                        </div>
                                        <!-- endregion -->


                                    </section>
                                </td>
                                <!-- endregion -->

                                <td></td>

                            </tr>
                        </tfoot>

                    </table>

                </section>
                <!-- endregion -->

                <!-- region mobile view  -->
                <div class="showInMobile">
                    <div class="card-invoiceTable-wrapper"
                        *ngFor="let entry of invFormData.entries; let entryIdx = index; let first = first; let last = last">

                        <ng-container *ngFor="let transaction of entry.transactions;">
                            <!-- region static entry -->
                            <div class="card-invoiceTable" [hidden]="activeIndx === entryIdx">
                                <div class="row">

                                    <div class="col-xs-12">

                                        <div class="single-card-row">

                                            <div class="productName">
                                                <label class="card-label">Product/Service Description</label>
                                                <label *ngIf="!transaction.accountName" class="selectAccountLabel">Click
                                                    to Select
                                                    Account</label>
                                                <p>{{transaction.accountName}}</p>
                                                <span
                                                    *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}}
                                                    )</span>
                                            </div>

                                            <p class="discription">
                                                {{transaction.description}}
                                            </p>
                                            <p class="small text-muted sku_and_customfields"
                                                *ngIf="transaction.sku_and_customfields">
                                                {{transaction.sku_and_customfields}}</p>

                                            <div class="dateHsnCode pdR0">
                                                <div class="row">

                                                    <div class="col-xs-6" *ngIf="entry.entryDate">
                                                        <div class="entryDate">
                                                            <label>Entry Date: {{entry.entryDate | date: 'dd-MM-yyyy'}}
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <div class="col-xs-6 pdL0" *ngIf="transaction.hsnNumber">
                                                        <div class="hsnCode text-right">
                                                            <label>HSN/SAC:
                                                                {{transaction.hsnNumber}}</label>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                </div>

                                <div class="row">

                                    <div class="col-xs-6">

                                        <div class="single-card-row">
                                            <div class="qty-unit">
                                                <label class="card-label">Qty/Unit</label>
                                                <p>{{transaction.quantity}} {{transaction.stockUnit}}</p>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-xs-6">

                                        <div class="single-card-row">
                                            <div class="card-rate">
                                                <label class="card-label">Rate</label>
                                                <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">

                                                    <p> <span *ngIf="isMulticurrencyAccount">
                                                            {{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{transaction.rate | giddhCurrency}}
                                                    </p>


                                                    <div *ngIf="isMulticurrencyAccount" class="differ-currency">
                                                        <span>{{baseCurrencySymbol}}</span>
                                                        <span>{{transaction.rate * exchangeRate | giddhCurrency}}</span>

                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>

                                </div>

                                <div class="row">

                                    <div class="col-xs-6">

                                        <div class="single-card-row">
                                            <div class="card-amount">
                                                <label class="card-label">Amount</label>
                                                <p> <span
                                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{transaction.amount | giddhCurrency}}</p>

                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{transaction.amount * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-xs-6">

                                        <div class="single-card-row">
                                            <div class="card-discount">
                                                <label class="card-label">Discount</label>
                                                <p> <span *ngIf="isMulticurrencyAccount">
                                                        {{invFormData.accountDetails.currencySymbol}}</span>{{ entry.discountSum }}
                                                </p>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>

                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>

                                <div class="row">

                                    <div class="col-xs-6">
                                        <div class="single-card-row">
                                            <div class="card-tax">
                                                <label class="card-label">Tax</label>
                                                <p><span *ngIf="isMulticurrencyAccount">
                                                        {{invFormData.accountDetails.currencySymbol}}</span>{{entry.taxSum}}
                                                    %
                                                </p>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-6">
                                        <div class="single-card-row">
                                            <div class="card-total">
                                                <label class="card-label">Total</label>
                                                <p><span *ngIf="isMulticurrencyAccount">
                                                        {{invFormData.accountDetails.currencySymbol}}</span>{{transaction.total | giddhCurrency}}
                                                </p>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="edit-card" (click)="setActiveIndx(entryIdx);$event.stopPropagation()">
                                    <img src="assets/images/edit-pencilicon.svg">
                                </div>

                                <div class="del-card" (click)="removeTransaction(entryIdx)"
                                    *ngIf="!isUpdateMode || (isUpdateMode && entry.isNewEntryInUpdateMode)">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </div>

                            </div>
                            <!-- endregion -->

                            <!-- region dynamic entry -->
                            <div class="card-invoiceTable edit-card-invoiceTable" [hidden]="activeIndx !== entryIdx">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="single-card-row">
                                            <div class="productName">
                                                <label class="card-label">Product/Service Description</label>
                                                <div class="productName">
                                                    <div class="ng-select-wrap">
                                                        <sh-select [options]="salesAccounts$ | async"
                                                            [(ngModel)]="transaction.fakeAccForSelect2"
                                                            name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                                            (selected)="onSelectSalesAccount($event,transaction, entry)"
                                                            [placeholder]="'Select A/cc'" [notFoundLink]="true"
                                                            [forceClearReactive]="forceClear$ | async"
                                                            (noResultsClicked)="onNoResultsClicked(entryIdx)"
                                                            [multiple]="false" [ItemHeight]="67"
                                                            (onClear)="onClearSalesAccount(transaction)"
                                                            [useInBuiltFilterForFlattenAc]="true">

                                                            <ng-template #optionTemplate let-option="option">
                                                                <ng-container *ngIf="!option.additional?.stock">
                                                                    <a href="javascript:void(0)" class="list-item"
                                                                        style="border-bottom: 1px solid #ccc;">
                                                                        <div class="item">{{ option.label }}</div>
                                                                        <div class="item_unq">
                                                                            {{ option.additional?.uniqueName }}</div>
                                                                    </a>
                                                                </ng-container>
                                                                <ng-container *ngIf="option.additional?.stock">
                                                                    <a href="javascript:void(0)" class="list-item"
                                                                        style="border-bottom: 1px solid #ccc;">
                                                                        <div class="item">{{ option.label }}</div>
                                                                        <div class="item_unq">
                                                                            {{ option.additional?.uniqueName }}</div>
                                                                        <div class="item_stock">Stock:
                                                                            {{ option.additional?.stock.uniqueName }}
                                                                        </div>
                                                                    </a>
                                                                </ng-container>
                                                            </ng-template>
                                                        </sh-select>
                                                    </div>
                                                </div>

                                                <div class="" *ngIf="transaction.fakeAccForSelect2">
                                                    <div class="skuNumber">
                                                        <label>SKU:</label>Number
                                                    </div>

                                                    <div class="discription">
                                                        <textarea type="text" placeholder="Add Description"
                                                            name="transaction.description_{{entryIdx}}"
                                                            class="form-control" [(ngModel)]="transaction.description">
                                          </textarea>
                                                        <p class="small text-muted sku_and_customfields"
                                                            *ngIf="transaction.sku_and_customfields">
                                                            {{transaction.sku_and_customfields}}</p>
                                                    </div>

                                                    <!-- region entry date/ hsncode -->
                                                    <div class="dateHsnCode">

                                                        <div class="row">
                                                            <div class="col-xs-6 pdR0">
                                                                <div class="entryDate">
                                                                    <label>Entry Date: </label>

                                                                    <span *ngIf="!isUpdateMode">
                                                                        <input type="text"
                                                                            [placeholder]="giddhDateFormat" bsDatepicker
                                                                            name="transaction.date_{{entryIdx}}"
                                                                            class="form-control text-left"
                                                                            [(ngModel)]="entry.entryDate"
                                                                            [disabled]="isUpdateMode"
                                                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                                            #dp="bsDatepicker" />
                                                                        <span class="edit-icon cp" (click)="dp.toggle()"
                                                                            [attr.aria-expanded]="dp.isOpen">
                                                                            <img
                                                                                src="assets/images/edit-pencilicon.svg">
                                                                        </span>
                                                                    </span>

                                                                    <span *ngIf="isUpdateMode">
                                                                        {{ entry.entryDate | date: 'dd-MM-yyyy'}}
                                                                    </span>

                                                                </div>
                                                            </div>

                                                            <div class="col-xs-6 pdL0">
                                                                <div class="wrap-hsnBox">
                                                                    <div class="hsnCode text-right"
                                                                        (click)="hsnDropdownShow=!hsnDropdownShow">
                                                                        <label>HSN/SAC:</label>
                                                                        <span>
                                                                            {{transaction.hsnNumber }}
                                                                            <span *ngIf="!transaction.hsnNumber"
                                                                                class="updateText">Update
                                                                            </span>
                                                                            <span class="edit-icon cp">
                                                                                <img
                                                                                    src="assets/images/edit-pencilicon.svg">
                                                                            </span>
                                                                        </span>
                                                                    </div>


                                                                    <div class="hsnCodeDropdown"
                                                                        *ngIf="hsnDropdownShow">
                                                                        <label>HSN/SAC</label>
                                                                        <input type="text" maxLength="10"
                                                                            placeholder="HSN/SAC Number"
                                                                            name="transaction.hsnNumber_{{entryIdx}}"
                                                                            class=""
                                                                            [(ngModel)]="transaction.hsnNumber" />
                                                                        <a>
                                                                            <!--                            <i class="fa fa-search"></i> -->
                                                                        </a>
                                                                        <div class="btngroup m-t-10">
                                                                            <button class="btn btn-sm btn-success"
                                                                                type="button"
                                                                                (click)="hsnDropdownShow=!hsnDropdownShow">
                                                                                Save
                                                                            </button>
                                                                            <button class="btn btn-sm btn-primary"
                                                                                type="button"
                                                                                (click)="hsnDropdownShow=!hsnDropdownShow">
                                                                                Cancel
                                                                            </button>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <!-- endregion -->
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row quantityUnitW100">
                                    <div class="col-xs-6">

                                        <div class="single-card-row">
                                            <div class="qty-unit">

                                                <div class="row">

                                                    <div class="col-xs-6" style="padding-right:0;">
                                                        <label class="card-label text-right">Qty</label>
                                                        <input type="text" [disabled]="!transaction.isStockTxn"
                                                            (blur)="calculateStockEntryAmount(transaction); calculateWhenTrxAltered(entry, transaction);"
                                                            placeholder="Quantity" decimalDigitsDirective
                                                            name="transaction.quantity_{{entryIdx}}"
                                                            class="form-control text-right"
                                                            [(ngModel)]="transaction.quantity" />
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <label class="card-label text-right">Unit</label>
                                                        <select class="form-control"
                                                            [disabled]="!transaction.isStockTxn"
                                                            name="transaction.stockUnit_{{entryIdx}}"
                                                            [(ngModel)]="transaction.stockUnit"
                                                            (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                                            <option *ngFor="let stock of transaction.stockList"
                                                                [ngValue]="stock.id">
                                                                {{stock.text}}
                                                            </option>
                                                        </select>

                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-xs-6">

                                        <div class="single-card-row">

                                            <div class="card-rate">
                                                <label class="card-label text-right">Rate</label>
                                                <div style="flex: 1;">
                                                    <input type="text" [disabled]="!transaction.isStockTxn"
                                                        (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                                        placeholder="Rate" decimalDigitsDirective
                                                        name="transaction.rate_{{entryIdx}}"
                                                        class="form-control transaction-rate text-right"
                                                        [(ngModel)]="transaction.rate"
                                                        [prefix]="invFormData.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                                </div>
                                                <!-- please add condition for show and hide -->
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{transaction.rate * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-xs-6">

                                        <div class="single-card-row">

                                            <div class="card-amount">

                                                <label class="card-label text-right">Amount</label>
                                                <div style="flex: 1;">
                                                    <input type="text" [disabled]="transaction.isStockTxn"
                                                        (blur)="calculateWhenTrxAltered(entry, transaction)"
                                                        placeholder="Amount" name="transaction.amount_{{entryIdx}}"
                                                        class="form-control text-right" [(ngModel)]="transaction.amount"
                                                        decimalDigitsDirective
                                                        [prefix]="invFormData.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{transaction.amount * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="col-xs-6">

                                        <div class="single-card-row">

                                            <div class="card-discount">
                                                <label class="card-label text-right">Discount</label>
                                                <div class="text-right" style="flex:1;">

                                                    <discount-control-component #discountComponent
                                                        [discountMenu]="false"
                                                        [discountAccountsDetails]="entry.discounts"
                                                        [discountSum]="entry.discountSum" [showHeaderText]="false"
                                                        (hideOtherPopups)="closeTaxControlPopup()"
                                                        (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                                        [maskInput]="inputMaskFormat"
                                                        [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                        [suffixInput]="selectedSuffixForCurrency">
                                                    </discount-control-component>

                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-xs-6">

                                        <div class="single-card-row">
                                            <div class="card-tax">
                                                <label class="card-label text-right">Tax</label>

                                                <div class="text-right" style="flex:1;">
                                                    <tax-control [taxes]="companyTaxesList" [date]="entry.entryDate"
                                                        [taxRenderData]="entry.taxes"
                                                        [totalForTax]="transaction.taxableValue"
                                                        [applicableTaxes]="transaction.applicableTaxes"
                                                        [exceptTaxTypes]="exceptTaxTypes"
                                                        [allowedSelectionOfAType]="[{ type: ['GST', 'commongst', 'InputGST'], count:1 }]"
                                                        [showHeading]="false" [rootClass]="'salseInvoicetable'"
                                                        (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                                        (hideOtherPopups)="closeDiscountPopup()"
                                                        [maskInput]="inputMaskFormat"
                                                        [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                        [suffixInput]="selectedSuffixForCurrency">
                                                    </tax-control>
                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-6">
                                        <div class="single-card-row">
                                            <div class="card-total">
                                                <label class="card-label text-right">Total</label>
                                                <div style="flex:1;">
                                                    <input type="text" name="transaction.total_{{entryIdx}}"
                                                        class="form-control text-right" [(ngModel)]="transaction.total"
                                                        readonly decimalDigitsDirective
                                                        [prefix]="invFormData.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />

                                                    <div class="wrap-otherTax">
                                                        <input type="checkbox" class="other-taxes-checkobx"
                                                            [(ngModel)]="entry.isOtherTaxApplicable"
                                                            *ngIf="!entry.isOtherTaxApplicable"
                                                            name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                            id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                            (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                                        <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                            *ngIf="!entry.isOtherTaxApplicable" class="otherTaxLable"
                                                            style="font-size:13px;vertical-align: middle">Other
                                                            Tax?</label>
                                                    </div>
                                                    <div *ngIf="entry.isOtherTaxApplicable" class="mrT1 othertaxes">

                                                        <span>

                                                            <div style="display: flex;align-items: center">
                                                                <span style="margin-right: 5px">
                                                                    <a href="javascript: void 0"
                                                                        (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                                        <img src="assets/images/edit-pencilicon.svg">
                                                                    </a>
                                                                </span>

                                                                <input class="text-right otherTaxsinput"
                                                                    disabled="disabled" [(ngModel)]="entry.otherTaxSum"
                                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                                    [suffix]="selectedSuffixForCurrency"
                                                                    [mask]="inputMaskFormat"
                                                                    name="entry.otherTaxesSum" />
                                                            </div>

                                                            <p
                                                                style="margin-top: 5px; font-size: 12px; text-transform: capitalize; margin-bottom: 20px;">
                                                                {{ entry.otherTaxModal?.appliedOtherTax?.name}}</p>
                                                        </span>

                                                    </div>
                                                </div>
                                                <div *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount"
                                                    class="texIncurrency" style="color:#999;">
                                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                    <span>{{baseCurrencySymbol}}</span> :
                                                    <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                                </div>


                                                <ng-container
                                                    *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                                </ng-container>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="saveCard-data">
                                    <i class="fa fa-floppy-o" aria-hidden="true"></i>
                                </div>

                                <div class="del-card" (click)="removeTransaction(entryIdx)"
                                    *ngIf="!isUpdateMode || (isUpdateMode && entry.isNewEntryInUpdateMode)">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </div>

                            </div>
                            <!-- endregion -->
                        </ng-container>

                    </div>

                    <div class="add-btn" (click)="addBlankRow(null)">
                        <button class="btn btn-sm btn-success">Add More</button>
                    </div>

                    <div class="otherDetail-card">

                        <div class="">
                            <div class="collapse-pane clearfix">

                                <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                                    <div class="ico-box-wrap">
                                        <div class="ico-box">
                                            <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'"
                                                aria-hidden="true"></span>
                                        </div>
                                    </div>
                                    <div class="ico-head">Other Details</div>
                                </div>

                                <div [collapse]="isOthrDtlCollapsed" class="clearfix max-600  mr0">

                                    <div class="row">

                                        <div class="form-group col-xs-4">
                                            <input type="text" #shippingDate="ngModel" [placeholder]="giddhDateFormat"
                                                bsDatepicker name="shippingDate"
                                                [(ngModel)]="invFormData.templateDetails.other.shippingDate"
                                                class="form-control" [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                placeholder="Ship Date"
                                                [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)" />
                                            <p class="text-danger"
                                                *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                Invalid Date</p>
                                        </div>

                                        <div class="form-group col-xs-4">
                                            <input type="text" name="shippedVia"
                                                [(ngModel)]="invFormData.templateDetails.other.shippedVia"
                                                class="form-control" placeholder="Ship Via" />
                                        </div>

                                        <div class="form-group col-xs-4">
                                            <input type="text" name="trackingNumber"
                                                [(ngModel)]="invFormData.templateDetails.other.trackingNumber"
                                                class="form-control" placeholder="Tracking No." />
                                        </div>

                                        <div class="form-group col-xs-4">
                                            <input type="text" name="customField1"
                                                [(ngModel)]="invFormData.templateDetails.other.customField1"
                                                class="form-control" placeholder="Field 1" />
                                        </div>

                                        <div class="form-group col-xs-4">
                                            <input type="text" name="customField2"
                                                [(ngModel)]="invFormData.templateDetails.other.customField2"
                                                class="form-control" placeholder="Field 2" />
                                        </div>

                                        <div class="form-group col-xs-4">
                                            <input type="text" name="customField3"
                                                [(ngModel)]="invFormData.templateDetails.other.customField3"
                                                class="form-control" placeholder="Field 3" />
                                        </div>

                                    </div>


                                </div>

                            </div>

                            <div class="pdT1 pl0 max-600" *ngIf="!isPurchaseInvoice">
                                <label class="mrB1">Message</label>
                                <textarea style="height:120px" class="form-control" name="message2"
                                    [(ngModel)]="invFormData.templateDetails.other.message2"></textarea>
                            </div>

                        </div>
                    </div>

                    <div class="total-amountDiscription">

                        <section class="tableSec form-group">

                            <div class="tableRow">
                                <div class="tableCell">Total Amount</div>
                                <div class="tableCell figureCell">
                                    <span
                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.subTotal | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow">
                                <div class="tableCell">Discount</div>
                                <div class="tableCell figureCell"><span
                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>-{{invFormData.voucherDetails.totalDiscount | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow">
                                <div class="tableCell">Taxable Value</div>
                                <div class="tableCell figureCell">
                                    <span
                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.totalTaxableValue | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow">
                                <div class="tableCell">Tax</div>
                                <div class="tableCell figureCell"><span
                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.gstTaxesTotal | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow">
                                <div class="tableCell">CESS</div>
                                <div class="tableCell figureCell"><span
                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.cessTotal | giddhCurrency}}
                                </div>
                            </div>
                            <div class="tableRow" *ngIf="calculatedRoundOff > 0 || calculatedRoundOff < 0">

                                <div class="tableCell">
                                    <strong>Round Off</strong>
                                    <!-- {{invFormData.voucherDetails.roundOff && invFormData.voucherDetails.roundOff.balanceType && invFormData.voucherDetails.roundOff.balanceType === 'CREDIT' ? '(-)' : '(+)'}} -->
                                </div>

                                <div class="tableCell figureCell">
                                    <strong> <span
                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                        {{calculatedRoundOff | giddhCurrency}}</strong>
                                </div>

                            </div>
                            <div class="tableRow">
                                <div class="tableCell">
                                    <strong>Total <span
                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span></strong>
                                </div>

                                <div class="tableCell figureCell">
                                    <strong><span
                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.grandTotal | giddhCurrency}}
                                    </strong>
                                </div>
                            </div>
                            <!-- <div class="tableRow">
                <div class="tableCell">
                  <strong>Total <span
                      *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                  </strong>
                </div>

                <div class="tableCell figureCell" *ngIf="isMulticurrencyAccount">
                  <input type="text" class="form-control" [value]="invFormData.voucherDetails.grandTotal">

                </div>
              </div> -->
                            <div class="tableRow" *ngIf="isMulticurrencyAccount">
                                <div class="tableCell biggerDollar">
                                    <strong>Total <span>{{baseCurrencySymbol}}</span>
                                    </strong>
                                </div>

                                <div class="tableCell figureCell">
                                    <input #grandTotalInr type="text" class="form-control" name="grandTotalMulDum"
                                        [prefix]="baseCurrencySymbol" [suffix]="selectedSuffixForCurrency"
                                        [mask]="inputMaskFormat" [(ngModel)]="grandTotalMulDum"
                                        (blur)="updateExchangeRate(grandTotalInr.value)">

                                </div>
                            </div>


                            <div class="tableRow" *ngIf="invFormData.voucherDetails.tcsTotal > 0">
                                <div class="tableCell">TCS</div>
                                <div class="tableCell figureCell">
                                    {{invFormData.voucherDetails.tcsTotal | giddhCurrency}}</div>
                            </div>

                            <div class="tableRow" *ngIf="invFormData.voucherDetails.tdsTotal > 0">
                                <div class="tableCell">TDS</div>
                                <div class="tableCell figureCell">
                                    {{invFormData.voucherDetails.tdsTotal | giddhCurrency}}</div>
                            </div>

                            <!-- <div class="tableRow" *ngIf="toggleFieldForSales && isCustomerSelected && !isPurchaseInvoice">
                <div class="tableCell">

                  <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle"
                      aria-controls="deposit-dropdown_dropdown_mobile">
                      Deposit
                    </button>

                    <ul (click)="clickedInside($event)" id="deposit-dropdown_mobile" *ngIf="dropdownisOpen"
                      class="dropdown-menu form-group pd1" role="menu" aria-labelledby="button-dropup">
                      <span class="caret"></span>

                      <li role="menuitem">
                        <div class="">
                          <label>Amount</label>
                          <input type="number" (blur)="calculateBalanceDue()" placeholder="Amount" name="dueAmount"
                            class="form-control max100" decimalDigitsDirective [(ngModel)]="depositAmount" />
                        </div>
                      </li>

                      <li role="menuitem" class="mrT1">

                        <div class="">

                          <label>Payment Mode</label>
                          <sh-select name="depositAccountUniqueName" [options]="bankAccounts$ | async"
                            [(ngModel)]="depositAccountUniqueName" (selected)="onSelectPaymentMode($event)"
                            [placeholder]="'Select Account'" [notFoundLink]="false"
                            [forceClearReactive]="forceClear$ | async" [multiple]="false" [ItemHeight]="33"
                            [useInBuiltFilterForIOptionTypeItems]="true" class="text-left">
                            <ng-template #optionTemplate1 let-option="option">
                              <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                                <div class="item">{{ option.label }}</div>
                                <div class="item_unq">{{ option.value }}</div>
                              </a>
                            </ng-template>
                          </sh-select>

                        </div>

                      </li>
                    </ul>

                  </div>

                </div>

              </div> -->
                            <!--region balance due for non-purchase-->
                            <div class="tableRow" *ngIf="((isSalesInvoice || isCashInvoice) && !isUpdateMode )">

                                <div class="tableCell depositeSection">

                                    <div class="btn-group">

                                        <div (click)="clickedInside($event)" id="deposit-dropdown"
                                            class="form-group pd1">
                                            <p>Deposit</p>
                                            <ul>
                                                <!--                          <li role="menuitem">-->
                                                <li role="menuitem" class="mrT1 ">
                                                    <div class="clearfix paymentMode">

                                                        <sh-select class="pull-right " name="depositAccountUniqueName"
                                                            [options]="bankAccounts$ | async"
                                                            [(ngModel)]="depositAccountUniqueName"
                                                            (selected)="onSelectPaymentMode($event)"
                                                            [placeholder]="'Select Account'" [notFoundLink]="false"
                                                            [forceClearReactive]="forceClear$ | async"
                                                            [multiple]="false" [ItemHeight]="33"
                                                            [useInBuiltFilterForIOptionTypeItems]="true"
                                                            class="text-left">
                                                            <ng-template #optionTemplate1 let-option="option">
                                                                <a href="javascript:void(0)" class="list-item"
                                                                    style="border-bottom: 1px solid #ccc;">
                                                                    <div class="item">{{ option.label }}</div>
                                                                    <div class="item_unq">{{ option.value }}</div>
                                                                </a>
                                                            </ng-template>
                                                        </sh-select>
                                                        <label class="pull-right">Payment Mode</label>
                                                    </div>
                                                </li>

                                                <li class="clearfix mrT1" *ngIf="isSalesInvoice">
                                                    <input type="text" (blur)="calculateBalanceDue()"
                                                        placeholder="Amount" name="dueAmount"
                                                        class="form-control amountField text-right pull-right max100"
                                                        [(ngModel)]="depositAmount" [prefix]="depositCurrSymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                                    <label class="pull-right">Amount</label>
                                                </li>

                                                <li class="clearfix mrT1" *ngIf="isCashInvoice">
                                                    <span class="amountField pull-right max100 amountFiledCash">
                                                        <span
                                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{invFormData.voucherDetails.balanceDue | giddhCurrency}}</span>
                                                    <label class="pull-right">Amount</label>
                                                </li>

                                                <li class="clearfix mrT1 biggerDollar" *ngIf="isSalesInvoice ">
                                                    <strong class="pull-right balanceDueText"> <span
                                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{invFormData.voucherDetails.balanceDue | giddhCurrency}}
                                                    </strong>
                                                    <strong class="pull-right">Balance Due</strong>
                                                </li>

                                            </ul>
                                        </div>

                                    </div>
                                </div>

                                <!--                  <div class="tableCell figureCell">-->
                                <!--                    {{depositAmount | giddhCurrency}}-->
                                <!--                  </div>-->
                            </div>
                            <!--endregion-->

                            <!-- region balance due for purchase -->
                            <div class="tableRow" *ngIf="isPurchaseInvoice">
                                <div class="tableCell">
                                    <strong>Balance Due</strong>
                                </div>
                                <div class="tableCell figureCell">
                                    <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong>
                                </div>
                            </div>
                            <!-- endregion -->


                            <!-- <div class="tableRow" *ngIf="toggleFieldForSales">
                <div class="tableCell">
                  <strong>Balance Due</strong>
                </div>
                <div class="tableCell figureCell">
                  <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong>
                </div>
              </div> -->

                        </section>

                    </div>
                </div>
                <!-- endregion -->

            </ng-container>
            <!-- endregion -->

            <!-- region submit actions-->
            <section class="clearfix">

                <section id="actionPane" class="text-center">

                    <div class="col-xs-12">

                        <!-- region generate mode -->
                        <div class="pull-right pr updateMode" *ngIf="!isUpdateMode">
                            <button type="button" (click)="resetInvoiceForm(invoiceForm)"
                                class="btn btn-danger d-inline-block v-align-middle">Clear
                            </button>

                            <!-- region purchase invoice -->
                            <span class="d-inline-block v-align-middle" *ngIf="isPurchaseInvoice">
                                <button type="button" (click)="triggerSubmitInvoiceForm(invoiceForm, true)"
                                    class="btn btn-default" *ngIf="isCustomerSelected">Save &amp; Update A/c
                                </button>
                                <button type="button" (click)="doAction(0);triggerSubmitInvoiceForm(invoiceForm, false)"
                                    class="btn btn-default">Save
                                </button>
                            </span>
                            <!-- endregion -->

                            <!-- region non purchase -->
                            <span class="d-inline-block v-align-middle"
                                *ngIf="!isPurchaseInvoice && (!isProformaInvoice  && !isEstimateInvoice)">

                                <button type="button" (click)="triggerSubmitInvoiceForm(invoiceForm, true)"
                                    class="btn btn-default" *ngIf="isCustomerSelected">Generate
                                    {{invoiceType | titlecase}}
                                    &amp; Update A/c
                                </button>

                                <div class="btn-group" dropdown [dropup]="true">

                                    <button type="button"
                                        (click)="doAction(0);triggerSubmitInvoiceForm(invoiceForm, false)"
                                        class="btn btn-default generateInvoie">Generate {{invoiceType | titlecase}}
                                    </button>

                                    <button id="button-split" type="button" dropdownToggle
                                        class="btn btn-default dropdown-toggle dropdown-toggle-split"
                                        aria-controls="dropdown-split" *ngIf="invoiceType === 'sales'">
                                        <span class="caret"></span>
                                        <span class="sr-only">Split button!</span>
                                    </button>

                                    <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu dropdown-menu-right"
                                        role="menu" aria-labelledby="button-basic">
                                        <!--                      <li role="menuitem">-->
                                        <!--                          <a class="dropdown-item cp"-->
                                        <!--                             (click)="doAction(1);triggerSubmitInvoiceForm(invoiceForm, false)">Generate & Close</a>-->
                                        <!--                      </li>-->

                                        <li role="menuitem">
                                            <a class="dropdown-item cp"
                                                (click)="doAction(2);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Send</a>
                                        </li>

                                        <li role="menuitem">
                                            <a class="dropdown-item cp"
                                                (click)="doAction(3);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Print</a>
                                        </li>

                                        <li role="menuitem"
                                            (click)="doAction(4);triggerSubmitInvoiceForm(invoiceForm, false)">
                                            <a class="dropdown-item cp">Generate & Recurring</a>
                                        </li>
                                    </ul>
                                </div>
                            </span>
                            <!-- endregion -->

                            <!-- region proforma/estimates -->
                            <span class="d-inline-block v-align-middle" *ngIf="isProformaInvoice || isEstimateInvoice">

                                <div class="btn-group" dropdown [dropup]="true">

                                    <button type="button"
                                        (click)="doAction(0);triggerSubmitInvoiceForm(invoiceForm, false)"
                                        class="btn btn-default">Create
                                    </button>

                                    <button id="button-split2" type="button" dropdownToggle
                                        class="btn btn-default dropdown-toggle dropdown-toggle-split"
                                        aria-controls="dropdown-split">
                                        <span class="caret"></span>
                                        <span class="sr-only">Split button!</span>
                                    </button>

                                    <ul id="dropdown-basic2" *dropdownMenu class="dropdown-menu dropdown-menu-right"
                                        role="menu" aria-labelledby="button-basic">
                                        <li role="menuitem">
                                            <a class="dropdown-item cp"
                                                (click)="doAction(2);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Send</a>
                                        </li>

                                        <li role="menuitem">
                                            <a class="dropdown-item cp"
                                                (click)="doAction(3);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Print</a>
                                        </li>

                                        <!--                      <li role="menuitem">-->
                                        <!--                          <a class="dropdown-item cp"-->
                                        <!--                             (click)="doAction(6);triggerSubmitInvoiceForm(invoiceForm, false)">Save as Draft</a>-->
                                        <!--                      </li>-->
                                    </ul>
                                </div>
                            </span>
                            <!-- endregion -->

                        </div>
                        <!-- endregion -->

                        <!-- region update mode -->
                        <div class="pull-right pr" *ngIf="isUpdateMode">

                            <button type="button" class="btn btn-danger d-inline-block v-align-middle"
                                (click)="cancelUpdate()">Cancel
                            </button>

                            <button type="button" class="btn btn-default" (click)="submitUpdateForm(invoiceForm)">
                                <span>Update {{invoiceType | titlecase}}</span>
                            </button>
                        </div>
                        <!-- endregion -->

                    </div>
                </section>
            </section>
            <!-- endregion -->

        </form>
    </div>
    <!-- endregion -->
</div>

<!-- region models section -->
<!-- open account aside -->
<div class="aside-overlay" *ngIf="accountAsideMenuState === 'in' || asideMenuStateForProductService === 'in' ||
     asideMenuStateForRecurringEntry === 'in' || asideMenuStateForOtherTaxes === 'in'"></div>

<generic-aside-menu-account [class]="accountAsideMenuState" [@slideInOut]="accountAsideMenuState"
    (closeAsideEvent)="toggleAccountAsidePane($event)"
    [selectedGrpUniqueName]="selectedGrpUniqueNameForAddEditAccountModal"
    [keyboardShortcut]="{'esc':accountAsideMenuState ==='in'}" *ngIf="accountAsideMenuState === 'in'"
    [selectedAccountUniqueName]="selectedCustomerForDetails" (onShortcutPress)="toggleAccountAsidePane()"
    (addEvent)="addNewSidebarAccount($event)" (updateEvent)="updateSidebarAccount($event)"></generic-aside-menu-account>

<!--&lt;!&ndash; open product service aside &ndash;&gt;-->
<aside-menu-product-service [class]="asideMenuStateForProductService" [@slideInOut]="asideMenuStateForProductService"
    (closeAsideEvent)="onNoResultsClicked()" (animatePAside)="getActionFromAside($event)"></aside-menu-product-service>

<app-aside-recurring-entry [voucherType]="invoiceType" [voucherNumber]="voucherNumber"
    [class]="asideMenuStateForRecurringEntry" [@slideInOut]="asideMenuStateForRecurringEntry"
    (closeAsideEvent)="toggleRecurringAsidePane('out')"></app-aside-recurring-entry>
<!-- region send email popup -->
<div bsModal #sendEmailModal="bs-modal" tabindex="-1" class="modal fade" role="dialog" [config]="modalConfig">

    <div class="modal-dialog modal-md">
        <div class="modal-content">

            <ng-container *ngIf="actionAfterGenerateORUpdate === 2">
                <app-send-email-invoice-component [voucherType]="invoiceType" (successEvent)="sendEmail($event)"
                    [selectedItem]="{ voucherNumber: invoiceNo, uniqueName: accountUniqueName }"
                    (cancelEvent)="cancelEmailModal()"></app-send-email-invoice-component>
            </ng-container>

        </div>
    </div>

</div>
<!-- endregion -->

<!-- region bulk items -->
<div bsModal #bulkItemsModal="bs-modal" tabindex="-1" class="modal fade" role="dialog" style=""
    [config]="{ animated: true,keyboard: false,backdrop: false,ignoreBackdropClick: true }">

    <ng-container *ngIf="showBulkItemModal">
        <proforma-add-bulk-items-component [data]="salesAccounts$ | async" (saveItemsEvent)="addBulkStockItems($event)"
            (closeEvent)="bulkItemsModal.hide()"></proforma-add-bulk-items-component>
    </ng-container>

</div>
<!-- endregion -->

<!-- region last estimate modal-->
<ng-template #lastEstimateModal let-show>
    <div *ngIf="show" class="lastEstimateModal">
        <proforma-last-invoices-component [data]="lastInvoices" (invoiceSelected)="getLastInvoiceDetails($event)">
        </proforma-last-invoices-component>
    </div>
</ng-template>
<!-- endregion -->

<!-- region gst treatment modal-->
<ng-template #gstTreatmentModal let-show>
    <div *ngIf="show" class="gstTreatmentModal">
        <proforma-gst-treatment-component (closeEvent)="showGstTreatmentModal = false">
        </proforma-gst-treatment-component>
    </div>
</ng-template>
<!-- endregion -->

<ng-template let-entry #otherTaxesModal>
    <div id="top0">
        <app-aside-menu-other-taxes *ngIf="asideMenuStateForOtherTaxes === 'in'" [class]="asideMenuStateForOtherTaxes"
            [taxes]="companyTaxesList" [otherTaxesModal]="entry.otherTaxModal"
            [@slideInOut]="asideMenuStateForOtherTaxes" (closeModal)="toggleOtherTaxesAsidePane(true, null)"
            (applyTaxes)="calculateOtherTaxes($event);toggleOtherTaxesAsidePane(true, null);calculateAffectedThingsFromOtherTaxChanges()">
        </app-aside-menu-other-taxes>
    </div>
</ng-template>

<!-- create Group modal -->
<section *ngIf="showCreateGroupModal">
    <div bsModal #createGroupModal="bs-modal" class="modal fade" role="dialog" [keyboardShortcut]="'esc'"
        (onShortcutPress)="closeCreateGroupModal()" [config]="modalConfig">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <sales-add-group-modal (actionFired)="closeCreateGroupModal($event)"></sales-add-group-modal>
            </div>
        </div>
    </div>
</section>

<!-- create Ac modal -->
<section *ngIf="showCreateAcModal">
    <div bsModal #createAcModal="bs-modal" class="modal fade" role="dialog" [config]="modalConfig">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <create-account-modal [gType]="createAcCategory" (actionFired)="closeCreateAcModal()">
                </create-account-modal>
            </div>
        </div>
    </div>
</section>

<!-- region print voucher popup -->
<div bsModal #printVoucherModal="bs-modal" tabindex="-1" class="modal fade" role="dialog" [config]="modalConfig">

    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <ng-container *ngIf="actionAfterGenerateORUpdate === 3 && (invoiceNo && accountUniqueName)">
                <proforma-print-in-place-component [voucherType]="invoiceType"
                    [selectedItem]="{ voucherNumber: invoiceNo, uniqueName: accountUniqueName }"
                    (cancelEvent)="cancelPrintModal()"></proforma-print-in-place-component>
            </ng-container>

        </div>
    </div>

</div>
