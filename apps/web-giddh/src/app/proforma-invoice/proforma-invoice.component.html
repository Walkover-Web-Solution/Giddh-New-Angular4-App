<div class="no-data mr-t2 loader-main" *ngIf="showLoader">
    <div class="spinner2">
        <div class="cube1"></div>
        <div class="cube2"></div>
    </div>
</div>
<div *ngIf="!showLoader">
    <!-- region page change menu -->
        <div class="d-flex border-bottom mobile-view-padding" [ngClass]="{'pending-sales-page': isPendingSales}">
            <hamburger-menu *ngIf="!isPendingSales"></hamburger-menu>
            <div class="form-group mrB clearfix">
                <div class="clearfix">
                    <div class="btn-group proformaSalesTime" dropdown>
                        <button id="button1-basic" dropdownToggle type="button" class="btn more-btn-dropdown dropdown-toggle"
                            aria-controls="dropdown-basic">

                                <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                    Cash
                                </span>

                            <small *ngIf="invoiceType==='estimates'"> (Beta) </small>
                            <span class="caret" *ngIf="!isUpdateMode"></span>
                        </button>

                        <ng-container *ngIf="!isUpdateMode">
                            <ul id="dropdown1-basic" *dropdownMenu class="dropdown-menu" role="menu"
                                aria-labelledby="button-basic">
                                <li role="menuitem" (click)="pageChanged(item.value, item.additional.label)"
                                    *ngFor="let item of pageList">
                                    <a class="dropdown-item cp">{{ item.additional?.label }}</a>
                                </li>
                            </ul>
                        </ng-container>
                    </div>

                </div>
            </div>
        </div>

    <!-- endregion -->

    <!-- region update mode loader-->
    <ng-container *ngIf="isUpdateDataInProcess">
        <div class="loaderClass">
            <div class="no-data mr-t2 loader-main">
                <!-- <div class="giddh-spinner vertical-center-spinner"></div> -->
                <div class="spinner2">
                    <div class="cube1"></div>
                    <div class="cube2"></div>
                </div>
            </div>
        </div>
    </ng-container>
    <!--endregion-->

    <!-- region main form -->
    <div [hidden]="(isUpdateMode && isUpdateDataInProcess) || (isLastInvoiceCopied && isUpdateDataInProcess)">
        <form #invoiceForm="ngForm" novalidate autocomplete="off"
            [ngClass]="{ 'customer-invoice-form' : !invFormData.voucherDetails.customerName,
            'customer-invoice-form-purchase': isPurchaseInvoice || isCreditNote || isDebitNote,
            'slaesPrEsti': isSalesInvoice || isProformaInvoice || isEstimateInvoice,
            'forMultiCurrency' : isMulticurrencyAccount} ">

            <div class="clearfix" [keyboardShortcut]="'alt+c'" (onShortcutPress)="addAccountFromShortcut()">

                <div class="clearfix wrapper-customer-table  pt-15">
                    <!-- region customer and address section -->
                    <div class="customerInvoiceTable">

                        <div class="inner-container">

                            <div class="show-on-small-screen" [ngClass]="{'pending-sales-balance-due': isPendingSales}"
                                *ngIf="isSalesInvoice || isProformaInvoice || isEstimateInvoice">

                                <div class="text-right">
                                    <p class="fs20 b pbR1">
                                        <span
                                            class="balance-due">{{isProformaInvoice || isEstimateInvoice ? 'Total Amount' : 'Balance Due'}}</span>
                                        <span class="sp-rupees"
                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                            <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong></span>
                                        <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                        <span class="sp-rupees" *ngIf='isMulticurrencyAccount'>
                                            <span *ngIf="isMulticurrencyAccount">{{baseCurrencySymbol}}</span>
                                            <span>{{invFormData.voucherDetails.balanceDue * exchangeRate | giddhCurrency}}</span>
                                        </span>
                                        <span class="sp-rupees"
                                            *ngIf='!isMulticurrencyAccount'>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</span>
                                    </p>
                                </div>

                            </div>

                            <!-- region customer section -->
                            <div class="clearfix">

                                <div class="row">
                                    <!-- region customer name -->
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                        <label>{{!isPurchaseInvoice ? 'Customer' : 'Vendor'}} Name<span
                                                class="red-text">*</span></label>
                                    </div>
                                    <!-- endregion -->

                                    <!-- region customer dropdown -->
                                    <div class="col-sm-12 col-xl-7 col-lg-8 col-md-9 col-xs-12 selectCustomerName">

                                        <div class="clearfix d-flex flex-column">
                                            <div class="d-flex">
                                                <!-- region if not cashinvoice show customer dropdown -->
                                                <ng-container *ngIf="!isCashInvoice">
                                                    <sales-sh-select style="width:62.7%; float: left;"
                                                        name="voucherDetails.customerName" #customerNameDropDown
                                                        [options]="customerAcList$ | async"
                                                        [(ngModel)]="invFormData.voucherDetails.customerUniquename"
                                                        [customFilter]="customMoveGroupFilter"
                                                        (noOptionsFound)="noResultsForCustomer($event)"
                                                        [isPaginationEnabled]="true" (scrollEnd)="handleScrollEnd('customer')"
                                                        (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'customer')"
                                                        [notFoundMsg]="noResultsFoundLabel"
                                                        [enableDynamicSearch]="true" (onHide)="resetPreviousSearchResults(true, 'customer')"
                                                        (selected)="onSelectCustomer($event);"
                                                        [placeholder]="customerPlaceHolder" [notFoundLink]="true"
                                                        [doNotReset]="true" [forceClearReactive]="forceClear$ | async"
                                                        [isFilterEnabled]="true" (noResultsClicked)="addNewAccount()"
                                                        [multiple]="false" [ItemHeight]="67"
                                                        [notFoundLinkText]="customerNotFoundText"
                                                        (keyup)="resetCustomerName($event)"
                                                        (onClear)="resetCustomerName(null)"
                                                        [disabled]="isUpdateMode && invoiceType !== 'sales' && invoiceType !== 'cash' && invoiceType !== 'purchase'">

                                                        <ng-template #optionTemplate let-option="option">
                                                            <a href="javascript:void(0)" class="list-item flex-column">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item-unique">{{ option.value }}</div>
                                                            </a>
                                                        </ng-template>

                                                        <ng-template #notFoundLinkTemplate>
                                                            <a href="javascript:void(0)" class="list-item pl-05 pr-05 border-none d-flex justify-content-between w-100"
                                                                [keyboardShortcut]="'alt+c'">
                                                                <div class="item">{{ customerNotFoundText }}</div>
                                                                <div class="item">Alt+C</div>
                                                            </a>
                                                        </ng-template>

                                                    </sales-sh-select>
                                                </ng-container>
                                                <!-- endregion -->
                                                <!-- region if not cashinvoice show customer dropdown -->
                                                <ng-container *ngIf="isCashInvoice">
                                                    <input type="text" name="voucherDetails.customerName"
                                                        [autofocus]="true" #inputCustomerName
                                                        class="form-control cashInvoiceInput"
                                                        [(ngModel)]="invFormData.voucherDetails.customerName"
                                                        (change)="handleCustomerChange($event)"
                                                        (blur)='selectDefaultbank()'
                                                        [readOnly]="isUpdateMode && invoiceType !== 'sales' && invoiceType !== 'cash'">
                                                </ng-container>
                                                <!-- endregion -->

                                                <!-- region previous details commented for multicurrency changes-->
                                                <div class="d-flex cp aqua-color" #copyPreviousEstimate
                                                    *ngIf="!isPurchaseInvoice && !(isPendingVoucherType && isCashInvoice) && invFormData.voucherDetails.customerName && lastInvoices.length && !isUpdateMode"
                                                    style="align-items: center;margin-left: 2%">
                                                    <a href="javascript: void 0"
                                                        (click)="showLastEstimateModal = !showLastEstimateModal">
                                                        <i class="fa fa-files-o"></i> Copy Previous
                                                        {{ invoiceType | voucherTypeToNamePipe | titlecase}} Invoices
                                                    </a>
                                                    <ng-container
                                                        *ngTemplateOutlet="lastEstimateModal;context:{ $implicit: showLastEstimateModal}">
                                                    </ng-container>
                                                </div>
                                                <!-- endregion -->
                                            </div>

                                            <!-- region Unregistered Business / customer details -->
                                            <div class="d-flex aqua-color"
                                                *ngIf="invFormData.voucherDetails.customerName">

                                                <ng-container
                                                    *ngTemplateOutlet="gstTreatmentModal;context:{ $implicit: showGstTreatmentModal}">
                                                </ng-container>

                                                <span style="margin-right: 5px" class="cp aqua-color"
                                                    *ngIf="!isCashInvoice && !isUpdateMode">
                                                    <a href="javascript:void(0)"
                                                        (click)="getCustomerDetails()">{{!isPurchaseInvoice ? 'Customer' : 'Vendor'}}
                                                        Details</a>
                                                </span>
                                            </div>
                                            <!-- endregion -->
                                        </div>
                                        <!-- region search_customer image -->
                                        <ng-container *ngIf="isSalesInvoice && !isCashInvoice">
                                            <img src="assets/images/new/search_customer.svg" class="img-responsive search-arrow-image "
                                                *ngIf="!invFormData.voucherDetails.customerName" />
                                        </ng-container>

                                        <!-- need to show this image on purchase invoice module -->
                                        <ng-container *ngIf="isPurchaseInvoice">
                                            <img src="assets/images/new/search-vendor.svg" class="img-responsive search-arrow-image "
                                                *ngIf="!invFormData.voucherDetails.customerName" />
                                        </ng-container>

                                        <ng-container *ngIf="isCashInvoice">
                                            <img src="assets/images/new/search_customer_Cash Invoice.svg"
                                                class="img-responsive  cash-invoice-tip-img search-arrow-image "
                                                *ngIf="!invFormData.voucherDetails.customerName" />
                                        </ng-container>
                                        <!-- endregion -->

                                    </div>
                                    <!-- endregion -->

                                </div>
                            </div>
                            <!-- endregion -->

                            <!-- region customer address section -->
                            <div class="row">

                                <div class="col-sm-12 col-xl-9 offset-lg-3 col-lg-8 col-md-9 offset-xl-2 offset-md-3">
                                    <ng-container>
                                        <section [ngClass]="{' billing-addressWrap' : !invFormData.voucherDetails.customerName }">

                                            <div class="wrap-billing-address clearfix w-100">

                                                <div class="row">
                                                    <!-- region billing address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">

                                                        <div class="form-group">
                                                            <label class="pb-0">Billing Address</label>

                                                            <div class="billing-address clearfix">
                                                                <textarea name="billingDetails.address"
                                                                    class="form-control"
                                                                    (keyup)="autoFillShippingDetails()" rows="3"
                                                                    autocomplete="off"
                                                                    [(ngModel)]="invFormData.accountDetails.billingDetails.address[0]"
                                                                    autofocus="off" aria-autocomplete="none"
                                                                    #customerBillingAddress></textarea>

                                                                <div class="row">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <label class="sales-country-label">
                                                                            {{ customerCountryName }}
                                                                        </label>
                                                                    </div>

                                                                    <div class="col-sm-12 col-md-6" #billingState>
                                                                        <sales-sh-select [placeholder]="'State'"
                                                                            class="select-bdr-bottom"
                                                                            (selected)="fillShippingBillingDetails($event, true); autoFillShippingDetails()"
                                                                            #statesBilling [showBottomBorderOnly]="true"
                                                                            [options]="statesSource"
                                                                            name="billingDetails.stateCode"
                                                                            [(ngModel)]="invFormData.accountDetails.billingDetails.state.code">
                                                                        </sales-sh-select>
                                                                    </div>

                                                                    <div class="col-sm-12"
                                                                        *ngIf="shouldShowTrnGstField">
                                                                        <!-- <label>GSTIN</label> -->
                                                                        <input maxLength="15" autocomplete="None"
                                                                            type="text" name="billingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            *ngIf="showGSTINNo"
                                                                            [(ngModel)]="invFormData.accountDetails.billingDetails.gstNumber"
                                                                            (change)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()"
                                                                            placeholder="GSTIN" />
                                                                        <input maxLength="15" autocomplete="None"
                                                                            type="text" name="billingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            *ngIf="showTRNNo"
                                                                            [(ngModel)]="invFormData.accountDetails.billingDetails.gstNumber"
                                                                            (change)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()"
                                                                            placeholder="TRN" />
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>

                                                    </div>
                                                    <!-- endregion -->

                                                    <!-- region shipping address -->
                                                    <div class="col-sm-12 col-xl-6 col-md-10 bill-add">

                                                        <div class="form-group p0 width100">
                                                            <label class="pb-0">
                                                                <input type="checkbox" autocomplete="None"
                                                                    (change)="autoFillShippingDetails()"
                                                                    name="autoFillShipping"
                                                                    [(ngModel)]="autoFillShipping"> Shipping Address
                                                                Same as
                                                                Billing
                                                                Address
                                                            </label>

                                                            <div class="billing-address"
                                                                [ngClass]="{'disabled': autoFillShipping}">

                                                                <textarea [readonly]="autoFillShipping"
                                                                    name="shippingDetails.address" class="form-control"
                                                                    [(ngModel)]="invFormData.accountDetails.shippingDetails.address[0]"
                                                                    rows="3" autocomplete="off"></textarea>

                                                                <div class="clearfix form-group mb-0">

                                                                    <div class="row">

                                                                        <div class="col-sm-12 col-md-6">
                                                                            <div class="form-group mb-0">

                                                                                <label class="sales-country-label">
                                                                                    {{ customerCountryName }}
                                                                                </label>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-sm-12 col-md-6" #shippingState>

                                                                            <sales-sh-select
                                                                                [disabled]="autoFillShipping"
                                                                                [placeholder]="'State'"
                                                                                class="select-bdr-bottom"
                                                                                #statesShipping
                                                                                [showBottomBorderOnly]="true"
                                                                                (selected)="fillShippingBillingDetails($event, false)"
                                                                                [options]="statesSource"
                                                                                name="shippingDetails.stateCode"
                                                                                [(ngModel)]="invFormData.accountDetails.shippingDetails.state.code">
                                                                            </sales-sh-select>
                                                                        </div>

                                                                        <div class="col-sm-12"
                                                                            *ngIf="shouldShowTrnGstField">
                                                                            <input [readonly]="autoFillShipping"
                                                                                autocomplete="None" maxLength="15"
                                                                                type="text"
                                                                                name="shippingDetails.gstNumber"
                                                                                *ngIf="showGSTINNo"
                                                                                class="form-control input-custom"
                                                                                [(ngModel)]="invFormData.accountDetails.shippingDetails.gstNumber"
                                                                                (change)="getStateCode('shippingDetails', statesShipping)"
                                                                                placeholder="GSTIN" />
                                                                            <input [readonly]="autoFillShipping"
                                                                                maxLength="15" autocomplete="None"
                                                                                type="text"
                                                                                name="shippingDetails.gstNumber"
                                                                                class="form-control input-custom"
                                                                                *ngIf="showTRNNo"
                                                                                [(ngModel)]="invFormData.accountDetails.shippingDetails.gstNumber"
                                                                                (change)="getStateCode('shippingDetails', statesShipping);"
                                                                                placeholder="TRN" />
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- endregion -->
                                                </div>
                                            </div>
                                        </section>
                                    </ng-container>
                                </div>
                            </div>
                            <!-- endregion -->
                        </div>

                        <!-- region balance due -->
                        <div class="col-sm-3 col-md-3 balance-due-absolute"
                            *ngIf="isSalesInvoice || isProformaInvoice || isEstimateInvoice">

                            <div class="text-right">
                                <p class="fs20 b pbR1">
                                    <span
                                        class="balance-due">{{isProformaInvoice || isEstimateInvoice ? 'Total Amount' : 'Balance Due'}}</span>
                                    <span class="sp-rupees"
                                        *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}
                                        <strong>
                                            <ng-container *ngIf="adjustPaymentData?.totalAdjustedAmount">
                                                {{adjustPaymentBalanceDueData | giddhCurrency}}</ng-container>
                                            <ng-container *ngIf="!adjustPaymentData?.totalAdjustedAmount">
                                                {{invFormData.voucherDetails.balanceDue | giddhCurrency}}</ng-container>
                                        </strong></span>
                                    <!-- added multicurrency feature make it functional to change into appropriate currency -->
                                    <span class="sp-rupees" *ngIf='isMulticurrencyAccount'>
                                        <span *ngIf="isMulticurrencyAccount">{{baseCurrencySymbol}}</span>
                                        <span>{{invFormData.voucherDetails.balanceDue * exchangeRate  | giddhCurrency}}</span>
                                    </span>
                                    <span class="sp-rupees" *ngIf='!isMulticurrencyAccount'>
                                        <ng-container *ngIf="adjustPaymentData?.totalAdjustedAmount">
                                            {{adjustPaymentBalanceDueData | giddhCurrency}}</ng-container>
                                        <ng-container *ngIf="!adjustPaymentData?.totalAdjustedAmount">
                                            {{invFormData.voucherDetails.balanceDue | giddhCurrency}}</ng-container>
                                    </span>
                                </p>
                            </div>

                        </div>
                        <!-- endregion -->
                    </div>
                    <!-- endregion -->

                    <!-- region attention to, email, mobile, voucher section -->
                    <div class="customerInvoiceTable bg-white pdB2 pdT2">
                        <div class="inner-container">

                            <!-- region attention to -->
                            <div class="row">

                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Attention to</label>
                                </div>

                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="pl0 col-sm-12 col-xl-6 col-lg-10 col-md-10">

                                        <input type="text" name="accountDetails.attention" placeholder="Attention to"
                                            class="form-control attentionTo"
                                            [(ngModel)]="invFormData.accountDetails.attentionTo" />
                                    </div>
                                </div>

                            </div>
                            <!-- endregion-->

                            <!-- region email -->
                            <div class="row mt-1">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Email Id</label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                        <input type="email" placeholder="someone@example.com"
                                            name="accountDetails.email" class="form-control attentionTo"
                                            [(ngModel)]="invFormData.accountDetails.email" />
                                    </div>
                                </div>
                            </div>

                            <!-- endregion-->

                            <!-- region mobile no -->
                            <div class="row mt-1">

                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Mobile Number</label>
                                </div>

                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                        <input digitsOnlyDirective placeholder="9198XXXXXXXX" type="tel"
                                            name="accountDetails.mobileNumber" class="form-control attentionTo"
                                            [(ngModel)]="invFormData.accountDetails.mobileNumber" />
                                    </div>
                                </div>
                            </div>
                            <!-- endregion-->
                            <!-- warehouse selection -->
                            <div class="row mt-1" *ngIf="shouldShowWarehouse && warehouses && warehouses.length > 1">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Warehouse</label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                        <sh-select class="multi-select" name="warehouse"
                                            [placeholder]="'Select Warehouse'" [(ngModel)]="selectedWarehouse"
                                            [options]="warehouses"
                                            (selected)="onSelectWarehouse($event)">
                                        </sh-select>
                                    </div>
                                </div>
                            </div>
                            <!-- end warehouse field -->

                            <div class="row mb-1 delivery-from-field" *ngIf="isPurchaseInvoice">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Deliver To<span class="red-text">*</span></label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12 select-customer-name">
                                    <section class="form-inline">
                                        <div class="wrap-billing-address w-100 clearfix">
                                            <div class="row">
                                                <!-- region billing address -->
                                                <div class="col-sm-12 col-xl-6 col-md-10 bill-add">
                                                    <div class="form-group">
                                                        <label>Billing Address</label>
                                                        <div class="billing-address clearfix">
                                                            <textarea name="companyBillingDetailsAddress"
                                                                (keyup)="autoFillCompanyShippingDetails()"
                                                                [(ngModel)]="purchaseBillCompany.billingDetails.address[0]"
                                                                class="form-control" rows="3" autocomplete="off" autofocus="off"
                                                                aria-autocomplete="none"></textarea>
                                                            <div class="row">
                                                                <div class="col-sm-12 col-md-6">
                                                                    <label class="sales-country-label">
                                                                        {{companyCountryName}}
                                                                    </label>
                                                                </div>
                                                                <div class="col-sm-12 col-md-6" #billingStateCompany>
                                                                    <sales-sh-select [placeholder]="'State'"
                                                                        class="select-border-bottom"
                                                                        (selected)="fillShippingBillingCompanyDetails($event, true); autoFillCompanyShippingDetails()"
                                                                        [showBottomBorderOnly]="true"
                                                                        [options]="companyStatesSource"
                                                                        name="companyBillingDetailsStateCode"
                                                                        [(ngModel)]="purchaseBillCompany.billingDetails.state.code">
                                                                    </sales-sh-select>
                                                                </div>
                                                                <div class="col-sm-12"
                                                                    *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                    <input maxlength="15" autocomplete="None" type="text"
                                                                        name="companyBillingDetailsTax"
                                                                        [(ngModel)]="purchaseBillCompany.billingDetails.gstNumber"
                                                                        class="form-control input-custom"
                                                                        (blur)="autoFillCompanyShippingDetails()"
                                                                        (change)="getStateCodeCompany('billingDetails', billingStateCompany)"
                                                                        placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- endregion -->

                                                <!-- region shipping address -->
                                                <div class="col-sm-12 col-xl-6 col-md-10  bill-add">

                                                    <div class="form-group p0 width100">
                                                        <label>
                                                            <input type="checkbox" autocomplete="None"
                                                                name="autoFillCompanyShipping"
                                                                [(ngModel)]="autoFillCompanyShipping"
                                                                (change)="autoFillCompanyShippingDetails()"> Shipping Address
                                                            Same as Billing Address
                                                        </label>
                                                        <div
                                                            [ngClass]="{'billing-address': true, 'disabled': autoFillCompanyShipping}">
                                                            <textarea name="companyShippingDetailsAddress"
                                                                [(ngModel)]="purchaseBillCompany.shippingDetails.address[0]"
                                                                class="form-control" rows="3" autocomplete="off" autofocus="off"
                                                                aria-autocomplete="none"></textarea>
                                                            <div class="clearfix">
                                                                <div class="form-group row deliver-same-address">
                                                                    <div class="col-sm-12 col-md-6">
                                                                        <div class="form-group">
                                                                            <label class="sales-country-label">
                                                                                {{companyCountryName}}
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-12 col-md-6" #shippingStateCompany>
                                                                        <sales-sh-select [placeholder]="'State'"
                                                                            [disabled]="autoFillCompanyShipping"
                                                                            class="select-border-bottom"
                                                                            [ngClass]="{'disabled': autoFillCompanyShipping}"
                                                                            (selected)="fillShippingBillingCompanyDetails($event, false);"
                                                                            [showBottomBorderOnly]="true"
                                                                            [options]="companyStatesSource"
                                                                            name="companyShippingDetailsStateCode"
                                                                            [(ngModel)]="purchaseBillCompany.shippingDetails.state.code">
                                                                        </sales-sh-select>
                                                                    </div>
                                                                    <div class="col-sm-12"
                                                                        *ngIf="shouldShowTrnGstField && (showGSTINNo || showTRNNo)">
                                                                        <input maxLength="15" autocomplete="None" type="text"
                                                                            name="companyShippingDetailsTax"
                                                                            [(ngModel)]="purchaseBillCompany.shippingDetails.gstNumber"
                                                                            class="form-control input-custom"
                                                                            (change)="getStateCodeCompany('shippingDetails', shippingStateCompany)"
                                                                            placeholder="{{showGSTINNo ? 'GSTIN' : 'TRN'}}">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- endregion -->
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                            <div class="row mt-1" *ngIf="isPurchaseInvoice && (!isUpdateMode || (isUpdateMode && poLinkUpdated))">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>Link Purchase Order</label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-xl-6 col-lg-10 col-md-10 pl-0">
                                        <sh-select [options]="purchaseOrders" placeholder="Select Order" [multiple]="true" name="linkedPO" [(ngModel)]="linkedPo" (selected)="getPurchaseOrder($event, true)" [isFilterEnabled]="true" [useInBuiltFilterForIOptionTypeItems]="true">
                                            <ng-template #optionTemplate let-option="option">
                                                <ng-container>
                                                    <a href="javascript:void(0)" class="list-item d-flex">
                                                        <span><input type="checkbox" [checked]="linkedPo && linkedPo.includes(option.value)" [value]="option.value"></span>&nbsp;
                                                        <span>
                                                            <div class="item">{{ option.label }}</div>
                                                            <div class="item-unq" *ngIf="option.additional?.pending">
                                                                Pending: {{ option.additional?.pending }}
                                                            </div>
                                                            <div class="item-unq" *ngIf="option.additional?.grandTotal">
                                                                Amount: {{ option.additional?.grandTotal }}
                                                            </div>
                                                        </span>
                                                    </a>
                                                </ng-container>
                                            </ng-template>
                                        </sh-select>
                                    </div>
                                </div>
                            </div>
                            <!-- end Link purchase order -->

                            <!-- region invoice no, invoice date, Expiry date -->
                            <div class="row mt-1">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label> {{ invoiceNoLabel }} </label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-sm-12 col-xl-6 col-lg-5 col-md-10 pl-0">
                                        <!-- Enabled for CR/DR update flow -->
                                        <div>
                                            <input *ngIf="(!isCreditNote && !isDebitNote)" type="text"
                                                name="accountDetails.invoiceNum"
                                                class="form-control invoiceDate attentionTo"
                                                [ngClass]="{'dateinvoice': !isPurchaseInvoice }"
                                                [disabled]="(isUpdateMode && !(isDebitNote || isPurchaseInvoice)) ? 'disabled' : null"
                                                [(ngModel)]="invFormData.voucherDetails.voucherNumber" />

                                            <ng-container *ngIf="isCreditNote || isDebitNote">
                                                <sh-select [options]="invoiceList" placeholder="Select Accounts"
                                                    [forceClearReactive]="invoiceForceClearReactive$ | async"
                                                    [notFoundLink]="false" [(ngModel)]="selectedInvoice"
                                                    [ngModelOptions]="{standalone: true}"
                                                    (selected)="creditNoteInvoiceSelected($event)" [multiple]="false"
                                                    [ItemHeight]="67" [showClear]="false">
                                                    <ng-template *ngIf="invoiceList?.length" #optionTemplate
                                                        let-option="option">
                                                        <a href="javascript:void(0)" class="list-item sh-template">
                                                            <div class="item">{{ option.label }}
                                                            </div>
                                                            <div class="item-unique">
                                                                (Dated: {{ option.additional?.voucherDate}})
                                                            </div>
                                                            <div class="item-unique">
                                                                (Due:
                                                                {{ option.additional?.balanceDue?.amountForAccount | giddhCurrency }})
                                                            </div>
                                                        </a>
                                                    </ng-template>
                                                </sh-select>
                                            </ng-container>
                                        </div>
                                        <div *ngIf="(isCreditNote || isDebitNote) && selectedInvoice"
                                            class="cp for-mobile-screen remove-invoice"
                                            (click)="removeSelectedInvoice()">
                                            <span class="remove-invoice-icon mr-05">×</span>
                                            <span class="remove-invoice-label">Remove</span>
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 invoice-date-due-date" *ngIf="!isMobileScreen">
                                        <div class="form-inline flex-row flex-nowrap">
                                            <div *ngIf="(isCreditNote || isDebitNote) && selectedInvoice"
                                                class="cp remove-invoice" (click)="removeSelectedInvoice()">
                                                <span class="remove-invoice-icon mr-05">×</span>
                                                <span class="remove-invoice-label">Remove</span>
                                            </div>
                                            <div class="form-group">
                                                <label>{{ invoiceDateLabel }}</label>

                                                <input type="text" [placeholder]="giddhDateFormat"
                                                    #voucherDate="ngModel" name="voucherDate"
                                                    class="form-control dateinvoice" bsDatepicker
                                                    [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                    [(ngModel)]="invFormData.voucherDetails.voucherDate"
                                                    [disabled]="(invoiceType !== 'purchase' && isUpdateMode) ? 'disabled' : null"
                                                    [class.invalid-inp]="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)"
                                                    (blur)="onBlurInvoiceDate(0)"
                                                    (bsValueChange)="onVoucherDateChanged($event, invFormData.voucherDetails.voucherDate)" />
                                                <p class="text-danger"
                                                    *ngIf="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)">
                                                    Invalid Date
                                                </p>

                                            </div>

                                            <div class="form-group m-l-10"
                                                *ngIf="isSalesInvoice || isPurchaseInvoice || isProformaInvoice || isEstimateInvoice">
                                                <label>{{ invoiceDueDateLabel }}</label>

                                                <input type="text" [placeholder]="giddhDateFormat" #dueDate="ngModel"
                                                    name="dueDate" class="form-control dateinvoice" bsDatepicker
                                                    [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                    [(ngModel)]="invFormData.voucherDetails.dueDate"
                                                    [class.invalid-inp]="dueDate.errors && (dueDate.dirty || dueDate.touched)"
                                                    (blur)="onBlurDueDate(0)" />
                                                <p class="text-danger"
                                                    *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)">Invalid
                                                    Date
                                                </p>

                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-1" *ngIf="isMobileScreen">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>{{ invoiceDateLabel }}</label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                        <input type="text" [placeholder]="giddhDateFormat" #voucherDate="ngModel"
                                            name="voucherDate" class="form-control dateinvoice" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            [(ngModel)]="invFormData.voucherDetails.voucherDate"
                                            (blur)="onBlurInvoiceDate(0)"
                                            (bsValueChange)="onVoucherDateChanged($event, invFormData.voucherDetails.voucherDate)"
                                            [disabled]="(invoiceType !== 'purchase' && isUpdateMode) ? 'disabled' : null"
                                            [class.invalid-inp]="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)" />
                                        <p class="text-danger"
                                            *ngIf="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)">
                                            Invalid Date
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-1"
                                *ngIf="isMobileScreen && (isSalesInvoice || isPurchaseInvoice || isProformaInvoice || isEstimateInvoice)">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                    <label>{{ invoiceDueDateLabel }}</label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                        <input type="text" [placeholder]="giddhDateFormat" #dueDate="ngModel"
                                            name="dueDate" class="form-control dateinvoice" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                            [(ngModel)]="invFormData.voucherDetails.dueDate"
                                            [class.invalid-inp]="dueDate.errors && (dueDate.dirty || dueDate.touched)" />
                                        <p class="text-danger"
                                            *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)">Invalid Date
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- reverse charge transction start -->
                            <!-- for purchase record start -->
                            <div class="row mt-1" *ngIf="isPurchaseInvoice">
                                <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12" *ngIf="!isMobileView">
                                    <label></label>
                                </div>
                                <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                    <div class="col-sm-6 col-xl-6 col-lg-10 col-md-10 pl-0">
                                        <input id="reverse-charge" name="rcmEntry" class="checkbox-custom"
                                            type="checkbox" [ngModel]="isRcmEntry" (click)="toggleRcmCheckbox($event)">
                                        <label #rcmPopup="bs-popover" [popover]="rcmTemplate" container="body"
                                            placement="bottom right" containerClass="purchase-invoice-rcm"
                                            for="reverse-charge" class="checkbox-custom-label">
                                            Is this transaction applicable for reverse charge?
                                        </label>
                                    </div>
                                </div>
                                <ng-template #rcmTemplate>
                                    <confirmation-modal [configuration]="rcmConfiguration"
                                        (buttonClicked)="handleRcmChange($event)"></confirmation-modal>
                                </ng-template>
                            </div>
                            <!-- for purchase record end -->
                            <!-- reverse charge transction end  -->
                            <!-- For Tourist Scheme start -->
                            <!-- for sales invoice start (ngModelChange)="touristSchemeApplicableToggle($event)"-->
                            <ng-container *ngIf="companyCountryCode === 'AE'">
                                <div class="row mt-1" *ngIf="isSalesInvoice || isCashInvoice">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12" *ngIf="!isMobileView">
                                        <label></label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12">
                                        <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0">
                                            <input id="tourist-scheme" type="checkbox" name="touristSchemeApplicable"
                                                class="checkbox-custom"
                                                [(ngModel)]="invFormData.touristSchemeApplicable"
                                                (ngModelChange)="touristSchemeApplicableToggle()">
                                            <label for="tourist-scheme" class="checkbox-custom-label">
                                                Is this transaction applicable for Tourist Scheme?
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- endregion -->
                                <div class="row mt-1 "
                                    *ngIf="(isSalesInvoice || isCashInvoice) && invFormData.touristSchemeApplicable ">
                                    <div class="col-sm-12 col-xl-2 col-lg-3 col-md-3 col-xs-12">
                                        <label>Passport Number</label>
                                    </div>
                                    <div class="col-sm-12 col-xl-9 col-lg-8 col-md-9 col-xs-12 ">
                                        <div class="col-sm-12 col-xl-6 col-lg-10 col-md-10 pl-0 ">
                                            <input type="text" name="passportNumber" #passportNumber
                                                placeholder="Passport Number" class="form-control attentionTo"
                                                (blur)="allowAlphanumericChar(passportNumber)"
                                                (keypress)="allowAlphanumericChar(passportNumber)"
                                                [(ngModel)]="invFormData.passportNumber" />
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                            <!-- For Tourist Scheme end -->
                            <!-- for sales invoice end -->
                            <!-- endregion -->

                        </div>
                    </div>
                    <!-- endregion -->

                </div>
            </div>
            <!-- region entries table -->
            <ng-container>

                <!-- region normal view -->
                <section class="staticInvoiceTable salseInvoicetable clearfix mr-b2 whiteBg container-fluid ng-tns-c8-0"
                    *ngIf="!isMobileScreen">

                    <ng-container
                        *ngIf="isSalesInvoice || isCashInvoice || isCreditNote || isDebitNote || isProformaInvoice || isEstimateInvoice">
                        <!-- switch currency on click, remaining functional work , UI is completed -->
                        <div class="switch-currency" *ngIf="isMulticurrencyAccount && !showSwitchedCurr">
                            <span class="left-currency">1 {{companyCurrencyName}}</span>
                            <img class="switchIcon" src="assets/images/switch-icon.svg" alt="switch-icon"
                                (click)="switchCurrencyImg(true)">
                            <span class="right-currency">
                                <span class="currency-digits"
                                    *ngIf="!showCurrencyValue">{{originalExchangeRate | giddhCurrency}}</span>
                                <input type="number" name="exchangeRate" [(ngModel)]="exchangeRate"
                                    *ngIf="showCurrencyValue" class="form-control edit-currency"> {{companyCurrency}}
                            </span>

                            <span class="edit-icon cp">
                                <img src="assets/images/edit-pencilicon.svg" class="edit-pencil" *ngIf="!autoSaveIcon"
                                    (click)="showCurrencyValue = !showCurrencyValue ; autoSaveIcon = !autoSaveIcon; exchangeRate = originalExchangeRate">
                                <img src=" assets/images/autosave.svg" class="edit-pencil"
                                    (click)="originalExchangeRate = exchangeRate; autoSaveIcon = !autoSaveIcon; showCurrencyValue= !showCurrencyValue; calculateGrandTotal()"
                                    *ngIf="autoSaveIcon">
                            </span>


                        </div>
                        <!-- switch currency on click, remaining functional work , UI is completed -->
                        <div class="switch-currency" *ngIf="isMulticurrencyAccount && showSwitchedCurr">
                            <span class="left-currency">1 {{companyCurrency}}</span>
                            <img class="switchIcon" src="assets/images/switch-icon.svg" alt="switch-icon"
                                (click)="switchCurrencyImg(false)">
                            <span class="right-currency">
                                <span class="currency-digits"
                                    *ngIf="!showCurrencyValue">{{originalReverseExchangeRate | giddhCurrency}}</span>
                                <input type="number" name="exchangeRate" [(ngModel)]="reverseExchangeRate"
                                    *ngIf="showCurrencyValue" class="form-control edit-currency">
                                {{companyCurrencyName}}
                            </span>

                            <span class="edit-icon cp">
                                <img *ngIf="!autoSaveIcon" src="assets/images/edit-pencilicon.svg" class="edit-pencil"
                                    (click)="saveCancelExcRate(false)">
                                <img src=" assets/images/autosave.svg" class="edit-pencil"
                                    (click)="saveCancelExcRate(true)" *ngIf="autoSaveIcon">
                            </span>

                        </div>
                    </ng-container>
                    <table class="table table-custom-invoice  basic">
                        <thead>
                            <tr>
                                <th *ngFor="let item of theadArrReadOnly;" [hidden]="!item.display"
                                    class="theadOfSalesInvoice" [ngClass]="item.label">
                                    {{item.label}} <span *ngIf="item.label === 'Tax' && isRcmEntry">(RCM)<sup
                                            class="mandatory-asterisk">*</sup></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody
                            *ngFor="let entry of invFormData.entries; let entryIdx = index; let first = first; let last = last;"
                            (clickOutside)="handleOutsideClick()" [exclude]="'.entriesTr'">

                            <ng-container *ngFor="let transaction of entry.transactions;">
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature) -->
                                <!-- region static entries-->
                                <tr (click)="setActiveIndx(entryIdx);$event.stopPropagation()"
                                    [hidden]="activeIndx === entryIdx" class="entriesTr set-active"
                                    [ngClass]="{'isOtherTax' : entry.isOtherTaxApplicable && isMulticurrencyAccount}">

                                    <td>{{ entryIdx + 1 }}</td>

                                    <td>
                                        <div class="productName">
                                            <label *ngIf="!transaction.accountName" class="selectAccountLabel">Click to
                                                Select
                                                Account</label> {{transaction.accountName}}
                                            <span
                                                *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}}
                                                )</span>

                                        </div>

                                        <div class="skuNumber">
                                            <label>SKU:</label>Number
                                        </div>

                                        <div class="discription">
                                            {{transaction.description}}

                                        </div>
                                        <p class="small text-muted sku_and_customfields"
                                            *ngIf="transaction.sku_and_customfields">
                                            {{transaction.sku_and_customfields}}</p>
                                        <div class="dateHsnCode">

                                            <div class="row">

                                                <div class="col-6 col-sm-6 pdR0" *ngIf="entry.entryDate">
                                                    <div class="entryDate">
                                                        <label>Entry Date: </label>
                                                        {{entry.entryDate | date: 'dd-MM-yyyy'}}
                                                        <span class="edit-icon cp" *ngIf="!isUpdateMode">
                                                            <img src="assets/images/edit-pencilicon.svg">
                                                        </span>

                                                    </div>
                                                </div>

                                                <div class="col-6 col-sm-6 pdL0"
                                                    *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                                    <div class="hsnCode text-right">
                                                        <label>HSN/SAC:</label>
                                                        <span>
                                                            {{(inventorySettings?.manageInventory || !transaction.sacNumberExists) ? transaction.hsnNumber : transaction.sacNumber}}
                                                            <span class="edit-icon cp">
                                                                <img src="assets/images/edit-pencilicon.svg">
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-right stockUnit">
                                        <div class="wrap-td-data">
                                            {{transaction.quantity | giddhCurrency}} {{transaction.stockUnit}}
                                        </div>
                                    </td>
                                    <td class="text-right tra-rate item-rate " style="height:1px;">
                                        <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                            <div class="td-wrapper">
                                                <div style="flex: 1;">
                                                    <div class="wrap-td-data"> <span
                                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                            {{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{transaction.rate | giddhCurrency: ratePrecision:true}}
                                                    </div>
                                                </div>
                                            </div>

                                            <div *ngIf="isMulticurrencyAccount && !isPurchaseInvoice"
                                                class="differ-currency">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>

                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-right  item-amount" style="height:1px;">
                                        <div class="td-wrapper">
                                            <div style="flex: 1;">
                                                <div class="wrap-td-data"><span
                                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{transaction.amount | giddhCurrency}}</div>
                                            </div>
                                        </div>
                                        <div class="differ-currency"
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                            <span>{{baseCurrencySymbol}}</span>
                                            <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                                        </div>
                                    </td>
                                    <td class="item-discount" style="height:1px;">
                                        <div class=" text-right td-wrapper">

                                            <div style="flex: 1;">
                                                <div class="wrap-td-data"> <span
                                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{ entry.discountSum | giddhCurrency}}</div>
                                            </div>
                                        </div>
                                        <div class="differ-currency"
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                            <span>{{baseCurrencySymbol}}</span>
                                            <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                        </div>

                                    </td>
                                    <td [class.error-box]="transaction.requiredTax" class="text-right item-tax"
                                        style="height:1px;" (focus)="transaction.requiredTax = false;">
                                        <div class="td-wrapper">
                                            <div style="flex:1;">
                                                <div class="wrap-td-data"><span
                                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{(entry.taxSum + entry.cessSum) | giddhCurrency}}</div>
                                            </div>
                                        </div>
                                        <div class="differ-currency"
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                            <span>{{baseCurrencySymbol}}</span>
                                            <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                        </div>
                                    </td>
                                    <td class="text-right item-tax delete-btn-absolute" style="height:1px;">
                                        <div class="td-wrapper">
                                            <div style="flex:1;">
                                                <div class="wrap-td-data">
                                                    <span><span
                                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}
                                                        </span>{{transaction.total | giddhCurrency}}</span>
                                                    <br>
                                                    <span *ngIf="entry.isOtherTaxApplicable">
                                                        {{ entry.otherTaxModal?.appliedOtherTax?.name }} : <span
                                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}
                                                        </span>{{ entry.otherTaxSum | giddhCurrency}}
                                                    </span>
                                                </div>
                                                <div class="texIncurrency"
                                                    *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && !isPurchaseInvoice">
                                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }} :
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>

                                            <div class="differ-currency"
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                        </div>

                                        <div class="trash-icon-delete" (click)="removeTransaction(entryIdx)">
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                </tr>

                                <!-- endregion -->

                                <!-- region dynamic entries-->
                                <!-- added new element in td which is content amount element class is 'differ-currency' (multicurrency feature)-->
                                <tr [hidden]="activeIndx !== entryIdx" class="entriesTr defaultActive"
                                    (click)="$event.stopPropagation();">
                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup();">{{ entryIdx + 1 }}</td>
                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup();">

                                        <div class="productName">
                                            <div class="ng-select-wrap">
                                                <sh-select [options]="salesAccounts$ | async" #selectAccount
                                                    [(ngModel)]="transaction.fakeAccForSelect2"
                                                    name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                                    (selected)="onSelectSalesAccount($event,transaction, entry)"
                                                    [placeholder]="'Select A/c'" [notFoundLink]="true"
                                                    [isPaginationEnabled]="true" (scrollEnd)="handleScrollEnd('item')"
                                                    (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'item')"
                                                    (onHide)="noResultsFoundLabel = 'Type to search a/c'"
                                                    [notFoundMsg]="noResultsFoundLabel"
                                                    [enableDynamicSearch]="true"
                                                    [fixedValue]="(transaction.stockDetails && transaction.stockDetails.name) ? transaction.accountName+' ('+transaction.stockDetails?.name+')' : transaction.accountName"
                                                    [forceClearReactive]="forceClear$ | async"
                                                    (noResultsClicked)="onNoResultsClicked(entryIdx)" [multiple]="false"
                                                    [ItemHeight]="67" (onClear)="onClearSalesAccount(transaction)"
                                                    [useInBuiltFilterForFlattenAc]="true">

                                                    <ng-template #optionTemplate let-option="option">
                                                        <ng-container *ngIf="!option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item flex-column">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item-unique">
                                                                    {{ option.additional?.uniqueName }}</div>
                                                            </a>
                                                        </ng-container>
                                                        <ng-container *ngIf="option.additional?.stock">
                                                            <a href="javascript:void(0)" class="list-item flex-column">
                                                                <div class="item">{{ option.label }}</div>
                                                                <div class="item-unique">
                                                                    {{ option.additional?.uniqueName }}</div>
                                                                <div class="item-stock">Stock:
                                                                    {{ option.additional?.stock.uniqueName }}</div>
                                                            </a>
                                                        </ng-container>
                                                    </ng-template>
                                                </sh-select>
                                            </div>
                                        </div>

                                        <div *ngIf="transaction.fakeAccForSelect2">
                                            <div class="skuNumber">
                                                <label>SKU:</label>Number
                                            </div>

                                            <div class="discription">
                                                <textarea type="text" placeholder="Add Description"
                                                    name="transaction.description_{{entryIdx}}" class="form-control"
                                                    [(ngModel)]="transaction.description" #description>
                                                </textarea>
                                                <p class="small text-muted sku_and_customfields"
                                                    *ngIf="transaction.sku_and_customfields">
                                                    {{transaction.sku_and_customfields}}</p>
                                            </div>

                                            <!-- region entry date/ hsncode -->
                                            <div class="dateHsnCode">
                                                <div class="row">
                                                    <div class="col-6 col-sm-6 pdR0">
                                                        <div class="entryDate">
                                                            <label>Entry Date: </label>
                                                            <span *ngIf="!isUpdateMode">
                                                                <input type="text" [placeholder]="giddhDateFormat"
                                                                    bsDatepicker name="transaction.date_{{entryIdx}}"
                                                                    id="transaction.date_{{entryIdx}}"
                                                                    class="form-control text-left"
                                                                    [(ngModel)]="entry.entryDate"
                                                                    [disabled]="isUpdateMode"
                                                                    (onShown)="hsnDropdownShow = false;"
                                                                    [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                                    #dp="bsDatepicker" placement="right" />
                                                                <span class="edit-icon cp" (click)="dp.toggle()"
                                                                    [attr.aria-expanded]="dp.isOpen">
                                                                    <img src="assets/images/edit-pencilicon.svg">
                                                                </span>
                                                            </span>

                                                            <span *ngIf="isUpdateMode">
                                                                {{ entry.entryDate | date: 'dd-MM-yyyy'}}
                                                            </span>

                                                        </div>
                                                    </div>

                                                    <div class="col-6 col-sm-6 pdL0">
                                                        <div class="wrap-hsnBox">
                                                            <div class="hsnCode text-right"
                                                                (click)="toggleHsnSacDropDown(transaction)">
                                                                <label>HSN/SAC:</label>
                                                                <span>
                                                                    {{(inventorySettings?.manageInventory || !transaction.sacNumber) ? transaction.hsnNumber : transaction.sacNumber }}
                                                                    <span
                                                                        *ngIf="!transaction.hsnNumber && !transaction.sacNumber"
                                                                        class="updateText">Update
                                                                    </span>
                                                                    <span class="edit-icon cp">
                                                                        <img src="assets/images/edit-pencilicon.svg">
                                                                    </span>
                                                                </span>
                                                            </div>

                                                            <div class="hsn-code-dropdown" *ngIf="hsnDropdownShow">
                                                                <label>HSN/SAC</label>
                                                                <input type="text" maxLength="10"
                                                                    placeholder="HSN/SAC Number"
                                                                    name="transaction.hsnNumber_{{entryIdx}}"
                                                                    *ngIf="(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                    [(ngModel)]="transaction.hsnNumber" />
                                                                <input type="text" maxLength="10"
                                                                    placeholder="HSN/SAC Number"
                                                                    name="transaction.hsnNumber_{{entryIdx}}"
                                                                    *ngIf="!(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                    [(ngModel)]="transaction.sacNumber" />
                                                                <a>
                                                                </a>
                                                                <div class="btngroup m-t-10">
                                                                    <button class="btn btn-sm btn-success" type="button"
                                                                        (click)="hsnDropdownShow=!hsnDropdownShow">Save
                                                                    </button>
                                                                    <button class="btn btn-sm btn-primary" type="button"
                                                                        (click)="hideHsnSacEditPopup(transaction)">
                                                                        Cancel
                                                                    </button>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <!-- endregion -->
                                        </div>
                                    </td>

                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup();" class="text-right stockUnit">
                                        <input type="text" [disabled]="!transaction.isStockTxn"
                                            (blur)="handleQuantityBlur(entry, transaction);" placeholder="Quantity"
                                            decimalDigitsDirective name="transaction.quantity_{{entryIdx}}"
                                            class="form-control text-right" [(ngModel)]="transaction.quantity"
                                            [mask]="inputMaskFormat" />

                                        <select class="form-control" [disabled]="!transaction.isStockTxn"
                                            name="transaction.stockUnit_{{entryIdx}}"
                                            [(ngModel)]="transaction.stockUnit"
                                            (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                            <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">
                                                {{stock.text}}
                                            </option>
                                        </select>
                                    </td>

                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup();" class="text-right item-rate" style="height: 1px;">
                                        <div class="td-wrapper">

                                            <div style="flex: 1;">
                                                <input type="text" [disabled]="!transaction.isStockTxn"
                                                    (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                                    placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                                    class="form-control transaction-rate text-right"
                                                    [(ngModel)]="transaction.rate"
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                    [customDecimalPlaces]="highPrecisionRate" />
                                            </div>
                                            <!-- please add condition for show and hide -->
                                            <div class="differ-currency"
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>
                                            </div>
                                        </div>
                                    </td>

                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup();" class="text-right item-amount" style="height:1px;">
                                        <div class="td-wrapper">
                                            <div style="flex: 1;">
                                                <input type="text" (blur)="calculateWhenTrxAltered(entry, transaction, true)"
                                                    (click)="transactionAmountClicked(transaction)" placeholder="Amount"
                                                    (input)="checkVoucherEntries()"
                                                    name="transaction.amount_{{entryIdx}}"
                                                    class="form-control text-right" [(ngModel)]="transaction.amount"
                                                    decimalDigitsDirective
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                            </div>
                                            <div class="differ-currency"
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                                            </div>
                                        </div>
                                    </td>

                                    <td (click)="closeTaxControlPopup();" class="item-discount" style="height:1px;">
                                        <div class="td-wrapper">
                                            <div class="text-right" style="flex:1;">
                                                <discount-control-component #discountComponent [discountMenu]="false"
                                                    [discountAccountsDetails]="entry.discounts"
                                                    [discountSum]="entry.discountSum" [showHeaderText]="false"
                                                    (hideOtherPopups)="closeTaxControlPopup()"
                                                    (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency">
                                                </discount-control-component>
                                            </div>
                                            <div class="differ-currency"
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                        </div>
                                    </td>

                                    <td (click)="closeDiscountPopup();" class="pos-rel dropdown-container item-tax" style="height:1px;">
                                        <div class="td-wrapper">
                                            <div class="text-right" style="flex:1;">
                                                <tax-control #taxControlComponent [taxes]="companyTaxesList" [date]="entry.entryDate"
                                                    [taxRenderData]="entry.taxes"
                                                    [totalForTax]="transaction.taxableValue"
                                                    [applicableTaxes]="transaction.applicableTaxes"
                                                    [exceptTaxTypes]="exceptTaxTypes"
                                                    [allowedSelectionOfAType]="allowedSelectionOfAType"
                                                    [showHeading]="false" [rootClass]="'salseInvoicetable'"
                                                    (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                                    (hideOtherPopups)="closeDiscountPopup()"
                                                    [maskInput]="inputMaskFormat"
                                                    [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                    [suffixInput]="selectedSuffixForCurrency">
                                                </tax-control>
                                                <!-- TODO: After design finalization
                                                <span class="eligible-ITC">Eligible for ITC <span
                                                    class="icon-edit"></span>
                                            </span> -->
                                            </div>

                                            <div class="differ-currency"
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                        </div>
                                    </td>

                                    <td (click)="closeDiscountPopup(); closeTaxControlPopup();" class="text-right item-total delete-btn-absolute">
                                        <div class="td-wrapper">

                                            <div style="flex:1;">
                                                <input type="text" name="transaction.total_{{entryIdx}}"
                                                    class="form-control text-right" [(ngModel)]="transaction.total"
                                                    decimalDigitsDirective
                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                    (blur)="calculateTransactionValueInclusively(entry, transaction)" />

                                                <div *ngIf="isTcsTdsApplicable" class="wrap-otherTax">
                                                    <input type="checkbox" class="other-taxes-checkobx"
                                                        [(ngModel)]="entry.isOtherTaxApplicable"
                                                        (click)="tcsTdsIndex = entryIdx"
                                                        *ngIf="!entry.isOtherTaxApplicable"
                                                        name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                        id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                        (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                                    <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                        *ngIf="!entry.isOtherTaxApplicable" class="otherTaxLable"
                                                        style="font-size:13px;vertical-align: middle">Other Tax?</label>
                                                </div>
                                                <div *ngIf="entry.isOtherTaxApplicable" class="mr-t1">

                                                    <span>

                                                        <div style="display: flex;align-items: center">
                                                            <span style="margin-right: 5px">
                                                                <a href="javascript: void 0"
                                                                    (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                                    <img src="assets/images/edit-pencilicon.svg">
                                                                </a>
                                                            </span>
                                                            <input class="text-right form-control other-taxes-input"
                                                                disabled="disabled" [(ngModel)]="entry.otherTaxSum"
                                                                [prefix]="invFormData.accountDetails.currencySymbol"
                                                                [suffix]="selectedSuffixForCurrency"
                                                                [mask]="inputMaskFormat"
                                                                name="entry.otherTaxesSum_{{entryIdx}}" />
                                                        </div>

                                                        <p
                                                            style="margin-top: 5px; font-size: 12px; text-transform: capitalize; margin-bottom: 20px;">
                                                            {{ entry.otherTaxModal?.appliedOtherTax?.name}}</p>
                                                    </span>

                                                </div>
                                            </div>
                                            <div *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && !isPurchaseInvoice"
                                                class="texIncurrency" style="color:#999;">
                                                {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                <span>{{baseCurrencySymbol}}</span> :
                                                <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                            </div>
                                            <div class="differ-currency"
                                                *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                <span>{{baseCurrencySymbol}}</span>
                                                <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                            </div>


                                            <ng-container
                                                *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                            </ng-container>

                                        </div>

                                        <div class="trash-icon-delete" (click)="removeTransaction(entryIdx)">
                                            <span class="cp">
                                                <i class="icon-trash" aria-hidden="true"></i>
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <!-- endregion -->
                            </ng-container>
                        </tbody>

                        <!-- region add bulk items -->
                        <div class="p-1 aqua-color add-line-bulk-item" style="width: max-content;">
                            <a href="javascript:void 0" (click)="addBlankRow(null)">+ Add New Line</a>
                            <span style="font-size:14px; color: #c5c5c5;"> | </span>
                            <a (click)="showBulkItemModal = true; bulkItemsModal.show()" href="javascript:void 0">+ Add
                                Bulk
                                Entries</a>
                        </div>
                        <!-- endregion -->
                        <tfoot>
                            <tr>
                                <td colspan="4">
                                    <!-- region other details-->
                                        <div>
                                            <div class="collapse-pane clearfix">

                                                <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">

                                                    <div class="ico-box-wrap">
                                                        <div class="ico-box">
                                                            <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
                                                        </div>
                                                    </div>

                                                    <div class="ico-head">Other Details</div>
                                                </div>

                                                <div [collapse]="isOthrDtlCollapsed" class="clearfix max-600 pdL3 mr0">
                                                    <div class="row">
                                                    <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                            <giddh-datepicker #shippingDate="ngModel" [placeholder]="templatePlaceholder?.shippedDateLabel" name="shippingDate" [(ngModel)]="invFormData.templateDetails.other.shippingDate" [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                            </giddh-datepicker>

                                                        <p class="text-danger" *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                            Invalid Date
                                                        </p>
                                                    </div>

                                                    <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                        <input type="text" name="shippedVia" [(ngModel)]="invFormData.templateDetails.other.shippedVia"
                                                            class="form-control" [placeholder]="templatePlaceholder?.shippedViaLabel || 'Ship Via'" />
                                                    </div>

                                                    <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                        <input type="text" name="trackingNumber" [(ngModel)]="invFormData.templateDetails.other.trackingNumber"
                                                            class="form-control" [placeholder]="templatePlaceholder?.trackingNumber || 'Tracking No.'" />
                                                    </div>

                                                    </div>
                                                    <div class="row">
                                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                            <input type="text" name="customField1" [(ngModel)]="invFormData.templateDetails.other.customField1"
                                                                class="form-control" [placeholder]="templatePlaceholder?.customField1Label || 'Field 1'" />
                                                        </div>

                                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                            <input type="text" name="customField2" [(ngModel)]="invFormData.templateDetails.other.customField2"
                                                                class="form-control" [placeholder]="templatePlaceholder?.customField2Label || 'Field 2'" />
                                                        </div>

                                                        <div class="form-group col-xs-4 col-sm-4 mb-0">
                                                            <input type="text" name="customField3" [(ngModel)]="invFormData.templateDetails.other.customField3"
                                                                class="form-control" [placeholder]="templatePlaceholder?.customField3Label || 'Field 3'" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                        <!-- endregion -->

                                        <!-- region note/messages -->
                                        <div class="pd-t1 pl0 max-600" *ngIf="!isPurchaseInvoice">

                                            <label class="mr-b1">Note</label>
                                            <textarea style="height:120px !important" class="form-control"
                                                name="message2"
                                                [(ngModel)]="invFormData.templateDetails.other.message2">
                                             </textarea>
                                        </div>
                                        <!-- endregion -->

                                        <div class="pd-t1 pl0 max-600 pos-rel" *ngIf="isPurchaseInvoice">

                                            <label class="mr-b1"><i class="icon-file-path"></i>
                                                Attachment</label>

                                            <label class="custom-file-label form-control cp pos-rel" for="invoiceFile">
                                                <em *ngIf="!selectedFileName && !isFileUploading">Drag/Drop file or
                                                    click here</em>
                                                <div *ngIf="isFileUploading"
                                                    class="d-flex justify-content-center align-items-center">
                                                    <i class="fa fa-spinner rotate"></i>
                                                </div>
                                                <em *ngIf="selectedFileName && !isFileUploading"
                                                    class="text-success">{{selectedFileName}}</em>
                                                <span class="text-success"><i class="fa fa-check"
                                                        *ngIf="selectedFileName && !isFileUploading"></i></span>
                                                <input type="file" name="invoiceFile" id="invoiceFile"
                                                    [options]="fileUploadOptions" ngFileSelect
                                                    [uploadInput]="uploadInput" (uploadOutput)="onUploadOutput($event)"
                                                    (change)="onFileChange($event.target)" droppable="true">
                                            </label>

                                        </div>
                                        <!-- endregion -->

                                </td>
                                <!-- region total section -->
                                <td colspan="4">

                                    <section class="tableSec form-group">

                                        <div class="tableRow">
                                            <div class="tableCell">Total Amount</div>
                                            <div class="tableCell figureCell">
                                                <span
                                                    *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.subTotal | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow">
                                            <div class="tableCell">Discount</div>
                                            <div class="tableCell figureCell">
                                                <span
                                                    *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>
                                                {{invFormData.voucherDetails.totalDiscount * -1 | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow">
                                            <div class="tableCell">Taxable Value</div>
                                            <div class="tableCell figureCell">
                                                <span
                                                    *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.totalTaxableValue | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow" *ngIf="!excludeTax">
                                            <div class="tableCell">Tax</div>
                                            <div class="tableCell figureCell">
                                                <span
                                                    *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.gstTaxesTotal | giddhCurrency}}
                                            </div>
                                        </div>

                                        <div class="tableRow" *ngIf="!excludeTax">
                                            <div class="tableCell">CESS</div>
                                            <div class="tableCell figureCell"><span
                                                    *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.cessTotal | giddhCurrency}}
                                            </div>
                                        </div>
                                        <div class="tableRow"
                                            *ngIf="(calculatedRoundOff > 0 || calculatedRoundOff < 0)">

                                            <div class="tableCell">
                                                <strong>Round Off</strong>
                                            </div>

                                            <div class="tableCell figureCell">
                                                <strong> <span
                                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>
                                                    {{calculatedRoundOff | giddhCurrency}}</strong>
                                            </div>

                                        </div>

                                        <div class="tableRow ">

                                            <div class="tableCell bigger-dollar">
                                                <strong>Total <span
                                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span></strong>
                                            </div>

                                            <div class="tableCell figureCell">
                                                <strong><span
                                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.grandTotal | giddhCurrency}}
                                                </strong>
                                            </div>

                                        </div>
                                        <!-- multicurrency feature (editable grand total make it functional) -->
                                        <div class="tableRow" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                            <div class="tableCell bigger-dollar">
                                                <strong>Total <span>{{baseCurrencySymbol}}</span>
                                                </strong>
                                            </div>

                                            <div class="tableCell figureCell">
                                                <input #grandTotalInr type="text" class="form-control"
                                                    name="grandTotalMulDum" [prefix]="baseCurrencySymbol"
                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                    [(ngModel)]="grandTotalMulDum"
                                                    (blur)="updateExchangeRate(grandTotalInr.value)">

                                            </div>
                                        </div>

                                        <div class="tableRow" *ngIf="invFormData.voucherDetails.tcsTotal > 0">
                                            <div class="tableCell">TCS</div>
                                            <div class="tableCell figureCell"><span
                                                    *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>
                                                {{invFormData.voucherDetails.tcsTotal | giddhCurrency}}</div>
                                        </div>

                                        <div class="tableRow" *ngIf="invFormData.voucherDetails.tdsTotal > 0">
                                            <div class="tableCell">TDS</div>
                                            <div class="tableCell figureCell"><span
                                                    *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.tdsTotal | giddhCurrency}}
                                            </div>
                                        </div>

                                        <!--region balance due for non-purchase-->
                                        <div class="tableRow"
                                            *ngIf="((isSalesInvoice || isCashInvoice)) && !(isPendingVoucherType && isCashInvoice) && !(!(isAccountHaveAdvanceReceipts || isInvoiceAdjustedWithAdvanceReceipts) && isUpdateMode)">

                                            <div class="tableCell deposit-section">

                                                <div class="btn-group">

                                                    <div (click)="clickedInside($event)" id="deposit-dropdown"
                                                        class="form-group pd-1">
                                                        <p>Deposit</p>
                                                        <ul>
                                                            <ng-container
                                                                *ngIf="isSalesInvoice && (isAccountHaveAdvanceReceipts || isInvoiceAdjustedWithAdvanceReceipts)">
                                                                <li role="menuitem" class="mr-t1 ">
                                                                    <div
                                                                        class="clearfix paymentMode deposit-payment-mode">

                                                                        <div class="pull-right balanceDueText">
                                                                            <div class="clearfix mb-1 text-left">
                                                                                <span class="pd0 mr-2 d-inline-block">
                                                                                    <input class="radio-custom cp ml0"
                                                                                        name="advanceReceipt"
                                                                                        [value]="false"
                                                                                        name="isAdjustAmount"
                                                                                        [(ngModel)]="isAdjustAmount"
                                                                                        (ngModelChange)="clickAdjustAmount($event)"
                                                                                        id="adjustAmountNo"
                                                                                        type="radio">
                                                                                    <label class="radio-custom-label"
                                                                                        for="adjustAmountNo"
                                                                                        (click)="clickAdjustAmount(false)">No</label>
                                                                                </span>
                                                                                <span class="pd0 d-inline-block">
                                                                                    <input class="radio-custom cp ml0"
                                                                                        name="advanceReceipt"
                                                                                        [value]="true"
                                                                                        name="isAdjustAmount"
                                                                                        (ngModelChange)="clickAdjustAmount($event)"
                                                                                        [(ngModel)]="isAdjustAmount"
                                                                                        id="adjustAmountYes"
                                                                                        type="radio">
                                                                                    <label class="radio-custom-label"
                                                                                        for="adjustAmountYes"
                                                                                        (click)="clickAdjustAmount(true)">Yes</label>
                                                                                </span>
                                                                            </div>

                                                                            <div class="clearfix">
                                                                                <span class="pull-left">
                                                                                    <p class="text-light mb-0">Advance
                                                                                        Receipt</p>
                                                                                    <p class="text-light">
                                                                                        {{adjustPaymentData.totalAdjustedAmount | giddhCurrency}}
                                                                                    </p>
                                                                                </span>
                                                                                <a href="javascript:void(0)"
                                                                                    (click)="clickAdjustAmount(true)"
                                                                                    class="font-12 pl-1 color-primary"><i
                                                                                        class="icon-edit11"></i></a>
                                                                            </div>
                                                                        </div>

                                                                        <label class="pull-right">Adjust Amount</label>
                                                                    </div>
                                                                </li>
                                                            </ng-container>

                                                            <ng-container *ngIf="!isUpdateMode">
                                                                <li role="menuitem" class="mr-t1 ">
                                                                    <div class="clearfix paymentMode">

                                                                        <sh-select class="pull-right "
                                                                            name="depositAccountUniqueName"
                                                                            [options]="bankAccounts$ | async"
                                                                            [(ngModel)]="depositAccountUniqueName"
                                                                            (selected)="onSelectPaymentMode($event)"
                                                                            [placeholder]="'Select Account'"
                                                                            [notFoundLink]="false"
                                                                            [forceClearReactive]="forceClear$ | async"
                                                                            [multiple]="false" [ItemHeight]="33"
                                                                            [useInBuiltFilterForIOptionTypeItems]="true"
                                                                            class="text-left">
                                                                            <ng-template #optionTemplate1
                                                                                let-option="option">
                                                                                <a href="javascript:void(0)"
                                                                                    class="list-item"
                                                                                    style="border-bottom: 1px solid #ccc;">
                                                                                    <div class="item">{{ option.label }}
                                                                                    </div>
                                                                                    <div class="item-unique">
                                                                                        {{ option.value }}
                                                                                    </div>
                                                                                </a>
                                                                            </ng-template>
                                                                        </sh-select>
                                                                        <label class="pull-right">Payment Mode</label>
                                                                    </div>
                                                                </li>

                                                                <li class="clearfix mr-t1 d-flex align-items-center payment-mode-amount" *ngIf="isSalesInvoice">
                                                                    <input type="text" (blur)="calculateBalanceDue()"
                                                                        placeholder="Amount" name="dueAmount"
                                                                        class="form-control amountField text-right pull-right max100"
                                                                        [(ngModel)]="depositAmount"
                                                                        [prefix]="depositCurrSymbol"
                                                                        [suffix]="selectedSuffixForCurrency"
                                                                        [mask]="inputMaskFormat" />
                                                                    <label class="pull-right">Amount</label>
                                                                </li>

                                                                <li class="clearfix mr-t1  d-flex align-items-center payment-mode-amount" *ngIf="isCashInvoice">
                                                                    <span
                                                                        class="amountField pull-right max100 amountFiledCash">
                                                                        <span
                                                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span> {{invFormData.voucherDetails.balanceDue
                                                | giddhCurrency}}</span>
                                                                    <label class="pull-right">Amount</label>
                                                                </li>

                                                                <li class="clearfix mr-t1 bigger-dollar"
                                                                    *ngIf="isSalesInvoice ">
                                                                    <strong class="pull-right balanceDueText"> <span
                                                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>
                                                                        <ng-container
                                                                            *ngIf="adjustPaymentData?.totalAdjustedAmount">
                                                                            {{adjustPaymentBalanceDueData | giddhCurrency }}
                                                                        </ng-container>
                                                                        <ng-container
                                                                            *ngIf="!adjustPaymentData?.totalAdjustedAmount">
                                                                            {{invFormData.voucherDetails.balanceDue | giddhCurrency }}
                                                                        </ng-container>
                                                                    </strong>
                                                                    <strong class="pull-right">Balance Due</strong>
                                                                </li>
                                                            </ng-container>
                                                        </ul>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <!--endregion-->

                                        <!-- region balance due for purchase -->
                                        <div class="tableRow" *ngIf="isPurchaseInvoice">
                                            <div class="tableCell">
                                                <strong>Balance Due</strong>
                                            </div>
                                            <div class="tableCell figureCell">
                                                <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong>
                                            </div>
                                        </div>
                                        <!-- endregion -->
                                    </section>
                                </td>
                                <!-- endregion -->
                                <td></td>
                            </tr>
                        </tfoot>

                    </table>

                </section>
                <!-- endregion -->

                <!-- region mobile view -->
                <div class="showInMobile" *ngIf="isMobileScreen">
                    <div class="card-invoice-table-wrapper"
                        *ngFor="let entry of invFormData.entries; let entryIdx = index; let first = first; let last = last">
                        <ng-container *ngFor="let transaction of entry.transactions;">
                            <!-- region static entry -->
                            <div class="card-invoiceTable" [hidden]="activeIndx === entryIdx">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-12">
                                        <div class="single-card-row">
                                            <div class="productName">
                                                <label class="card-label">Product/Service Description</label>
                                                <label *ngIf="!transaction.accountName" class="selectAccountLabel">Click
                                                    to Select
                                                    Account</label>
                                                <p>{{transaction.accountName}}</p>
                                                <span *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}}
                                                    )</span>
                                            </div>

                                            <p class="discription">
                                                {{transaction.description}}
                                            </p>
                                            <p class="small text-muted sku_and_customfields" *ngIf="transaction.sku_and_customfields">
                                                {{transaction.sku_and_customfields}}</p>

                                            <div class="dateHsnCode pdR0">
                                                <div class="row">

                                                    <div class="col-xs-6 col-sm-6" *ngIf="entry.entryDate">
                                                        <div class="entryDate">
                                                            <label>Entry Date: {{entry.entryDate | date: 'dd-MM-yyyy'}}
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <div class="col-xs-6 col-sm-6 pdL0" *ngIf="transaction.hsnNumber || transaction.sacNumber">
                                                        <div class="hsnCode text-right">
                                                            <label>HSN/SAC:
                                                                {{(inventorySettings?.manageInventory || !transaction.sacNumberExists) ? transaction.hsnNumber : transaction.sacNumber}}</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-6 col-sm-6">
                                        <div class="single-card-row">
                                            <div class="qty-unit">
                                                <label class="card-label">Qty/Unit</label>
                                                <p>{{transaction.quantity}} {{transaction.stockUnit}}</p>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-xs-6 col-sm-6">
                                        <div class="single-card-row">
                                            <div class="card-rate">
                                                <label class="card-label">Rate</label>
                                                <div *ngIf="transaction.rate > 0 || transaction.isStockTxn">
                                                    <p> <span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                            {{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{transaction.rate | giddhCurrency: ratePrecision:true}}
                                                    </p>
                                                    <div *ngIf="isMulticurrencyAccount && !isPurchaseInvoice" class="differ-currency">
                                                        <span>{{baseCurrencySymbol}}</span>
                                                        <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-6 col-sm-6">
                                        <div class="single-card-row">
                                            <div class="card-amount">
                                                <label class="card-label">Amount</label>
                                                <p> <span
                                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}
                                                    </span>{{transaction.amount | giddhCurrency}}</p>

                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-6 col-sm-6">
                                        <div class="single-card-row">
                                            <div class="card-discount">
                                                <label class="card-label">Discount</label>
                                                <p> <span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                        {{invFormData.accountDetails.currencySymbol}}</span>{{ entry.discountSum }}
                                                </p>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-6 col-sm-6">
                                        <div class="single-card-row">
                                            <div class="card-tax">
                                                <label class="card-label">Tax</label>
                                                <p><span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                        {{invFormData.accountDetails.currencySymbol}}</span>{{entry.taxSum}} %
                                                </p>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-6 col-sm-6">
                                        <div class="single-card-row">
                                            <div class="card-total">
                                                <label class="card-label">Total</label>
                                                <p><span *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                        {{invFormData.accountDetails.currencySymbol}}</span>{{transaction.total | giddhCurrency}}
                                                </p>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="edit-card" (click)="setActiveIndx(entryIdx);$event.stopPropagation()">
                                    <img src="assets/images/edit-pencilicon.svg">
                                </div>

                                <div class="del-card" (click)="removeTransaction(entryIdx)">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </div>

                            </div>
                            <!-- endregion -->

                            <!-- region dynamic entry -->
                            <div class="card-invoiceTable edit-card-invoiceTable" [hidden]="activeIndx !== entryIdx">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-12">
                                        <div class="single-card-row">
                                            <div class="productName">
                                                <label class="card-label">Product/Service Description</label>
                                                <div class="productName">
                                                    <div class="ng-select-wrap">
                                                        <sh-select [options]="salesAccounts$ | async"
                                                            [(ngModel)]="transaction.fakeAccForSelect2"
                                                            name="transaction.fakeAccForSelect2_{{entryIdx}}"
                                                            (selected)="onSelectSalesAccount($event,transaction, entry)"
                                                            [placeholder]="'Select A/cc'" [notFoundLink]="true"
                                                            [isPaginationEnabled]="true" (scrollEnd)="handleScrollEnd('item')"
                                                            (dynamicSearchedQuery)="onSearchQueryChanged($event, 1, 'item')"
                                                            [notFoundMsg]="noResultsFoundLabel"
                                                            [enableDynamicSearch]="true" (onHide)="resetPreviousSearchResults(true, 'item')"
                                                            [forceClearReactive]="forceClear$ | async"
                                                            (noResultsClicked)="onNoResultsClicked(entryIdx)" [multiple]="false"
                                                            [ItemHeight]="67" (onClear)="onClearSalesAccount(transaction)"
                                                            [useInBuiltFilterForFlattenAc]="true">

                                                            <ng-template #optionTemplate let-option="option">
                                                                <ng-container *ngIf="!option.additional?.stock">
                                                                    <a href="javascript:void(0)" class="list-item flex-column">
                                                                        <div class="item">{{ option.label }}</div>
                                                                        <div class="item-unique">
                                                                            {{ option.additional?.uniqueName }}</div>
                                                                    </a>
                                                                </ng-container>
                                                                <ng-container *ngIf="option.additional?.stock">
                                                                    <a href="javascript:void(0)" class="list-item flex-column">
                                                                        <div class="item">{{ option.label }}</div>
                                                                        <div class="item-unique">
                                                                            {{ option.additional?.uniqueName }}</div>
                                                                        <div class="item-stock">Stock:
                                                                            {{ option.additional?.stock.uniqueName }}
                                                                        </div>
                                                                    </a>
                                                                </ng-container>
                                                            </ng-template>
                                                        </sh-select>
                                                    </div>
                                                </div>

                                                <div *ngIf="transaction.fakeAccForSelect2">
                                                    <div class="skuNumber">
                                                        <label>SKU:</label>Number
                                                    </div>

                                                    <div class="discription">
                                                        <textarea type="text" placeholder="Add Description"
                                                            name="transaction.description_{{entryIdx}}" class="form-control"
                                                            [(ngModel)]="transaction.description">
                                                          </textarea>
                                                        <p class="small text-muted sku_and_customfields"
                                                            *ngIf="transaction.sku_and_customfields">
                                                            {{transaction.sku_and_customfields}}</p>
                                                    </div>

                                                    <!-- region entry date/ hsncode -->
                                                    <div class="dateHsnCode">

                                                        <div class="row">
                                                            <div class="col-xs-6 col-sm-6 pdR0">
                                                                <div class="entryDate">
                                                                    <label>Entry Date: </label>

                                                                    <span *ngIf="!isUpdateMode">
                                                                        <input type="text" [placeholder]="giddhDateFormat" bsDatepicker
                                                                            name="transaction.date_{{entryIdx}}"
                                                                            id="transaction.date_{{entryIdx}}"
                                                                            class="form-control text-left" [(ngModel)]="entry.entryDate"
                                                                            [disabled]="isUpdateMode"
                                                                            (onShown)="hsnDropdownShow = false"
                                                                            [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                                                                            #dp="bsDatepicker" />
                                                                        <span class="edit-icon cp" (click)="dp.toggle()"
                                                                            [attr.aria-expanded]="dp.isOpen">
                                                                            <img src="assets/images/edit-pencilicon.svg">
                                                                        </span>
                                                                    </span>

                                                                    <span *ngIf="isUpdateMode">
                                                                        {{ entry.entryDate | date: 'dd-MM-yyyy'}}
                                                                    </span>

                                                                </div>
                                                            </div>

                                                            <div class="col-xs-6 col-sm-6 pdL0">
                                                                <div class="wrap-hsnBox">
                                                                    <div class="hsnCode text-right"
                                                                        (click)="toggleHsnSacDropDown(transaction)">
                                                                        <label>HSN/SAC:</label>
                                                                        <span>
                                                                            {{(inventorySettings?.manageInventory || !transaction.sacNumber) ? transaction.hsnNumber : transaction.sacNumber }}
                                                                            <span
                                                                                *ngIf="!transaction.hsnNumber && !transaction.sacNumber"
                                                                                class="updateText">Update
                                                                            </span>
                                                                            <span class="edit-icon cp">
                                                                                <img src="assets/images/edit-pencilicon.svg">
                                                                            </span>
                                                                        </span>
                                                                    </div>

                                                                    <div class="hsn-code-dropdown" *ngIf="hsnDropdownShow">
                                                                        <label>HSN/SAC</label>
                                                                        <input type="text" maxLength="10" placeholder="HSN/SAC Number"
                                                                            name="transaction.hsnNumber_{{entryIdx}}"
                                                                            *ngIf="(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                            [(ngModel)]="transaction.hsnNumber" />
                                                                        <input type="text" maxLength="10" placeholder="HSN/SAC Number"
                                                                            name="transaction.hsnNumber_{{entryIdx}}"
                                                                            *ngIf="!(inventorySettings?.manageInventory || !transaction.sacNumberExists)"
                                                                            [(ngModel)]="transaction.sacNumber" />
                                                                        <a>
                                                                        </a>
                                                                        <div class="btngroup m-t-10">
                                                                            <button class="btn btn-sm btn-success" type="button"
                                                                                (click)="hsnDropdownShow=!hsnDropdownShow">
                                                                                Save
                                                                            </button>
                                                                            <button class="btn btn-sm btn-primary" type="button"
                                                                                (click)="hideHsnSacEditPopup(transaction)">
                                                                                Cancel
                                                                            </button>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <!-- endregion -->
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row quantityUnitW100">
                                    <div class="col-xs-6 col-sm-6">

                                        <div class="single-card-row">
                                            <div class="qty-unit">

                                                <div class="row">

                                                    <div class="col-xs-6 col-sm-6">
                                                        <label class="card-label text-right">Qty</label>
                                                        <input type="text" [disabled]="!transaction.isStockTxn"
                                                            (blur)="handleQuantityBlur(entry, transaction);" placeholder="Quantity"
                                                            decimalDigitsDirective name="transaction.quantity_{{entryIdx}}"
                                                            class="form-control text-right" [(ngModel)]="transaction.quantity" />
                                                    </div>
                                                    <div class="col-xs-6 col-sm-6">
                                                        <label class="card-label text-right">Unit</label>
                                                        <select class="form-control" [disabled]="!transaction.isStockTxn"
                                                            name="transaction.stockUnit_{{entryIdx}}"
                                                            [(ngModel)]="transaction.stockUnit"
                                                            (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                                                            <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">
                                                                {{stock.text}}
                                                            </option>
                                                        </select>

                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-xs-6 col-sm-6">

                                        <div class="single-card-row">

                                            <div class="card-rate">
                                                <label class="card-label text-right">Rate</label>
                                                <div style="flex: 1;">
                                                    <input type="text" [disabled]="!transaction.isStockTxn"
                                                        (blur)="calculateStockEntryAmount(transaction);calculateWhenTrxAltered(entry, transaction)"
                                                        placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                                        class="form-control transaction-rate text-right" [(ngModel)]="transaction.rate"
                                                        [prefix]="invFormData.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                        [customDecimalPlaces]="highPrecisionRate" />
                                                </div>
                                                <!-- please add condition for show and hide -->
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{((transaction.rate * exchangeRate) ? transaction.rate * exchangeRate : 0) | giddhCurrency: ratePrecision:true}}</span>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-xs-6 col-sm-6">

                                        <div class="single-card-row">

                                            <div class="card-amount">

                                                <label class="card-label text-right">Amount</label>
                                                <div style="flex: 1;">
                                                    <input type="tel" (blur)="calculateWhenTrxAltered(entry, transaction, true)"
                                                        (input)="checkVoucherEntries()"
                                                        (click)="transactionAmountClicked(transaction)" placeholder="Amount"
                                                        name="transaction.amount_{{entryIdx}}" class="form-control text-right"
                                                        [(ngModel)]="transaction.amount" decimalDigitsDirective
                                                        [prefix]="invFormData.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{(transaction.amount * exchangeRate || 0) | giddhCurrency}}</span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="col-xs-6 col-sm-6">

                                        <div class="single-card-row">

                                            <div class="card-discount">
                                                <label class="card-label text-right">Discount</label>
                                                <div class="text-right" style="flex:1;">

                                                    <discount-control-component #discountComponent [discountMenu]="false"
                                                        [discountAccountsDetails]="entry.discounts" [discountSum]="entry.discountSum"
                                                        [showHeaderText]="false" (hideOtherPopups)="closeTaxControlPopup()"
                                                        (discountTotalUpdated)="calculateWhenTrxAltered(entry, transaction)"
                                                        [maskInput]="inputMaskFormat"
                                                        [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                        [suffixInput]="selectedSuffixForCurrency">
                                                    </discount-control-component>

                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{entry.discountSum * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-xs-6 col-sm-6">

                                        <div class="single-card-row">
                                            <div class="card-tax">
                                                <label class="card-label text-right">Tax</label>

                                                <div class="text-right" style="flex:1;">
                                                    <tax-control #taxControlComponent [taxes]="companyTaxesList" [date]="entry.entryDate"
                                                        [taxRenderData]="entry.taxes" [totalForTax]="transaction.taxableValue"
                                                        [applicableTaxes]="transaction.applicableTaxes"
                                                        [exceptTaxTypes]="exceptTaxTypes"
                                                        [allowedSelectionOfAType]="allowedSelectionOfAType" [showHeading]="false"
                                                        [rootClass]="'salseInvoicetable'"
                                                        (taxAmountSumEvent)="calculateWhenTrxAltered(entry, transaction)"
                                                        (hideOtherPopups)="closeDiscountPopup()" [maskInput]="inputMaskFormat"
                                                        [prefixInput]="invFormData.accountDetails.currencySymbol"
                                                        [suffixInput]="selectedSuffixForCurrency">
                                                    </tax-control>
                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{(entry.taxSum + entry.cessSum) * exchangeRate | giddhCurrency}}</span>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-6 col-sm-6">
                                        <div class="single-card-row">
                                            <div class="card-total">
                                                <label class="card-label text-right">Total</label>
                                                <div style="flex:1;">
                                                    <input type="tel" name="transaction.total_{{entryIdx}}"
                                                        class="form-control text-right"
                                                        (blur)="calculateTransactionValueInclusively(entry, transaction)"
                                                        [(ngModel)]="transaction.total" decimalDigitsDirective
                                                        [prefix]="invFormData.accountDetails.currencySymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />

                                                    <div *ngIf="isTcsTdsApplicable" class="wrap-otherTax">
                                                        <input type="checkbox" class="other-taxes-checkobx"
                                                            [(ngModel)]="entry.isOtherTaxApplicable" *ngIf="!entry.isOtherTaxApplicable"
                                                            (click)="tcsTdsIndex = entryIdx"
                                                            name="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                            id="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                            (ngModelChange)="toggleOtherTaxesAsidePane(entry.isOtherTaxApplicable, entryIdx)">
                                                        <label for="entry.isOtherTaxApplicable_{{entryIdx}}"
                                                            *ngIf="!entry.isOtherTaxApplicable" class="otherTaxLable"
                                                            style="font-size:13px;vertical-align: middle">Other
                                                            Tax?</label>
                                                    </div>
                                                    <div *ngIf="entry.isOtherTaxApplicable" class="mr-t1 othertaxes">

                                                        <span>

                                                            <div style="display: flex;align-items: center">
                                                                <span style="margin-right: 5px">
                                                                    <a href="javascript: void 0"
                                                                        (click)="toggleOtherTaxesAsidePane(true, entryIdx)">
                                                                        <img src="assets/images/edit-pencilicon.svg">
                                                                    </a>
                                                                </span>

                                                                <input class="text-right form-control other-taxes-input"
                                                                    disabled="disabled" [(ngModel)]="entry.otherTaxSum"
                                                                    [prefix]="invFormData.accountDetails.currencySymbol"
                                                                    [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                                                    name="entry.otherTaxesSum_{{entryIdx}}" />
                                                            </div>

                                                            <p
                                                                style="margin-top: 5px; font-size: 12px; text-transform: capitalize; margin-bottom: 20px;">
                                                                {{ entry.otherTaxModal?.appliedOtherTax?.name}}</p>
                                                        </span>

                                                    </div>
                                                </div>
                                                <div *ngIf="entry.isOtherTaxApplicable && isMulticurrencyAccount && !isPurchaseInvoice"
                                                    class="texIncurrency" style="color:#999;">
                                                    {{ entry.otherTaxModal?.appliedOtherTax?.name }}
                                                    <span>{{baseCurrencySymbol}}</span> :
                                                    <span>{{entry.otherTaxSum * exchangeRate | giddhCurrency}}</span>
                                                </div>
                                                <div class="differ-currency" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                                    <span>{{baseCurrencySymbol}}</span>
                                                    <span>{{transaction.total * exchangeRate | giddhCurrency}}</span>
                                                </div>

                                                <ng-container *ngTemplateOutlet="otherTaxesModal;context: {$implicit: entry }">
                                                </ng-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="saveCard-data pointer" (click)="handleOutsideClick()">
                                    <i class="fa fa-floppy-o" aria-hidden="true"></i>
                                </div>

                                <div class="del-card pointer" (click)="removeTransaction(entryIdx)">
                                    <i class="icon-trash" aria-hidden="true"></i>
                                </div>

                            </div>
                            <!-- endregion -->
                        </ng-container>

                    </div>

                    <div class="add-btn">
                        <button class="btn btn-sm btn-success" (click)="addBlankRow(null)">Add More</button>
                    </div>

                    <div class="other-detail-card">
                        <div>
                            <div class="collapse-pane clearfix">
                                <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                                    <div class="ico-box-wrap">
                                        <div class="ico-box">
                                            <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
                                        </div>
                                    </div>
                                    <div class="ico-head">Other Details</div>
                                </div>

                                <div [collapse]="isOthrDtlCollapsed" class="clearfix max-600  mr0">

                                    <div class="row">

                                        <div class="form-group col-12 col-sm-4 mb-0">
                                            <giddh-datepicker #shippingDate="ngModel" [placeholder]="templatePlaceholder?.shippedDateLabel" name="shippingDate"
                                                [(ngModel)]="invFormData.templateDetails.other.shippingDate"
                                                [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                            </giddh-datepicker>
                                            <p class="text-danger"
                                                *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">
                                                Invalid Date</p>
                                        </div>

                                        <div class="form-group col-12 col-sm-4 mb-0">
                                            <input type="text" name="shippedVia"
                                                [(ngModel)]="invFormData.templateDetails.other.shippedVia" class="form-control"
                                                [placeholder]="templatePlaceholder?.shippedViaLabel || 'Ship Via'" />
                                        </div>

                                        <div class="form-group col-12 col-sm-4 mb-0">
                                            <input type="text" name="trackingNumber"
                                                [(ngModel)]="invFormData.templateDetails.other.trackingNumber" class="form-control"
                                                [placeholder]="templatePlaceholder?.trackingNumber || 'Tracking No.'" />
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-12 col-sm-4 mb-0">
                                            <input type="text" name="customField1"
                                                [(ngModel)]="invFormData.templateDetails.other.customField1" class="form-control"
                                                [placeholder]="templatePlaceholder?.customField1Label || 'Field 1'" />
                                        </div>

                                        <div class="form-group col-12 col-sm-4 mb-0">
                                            <input type="text" name="customField2"
                                                [(ngModel)]="invFormData.templateDetails.other.customField2" class="form-control"
                                                [placeholder]="templatePlaceholder?.customField2Label || 'Field 2'" />
                                        </div>

                                        <div class="form-group col-12 col-sm-4 mb-0">
                                            <input type="text" name="customField3"
                                                [(ngModel)]="invFormData.templateDetails.other.customField3" class="form-control"
                                                [placeholder]="templatePlaceholder?.customField3Label || 'Field 3'" />
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="pd-t1 pl0 max-600" *ngIf="!isPurchaseInvoice">
                                <label class="mr-b1">Note</label>
                                <textarea style="height:120px" class="form-control" name="message2"
                                    [(ngModel)]="invFormData.templateDetails.other.message2"></textarea>
                            </div>

                        </div>
                    </div>

                    <div class="total-amountDiscription">

                        <section class="tableSec form-group">

                            <div class="tableRow">
                                <div class="tableCell">Total Amount</div>
                                <div class="tableCell figureCell">
                                    <span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.subTotal | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow">
                                <div class="tableCell">Discount</div>
                                <div class="tableCell figureCell"><span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.totalDiscount * -1 | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow">
                                <div class="tableCell">Taxable Value</div>
                                <div class="tableCell figureCell">
                                    <span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.totalTaxableValue | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow" *ngIf="!excludeTax">
                                <div class="tableCell">Tax</div>
                                <div class="tableCell figureCell"><span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.gstTaxesTotal | giddhCurrency}}
                                </div>
                            </div>

                            <div class="tableRow" *ngIf="!excludeTax">
                                <div class="tableCell">CESS</div>
                                <div class="tableCell figureCell"><span
                                        *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.cessTotal | giddhCurrency}}
                                </div>
                            </div>
                            <div class="tableRow"
                                *ngIf="(calculatedRoundOff > 0 || calculatedRoundOff < 0)">

                                <div class="tableCell">
                                    <strong>Round Off</strong>
                                </div>

                                <div class="tableCell figureCell">
                                    <strong> <span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>
                                        {{calculatedRoundOff | giddhCurrency}}</strong>
                                </div>

                            </div>
                            <div class="tableRow">
                                <div class="tableCell">
                                    <strong>Total <span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span></strong>
                                </div>

                                <div class="tableCell figureCell">
                                    <strong><span
                                            *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">{{invFormData.accountDetails.currencySymbol}}</span>{{invFormData.voucherDetails.grandTotal | giddhCurrency}}
                                    </strong>
                                </div>
                            </div>
                            <div class="tableRow" *ngIf="isMulticurrencyAccount && !isPurchaseInvoice">
                                <div class="tableCell bigger-dollar">
                                    <strong>Total <span>{{baseCurrencySymbol}}</span>
                                    </strong>
                                </div>

                                <div class="tableCell figureCell">
                                    <input #grandTotalInr type="text" class="form-control" name="grandTotalMulDum"
                                        [prefix]="baseCurrencySymbol" [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat"
                                        [(ngModel)]="grandTotalMulDum" (blur)="updateExchangeRate(grandTotalInr.value)">

                                </div>
                            </div>

                            <div class="tableRow" *ngIf="invFormData.voucherDetails.tcsTotal > 0">
                                <div class="tableCell">TCS</div>
                                <div class="tableCell figureCell">
                                    {{invFormData.voucherDetails.tcsTotal | giddhCurrency}}</div>
                            </div>

                            <div class="tableRow" *ngIf="invFormData.voucherDetails.tdsTotal > 0">
                                <div class="tableCell">TDS</div>
                                <div class="tableCell figureCell">
                                    {{invFormData.voucherDetails.tdsTotal | giddhCurrency}}</div>
                            </div>
                            <!--region balance due for non-purchase-->
                            <div class="tableRow" *ngIf="((isSalesInvoice || isCashInvoice) && !isUpdateMode )">

                                <div class="tableCell deposit-section">

                                    <div class="btn-group">

                                        <div (click)="clickedInside($event)" id="deposit-dropdown" class="form-group pd-1">
                                            <p>Deposit</p>
                                            <ul>



                                                <li role="menuitem" class="mr-t1 ">
                                                    <div class="clearfix paymentMode deposit-payment-mode">

                                                        <sh-select class="pull-right " name="depositAccountUniqueName"
                                                            [options]="bankAccounts$ | async" [(ngModel)]="depositAccountUniqueName"
                                                            (selected)="onSelectPaymentMode($event)" [placeholder]="'Select Account'"
                                                            [notFoundLink]="false" [forceClearReactive]="forceClear$ | async"
                                                            [multiple]="false" [ItemHeight]="33"
                                                            [useInBuiltFilterForIOptionTypeItems]="true" class="text-left">
                                                            <ng-template #optionTemplate1 let-option="option">
                                                                <a href="javascript:void(0)" class="list-item"
                                                                    style="border-bottom: 1px solid #ccc;">
                                                                    <div class="item">{{ option.label }}</div>
                                                                    <div class="item-unique">{{ option.value }}</div>
                                                                </a>
                                                            </ng-template>
                                                        </sh-select>
                                                        <label class="pull-right pt-1">Payment Mode</label>
                                                    </div>
                                                </li>

                                                <li class="clearfix mr-t1  d-flex align-items-center payment-mode-amount" *ngIf="isSalesInvoice">
                                                    <input type="text" (blur)="calculateBalanceDue()" placeholder="Amount"
                                                        name="dueAmount" class="form-control amountField text-right pull-right max100"
                                                        [(ngModel)]="depositAmount" [prefix]="depositCurrSymbol"
                                                        [suffix]="selectedSuffixForCurrency" [mask]="inputMaskFormat" />
                                                    <label class="pull-right pt-1">Amount</label>
                                                </li>

                                                <li class="clearfix mr-t1  d-flex align-items-center payment-mode-amount" *ngIf="isCashInvoice">
                                                    <span class="amountField pull-right max100 amountFiledCash">
                                                        <span
                                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{invFormData.voucherDetails.balanceDue | giddhCurrency}}</span>
                                                    <label class="pull-right pt-1">Amount</label>
                                                </li>

                                                <li class="clearfix mr-t1 bigger-dollar" *ngIf="isSalesInvoice ">
                                                    <strong class="pull-right balanceDueText"> <span
                                                            *ngIf="isMulticurrencyAccount">{{invFormData.accountDetails.currencySymbol}}</span>
                                                        {{invFormData.voucherDetails.balanceDue | giddhCurrency}}
                                                    </strong>
                                                    <strong class="pull-right">Balance Due</strong>
                                                </li>

                                            </ul>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!--endregion-->

                            <!-- region balance due for purchase -->
                            <div class="tableRow" *ngIf="isPurchaseInvoice">
                                <div class="tableCell">
                                    <strong>Balance Due</strong>
                                </div>
                                <div class="tableCell figureCell">
                                    <strong>{{invFormData.voucherDetails.balanceDue | giddhCurrency}}</strong>
                                </div>
                            </div>
                            <!-- endregion -->

                        </section>

                    </div>
                </div>
                <!-- endregion -->

            </ng-container>
            <!-- endregion -->

            <!-- endregion -->

            <!-- region submit actions-->
            <section class="clearfix">

                <section id="actionPane" class="text-center" [ngClass]="{'giddh-overlap-block': invFormData.voucherDetails.customerName }">

                    <div class="col-12">

                        <!-- region generate mode -->
                        <div class="pull-right pr update-mode" *ngIf="!isUpdateMode">
                            <button type="button" (click)="resetInvoiceForm(invoiceForm)"
                                class="btn btn-danger d-inline-block v-align-middle">Clear
                            </button>

                            <!-- region purchase invoice -->
                            <span class="d-inline-block v-align-middle" *ngIf="isPurchaseInvoice">
                                <!-- <button type="button" (click)="triggerSubmitInvoiceForm(invoiceForm, true)"
                            class="btn btn-default" *ngIf="isCustomerSelected">Save &amp; Update A/c
                        </button> -->
                                <button type="button" [disabled]="isFileUploading || !hasVoucherEntry"
                                    (click)="doAction(0);triggerSubmitInvoiceForm(invoiceForm, false)"
                                    class="btn btn-default">Save
                                </button>
                            </span>
                            <!-- endregion -->

                            <!-- region non purchase -->
                            <span class="d-inline-block v-align-middle"
                                *ngIf="!isPurchaseInvoice && (!isProformaInvoice  && !isEstimateInvoice)">

                                <button type="button" [disabled]="!hasVoucherEntry"
                                    (click)="triggerSubmitInvoiceForm(invoiceForm, true)" class="btn btn-default"
                                    *ngIf="isCustomerSelected && !isPendingVoucherType">Generate
                                    <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                        Cash
                                    </span> &amp; Update A/c
                                </button>

                                <div class="btn-group" [dropup]="isDropup" dropdown  [isDisabled]="!hasVoucherEntry">
                                    <button type="button" [disabled]="!hasVoucherEntry"
                                        (click)="doAction(0);triggerSubmitInvoiceForm(invoiceForm, false)"
                                        class="btn btn-default generateInvoie">Generate
                                        <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                            Cash
                                        </span>
                                    </button>
                                </div>

                                <div class="btn-group" dropdown [dropup]="isDropup">
                                    <button id="button-dropup"  *ngIf="invoiceType === 'sales'"
                                     dropdownToggle type="button" class="btn btn-default dropdown-toggle"
                                        aria-controls="dropdown-dropup">
                                        <span class="caret"></span>
                                    </button>
                                    <ul id="dropdown-dropup" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="button-dropup">
                                        <li role="menuitem">
                                            <a class="dropdown-item cp" (click)="doAction(2);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Send</a>
                                        </li>

                                        <li role="menuitem">
                                            <a class="dropdown-item cp" (click)="doAction(3);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Print</a>
                                        </li>

                                        <li role="menuitem" (click)="doAction(4);triggerSubmitInvoiceForm(invoiceForm, false)">
                                            <a class="dropdown-item cp">Generate & Recurring</a>
                                        </li>
                                    </ul>
                                </div>

                            </span>
                            <!-- endregion -->

                            <!-- region proforma/estimates -->
                            <span class="d-inline-block v-align-middle" *ngIf="isProformaInvoice || isEstimateInvoice">

                                <div class="btn-group" dropdown [dropup]="isDropup" [isDisabled]="!hasVoucherEntry">

                                    <button type="button" [disabled]="!hasVoucherEntry"
                                        (click)="doAction(0);triggerSubmitInvoiceForm(invoiceForm, false)"
                                        class="btn btn-default">Create
                                    </button>
                                    <button id="button-dropup" type="button" dropdownToggle
                                        class="btn btn-default dropdown-toggle dropdown-toggle-split" aria-controls="dropdown-dropup">
                                        <span class="caret"></span>
                                    </button>
                                    <ul id="dropdown-dropup" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu"
                                        aria-labelledby="button-dropup">
                                        <li role="menuitem">
                                            <a class="dropdown-item cp" (click)="doAction(2);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Send</a>
                                        </li>

                                        <li role="menuitem">
                                            <a class="dropdown-item cp" (click)="doAction(3);triggerSubmitInvoiceForm(invoiceForm, false)">Create
                                                & Print</a>
                                        </li>
                                    </ul>

                                </div>
                            </span>
                            <!-- endregion -->

                        </div>
                        <!-- endregion -->

                        <!-- region update mode -->
                        <div class="pull-right pr" *ngIf="isUpdateMode">

                            <button type="button" class="btn btn-danger d-inline-block v-align-middle"
                                (click)="cancelUpdate()">Cancel
                            </button>

                            <button type="button" class="btn btn-default"
                                [disabled]="isFileUploading || !hasVoucherEntry"
                                (click)="submitUpdateForm(invoiceForm)">
                                Update
                                <span *ngIf="isCashInvoice; else invoiceTypeDisplayRef">
                                    Cash
                                </span>

                            </button>
                        </div>
                        <!-- endregion -->

                    </div>
                </section>
            </section>
            <!-- endregion -->
            </form>
        </div>
        <!-- endregion -->
    </div>

    <!-- region models section -->
    <!-- open account aside -->
    <div class="aside-overlay" *ngIf="accountAsideMenuState === 'in' || asideMenuStateForProductService === 'in' ||
     asideMenuStateForRecurringEntry === 'in' || asideMenuStateForOtherTaxes === 'in'" (click)="closeAsideMenuStateForOtherTaxes()"></div>

    <generic-aside-menu-account [class]="accountAsideMenuState" [@slideInOut]="accountAsideMenuState"
        (closeAsideEvent)="toggleAccountAsidePane($event)"
        [selectedGrpUniqueName]="selectedGrpUniqueNameForAddEditAccountModal"
        [keyboardShortcut]="{'esc':accountAsideMenuState ==='in'}" *ngIf="accountAsideMenuState === 'in'"
        [selectedAccountUniqueName]="selectedCustomerForDetails" (onShortcutPress)="toggleAccountAsidePane()"
        (addEvent)="addNewSidebarAccount($event)" (updateEvent)="updateSidebarAccount($event)">
    </generic-aside-menu-account>

    <!--&lt;!&ndash; open product service aside &ndash;&gt;-->
    <aside-menu-product-service *ngIf="asideMenuStateForProductService === 'in'"
        [class]="asideMenuStateForProductService" [selectedVoucherType]="selectedVoucherType"
        [@slideInOut]="asideMenuStateForProductService" (closeAsideEvent)="onNoResultsClicked()"
        (animatePAside)="getActionFromAside($event)"></aside-menu-product-service>

    <app-aside-recurring-entry *ngIf="asideMenuStateForRecurringEntry === 'in'" [voucherType]="invoiceType"
        [voucherNumber]="voucherNumber" [class]="asideMenuStateForRecurringEntry"
        [@slideInOut]="asideMenuStateForRecurringEntry" (closeAsideEvent)="toggleRecurringAsidePane('out')">
    </app-aside-recurring-entry>
    <!-- region send email popup -->
    <div bsModal #sendEmailModal="bs-modal" tabindex="-1" class="modal fade" role="dialog" [config]="modalConfig">

        <div class="modal-dialog modal-md">
            <div class="modal-content">

                <ng-container *ngIf="actionAfterGenerateORUpdate === 2">
                    <app-send-email-invoice-component [voucherType]="invoiceType" (successEvent)="sendEmail($event)"
                        [selectedItem]="{ voucherNumber: invoiceNo, uniqueName: accountUniqueName, account: customerAccount }"
                        (cancelEvent)="cancelEmailModal()"></app-send-email-invoice-component>
                </ng-container>

            </div>
        </div>

    </div>
    <!-- endregion -->

    <!-- region bulk items -->
    <div bsModal #bulkItemsModal="bs-modal" tabindex="-1" class="modal fade" role="dialog"
        [config]="{ animated: true,keyboard: false,backdrop: false,ignoreBackdropClick: true }">

        <ng-container *ngIf="showBulkItemModal">
            <proforma-add-bulk-items-component [invoiceType]="invoiceType" (saveItemsEvent)="addBulkStockItems($event)" (closeEvent)="bulkItemsModal.hide()"></proforma-add-bulk-items-component>
        </ng-container>

    </div>
    <!-- endregion -->

    <!-- region last estimate modal-->
    <ng-template #lastEstimateModal let-show>
        <div *ngIf="show" class="last-estimate-modal">
            <proforma-last-invoices-component [data]="lastInvoices" (invoiceSelected)="getLastInvoiceDetails($event)">
            </proforma-last-invoices-component>
        </div>
    </ng-template>
    <!-- endregion -->

    <!-- region gst treatment modal-->
    <ng-template #gstTreatmentModal let-show>
        <div *ngIf="show" class="gstTreatmentModal">
            <proforma-gst-treatment-component (closeEvent)="showGstTreatmentModal = false">
            </proforma-gst-treatment-component>
        </div>
    </ng-template>
    <!-- endregion -->

    <ng-template let-entry #otherTaxesModal>
        <div id="top0">
            <app-aside-menu-other-taxes *ngIf="asideMenuStateForOtherTaxes === 'in'"
                [class]="asideMenuStateForOtherTaxes" [taxes]="companyTaxesList" [otherTaxesModal]="entry.otherTaxModal"
                [@slideInOut]="asideMenuStateForOtherTaxes" (closeModal)="toggleOtherTaxesAsidePane(true, null)"
                (applyTaxes)="calculateOtherTaxes($event);toggleOtherTaxesAsidePane(true, null);calculateAffectedThingsFromOtherTaxChanges();">
            </app-aside-menu-other-taxes>
        </div>
    </ng-template>

    <!-- create Group modal -->
    <section *ngIf="showCreateGroupModal">
        <div bsModal #createGroupModal="bs-modal" class="modal fade" role="dialog" [keyboardShortcut]="'esc'"
            (onShortcutPress)="closeCreateGroupModal()" [config]="modalConfig">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <sales-add-group-modal (actionFired)="closeCreateGroupModal($event)"></sales-add-group-modal>
                </div>
            </div>
        </div>
    </section>

    <!-- create Ac modal -->
    <section *ngIf="showCreateAcModal">
        <div bsModal #createAcModal="bs-modal" class="modal fade" role="dialog" [config]="modalConfig">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <create-account-modal [gType]="createAcCategory" (actionFired)="closeCreateAcModal()">
                    </create-account-modal>
                </div>
            </div>
        </div>
    </section>

    <!-- region print voucher popup -->
    <div bsModal #printVoucherModal="bs-modal" tabindex="-1" class="modal fade" role="dialog" [config]="modalConfig">

        <div class="modal-dialog modal-xl">
            <div class="modal-content">

                <ng-container *ngIf="actionAfterGenerateORUpdate === 3 && (invoiceNo && accountUniqueName)">
                    <proforma-print-in-place-component [voucherType]="invoiceType"
                        [selectedItem]="{ voucherNumber: invoiceNo, uniqueName: accountUniqueName }"
                        (cancelEvent)="cancelPrintModal()"></proforma-print-in-place-component>
                </ng-container>

            </div>
        </div>

    </div>


    <!-- common template ref for displaying invoice type with first letter capital -->
    <ng-template #invoiceTypeDisplayRef>
        {{((invoiceType === 'proforma' || invoiceType === 'proformas') ? 'proforma' : (invoiceType === 'estimate' || invoiceType === 'estimates') ? 'estimate' : invoiceType) | titlecase}}
    </ng-template>
    <div class="modal fade purchase-record-confirmation-modal" tabindex="-1" #purchaseRecordConfirmationPopup="bs-modal"
        [config]="{ animated: true, ignoreBackdropClick: true }" bsModal role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <confirmation-modal [configuration]="purchaseRecordConfirmationConfiguration"
                    (buttonClicked)="handlePurchaseRecordConfirmation($event)"></confirmation-modal>
            </div>
        </div>
    </div>

    <div class="modal fade purchase-record-confirmation-modal" tabindex="-1" #adjustPaymentModal="bs-modal"
        [config]="{ animated: true, ignoreBackdropClick: true }" bsModal role="dialog">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <advance-receipt-adjustment-component *ngIf="showAdvanceReceiptAdjust" #advanceReceiptComponent
                    [isUpdateMode]="isUpdateMode" [depositAmount]="depositAmount" [invoiceFormDetails]="invFormData"
                    [isVoucherModule]="true" [advanceReceiptAdjustmentUpdatedData]="advanceReceiptAdjustmentData"
                    (closeModelEvent)="closeAdvanceReceiptModal()"
                    (submitClicked)="getAdvanceReceiptAdjustData($event)">
                </advance-receipt-adjustment-component>
            </div>
        </div>
    </div>



    <!-- Need to remove  -->
    <!-- <ng-template>
    <div class="modal-header">
        <h4 class="modal-title bg pull-left">Adjust Payment</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body font-14">
        <form #generateTransporterForm="ngForm" action="">
            <div class="row mb-3">
                <div class="col-md-8">
                    <div class="form-group">
                        <label>Customer Name</label>
                        <input type="text" class="form-control" value="Walkover Web Solutions Pvt Ltd." [(ngModel)]="tempDateParams.customerName" readonly disabled>
                    </div>
                </div>
                <div class="col-md-4 text-right font-14 pt-2 xs-left">
                    <p>Invoice Total: <i class="icon-rupees font-10"></i>2110</p>
                    <p>Due <span class="text-light">(Post Adj):</span> <i class="icon-rupees font-10"></i>910</p>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-3">
                    <div class="form-group">
                        <label for="name">Adjustment Voucher<span class="text-danger">*</span></label>
                        <sh-select class="text-left dropdown-arrow" name="adjustmentVoucher" [(ngModel)]="tempDateParams.adjustmentVoucher" [placeholder]="'Select Account'" [notFoundLink]="false" [multiple]="false" [ItemHeight]="33">
                            <ng-template #optionTemplate1 let-option="option">
                                <a href="javascript:void(0)" class="list-item">
                                    <div class="item">AR2019374-3</div>
                                    <div class="item-unique">
                                        <p class="font-12 text-gray mb-0">(Dated: 20/01/2020)</p>
                                        <p class="font-12 text-gray mb-0">(Amount: ₹5,000.00)</p>
                                    </div>
                                </a>
                            </ng-template>
                        </sh-select>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="form-group">
                        <label for="name">Amount<span class="text-danger">* </span> <span class="text-light"> (Inclusive
                                Tax)</span></label>
                        <input id="name" type="text" class="form-control" value="1200.00" [(ngModel)]="tempDateParams.Amount">
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="form-group">
                        <label for="name">Tax</label>
                        <input id="name" type="text" class="form-control" value="57.14" [(ngModel)]="tempDateParams.Tax" readonly disabled>
                    </div>
                </div>
                <div class="col-sm-3">
                    <a href="javascript:void(0)" class="font-22 text-light pt-3 d-inline-block"><i
                            class="icon-trash"></i></a>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-3">
                    <div class="mb-1">
                        <sh-select class="text-left dropdown-arrow" name="adjustmentVoucher" [(ngModel)]="tempDateParams.adjustmentVoucher" [placeholder]="'Select Voucher'" [notFoundLink]="false" [multiple]="false" [ItemHeight]="33">
                            <ng-template #optionTemplate1 let-option="option">
                                <a href="javascript:void(0)" class="list-item">
                                    <div class="item">AR2019374-3</div>
                                    <div class="item-unique">
                                        <p class="font-12 text-gray mb-0">(Dated: 20/01/2020)</p>
                                        <p class="font-12 text-gray mb-0">(Amount: ₹5,000.00)</p>
                                    </div>
                                </a>
                            </ng-template>
                        </sh-select>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="mb-1">
                        <input id="name" type="text" class="form-control" placeholder="Enter Amount" [(ngModel)]="tempDateParams.Amount">
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="mb-1">
                        <input id="name" type="text" class="form-control" placeholder="00.00" [(ngModel)]="tempDateParams.Tax" readonly disabled>
                    </div>
                </div>
                <div class="col-sm-3">
                    <a href="javascript:void(0)" class="font-22 text-light pt-05 d-inline-block"><i
                            class="icon-trash"></i></a>
                </div>
            </div>
            <p><a href="javascript:void(0)" class="font-14"><span class="font-16">+</span> Add New Line</a></p>
            <div class="clearfix">
                <div class="clearfix mb-1 mt-2 row">
                    <div class="col-md-2 col-sm-3 col-xs-5">
                        <span class="d-inline-block font-14">Tax Deducted?</span>
                    </div>
                    <div class="col-md-8 col-sm-8 col-xs-7">
                        <span class="pd0 mr-2 d-inline-block">
                            <input name="options" class="radio-custom cp ml0" id="deductedNo" [(ngModel)]="options"
                                type="radio" [value]="true" [checked]="options" />
                            <label for="deductedNo" class="radio-custom-label">No</label>
                        </span>
                        <span class="pd0 mr-2 d-inline-block">
                            <input name="options" class="radio-custom cp ml0" [(ngModel)]="options" id="deductedYes"
                                type="radio" [value]="false" [checked]="!options" />
                            <label for="deductedYes" class="radio-custom-label">Yes</label>
                        </span>
                    </div>
                </div>
                <div class="row">
                    <div *ngIf="options"></div>
                    <div *ngIf="!options">
                        <div class="form-group clearfix">
                            <label class="col-md-2">TDS Account</label>
                            <div class="col-md-2">
                                <input type="text" class="form-control" placeholder="Select Amount">
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <label class="col-md-2">Amount</label>
                            <div class="col-md-2">
                                <input type="text" class="form-control" placeholder="Enter Amount">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <button type="button" class="btn btn-success mrR1" (click)="confirm()">Save</button>
                    <button type="button" class="btn btn-cancel" (click)="decline()">Cancel</button>
                </div>
            </div>
        </form>
    </div>
</ng-template> -->
    <!-- Adjust Payment modal start -->
