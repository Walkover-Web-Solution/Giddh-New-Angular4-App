<section
    appTranslate
    [file]="'vat-report'"
    (localeData)="localeData = $event"
    (commonLocaleData)="commonLocaleData = $event"
>
    <nav class="navbar">
        <div class="relative w-100">
            <hamburger-menu></hamburger-menu>
            <div
                class="help-support-aside setting-sidebar-wrapper gst-sidebar-wrapper"
                *ngIf="asideGstSidebarMenuState === 'in'"
            >
                <tax-sidebar
                    (navigateEvent)="handleNavigation()"
                    (clickOutside)="isMobileScreen ? (asideGstSidebarMenuState = 'out') : ''"
                    [exclude]="'#primary-new-header'"
                    class="gst-sidebar"
                ></tax-sidebar>
            </div>
            <div class="invoice-control w-100">
                <div class="row mr-0 ml-0">
                    <div class="vat-report w-100 pd-l15 pd-r15" id="setting-tab">
                        <div
                            *ngIf="currentCompanyBranches?.length > 2 && currentOrganizationType === 'COMPANY'"
                            class="row mb-3 mt-3"
                        >
                            <div class="tax-dropdown col-md-9 col-sm-9 col-12 linked-entities">
                                <div class="form-group">
                                    <!-- <sh-select
                                        [options]="currentCompanyBranches"
                                        [(ngModel)]="currentBranch.uniqueName"
                                        [showClear]="false"
                                        [ItemHeight]="33"
                                        width="100%"
                                        (selected)="handleBranchChange($event)"
                                        [isFilterEnabled]="true"
                                        [placeholder]="localeData?.select_entity"
                                        [fixedValue]="currentBranch?.alias"
                                    >
                                        <ng-template #optionTemplate let-option="option">
                                            <ng-container>
                                                <a href="javascript:void(0)" class="list-item d-flex">
                                                    <span class="entity-icon">
                                                        <i
                                                            class="icon-branch-icon pull-right"
                                                            *ngIf="!option.isCompany"
                                                            [tooltip]="commonLocaleData?.app_branch"
                                                        ></i>
                                                        <i
                                                            class="icon-company-profile pull-right"
                                                            *ngIf="option.isCompany"
                                                            [tooltip]="commonLocaleData?.app_company"
                                                        ></i>
                                                    </span>
                                                    <span class="entity-details">
                                                        <div class="item giddh-limit single-line-clamp">
                                                            {{ option.label || "-" }}
                                                        </div>
                                                        <div class="item-unique giddh-limit single-line-clamp">
                                                            {{ option.name || "-" }}
                                                        </div>
                                                    </span>
                                                </a>
                                            </ng-container>
                                        </ng-template>
                                    </sh-select> -->
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3 mt-3">
                            <div class="col-lg-10">
                                <div class="advance-search-by-date date-advance-search">
                                    <span class="input-wrapper">
                                        <div
                                            class="btn-group dropdown"
                                            dropdown
                                            [autoClose]="false"
                                            (isOpenChange)="onOpenChange($event)"
                                            #periodDropdown="bs-dropdown"
                                            (clickOutside)="checkIfDatepickerVisible()"
                                            [attachOutsideOnClick]="true"
                                        >
                                            <button mat-button [matMenuTriggerFor]="menu" class="datepicker-border">
                                                <ng-container *ngIf="isMonthSelected">
                                                    {{ dayjs(selectedMonth).format("MMMM YYYY") }}
                                                </ng-container>
                                                <ng-container *ngIf="!isMonthSelected">
                                                    {{
                                                        dayjs(currentPeriod?.from, giddhDateFormat).format(
                                                            "DD MMM YYYY"
                                                        )
                                                    }}
                                                    -
                                                    {{
                                                        dayjs(currentPeriod?.to, giddhDateFormat).format("DD MMM YYYY")
                                                    }}
                                                </ng-container>
                                                <span class="caret"></span>
                                            </button>
                                            <mat-menu #menu="matMenu">
                                                <button mat-menu-item [matMenuTriggerFor]="quarterly">
                                                    {{ commonLocaleData?.app_duration?.quarterly }}
                                                </button>
                                                <button mat-menu-item [matMenuTriggerFor]="month">
                                                    {{ commonLocaleData?.app_duration?.monthly }}
                                                </button>
                                                <button mat-menu-item>Custom</button>
                                            </mat-menu>
                                            <mat-menu #quarterly="matMenu">
                                                <div>
                                                    <div>
                                                        <button mat-menu-item>Quarter 1 (April 2023-June 2023)</button>
                                                        <button mat-menu-item>
                                                            Quarter 2 (July 2023-September 2023)
                                                        </button>
                                                        <button mat-menu-item>
                                                            Quarter 3 (October 2023-December 2023)
                                                        </button>
                                                        <button mat-menu-item>
                                                            Quarter 4 (January 2024-March 2024)
                                                        </button>
                                                    </div>
                                                </div>
                                            </mat-menu>
                                            <mat-menu #month="matMenu">
                                                <div>
                                                    <div class="d-flex">
                                                        <button mat-menu-item>Jan</button>
                                                        <button mat-menu-item>Feb</button>
                                                        <button mat-menu-item>Mar</button>
                                                        <button mat-menu-item>Apr</button>
                                                    </div>
                                                    <div class="d-flex">
                                                        <button mat-menu-item>May</button>
                                                        <button mat-menu-item>Jun</button>
                                                        <button mat-menu-item>Jul</button>
                                                        <button mat-menu-item>Aug</button>
                                                    </div>
                                                    <div class="d-flex">
                                                        <button mat-menu-item>Sep</button>
                                                        <button mat-menu-item>Oct</button>
                                                        <button mat-menu-item>Nov</button>
                                                        <button mat-menu-item>Dec</button>
                                                    </div>
                                                </div>
                                            </mat-menu>
                                        </div>
                                    </span>
                                    <div class="">
                                        <div
                                            class="input-group custom-datepicker custom-new-datepicker"
                                            (click)="showGiddhDatepicker($event)"
                                        >
                                            <input
                                                type="text"
                                                name="selectedDateRange"
                                                [value]="selectedDateRangeUi ? selectedDateRangeUi : ''"
                                                class="giddh-datepicker date-range-picker border-radius-2"
                                            />
                                        </div>
                                    </div>
                                    <div
                                        *ngIf="
                                            currentCompanyBranches?.length > 2 && currentOrganizationType === 'COMPANY'
                                        "
                                        class="trn-width"
                                    >
                                        <dropdown-field
                                            [label]="commonLocaleData?.app_entity"
                                            [options]="currentCompanyBranches"
                                            width="100%"
                                            (selectedOption)="
                                                currentBranch.uniqueName = $event.value; handleBranchChange($event)
                                            "
                                            [placeholder]="localeData?.select_entity"
                                        ></dropdown-field>
                                    </div>
                                    <div *ngIf="taxes?.length" class="trn-width">
                                        <dropdown-field
                                            [label]="commonLocaleData?.app_trn"
                                            [options]="taxes"
                                            (selectedOption)="getVatReport($event)"
                                            [placeholder]="localeData?.select_trn"
                                            [required]="true"
                                        ></dropdown-field>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div *ngIf="taxNumber" class="export-btn">
                                    <button mat-stroked-button color="primary" (click)="downloadVatReport()">
                                        <i class="icon-download1"></i>
                                        {{ commonLocaleData?.app_export }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div *ngFor="let report of vatReport; let i = index">
                            <div class="white-box" *ngIf="i < 2">
                                <p class="font-15 text-black">
                                    <strong>{{ report.section }}</strong>
                                </p>
                                <div class="table-responsive">
                                    <!-- mat-table -->
                                    <table
                                        mat-table
                                        [dataSource]="report.sections"
                                        class="table basic mr-t2 on-mobile-view vat-report-table"
                                    >
                                        <ng-container matColumnDef="number">
                                            <th mat-header-cell *matHeaderCellDef></th>
                                            <td mat-cell *matCellDef="let element">{{ element.section }}</td>
                                            <td mat-footer-cell *matFooterCellDef></td>
                                        </ng-container>
                                        <ng-container matColumnDef="name">
                                            <th mat-header-cell *matHeaderCellDef></th>
                                            <td mat-cell *matCellDef="let element">
                                                <a
                                                    href="javascript:;"
                                                    (click)="viewVatReportTransactions(element.section)"
                                                    >{{ element.description }}
                                                </a>
                                            </td>
                                            <td mat-footer-cell *matFooterCellDef class="font-weight-bold">
                                                {{ commonLocaleData?.app_total }}
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="description">
                                            <th mat-header-cell *matHeaderCellDef></th>
                                            <td mat-cell *matCellDef="let element">
                                                <a
                                                    href="javascript:void(0)"
                                                    class="text-light invoice-preview"
                                                    [matTooltip]="element.toolTip"
                                                    [matTooltipPosition]="'above'"
                                                >
                                                    <span class="icon-info text-light"></span>
                                                </a>
                                            </td>
                                            <td mat-footer-cell *matFooterCellDef></td>
                                        </ng-container>
                                        <ng-container matColumnDef="aed_amt">
                                            <th mat-header-cell *matHeaderCellDef class="text-right">
                                                {{ commonLocaleData?.app_amount }}
                                                ({{ activeCompany?.baseCurrency }})
                                            </th>
                                            <td mat-cell *matCellDef="let element" class="text-right">
                                                {{ activeCompany.baseCurrencySymbol }}
                                                {{ element.amount | giddhCurrency }}
                                            </td>
                                            <td mat-footer-cell *matFooterCellDef class="text-right font-weight-bold">
                                                {{ activeCompany.baseCurrencySymbol }}
                                                {{ report.totalAmount | giddhCurrency }}
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="vat_amt">
                                            <th mat-header-cell *matHeaderCellDef class="text-right">
                                                {{ localeData?.vat_amount }}
                                                ({{ activeCompany?.baseCurrency }})
                                            </th>
                                            <td mat-cell *matCellDef="let element" class="text-right">
                                                {{ activeCompany.baseCurrencySymbol }}
                                                {{ element.vatAmount | giddhCurrency }}
                                            </td>
                                            <td mat-footer-cell *matFooterCellDef class="text-right font-weight-bold">
                                                <span *ngIf="i === 0">{{ localeData?.a }}</span
                                                ><span *ngIf="i === 1">{{ localeData?.c }}</span>
                                                {{ activeCompany.baseCurrencySymbol }}
                                                {{ report.totalVatAmount | giddhCurrency }}
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="adjustment">
                                            <th mat-header-cell *matHeaderCellDef class="text-right">
                                                {{ localeData?.adjustment }}
                                                ({{ activeCompany?.baseCurrency }})
                                            </th>
                                            <td mat-cell *matCellDef="let element" class="text-right font-weight-bold">
                                                {{ activeCompany.baseCurrencySymbol }}
                                                {{ element.adjustmentAmount | giddhCurrency }}
                                            </td>
                                            <td mat-footer-cell *matFooterCellDef class="text-right font-weight-bold">
                                                <span *ngIf="i === 0">{{ localeData?.b }}</span
                                                ><span *ngIf="i === 1">{{ localeData?.d }}</span>
                                                {{ activeCompany.baseCurrencySymbol }}
                                                {{ report.totalAdjustmentAmount | giddhCurrency }}
                                            </td>
                                        </ng-container>
                                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                                        <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
                                    </table>
                                </div>
                            </div>
                            <div class="white-box" *ngIf="i == 2">
                                <p class="font-15 text-black">
                                    <strong>{{ report.section }}</strong>
                                </p>
                                <div class="table-responsive">
                                    <table
                                        mat-table
                                        [dataSource]="report.sections"
                                        class="table-hide-title table basic table-border-bottom mr-t2 on-mobile-view"
                                    >
                                        <ng-container matColumnDef="number">
                                            <th mat-header-cell *matHeaderCellDef></th>
                                            <td mat-cell *matCellDef="let element">{{ element.section }}</td>
                                        </ng-container>
                                        <ng-container matColumnDef="description">
                                            <th mat-header-cell *matHeaderCellDef></th>
                                            <td mat-cell *matCellDef="let element">{{ element.description }}</td>
                                        </ng-container>
                                        <ng-container matColumnDef="tooltip">
                                            <th mat-header-cell *matHeaderCellDef></th>
                                            <td mat-cell *matCellDef="let element">
                                                <span class="pr-1">{{ element.toolTip }}</span>
                                                <strong
                                                    >{{ activeCompany.baseCurrencySymbol }}
                                                    {{ element.amount | giddhCurrency }}</strong
                                                >
                                            </td>
                                        </ng-container>
                                        <tr mat-header-row *matHeaderRowDef="netdisplayedColumns"></tr>
                                        <tr mat-row *matRowDef="let row; columns: netdisplayedColumns"></tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div
                            *ngIf="!isTaxApiInProgress && !vatReport?.length && !taxes?.length"
                            class="no-data no-report"
                        >
                            <h1>{{ localeData?.no_trn_available }}</h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</section>

<ng-template #datepickerTemplate>
    <div class="datepicker-modal">
        <div class="modal-body">
            <app-datepicker-wrapper
                [inputStartDate]="selectedDateRange?.startDate"
                [inputEndDate]="selectedDateRange?.endDate"
                [alwaysShowCalendars]="true"
                [ranges]="datePickerOption"
                [selectedRangeLabel]="selectedRangeLabel"
                [showCustomRangeLabel]="true"
                [showClearButton]="false"
                [showCancel]="true"
                [linkedCalendars]="true"
                [showDropdowns]="true"
                (rangeClicked)="dateSelectedCallback($event)"
                (datesUpdated)="dateSelectedCallback($event)"
                [keepCalendarOpeningWithRange]="false"
                [showRangeLabelOnInput]="false"
                [dateFieldPosition]="dateFieldPosition"
            ></app-datepicker-wrapper>
        </div>
    </div>
</ng-template>
