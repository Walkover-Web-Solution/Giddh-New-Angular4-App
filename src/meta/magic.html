<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="../assets/css/bootstrap.css">
  <link rel="stylesheet" href="../assets/css/font-awesome.css">
  <link href="https://cdn.bootcss.com/bootstrap-daterangepicker/2.1.25/daterangepicker.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style-1.css">
  <link rel="stylesheet" href="../assets/css/style-2.css">
  <link rel="stylesheet" href="./magic.css">
</head>

<body>
  <div id="app">
    <section class="bg-f9" id="magicLink">
      <section class="bg-bl">
        <div class="container-fluid text-white text-center gTbl" style="height:77px">
          <div class="vcenter" style="font-size:26px">{{ledgerData.companyName}}</div>
        </div>
      </section>
      <section class="pdB1">
        <div id="web-bg" class="container mrT3">
          <div class="row">
            <div class="col-sm-12 col-md-3">
              <div class="row">
                <div v-bind:class="{'mrB2': isResponsive}">
                  <!-- #dateRangePickerDir -->
                  <!-- [options]="datePickerOptions" -->
                  <!-- (applyDaterangepicker)="onDateRangeSelected($event)" -->
                  <!-- <input type="text" name="daterangeInput" daterangepicker
                    class="form-control" /> -->
                  <!-- <input type="text" class="form-control" placeholder="01/01/2017 - 31/01/2017"> -->
                  <!-- <span class="input-group-addon">
                    <span class="fa fa-calendar"></span>
                  </span> -->
                  <!-- <date-range-picker :config></date-range-picker> -->
                  <date-range-picker id="dfdfd" v-on:dateRangeChanged="onDateRangeChanged"></date-range-picker>
                </div>
              </div>
            </div>
            <div id="web-cont" class="col-md-6 text-center" v-if="!isResponsive" style="font-size:25px;color:#6d6e70">
              {{ledgerData.account.name}} A/c
            </div>
            <div class="col-md-3 col-sm-12">
              <div class="row">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search Ledger" name="searchText" v-model="searchText">
                  <span class="input-group-addon">
                    <span class="fa fa-search"></span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="pdT4">
        <!-- v-if="!isResponsive" -->
        <div id="mob-cont" class="container">
          <div class="row bg-wh" style="padding-bottom:10px;padding-top:10px">
            <div class="col-xs-4">
              <div style="font-size:12px;color:#262626">Opening</div>
              <div>
                <!-- | number:'1.2-2' -->
                <span class="fs-18" style="color:#262626">{{ledgerData.ledgerTransactions.forwardedBalance.amount}}</span>
                <span style="font-size:16px;color:#262626">{{ ledgerData.ledgerTransactions.forwardedBalance.type === 'DEBIT' ? 'Dr' : 'Cr' }}</span>
              </div>
            </div>
            <div class="col-xs-4" style="font-size:11px;padding-top:15px">
              <!-- <div class="text-center">
                                        <div>10,340 Dr.</div>
                                    </div> -->
            </div>
            <div class="col-xs-4 text-right">
              <div style="font-size:12px;color:#262626">
                Closing
              </div>
              <div>
                <span style="font-size:16px;color:#262626">{{ ledgerData.ledgerTransactions.balance.type === 'DEBIT' ? 'Dr' : 'Cr' }}</span>
                <!-- | number:'1.2-2' -->
                <span class="fs-18" style="color:#262626">{{ledgerData.ledgerTransactions.balance.amount }}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="container">
          <div class="row">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs device-small bg-gr" role="tablist">
              <li class="nav-item wid-50" role="presentation">
                <a class="nav-link" v-bind:class="{'active': selectedTab === 'debit' || !selectedTab }" v-on:click="selectedTab='debit'"
                  href="javascript:void(0);" aria-controls="debit" role="tab" data-toggle="tab">Debit</a>
              </li>
              <li class="nav-item text-right wid-50" role="presentation">
                <a class="nav-link" v-bind:class="{'active': selectedTab === 'credit'}" v-on:click="selectedTab='credit'" aria-controls="credit"
                  href="javascript:void(0);" role="tab" data-toggle="tab">Credit</a>
              </li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content ledger_book" id="transaction_table">
              <div role="tabpanel" class="tab-pane col-xs-12 col-md-6" v-bind:class="{'active': selectedTab === 'debit' || !selectedTab, 'pd350':!isResponsive}"
                id="debit" v-if="!selectedTab || selectedTab == 'debit'">
                <div class="row">
                  <table class="table table-bordered bg-wh">
                    <thead>
                      <tr class="bg-f9">
                        <th colspan="3">
                          <span class="account_name">{{ledgerData.account.name}} is </span>
                          <span class="rec">receiving</span>
                        </th>
                      </tr>
                      <tr class="bg-yl">
                        <th class="col-xs-3">Date</th>
                        <th class="col-xs-6">Particular</th>
                        <th class="text-right col-xs-3">Amount</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="ledger-row" v-if="ledgerData.ledgerTransactions.forwardedBalance.amount > 0 && ledgerData.ledgerTransactions.forwardedBalance.type === 'DEBIT'">
                        <td class="col-xs-3"></td>
                        <td class="col-xs-6">B/F Balance</td>
                        <td class="col-xs-3 text-right">
                          <!-- | number: '1.2-2'  -->
                          <span v-if="ledgerData.ledgerTransactions.forwardedBalance.type === 'DEBIT'" class="">{{ ledgerData.ledgerTransactions.forwardedBalance.amount }}</span>
                          <span v-if="ledgerData.ledgerTransactions.forwardedBalance.type === 'CREDIT'" class="">0</span>
                        </td>
                      </tr>
                      <tr class="ledger-row" v-if="(ledgerData.ledgerTransactions.forwardedBalance.type !== 'DEBIT') || (ledgerData.ledgerTransactions.forwardedBalance.amount == 0)">
                        <td colspan="3" class="">&nbsp;</td>
                      </tr>
                      <!-- v-if="ledger.hasDebit" -->
                      <!-- v-for="item in items" -->
                      <tr v-for="ledger in ledgerData.ledgerTransactions.ledgers" v-on:click="checkCompEntry(ledger)" v-bind:class="{compoundEntry: ledger.isCompoundEntry}">
                        <td colspan="100%" style="padding:0;border:0">
                          <table style="width:100%">
                            <tbody>
                              <!-- ng-if="txn.type == 'DEBIT'" -->
                              <!-- | filter: searchText -->
                              <template v-for="txn in filterBy(ledger.transactions, searchText)">
                                <tr class="text-left bdrB" v-if="txn.type === 'DEBIT'">
                                  <td class="col-xs-3">{{ledger.entryDate}}</td>
                                  <td class="col-xs-6 bdrL">{{txn.particular.name}}</td>
                                  <td class="col-xs-3 bdrL pos-rel" v-bind:class="{'pdR25imp': ledger.invoiceGenerated}" align="right">
                                    {{txn.amount}}
                                    <template v-if="ledger.invoiceGenerated && ledger.invoiceNumber">
                                      <!-- <span class="download-invoice-ledger" v-on:click="downloadInvoice(ledger.invoiceNumber)" container="body" tooltip="Download Invoice : {{ledger.invoiceNumber}}"
                                        [placement]="'top'">
                                        <i class="glyphicon glyphicon-download" style="font-size:15px;"></i>
                                      </span> -->
                                    </template>
                                    <template v-if="ledger.invoiceGenerated && ledger.purchaseInvoiceNumber">
                                      <!-- <span class="download-invoice-ledger" v-on:click="downloadPurchaseInvoice(ledger.purchaseInvoiceNumber)" container="body" tooltip="Download Invoice : {{ledger.purchaseInvoiceNumber}}"
                                        [placement]="'top'">
                                        <i class="glyphicon glyphicon-download" style="font-size:15px;"></i>
                                      </span> -->
                                    </template>
                                  </td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </td>
                      </tr>
                      <tr class="total_col" v-if="ledgerData.ledgerTransactions.balance.type === 'CREDIT' && isResponsive">
                        <td colspan="12" class="col-xs-12 text-right h32">
                          <!-- <span [tooltip]="'(-) Asset ( ohh no!)'" [placement]="'top'" class=""> -->
                          <!-- | number: '1.2-2'  -->
                          <!-- C/F: Cr {{ ledgerData.ledgerTransactions.balance.amount }}
                          </span> -->
                        </td>
                      </tr>
                      <tr v-if="isResponsive">
                        <td colspan="12" class="col-xs-12 text-right h32" style="padding-right:10px !important;">
                          <!-- | number: '1.2-2'  -->
                          <span class="" style="width: 150px;display: block;float: right;">{{ reckoningDebitTotal }}</span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div role="tabpanel" class="tab-pane col-xs-12 col-md-6" v-bind:class="{'active': selectedTab === 'credit', 'pd350':!isResponsive}"
                id="credit" v-if="!selectedTab || selectedTab == 'credit'">
                <div class="row">
                  <table class="table table-bordered bg-wh">
                    <thead>
                      <tr class="bg-f9" style="border:none !important">
                        <th colspan="3" class="text-right">
                          <span class="account_name">{{ledgerData.account.name}} is </span>
                          <span class="rec">giving</span>
                        </th>
                      </tr>
                      <tr class="bg-yl">
                        <th class="col-xs-3">Date</th>
                        <th class="col-xs-6">Particular</th>
                        <th class="text-right col-xs-3">Amount</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="ledger-row" v-if="ledgerData.ledgerTransactions.forwardedBalance.amount > 0 && ledgerData.ledgerTransactions.forwardedBalance.type === 'CREDIT'">
                        <td class="col-xs-3"></td>
                        <td class="col-xs-6">B/F Balance</td>
                        <td class="col-xs-3 text-right">
                          <span v-if="ledgerData.ledgerTransactions.forwardedBalance.type === 'CREDIT'">
                            <!-- | number: '1.2-2' -->
                            {{ ledgerData.ledgerTransactions.forwardedBalance.amount }}</span>
                          <span v-if="ledgerData.ledgerTransactions.forwardedBalance.type === 'DEBIT'">0</span>
                        </td>
                      </tr>
                      <tr class="ledger-row" v-if="ledgerData.ledgerTransactions.forwardedBalance.type !== 'CREDIT' || (ledgerData.ledgerTransactions.forwardedBalance.amount == 0)">
                        <td class="" colspan="3">&nbsp;</td>
                      </tr>
                      <!-- ng-if="ledger.hasCredit" -->
                      <!-- ng-class="{compoundEntry: ledger.isCompoundEntry}"
                                         ng-click="checkCompEntry(ledger)" -->
                      <!-- uib-tooltip="Total : {{ledger.total.amount}} {{ledger.total.type}}" tooltip-placement="top" -->
                      <tr v-for="ledger in ledgerData.ledgerTransactions.ledgers" v-on:click="checkCompEntry(ledger)" v-bind:class="{compoundEntry: ledger.isCompoundEntry}">
                        <td colspan="100%" style="padding:0; border:0">
                          <table style="width:100%;">
                            <tbody>
                              <!-- | filter: searchText -->
                              <template v-for="txn in filterBy(ledger.transactions, searchText)">
                                <tr class="text-left bdrB" v-if="txn.type === 'CREDIT'">
                                  <td class="col-xs-3">{{ledger.entryDate}}</td>
                                  <td class="col-xs-6 bdrL">{{txn.particular.name}}</td>
                                  <td class="col-xs-3 bdrL pos-rel" v-bind:class="{'pdR25imp': ledger.invoiceGenerated}" align="right">
                                    {{txn.amount}}
                                    <template v-if="ledger.invoiceGenerated && ledger.invoiceNumber">
                                      <!-- tooltip="Download Invoice : {{ledger.invoiceNumber}}" -->
                                      <!-- [placement]="'top'" -->
                                      <span class="download-invoice-ledger" v-on:click="downloadInvoice(ledger.invoiceNumber)" container="body">
                                        <i class="glyphicon glyphicon-download" style="font-size:15px;"></i>
                                      </span>
                                    </template>
                                    <template v-if="ledger.invoiceGenerated && ledger.purchaseInvoiceNumber">
                                      <!-- tooltip="Download Invoice : {{ledger.purchaseInvoiceNumber}}" -->
                                      <!-- [placement]="'top'" -->
                                      <span class="download-invoice-ledger" v-on:click="downloadPurchaseInvoice(ledger.purchaseInvoiceNumber)" container="body">
                                        <i class="glyphicon glyphicon-download" style="font-size:15px;"></i>
                                      </span>
                                    </template>
                                  </td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </td>
                      </tr>
                      <tr v-if="ledgerData.ledgerTransactions.balance.type === 'DEBIT' && isResponsive">
                        <td colspan="12" class="col-xs-12 text-right h32">
                          <!-- tooltip="" -->
                          <!-- [placement]="'top'" -->
                          <span>
                            C/F: Dr
                            <!-- | number: '1.2-2' -->
                            <span class="primary_clr">{{ledgerData.ledgerTransactions.balance.amount }}
                            </span>
                          </span>
                        </td>
                      </tr>
                      <tr v-if="isResponsive">
                        <td colspan="12" class="col-xs-12 text-right h32" style="padding-right:10px !important;">
                          <!-- | number: '1.2-2'  -->
                          <span class="" style="width: 150px;display: block;float: right;">{{reckoningCreditTotal }}</span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- table footer for unresponsive -->
              <div style="width: 100%" v-if="!isResponsive">
                <table class="ledger-footer-1" style="width:50%;left:0;bottom:0;float: left;">
                  <tbody>
                    <tr class="total_col">
                      <td colspan="12" class="col-xs-12 text-right h32" style="padding-right:10px !important">
                        <!-- [tooltip]="'(-) Asset ( ohh no!)'" -->
                        <!-- [placement]="'top'" -->
                        <span v-if="ledgerData.ledgerTransactions.balance.type === 'CREDIT'" class="">
                          <!-- | number: '1.2-2'  -->
                          C/F: Cr {{ ledgerData.ledgerTransactions.balance.amount }}
                        </span>
                      </td>
                    </tr>
                    <tr class="total_col">
                      <td colspan="12" class="col-xs-12 text-right h32" style="padding-right:10px !important;">
                        <!-- | number: '1.2-2'  -->
                        <span class="bdrT" style="width: 150px;display: block;float: right;padding: 10px 0;">{{ reckoningDebitTotal }}</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <table class="ledger-footer-1 " style="width:50%;right:0;bottom:0;">
                  <tbody>
                    <tr class="total_col">
                      <td colspan="12" class="col-xs-12 text-right h32" style="padding-right:10px !important">
                        <!-- tooltip="" [placement]="'top'" -->
                        <span v-if="ledgerData.ledgerTransactions.balance.type === 'DEBIT'">
                          C/F: Dr
                          <!-- | number: '1.2-2' -->
                          <span class="primary_clr">{{ledgerData.ledgerTransactions.balance.amount }}
                          </span>
                        </span>
                      </td>
                    </tr>
                    <tr class="total_col">
                      <td colspan="12" class="col-xs-12 text-right h32" style="padding-right:10px !important;">
                        <!-- | number: '1.2-2'  -->
                        <span class="bdrT" style="width: 150px;display: block;float: right;padding: 10px 0;">{{reckoningCreditTotal }}</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <!--footer-->
            </div>
          </div>
        </div>
      </section>
      <!--total section-->
      <section class="ledger-stat" v-if="(ledgerData.ledgerTransactions.totalDebitTransactions > 0 || ledgerData.ledgerTransactions.totalCreditTransactions > 0) && !isResponsive">
        <div class="container">
          <div class="col-xs-3">
            <!--<span class="primary_clr mrB1" style="font-size: 12px">{{cDate.startDate | date:'dd-MMM-yyyy'}} - {{cDate.endDate | date:'dd-MMM-yyyy'}}</span>-->
            <h1>Total Transactions
              <span class="primary_clr">{{ledgerData.ledgerTransactions.totalTransactions}}</span>
            </h1>
            <span class="mrT1 mrR2">Dr {{ledgerData.ledgerTransactions.totalDebitTransactions}}</span>
            <span class="mrT1 mrR2">Cr {{ledgerData.ledgerTransactions.totalCreditTransactions}}</span>
          </div>
          <div class="col-xs-3">
            <h1>Opening Balance</h1>
            <!-- | number:'1.2-2' -->
            <h3>{{ledgerData.ledgerTransactions.forwardedBalance.amount }} {{ ledgerData.ledgerTransactions.forwardedBalance.type
              === 'DEBIT' ? 'Dr' : 'Cr' }}</h3>
          </div>
          <div class="col-xs-3">
            <h1 class="primary_clr">Net Total
              <span v-if="ledgerData.ledgerTransactions.creditTotal > ledgerData.ledgerTransactions.debitTotal">Credit</span>
              <span v-if="ledgerData.ledgerTransactions.creditTotal < ledgerData.ledgerTransactions.debitTotal">Debit</span>
            </h1>
            <h3 class=" primary_clr" v-if="ledgerData.ledgerTransactions.creditTotal > ledgerData.ledgerTransactions.debitTotal">
              <!-- | number:'1.2-2' -->
              {{ledgerData.ledgerTransactions.creditTotal - ledgerData.ledgerTransactions.debitTotal }}
            </h3>
            <h3 class=" primary_clr" v-if="ledgerData.ledgerTransactions.creditTotal < ledgerData.ledgerTransactions.debitTotal">
              <!-- | number:'1.2-2' -->
              {{ledgerData.ledgerTransactions.debitTotal - ledgerData.ledgerTransactions.creditTotal}}
            </h3>
            <!-- | number:'1.2-2' -->
            <h1 class="mrT">Dr Total {{ledgerData.ledgerTransactions.debitTotal }}</h1>
            <!-- | number:'1.2-2' -->
            <h1 class="mrT">Cr Total {{ledgerData.ledgerTransactions.creditTotal }}</h1>
          </div>
          <div class="col-xs-3">
            <h1>Closing Balance</h1>
            <!-- | number:'1.2-2' -->
            <h3>{{ledgerData.ledgerTransactions.balance.amount }} {{ ledgerData.ledgerTransactions.balance.type === 'DEBIT' ?
              'Dr' : 'Cr' }}</h3>
          </div>
        </div>
      </section>

      <section id="web_footer">
        <section class="cmnPd80 ylwBg homeBtmhalf">
          <div class="container">
            <div class="row text-center">
              <div class="col-sm-12">
                <h3 class="arvo">Giddh
                  <strong>automates the accounting</strong> on behalf of
                  <span class="companyName">
                    <strong>{{ledgerData.companyName}}</strong>
                  </span>.</h3>
                <h4 class="arvo">We would love to extend our support via
                  <a data-toggle="tooltip" data-placement="top" title="Tooltip on top" href="https://muneem.co" target="_blank" class="green"
                    style="text-decoration: underline;">Muneem</a> for any query related to your ledger with
                  <span class="companyName">{{ledgerData.companyName}}</span>.</h4>
              </div>
            </div>
          </div>
        </section>

        <section class="cmnPd80 sub_footer">
          <div class="container">
            <div class="row text-center">
              <div class="col-sm-12">
                <h3 class="arvo">Giddh is the future of online accounting software (but-obvious GST ready).</h3>
                <h3 class="arvo">Do you have any question with Giddh?</h3>
              </div>
            </div>
          </div>
        </section>


        <!-- footer start -->
        <section id="footer">
          <section id="contact">
            <div class="container">
              <div class="row pr">
                <div id="footer-mascot" class="visible-md-block visible-lg-block"></div>

                <div class="col-md-5 pull-right col-sm-12 col-xs-12" v-show="!formSubmitted">
                  <h4 class="headerline mrB2">Tell us!</h4>
                  <form novalidate name="contactForm">
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label for="name">Full Name *</label>
                          <input name="contactForm.name" placeholder="Full Name*" v-model="cForm.name" type="text" required class="form-control">
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label for="message">Contact Number *</label>
                          <input class="form-control" placeholder="Contact Number *" type="text" decimalDigitsDirective name="contactForm.number" v-model="cForm.number"
                            minlength="7" maxlength="12" required>
                        </div>
                      </div>
                    </div>

                    <div class="control-group">
                      <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input name="contactForm.email" placeholder="Email Address *" v-model="cForm.email" type="email" required class="form-control">
                      </div>
                    </div>

                    <div class="control-group">
                      <div class="form-group">
                        <label for="message">Message</label>
                        <textarea name="contactForm.message" placeholder="Message" v-model="cForm.message" class="form-control"></textarea>
                      </div>
                    </div>

                    <!-- <div class="control-group">
                                                    <div class="form-group">
                                                        <div theme="'light'" ="cForm.myRecaptchaResponse">
                                                        </div>
                                                        <div vc-recaptcha theme="'light'" key="captchaKey" ng-model="cForm.myRecaptchaResponse">
                                                        </div>
                                                    </div>
                                                </div> -->
                    <!-- [disabled]="contactForm.invalid" -->
                    <button v-on:click="submitForm(cForm)" class="btn btn-default btn-lg" :disabled="true" type="submit">Submit</button>

                  </form>

                </div>

                <div class="col-md-5 col-sm-12 col-xs-12" v-if="formSubmitted">
                  <h4 class="headerline">{{responseMsg}}</h4>
                </div>

                <div class="col-md-5 col-sm-12 col-xs-12" v-bind:class="{'mrT4': isResponsive}">
                  <h4 class="headerline">Contact Us</h4>

                  <div class="social">
                    <!-- <a ng-repeat="list in socialList" href="{{list.url}}">
                                                <div class="scicn {{list.class}}">{{list.name}}</div>
                                            </a> -->
                  </div>
                  <div class="inconsolata">
                    <p>405-406, Capt. C. S. Naidu Arcade,</p>
                    <p>Near Greater Kailash Hospital, 10/2 Old Palasia,</p>
                    <p>Indore, Madhya Pradesh 452018</p>
                    <p class="mrT3">Sales :
                      <a class="white" href="mailto:shubhendra@giddh.com">shubhendra@giddh.com</a>
                      <br /> Support :
                      <a class="white" href="mailto:support@giddh.com">support@giddh.com</a>
                      <br>
                      <i class="glyphicon glyphicon-phone"></i>
                      <a class="white" href="tel:07939593939">079 39 59 3939</a>
                      <i class="glyphicon glyphicon-phone"></i>
                      <a class="white" href="tel:08033037089">080 33 03 7089</a>
                    </p>
                    <div id="farzi"></div>
                  </div>
                </div>


              </div>
            </div>
          </section>
        </section>
        <!-- end of contact -->
        <!-- <app-footer></app-footer> -->
      </section>
      <!-- end of footer -->

    </section>
  </div>
</body>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
  crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
<script src="./vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.17.1/moment.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap-daterangepicker/2.1.25/daterangepicker.min.js"></script>
<script src="https://fastcdn.org/FileSaver.js/1.1.20151003/FileSaver.min.js"></script>

<script>
  Vue.component('date-range-picker', {
    props: ['id'],
    template: '<div class="input-group"><input type="text" :id="id" :name="id" class="form-control" /><span class="input-group-addon"><span class="fa fa-calendar"></span></span></div>',
    data: function () {
      return {
        some: 'thing'
      }
    },
    mounted: function () {
      var self = this;
      var input = $('input[name="' + this.id + '"]');
      input.daterangepicker({
        ranges: {
          'Last 1 Day': [
            moment().subtract(1, 'days'),
            moment()
          ],
          'Last 7 Days': [
            moment().subtract(6, 'days'),
            moment()
          ],
          'Last 30 Days': [
            moment().subtract(29, 'days'),
            moment()
          ],
          'Last 6 Months': [
            moment().subtract(6, 'months'),
            moment()
          ],
          'Last 1 Year': [
            moment().subtract(12, 'months'),
            moment()
          ]
        },
        startDate: moment().subtract(30, 'days'),
        endDate: moment()
      });
      input.on('apply.daterangepicker', function (ev, picker) {
        var dateObj = {
          startDate: picker.startDate,
          endDate: picker.endDate,
        }
        self.$emit('daterangechanged', dateObj);
      });
    }
  });

  var app = new Vue({
    data: {
      message: 'Hello Vue!',
      ledgerData: {
        account: {},
        ledgerTransactions: {
          forwardedBalance: {
            amount: '',
            type: ''
          },
          balance: {
            type: ''
          },
          ledgers: []
        }
      },
      reckoningDebitTotal: 0,
      reckoningCreditTotal: 0,
      responseMsg: '',
      selectedTab: '',
      isResponsive: false,
      formSubmitted: false,
      searchText: '',
      cForm: {},
      txn: {}
    },
    mounted() {
      var id = this.getParameterByName('id');
      this.getMagicLinkData(id)
    },
    created: function () {
      window.addEventListener('resize', this.handleResize);
      this.$nextTick(function () {
        $('[data-toggle="tooltip"]').tooltip();
      });
    },
    beforeDestroy: function () {
      window.removeEventListener('resize', this.handleResize)
    },
    methods: {
      getMagicLinkData(id, from, to) {
        var url = '';
        if (from && to) {
          url = 'http://apidev.giddh.com/magic-link/' + id + '?from=' + from + '&to=' + to;
        } else {
          url = 'http://apidev.giddh.com/magic-link/' + id;
        }
        axios.get(url)
          .then(response => {
            // JSON responses are automatically parsed.
            if (response.data.status === 'success') {
              this.ledgerData = response.data.body;
              // Add tooltip feature.
              this.$nextTick(function () {
                $('[data-toggle="tooltip"]').tooltip();
              });
            }
          })
          .catch(e => {
            console.log('the error is :', e);
            this.errors.push(e)
          })
      },
      getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      },
      checkCompEntry(ledger) {
        var unq = ledger.uniqueName;
        ledger.isCompoundEntry = true;
        this.ledgerData.ledgerTransactions.ledgers.forEach(function (lgr) {
          if (unq === lgr.uniqueName) {
            lgr.isCompoundEntry = true;
          } else {
            lgr.isCompoundEntry = false;
          }
        });
      },
      customFilter: function (txn) {
        return txn.particular.name.indexOf(this.searchText) != -1;
      },
      filterBy(list, value) {
        return list.filter(function (txn) {
          return txn.particular.name.toLowerCase().includes(value) || String(txn.amount).includes(value);
        });
      },
      onDateRangeChanged: function (picker) {
        var dates = {
          startDate: moment(picker.startDate).format('DD-MM-YYYY'),
          endDate: moment(picker.endDate).format('DD-MM-YYYY')
        };
        var id = this.getParameterByName('id');
        this.getMagicLinkData(id, dates.startDate, dates.endDate);
      },
      handleResize: function (ev) {
        var width = ev.currentTarget.innerWidth;
        if (width > 992) {
          this.selectedTab = '';
          this.isResponsive = false;
        } else {
          this.isResponsive = true;
        }
      },
      downloadInvoice: function (invoiceNum) {
        var id = this.getParameterByName('id');
        axios.get('http://apidav.giddh.com/magic-link/' + id + '/download-invoice/' + invoiceNum)
          .then(response => {
            // JSON responses are automatically parsed.
            if (response.data.status === 'success') {
              var blobData = this.base64ToBlob(response.data.body, 'application/pdf', 512);
              return saveAs(blobData, invoiceNum + '.pdf');
            }
          })
          .catch(e => {
            console.log('the error is :', e);
            this.errors.push(e)
          })
      },
      base64ToBlob: function (b64Data, contentType, sliceSize) {
        contentType = contentType || '';
        sliceSize = sliceSize || 512;
        var byteCharacters = atob(b64Data);
        var byteArrays = [];
        var offset = 0;
        while (offset < byteCharacters.length) {
          var slice = byteCharacters.slice(offset, offset + sliceSize);
          var byteNumbers = new Array(slice.length);
          var i = 0;
          while (i < slice.length) {
            byteNumbers[i] = slice.charCodeAt(i);
            i++;
          }
          var byteArray = new Uint8Array(byteNumbers);
          byteArrays.push(byteArray);
          offset += sliceSize;
        }
        return new Blob(byteArrays, {
          type: contentType
        });
      }
    }
  }).$mount('#app');

</script>

</html>
