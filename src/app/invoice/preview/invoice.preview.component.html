<form #invoiceForm="ngForm" (ngSubmit)="getInvoicesByFilters(invoiceForm)" novalidate class="form-inline">

    <div class="form-group" (clickOutside)="showFromDatePicker=false;">
        <label class="d-block">From</label>
        <div class="input-group">
            <input type="text" name="from" [ngModel]="moment(invoiceSearchRequest.from).format('DD-MM-YYYY')" (focus)="showFromDatePicker = true;" class="form-control" required/>
            <span class="input-group-btn">
                <button type="button" class="btn btn-default" (click)="showFromDatePicker = !showFromDatePicker">
                <i class="glyphicon glyphicon-calendar"></i>
                </button>
            </span>
        </div>
        <div *ngIf="showFromDatePicker" style="position: absolute; z-index:10; min-height:290px;">
            <ul class="my-dropdown-menu">
                <li>
                    <datepicker name="fromDate" (click)="$event.stopPropagation()" [(ngModel)]="invoiceSearchRequest.from" (selectionDone)="showFromDatePicker=!showFromDatePicker" [showWeeks]="false"></datepicker>
                </li>
                <li style="padding:10px 9px 2px" class="ng-scope">
                    <span class="btn-group pull-left">
                    <button type="button" class="btn btn-sm btn-info" (click)="setToday('from');showFromDatePicker = false;">Today</button>
                    <button type="button" class="btn btn-sm btn-danger ng-binding" (click)="clearDate('from');showFromDatePicker = false;">Clear</button></span>
                    <button type="button" class="btn btn-sm btn-success pull-right" (click)="showFromDatePicker = false">Done</button>
                </li>
            </ul>
        </div>
    </div>

    <div class="form-group" (clickOutside)="showToDatePicker=false;">
        <label class="d-block">To</label>
        <div class="input-group">
            <input type="text" name="to" [ngModel]="moment(invoiceSearchRequest.to).format('DD-MM-YYYY')" (focus)="showToDatePicker = true;" class="form-control" required/>
            <span class="input-group-btn">
                <button type="button" class="btn btn-default" (click)="showToDatePicker = !showToDatePicker">
                <i class="glyphicon glyphicon-calendar"></i>
                </button>
            </span>
        </div>
        <div *ngIf="showToDatePicker" style="position: absolute; z-index:10; min-height:290px;">
            <ul class="my-dropdown-menu">
                <li>
                    <datepicker name="toDate" (click)="$event.stopPropagation()" [(ngModel)]="invoiceSearchRequest.to" (selectionDone)="showToDatePicker=!showToDatePicker" [showWeeks]="false"></datepicker>
                </li>
                <li style="padding:10px 9px 2px" class="ng-scope">
                    <span class="btn-group pull-left">
                    <button type="button" class="btn btn-sm btn-info" (click)="setToday('to');showToDatePicker = false;">Today</button>
                    <button type="button" class="btn btn-sm btn-danger ng-binding" (click)="clearDate('to');showToDatePicker = false;">Clear</button></span>
                    <button type="button" class="btn btn-sm btn-success pull-right" (click)="showToDatePicker = false">Done</button>
                </li>
            </ul>
        </div>
    </div>
    <div class="form-group">
        <label class="d-block">Account</label>
        <select2 name="a" [(ngModel)]="invoiceSearchRequest.accountUniqueName" class="select2-parent" [data]="accounts$ | async" [options]="select2Options">
        </select2>
    </div>
    <div class="form-group">
        <label class="d-block">Description</label>
        <input type="text" class="form-control" name="description" placeholder="By description" [(ngModel)]="invoiceSearchRequest.description">
    </div>
    <div class="form-group">
        <label class="d-block">Count</label>
        <div class="custom-select pos-rel">
            <select class="form-control cp" name="count" [(ngModel)]="invoiceSearchRequest.count">
      <option value="select">Select</option>
      <option *ngFor="let num of counts;" [ngValue]="num">{{num}}</option>
      </select>
            <span class="select_drop"><i class="fa fa-caret-down"></i></span>
        </div>
    </div>
    <div class="form-group">
        <label class="d-block">Amount</label>
        <div class="custom-select pos-rel">
            <select class="form-control cp" name="entryTotalBy" [(ngModel)]="invoiceSearchRequest.entryTotalBy">
      <option value="">Please Select</option>
      <option *ngFor="let item of filtersForEntryTotal" [ngValue]="item.uniqueName"> {{ item.name }} </option>
      </select>
            <span class="select_drop"><i class="fa fa-caret-down"></i></span>
        </div>
    </div>
    <div class="form-group">
        <label class="d-block">&nbsp;</label>
        <input type="text" class="form-control col-xs-2" name="entryTotal" [(ngModel)]="invoiceSearchRequest.entryTotal" placeholder="By amount">
    </div>
    <div class="form-group">
        <label class="d-block">&nbsp;</label>
        <button class="btn btn-success btn-sm">GO</button>
    </div>
</form>
<!--list of data  -->
<div class="no-data mrT2" *ngIf="!invoiceData">
  <h1>No Entry found in sales!</h1>
  <h1>Have to do some sales before creating invoice</h1>
  <!-- <a class="btn btn-primary">Go to Sales</a> -->
</div>

<div class="no-data" *ngIf="invoiceData && invoiceData.results.length === 0">
  <h1>No entries found within given criteria.</h1>
  <h1>Do search with some other dates</h1>
</div>

<table class="table basic table-bordered mrT2" *ngIf="invoiceData && invoiceData.results.length > 0">
    <thead class="t-h-bg1">
        <tr>
            <th>#</th>
            <th>Invoice Number</th>
            <th>account</th>
            <th>Date</th>
            <th>Total amount</th>
            <th>Balance Due</th>
            <th>Action to perform</th>
            <th>Status</th>
            <th class="text-center">Delete</th>
        </tr>
    </thead>
    <tfoot>
      <tr>
        <td colspan="100%">
          <div class="alC">
            <pagination [totalItems]="invoiceData.totalPages" [(ngModel)]="invoiceData.page" [maxSize]="5" class="pagination-sm" [boundaryLinks]="true" [itemsPerPage]="1" [rotate]="false" (pageChanged)="pageChanged($event)"></pagination>
          </div>
        </td>
      </tr>
    </tfoot>
    <tbody>
        <tr *ngFor="let item of invoiceData.results; let i = index">
            <td>{{ i + 1}}</td>
            <td><a href="javascript:void(0);" (click)="onSelectInvoice(item)">{{item.invoiceNumber}}</a></td>
            <td>{{item.account.name}}</td>
            <td>{{item.invoiceDate}}</td>
            <td>{{item.grandTotal}}</td>
            <td>{{item.balanceDue}}</td>
            <td>
                <div class="custom-select pos-rel">
                    <select #invoiceAction class="form-control cp" (change)="onPerformAction(item, invoiceAction)">
                        <option value="">--Select--</option>
                        <option value="paid">Paid</option>
                        <option value="unpaid">Unpaid</option>
                        <option value="hold">Hold</option>
                        <option value="cancel">Cancel</option>
                    </select>
                    <span class="select_drop"><i class="fa fa-caret-down"></i></span>
                </div>
            </td>
            <td>{{item.balanceStatus}}</td>
            <td class="text-center"> <i (click)="onDeleteBtnClick(item.uniqueName)" class="fa fa-trash cp"></i> </td>
        </tr>
    </tbody>
</table>
<!-- Delete invoice confirmation model -->
<div bsModal #invoiceConfirmationModel="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
        <!-- modal-liq90 class is removed for now-->
        <div class="modal-content">
            <delete-role-confirmation-model [selectedInvoiceForDelete]="selectedInvoice" (confirmDeleteEvent)="deleteConfirmedInvoice()" (closeModelEvent)="closeConfirmationPopup()"></delete-role-confirmation-model>
        </div>
    </div>
</div>
<!-- Perform action on invoice model -->
<div bsModal #performActionOnInvoiceModel="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
        <!-- modal-liq90 class is removed for now-->
        <div class="modal-content">
            <perform-action-on-invoice-model (closeModelEvent)="closePerformActionPopup($event)"></perform-action-on-invoice-model>
        </div>
    </div>
</div>
<!-- Download or Send Invoice on mail -->
<div bsModal #downloadOrSendMailModel="bs-modal" class="modal fade" role="dialog" [config]="modalConfig">
  <div class="modal-dialog modal-lg">
    <!-- modal-liq90 class is removed for now-->
    <div class="modal-content">
      <download-or-send-mail-invoice (downloadOrSendMailEvent)="onDownloadOrSendMailEvent($event)" (closeModelEvent)="closeDownloadOrSendMailPopup($event)"></download-or-send-mail-invoice>
    </div>
  </div>
</div>

<!-- modal dialog -->
<div bsModal #invoiceGenerateModel="bs-modal" class="modal fade" role="dialog" [config]="modalConfig">
  <div class="modal-dialog gray modal-liquid">
    <div class="modal-content">
      <invoice-generate-model (closeEvent)="closeInvoiceModel($event)"></invoice-generate-model>
    </div>
  </div>
</div>
