<form #invoiceForm="ngForm" (ngSubmit)="getLedgersByFilters(invoiceForm)" novalidate class="form-inline filterForm">

    <div class="form-group" (clickOutside)="showFromDatePicker=false;">
        <label class="d-block">From</label>
        <div class="input-group">
            <input type="text" name="from" [ngModel]="moment(ledgerSearchRequest.from).format('DD-MM-YYYY')" (focus)="showFromDatePicker = true;" class="form-control" required/>
            <span class="input-group-btn">
                <button type="button" class="btn btn-default" (click)="showFromDatePicker = !showFromDatePicker">
                <i class="glyphicon glyphicon-calendar"></i>
                </button>
            </span>
        </div>
        <div *ngIf="showFromDatePicker" style="position: absolute; z-index:10; min-height:290px;">
            <ul class="my-dropdown-menu">
                <li>
                    <datepicker name="fromDate" (click)="$event.stopPropagation()" [(ngModel)]="ledgerSearchRequest.from" (selectionDone)="showFromDatePicker=!showFromDatePicker" [showWeeks]="false"></datepicker>
                </li>
                <li style="padding:10px 9px 2px" class="ng-scope">
                    <span class="btn-group pull-left">
                    <button type="button" class="btn btn-sm btn-info" (click)="setToday('from');showFromDatePicker = false;">Today</button>
                    <button type="button" class="btn btn-sm btn-danger ng-binding" (click)="clearDate('from');showFromDatePicker = false;">Clear</button></span>
                    <button type="button" class="btn btn-sm btn-success pull-right" (click)="showFromDatePicker = false">Done</button>
                </li>
            </ul>
        </div>
    </div>

    <div class="form-group" (clickOutside)="showToDatePicker=false;">
        <label class="d-block">To</label>
        <div class="input-group">
            <input type="text" name="to" [ngModel]="moment(ledgerSearchRequest.to).format('DD-MM-YYYY')" (focus)="showToDatePicker = true;" class="form-control" required/>
            <span class="input-group-btn">
                <button type="button" class="btn btn-default" (click)="showToDatePicker = !showToDatePicker">
                <i class="glyphicon glyphicon-calendar"></i>
                </button>
            </span>
        </div>
        <div *ngIf="showToDatePicker" style="position: absolute; z-index:10; min-height:290px;">
            <ul class="my-dropdown-menu">
                <li>
                    <datepicker name="toDate" (click)="$event.stopPropagation()" [(ngModel)]="ledgerSearchRequest.to" (selectionDone)="showToDatePicker=!showToDatePicker" [showWeeks]="false"></datepicker>
                </li>
                <li style="padding:10px 9px 2px" class="ng-scope">
                    <span class="btn-group pull-left">
                    <button type="button" class="btn btn-sm btn-info" (click)="setToday('to');showToDatePicker = false;">Today</button>
                    <button type="button" class="btn btn-sm btn-danger ng-binding" (click)="clearDate('to');showToDatePicker = false;">Clear</button></span>
                    <button type="button" class="btn btn-sm btn-success pull-right" (click)="showToDatePicker = false">Done</button>
                </li>
            </ul>
        </div>
    </div>
    <div class="form-group">
        <label>Account</label>
        <select2 name="a" [(ngModel)]="ledgerSearchRequest.accountUniqueName" class="select2-parent" [data]="accounts$ | async" [options]="select2Options">
        </select2>
    </div>
    <div class="form-group">
        <label>Description</label>
        <input type="text" class="form-control" name="description" placeholder="By description" [(ngModel)]="ledgerSearchRequest.description">
    </div>
    <div class="form-group">
        <label>Count</label>
        <select class="form-control col-xs-2" name="count" [(ngModel)]="ledgerSearchRequest.count">
      <option [ngValue]="'select'">Select</option>
      <option *ngFor="let num of counts;" [ngValue]="num">{{num}}</option>
    </select>
    </div>
    <div class="form-group">
        <label>Amount</label>
        <select class="form-control" name="entryTotalBy" [(ngModel)]="ledgerSearchRequest.entryTotalBy">
      <option [ngValue]="'select'">Please Select</option>
      <option *ngFor="let item of filtersForEntryTotal" [ngValue]="item.uniqueName"> {{ item.name }} </option>
    </select>
    </div>
    <div class="form-group">
        <label>&nbsp;</label>
        <input type="text" class="form-control col-xs-2" name="entryTotal" [(ngModel)]="ledgerSearchRequest.entryTotal" placeholder="By amount">
    </div>
    <div class="form-group">
        <label>&nbsp;</label>
        <button class="btn btn-primary">GO</button>
    </div>

</form>


<div class="clearfix pdT2 mrB2">
    <ul class="list-inline pull-left">
      <li><button [disabled]="selectedLedgerItems.length === 0" class="btn btn-primary" (click)="generateBulkInvoice(false)">Generate Multiple</button></li>
      <li><button [disabled]="selectedLedgerItems.length === 0" class="btn btn-primary" (click)="generateBulkInvoice(true)">Generate Compound</button></li>
      <li><button placement="top" tooltip="Works only for single entry." [disabled]="selectedLedgerItems.length === 0 || !togglePrevGenBtn" class="btn btn-primary" (click)="previewInvoice()">Preview &amp; Generate</button></li>
      <!-- <li><button class="btn btn-info" id="createNew" (click)="showInvoiceModal()">Create New</button></li> -->
      <!-- <li><a placement="right" tooltip="How to generate invoice?" class="cp" href="http://faq.giddh.com/invoice/how-to-make-invoice" target="_blank"><i class="glyphicon glyphicon-question-sign"></i></a></li> -->
    </ul>
    <!-- <div class="form-group pull-right">
    <input type="search" class="form-control maxW150" placeholder="Search">
  </div> -->
</div>

<!--list of data  -->

<div class="no-data" *ngIf="!ledgersData">
    <h1>No Entry found in sales!</h1>
    <h1>Have to do some sales before creating invoice</h1>
    <a class="btn btn-primary">Go to Sales</a>
</div>

<table class="table basic table-bordered" *ngIf="ledgersData && ledgersData.results.length > 0">
    <thead class="t-h-bg1">
        <tr>
            <th style="width:3%" class="mh18_img">
                <img src="assets/images/unchecked.png" *ngIf="!allItemsSelected" (click)="toggleAllItems(true)">
                <img src="assets/images/checked.png" *ngIf="allItemsSelected" (click)="toggleAllItems(false)">
            </th>
            <th style="width:10%">Date</th>
            <th style="width:23.5%">Particular</th>
            <th style="width:7%">Amount</th>
            <th style="width:30%">Description</th>
            <th style="width:7%">Total</th>
            <th style="width:20%">Account</th>
        </tr>
    </thead>
    <tfoot>
      <tr>
        <td colspan="100%">
          <div class="alC">
            <pagination [totalItems]="ledgersData.totalPages" [(ngModel)]="ledgersData.page" [maxSize]="5" class="pagination-sm" [boundaryLinks]="true" [itemsPerPage]="1" [rotate]="false" (pageChanged)="pageChanged($event)"></pagination>
          </div>
        </td>
      </tr>
    </tfoot>
    <tbody>
        <!--ng-class="{'danger': checkTransaction(ledger.uniqueName)}"  -->
        <tr *ngFor="let item of ledgersData.results">
            <td class="mh18_img">
                <img *ngIf="!item.isSelected" src="assets/images/unchecked.png" (click)="toggleItem(item, true)" />
                <img *ngIf="item.isSelected" src="assets/images/checked.png" (click)="toggleItem(item, false)" />
            </td>
            <td>{{item.entryDate}}</td>
            <td colspan="2">
                <table class="table nested_table">
                    <tr *ngFor="let transaction of item.transactions">
                        <td style="width:93%">
                            {{transaction.particular.name}}
                        </td>
                        <td style="width:23%;">
                            {{transaction.amount}}
                        </td>
                    </tr>
                </table>
            </td>
            <td>{{item.description}}</td>
            <td>{{item.total.amount}}</td>
            <td>{{item.account.name}}</td>
    </tbody>
</table>

<!--modal dialog  -->
<div bsModal #invoiceGenerateModel="bs-modal" class="modal fade" role="dialog">
    <div class="modal-dialog gray modal-liquid">
        <div class="modal-content">
            <invoice-generate-model (closeEvent)="closeInvoiceModel()"></invoice-generate-model>
        </div>
    </div>
</div>
