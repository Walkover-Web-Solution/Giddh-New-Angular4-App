<section id="purchaseInvoice" class="container-fluid mrT2">
    <!--<div>
        {{ allPurchaseInvoices | json}}
    </div>-->
    <!-- Top filter -->
    <form class="col-xs-12">
        <div class="row">
            <div class="form-group col-xs-2">
                <div class="row">
                    <label>GSTR Form</label>
                    <div class="btn-group btn-block" dropdown>
                        <button dropdownToggle type="button" data-toggle="dropdown" class="form-control text-left"> <span *ngIf="!selectedGstrType">-- Select GSTR --</span> <span *ngIf="selectedGstrType">{{selectedGstrType}}</span> <span class="pull-right"><i class="fa fa-caret-down"></i></span>
               </button>
                        <ul *dropdownMenu class="dropdown-menu pageListDD" role="menu">
                            <li (click)="onSelectGstrOption(item.name);" class="cp dd-options" *ngFor="let item of gstrOptions">
                                {{item.name}}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="form-group col-xs-2" (clickOutside)="showGSTR1DatePicker=false;" [hidden]="!selectedGstrType || selectedGstrType=='GSTR2'">
                <label>Month</label>
                <div class="input-group">
                    <input type="text" name="from" [ngModel]="moment(selectedDateForGSTR1).format('MM-YYYY')" (focus)="showGSTR1DatePicker = true;" class="form-control" required/>
                    <span class="input-group-btn">
         <button type="button" class="btn btn-default" (click)="showGSTR1DatePicker = !showGSTR1DatePicker">
         <i class="glyphicon glyphicon-calendar"></i>
         </button>
         </span>
                </div>
                <!--<div *ngIf="showGSTR1DatePicker" style="position: absolute; z-index:10; min-height:290px;">
         <datepicker name="fromDate" [(ngModel)]="manufacturingDetails.date" (selectionDone)="showGSTR1DatePicker=!showGSTR1DatePicker"
             [showWeeks]="true"></datepicker>
         </div>-->
                <div *ngIf="showGSTR1DatePicker" style="position: absolute; z-index:10; min-height:290px;">
                    <ul class="my-dropdown-menu calendar-dropdown">
                        <li>
                            <datepicker [datepickerMode]="'month'" name="fromDate" (click)="$event.stopPropagation()" [(ngModel)]="selectedDateForGSTR1" (selectionDone)="showGSTR1DatePicker=!showGSTR1DatePicker" [showWeeks]="false" [minMode]="'month'"></datepicker>
                        </li>
                        <li class="pd1 clearfix pdT pdB">
                            <span class="btn-group pull-left">
               <button type="button" class="btn btn-xs btn-primary mrR" (click)="setCurrentMonth();showGSTR1DatePicker = false;">Reset</button>
               <button type="button" class="btn btn-xs btn-success" (click)="showGSTR1DatePicker = false">Done</button>
               </span>
                            <button type="button" class="btn btn-xs btn-link pull-right" (click)="clearDate();showGSTR1DatePicker = false;">Clear</button>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="form-group col-xs-2" [hidden]="!selectedGstrType || selectedGstrType=='GSTR1'">
                <label>Report</label>
                <div class="btn-group btn-block" dropdown>
                    <button dropdownToggle type="button" data-toggle="dropdown" class="form-control text-left btn-block dropdown-toggle">-- Select Report --<span class="select_drop pull-right mrT1"><i class="fa fa-caret-down"></i></span>
         </button>
                    <ul *dropdownMenu class="dropdown-menu pageListDD" role="menu">
                        <li class="cp" *ngFor="let item of purchaseReportOptions">
                            {{item.name}}
                        </li>
                    </ul>
                </div>
            </div>
            <div class="form-group inline" *ngIf="selectedGstrType">
                <br />
                <button [disabled]="!selectedGstrType || selectedGstrType=='GSTR1'" class="btn btn-success">GO</button>
            </div>
            <div class="form-inline inline pull-right">
                <br />
                <div class="form-group">
                    <label></label>
                    <div [hidden]="isDownloadingFileInProgress" class="btn-group" dropdown [isDisabled]="!selectedGstrType || selectedGstrType=='GSTR2'">
                        <button dropdownToggle type="button" data-toggle="dropdown" class="form-control text-left"> File {{ selectedGstrType }} <span class="pull-right mrL4"><i class="fa fa-caret-down"></i></span>
         </button>
                        <ul *dropdownMenu class="dropdown-menu pageListDD" role="menu">
                            <li class="cp dd-options" (click)="onDownloadSheetGSTR1('gstr1');">Download Sheet</li>
                            <li class="cp dd-options text-danger" (click)="onDownloadSheetGSTR1('gstr1_error');">Download Error Sheet</li>
                            <li class="cp dd-options">Use JIOGST API</li>
                            <!--<li class="cursor-pointer dd-options" *ngFor="let item of fileGstrOptions" (click)="onDownloadSheetGSTR1();">
               {{item.name}}
               </li>-->
                        </ul>
                    </div>
                    <small [hidden]="!isDownloadingFileInProgress" class="inline primary_clr"> Downloading... </small>
                </div>
                <button class="btn btn-default primary_clr" (click)="toggleSettingAsidePane($event);"><i class="fa fa-cog" aria-hidden="true"></i> Settings</button>
            </div>
        </div>
    </form>
    <!-- Top filter end  -->

    <!-- page Title  -->
    <div class="col-xs-12" [hidden]="!selectedGstrType || selectedGstrType=='GSTR1'">
        <div class="row">
            <h1 class="section_title"><strong>Purchase Report </strong> <small>(To file your GST return, all missing data needs to be filled properly)</small></h1>
        </div>
    </div>

    <div class="box clearfix" [hidden]="!selectedGstrType || selectedGstrType=='GSTR1'">
        <!-- filter -->
        <div class="col-xs-12">
            <div class="row">
                <form class="col-xs-10">
                    <div class="row">
                        <div class="form-group col-xs-2">
                            <div class="row">
                                <label>Date Range</label>
                                <br>
                                <input type="text" name="dateInput" daterangepicker (selected)="selectedDate($event, mainInput)" [options]="datePickerOptions" class="form-control date-range-picker" />
                            </div>
                        </div>

                        <div class="form-group col-xs-2">
                            <label>Other Filters</label>

                            <div class="btn-group btn-block" dropdown>
                                <button dropdownToggle type="button" data-toggle="dropdown" class="form-control text-left btn-block dropdown-toggle"> Filter <span class="select_drop pull-right mrT1"><i class="fa fa-caret-down"></i></span>
                            </button>
                                <ul *dropdownMenu class="dropdown-menu pageListDD" role="menu">
                                    <li *ngFor="let item of otherFilters">
                                        <label><input type="checkbox"> {{item.name}}</label>
                                    </li>
                                </ul>
                            </div>

                        </div>
                        <div class="form-group inline" *ngIf="selectedGstrType">
                            <br />
                            <button type="button" class="btn btn-success">GO</button>
                            <a class="btn btn-link">Reset</a>
                        </div>
                        <button (click)="onUpdate()" class="btn btn-generate pull-right">Generate <br />Purchase Invoice</button>
                    </div>
                </form>

                <!-- search form  -->
                <form class="col-xs-2 pull-right search-form">
                    <br />
                    <div class="row">
                        <div class="input-group col-xs-11 pull-right">
                            <span class="input-group-btn">
                      <i class="glyphicon glyphicon-search"></i>
                    </span>
                            <input type="text" (keyup)="filterPurchaseInvoice(searchBox.value)" #searchBox class="form-control" placeholder="Search">
                        </div>
                        <!-- /input-group -->
                    </div>
                </form>
            </div>
        </div>
        <!-- filter end  -->

        <!-- table  -->
        <table class="table basic table-bordered">
            <thead>
                <tr>
                    <th>&nbsp;</th>
                    <th>Date</th>
                    <th>Particulars</th>
                    <th>Account</th>
                    <th> <span (click)="sortInvoicesBy('gstin')" class="cursor-pointer">GSTIN <i class="fa fa-sort" aria-hidden="true"></i></span> </th>
                    <th> <span (click)="sortInvoicesBy('invoiceNo')" class="cursor-pointer">Invoice No. <i class="fa fa-sort" aria-hidden="true"></i></span> </th>
                    <th>Voucher No.</th>
                    <th>Entry</th>
                    <th class="text-right">Taxable Value</th>
                    <th *ngIf="isReverseChargeSelected" class="text-right">Select Tax</th>
                    <th class="text-right">IGST</th>
                    <th class="text-right">CGST</th>
                    <th class="text-right">SGST</th>
                    <th class="text-right">UTGST</th>   
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let invoice of allPurchaseInvoices; let i = index">
                    <td class="text-center"><input type="checkbox" (click)="onSelectRow(i)" [disabled]="invoice.entryType === ''" /></td>
                    <td [innerHTML]="invoice.entryDate | highlight: searchBox.value"></td>
                    <td [innerHTML]="invoice.particulars | highlight: searchBox.value"></td>
                    <td [innerHTML]="invoice.account.accountName | highlight: searchBox.value"></td>
                    <td><input type="text" class="form-control" [value]="invoice.account.gstIn" /></td>
                    <td><input type="text" class="form-control" [value]="invoice.invoiceNo" /></td>
                    <td>{{invoice.voucherNo}}</td>
                    <td class="select text-center">
                        <div *ngIf="timeCounter == 10 || selectedRowIndex != i" class="custom-select pos-rel">
                            <select [(ngModel)]="value" name="entryType" class="form-control cp" (change)="onChangeEntryType(i, value);">
                            <option value="">None selected</option>
                            <option value="composite"> Composite </option>
                            <option value="reverse charge"> Reverse Charge</option>
                        </select>
                            <span class="select_drop"><i class="fa fa-caret-down"></i></span>
                        </div>
                        <button *ngIf="timeCounter != 10 && selectedRowIndex == i" (click)="onUndoEntryTypeChange()" class="btn btn-link">Undo in {{timeCounter}}s</button>
                    </td>
                    <td class="text-right">{{invoice.taxableValue}}</td>
                  <td class="form-group" *ngIf="isReverseChargeSelected">
                    <div class="btn-group btn-block" dropdown  (onShown)="onDDShown()" (onHidden)="onDDHidden(invoice.entryUniqueName, invoice.account.uniqueName)">
                      <button dropdownToggle type="button" class="form-control text-left btn-block dropdown-toggle">
                        {{dropdownHeading}} <span class="select_drop pull-right mrT1"><i class="fa fa-caret-down"></i></span>
                      </button>
                      <ul id="pageListDD" *dropdownMenu class="dropdown-menu" role="menu">
                        <li>
                          <label>
                            <input type="checkbox" [ngModelOptions]="{standalone: true}" (click)="selectAllTaxes($event)" [(ngModel)]="invoice.isAllTaxSelected"> Select all
                          </label>
                        </li>
                        <li *ngFor="let tax of allTaxes; let i = index">
                          <label>
                            <input type="checkbox" [ngModelOptions]="{standalone: true}" (click)="selectTax($event, tax)" [(ngModel)]="tax.isSelected"> {{ tax.name}}
                          </label>
                        </li>
                      </ul>
                    </div>
                </td>
                    <td class="text-right">{{invoice.igstAmount}}</td>
                    <td class="text-right">{{invoice.cgstAmount}}</td>
                    <td class="text-right">{{invoice.sgstAmount}}</td>
                    <td class="text-right">{{invoice.utgstAmount}}</td>
                </tr>

            </tbody>
        </table>
    </div>
    <div class="aside-overlay" *ngIf="accountAsideMenuState === 'in'"></div>
    <aside-menu-account [@slideInOut]="accountAsideMenuState" (closeAsideEvent)="toggleSettingAsidePane($event)"></aside-menu-account>
</section>
<!--<div class="form-group col-xs-2">
    <button class="btn btn-success" (click)="toggleSettingAsidePane($event);"><i class="fa fa-cog" aria-hidden="true"></i> Settings</button>
</div>-->
