<section class="pd2 h100">

  <div class="clearfix mrB2">
    <button (click)="goToManageStock()" class="btn btn-primary btn-md gico-wrap">
      <i class="icon-edit" aria-hidden="true"></i> Manage {{ activeStock$  }} Stock
    </button>
  </div>
  <form #filter="ngForm">
    <div class="filterForm clearfix pr">
      <div class="form-group mrB pull-left">
        <date-picker [label]="'From Date'" [minDate]="" [maxDate]="today" [(ngModel)]="fromDate" name="fromDate" [showAdditionalButton]="true" [showCalenderButton]="false"></date-picker>
      </div>
      <div class="form-group mrB pull-left">
          <date-picker [label]="'To Date'" [minDate]="" [maxDate]="today" [(ngModel)]="toDate" name="toDate" [showAdditionalButton]="true" [showCalenderButton]="false"></date-picker>
      </div>
      <div class="form-group">
        <label>&nbsp;</label>
        <button class="btn btn-primary" (click)="getStockReport(true)">Go</button>
      </div>
    </div>

  </form>

  <p class="mrT1" *ngIf="(stockReport$ | async)?.transactions?.length === 0">No Transactions for this Stock</p>

  <section style="margin-bottom: 40px">

    <div class="row fs13" *ngIf="(stockReport$ | async)?.openingBalance">
      <div class="col-xs-12 text-right">

        <span class="mrR2">
					<label>O/B Qty:
						{{(stockReport$ | async)?.openingBalance.quantity}}
						{{(stockReport$ | async)?.openingBalance.stockUnit}} &amp;
					</label>
					<label placement="top"
                 tooltip="Rate {{(stockReport$ | async)?.openingBalance.amount/(stockReport$ | async)?.openingBalance.quantity }}">&#8377;&nbsp;{{(stockReport$ | async)?.openingBalance.amount}}</label>
				</span>

        <span>
					<label>C/B Qty:
						{{(stockReport$ | async)?.closingBalance.quantity}}
						{{(stockReport$ | async)?.closingBalance.stockUnit}} &amp;
					</label>
					<label tooltip-placement="top"
                 tooltip="Rate {{(stockReport$ | async)?.closingBalance.amount/(stockReport$ | async)?.closingBalance.quantity }}">&#8377;&nbsp;{{(stockReport$ | async)?.closingBalance.amount}}</label>
				</span>

      </div>
    </div>

    <table class="mrT1 stkRprtTbl table_theme width100" *ngIf="(stockReport$ | async)?.transactions?.length > 0">
      <thead>
        <tr>
          <th rowspan="2">Date</th>
          <th rowspan="2">Voucher Type</th>
          <th rowspan="2" class="bdrR">Account name</th>
          <th colspan="4" class="alC">Transactions</th>
          <th class="bdrL" class="alC">Closing Stock</th>
        </tr>
        <tr>
          <th>Inwards</th>
          <th>Outwards</th>
          <th>Rate</th>
          <th>Value</th>
          <th class="bdrL">Quantity</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let txn of (stockReport$ | async)?.transactions">
          <td>{{txn.entryDate}}</td>
          <td>{{txn.voucherType}}</td>
          <td>{{txn.account.name}}</td>
          <td>
            <span *ngIf="txn.type == 'dr'">
							{{txn.quantity}}&nbsp;{{txn.stockUnit}}
						</span>
            <span *ngIf="txn.type == 'cr'">-</span>
          </td>
          <td>
            <span *ngIf="txn.type == 'cr'">
							{{txn.quantity}}&nbsp;{{txn.stockUnit}}
						</span>
            <span *ngIf="txn.type == 'dr'">-</span>
          </td>
          <td [ngClass]="txn.type === 'cr'? 'cr' : 'dr' ">{{txn.rate}}</td>
          <td [ngClass]="txn.type === 'cr'? 'cr' : 'dr' ">
            {{txn.amount}}
          </td>
          <td>
            {{txn.closingQuantity}}&nbsp;{{(stockReport$ | async)?.stockUnit}}
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="14">
            <div class="pagination pull-right">
              <ul class="list-inline">
                <li>
                  <button class="btn btn-default" (click)="prevPage()" [disabled]="(stockReport$ | async)?.page === 1">Prev
                </button>
                </li>
                <li>{{(stockReport$ | async)?.page}}/{{(stockReport$ | async)?.totalPages}}</li>
                <li>
                  <button class="btn btn-default" (click)="nextPage()" [disabled]="(stockReport$ | async)?.page === (stockReport$ | async)?.totalPages">Next
                </button>
                </li>
              </ul>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
  </section>
</section>
