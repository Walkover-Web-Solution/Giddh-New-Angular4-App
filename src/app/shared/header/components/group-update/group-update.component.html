<form class="horizontal-form ng-pristine ng-valid ng-valid-required" id="groupDetailForm" name="groupDetailForm"
      novalidate
      [formGroup]="groupDetailForm" (submit)="updateGroup()">
  <div class="form_bg pd2">
    <div class="form-group clearfix">
      <div class="col-xs-7">
        <div class="row">
          <label>Group Name</label>
          <input type="text" class="form-control" placeholder="Enter Group Name" formControlName="name">
        </div>
      </div>
    </div>
    <div class="form-group clearfix">
      <div class="col-xs-5">
        <div class="row">
          <label>Unique Name</label>
          <input type="text" class="form-control" UniqueNameDirective placeholder="Enter Unique Name"
                 formControlName="uniqueName">
        </div>
      </div>
    </div>
    <div class="form-group clearfix">
      <label>Description</label>
      <textarea maxlength="200" rows="5" cols="10" class="form-control" placeholder="Enter description"
                formControlName="description"></textarea>
    </div>
  </div>

  <div class="pd2 pdB clearfix">
    <a href="javascript:void(0);" class="btn isActive"
       *ngIf="(showEditGroup$ | async) && !(activeGroup$ | async)?.fixed" (click)="showDeleteGroupModal()">DELETE {{
      (activeGroup$ | async)?.name }}</a>
    <button class="btn btn-success pull-right" *ngIf="(showEditGroup$ | async)"
            [ladda]="isUpdateGroupInProcess$ | async"
            [disabled]="(activeGroup$ | async)?.fixed || groupDetailForm.invalid">Update
    </button>
  </div>
</form>

<!--move group-->
<div class="pd2 clearfix ng-scope" *ngIf="!(activeGroup$ | async)?.fixed">
  <form name="moveGroupForm" novalidate (submit)="moveGroup()" [formGroup]="moveGroupForm">
    <div>
      <label class="mrR">Move to group</label>
    </div>
    <div class="form-group col-xs-5 pdL0 mr0">

      <!--template for move group typeahead-->
      <ng-template #moveGroupTemplate let-model="item">
        <a href="javascript:void(0)" class="account-list-item" style="border-bottom:1px solid #e0e0e0;">
          <span class="account-list-item" style="display: block;font-size:12px">
            <p>{{ model.name }}</p>
          </span>
          <span class="account-list-item" style="display: block;font-size:10px">
            <p>{{ model.uniqueName }}</p>
          </span>
        </a>
      </ng-template>

      <input formControlName="moveto" placeholder="Group name" (typeaheadOnSelect)="moveToGroupSelected($event)"
             [typeahead]="accountList"
             typeaheadOptionField="name" class="form-control" [typeaheadItemTemplate]="moveGroupTemplate">
    </div>
    <div class="form-group mr0">
      <button class="btn isActive" [disabled]="!moveGroupForm.valid">Move</button>
    </div>
  </form>
</div>

<!--taxes  -->
<div class="clearfix bdrB" *ngIf="isTaxableGroup$ | async">
  <div class="clearfix">
    <div class="bdrB">
      <div class="dGryHead">
        Taxes
      </div>
      <div class="pd2 clearfix">
        <div class="tax-list-wrap">
          <div class="tax-label"><label>All Applied Taxes</label></div>

          <span class="tax-bullet" *ngFor="let tax of (activeGroup$ | async)?.applicableTaxes">{{ tax.name }}</span>

          <p *ngIf="!(activeGroup$ | async)?.applicableTaxes.length" class="ng-scope">No taxes Applied</p>
          <button id="editTax" class="btn btn-sm btn-default edit-tax-btn" (click)="taxHierarchy()">
            <i class="glyphicon glyphicon-edit"></i>
          </button>
        </div>

        <div class="edit-tax-section" *ngIf="showEditTaxSection">
          <div class="tax-list-wrap">
            <div class="tax-label"><label>All Inherited Taxes</label></div>
            <div *ngFor="let inTax of (activeGroupTaxHierarchy$ | async)?.inheritedTaxes">
              <ng-template #popTemplate>
                <div [innerHtml]="taxPopOverTemplate.replace('@inTax.name', inTax.name)"></div>
              </ng-template>
              <span class="tax-bullet" *ngFor="let inAppTax of inTax.applicableTaxes" [popover]="popTemplate"
                    placement="right" triggers="mouseenter:mouseleave">{{ inAppTax.name }}
                  </span>
            </div>
            <p *ngIf="!(activeGroupTaxHierarchy$ | async)?.inheritedTaxes.length">No Inherited Taxes</p>
            <div class="tax-list-wrap">
              <div class="tax-label"><label>All Applicable Taxes</label></div>
              <form name="taxGroupForm" novalidate [formGroup]="taxGroupForm" (submit)="applyTax()">
                <div class="clearfix max350 mrT1">
                  <sh-select formControlName="taxes" [placeholder]="'Select Taxes'"
                             [options]="companyTaxDropDown | async"
                             [multiple]="true">
                  </sh-select>
                </div>
                <button type="submit" class="btn btn-success mrT1"> Save</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>

<!--delete Group modal  -->
<div bsModal #deleteGroupModal="bs-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <confirm-modal [title]="'Delete Group'"
                     [body]="'Are you sure you want to delete this group? All child groups will also be deleted.'"
                     (cancelCallBack)="hideDeleteGroupModal()" (successCallBack)="deleteGroup()">
      </confirm-modal>
    </div>
  </div>
</div>
