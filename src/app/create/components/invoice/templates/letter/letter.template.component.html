<!-- <form #testForm id="sometemplate">
  <div class="invoice_area" id="template-3">
    <div id="template-header" class="mrT3">
      <header class="pdRL3">
        <table class="mrB1">
          <tbody>
            <tr>
              <td class="text-left vmiddle">
                <div *ngIf="!logoPath">
                  <label class="cp" for="upload_logo" id="upload_label">Your Logo
                    <i class="paper_clip"></i>
                  </label>
                  <input id="upload_logo" type='file' (change)="readUrl($event)" accept="image/*" />
                </div>
                <div *ngIf="logoPath" class="pos-rel">
                  <img [src]="logoPath" alt="" class="logo">
                  <p class="pos-abs">
                    <a (click)="clearUploadedImg()" href="javascript:void(0)" class="btn btn-link">clear</a>
                  </p>
                </div>
              </td>
              <td class="text-right vmiddle">
                <figure>
                  <p contenteditable="true" name="date" [(ngModel)]="name"></p>
                  <p contenteditable="true" name="gstin" [(ngModel)]="name1"></p>
                  <p contenteditable="true" name="pan" [(ngModel)]="name2"></p>
                </figure>
              </td>
            </tr>

          </tbody>
        </table>
      </header>

      <table class="meta pdRL3">
        <tbody>
          <tr>
            <td>
              <h4 class="mrB1" contenteditable="true">Hello Shubhendra Agrawal,</h4>
              <p contenteditable="true">This is a system generated
                <strong class="primary-clr" contenteditable="true">INVOICE #201770323-64</strong> due on September 15, 2017 for
                <strong class="primary-clr" contenteditable="true">Insta car Technologies Private Limited</strong> at 24 Building Name, 3rd Floor, 15 A.B. Road, Indore (M.P.)
                452000 [GSTIN:22BBBBBB000A1Z0] and the total amount is
                <strong class="primary-clr" contenteditable="true">INR 945</strong>.</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div id="Template-table" class="pos-rel">
      <table class="item product-table pdRL3" cellspacing="0" cellpadding="0">
        <thead>
          <tr>
            <th class="text-left" width="45px">S. No.</th>
            <th class="text-left">Description</th>
            <th>HSN/SAC</th>
            <th>Tax Rate</th>
            <th>Qty.</th>
            <th>Rate</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left">1</td>
            <td class="text-left" contenteditable="true">Transactional Route</td>
            <td contenteditable="true">12345678</td>
            <td contenteditable="true">18%</td>
            <td contenteditable="true">2</td>
            <td contenteditable="true">5000.00</td>
            <td>10000.00</td>
          </tr>
          <tr>
            <td class="text-left">2</td>
            <td class="text-left" contenteditable="true">Operational Route</td>
            <td contenteditable="true">45484848</td>
            <td contenteditable="true">10%</td>
            <td contenteditable="true">5</td>
            <td contenteditable="true">2500.00</td>
            <td>12500.00</td>
          </tr>
          <tr>
            <td colspan="7"></td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th colspan="5"></th>
            <th class="text-left grey_txt">Sub Total</th>
            <th class="text-right grey_txt">22500.00</th>
          </tr>
          <tr>
            <th colspan="5"></th>
            <th class="text-left grey_txt">Discount</th>
            <th class="text-right grey_txt">00.00</th>
          </tr>
          <tr>
            <th colspan="5"></th>
            <th class="text-left grey_txt">CGST</th>
            <th class="text-right grey_txt">1525.00</th>
          </tr>
          <tr>
            <th colspan="5"></th>
            <th class="text-left grey_txt">SGST</th>
            <th class="text-right grey_txt">1525.00</th>
          </tr>

          <tr>
            <th colspan="5" class="text-left inwords">Twenty Five Thousand Five Hundred Fifty Only</th>
            <th class="text-left">
              <strong>Total</strong>
            </th>
            <th class="text-right">
              <strong>25550.00</strong>
            </th>
          </tr>
        </tfoot>
      </table>
      <table class="tax-table item pdRL3" cellspacing="0" cellpadding="0">
        <thead>
          <tr>
            <th class="text-left">HSN/SAC</th>
            <th>Taxable Amt.</th>
            <th>CGST Rate</th>
            <th>Amt.</th>
            <th>SGST Rate</th>
            <th>Amt.</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" contenteditable="true">12345678</td>
            <td contenteditable="true">10000.00</td>
            <td contenteditable="true">9%</td>
            <td contenteditable="true">900.00</td>
            <td contenteditable="true">9%</td>
            <td contenteditable="true">900.00</td>
          </tr>

          <tr>
            <td class="text-left" contenteditable="true">12345678</td>
            <td contenteditable="true">12500.00</td>
            <td contenteditable="true">5%</td>
            <td contenteditable="true">625.00</td>
            <td contenteditable="true">5%</td>
            <td contenteditable="true">625.00</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th colspan="1"></th>
            <th class="text-right">Total
              <span class="mrL2">25550.00</span>
            </th>
            <th colspan="1"></th>
            <th class="text-right">1525.00</th>
            <th colspan="1"></th>
            <th class="text-right">1525.00</th>
          </tr>
        </tfoot>
      </table>
    </div>

    <div id="Template-footer" class="pdRL3">
      <table class="subfooter">
        <tbody>
          <tr>
            <td colspan="2" class="vbottom">
              <h1 class="primary-clr">THANK YOU
                <span class="normal primary-clr">FOR YOUR BUSINESS.</span>
              </h1>

            </td>
            <td class="text-center vbottom">
              <p class="bdrB"></p>
              <p contenteditable="true">
                <strong>Walkover Web Solutions Private Limited</strong>
              </p>
              <p>(Signature)</p>
            </td>
          </tr>
          <tr>
            <td colspan="3">
              <ul class="note">
                <li contenteditable="true">Tax to be paid on reverse charge</li>
                <li contenteditable="true">All payments to be made in cash. Contact us for queries on these quotations. </li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>

      <footer class="text-center">
        <p contenteditable="true">
          <strong>Walkover Web Solutions Private Limited</strong>
        </p>
        <p contenteditable="true">405-406, Capt. C. S. Naydu Arcade, 10/2, Old Palasia, near Greater Kailash Hospital, Indore 452001(M. P.)</p>
      </footer>
    </div>
  </div>

  <div class="invoice_sidebar">
    <div class="form-group">
      <input type="text" class="form-control" placeholder="Invoice Name" />
    </div>
    <button class="btn btn-primary" (click)="emitTemplateData(testForm)">Generate Invoice</button>
  </div>

</form> -->

<form #invoiceForm="ngForm" (ngSubmit)="onSubmitInvoiceForm(invoiceForm)" novalidate [formGroup]="CreateInvoiceForm">
  <div class="clearfix mrB2">
    <div class="clearfix pdT2 pdB2">
      <div class="col-xs-9" formGroupName="userDetails">
        <div class="flex-row">
          <div class="flex-row-child">
            <div class="form-group noMarg">
              <label>Customer Name</label>
              <input type="text" class="form-control" formControlName="userName" [ngClass]="{'has-error': isFormSubmitted && CreateInvoiceForm.controls['userDetails'].get('userName').invalid }">
            </div>
          </div>
          <div class="flex-row-child mrL2">
            <div class="form-group noMarg">
              <label>Email Id</label>
              <input type="email" placeholder="someone@example.com" formControlName="userEmail" class="form-control" />
            </div>
          </div>
          <div class="flex-row-child mrL2">
            <div class="form-group noMarg">
              <label>Mobile No.</label>
              <input digitsOnlyDirective placeholder="9198XXXXXXXX" type="text" formControlName="userMobileNumber" class="form-control"  />
            </div>
          </div>
          <div class="flex-row-child mrL2">
            <div class="form-group noMarg">
              <label>Company name</label>
              <input placeholder="Company name" type="text" formControlName="userCompanyName" class="form-control" [ngClass]="{'has-error': isFormSubmitted && CreateInvoiceForm.controls['userDetails'].get('userCompanyName').invalid }" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-12">
      <div class="bdrB"></div>
    </div>
  </div>

  <section class="form-inline col-xs-12 mrB1">

    <div class="collapse-pane clearfix">
      <div class="collapse-pane-heading" (click)="isGenDtlCollapsed = !isGenDtlCollapsed">
        <div class="ico-box-wrap">
          <div class="ico-box">
            <span [ngClass]="isGenDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
          </div>
        </div>
        <div class="ico-head">General Details</div>
      </div>
      <div [collapse]="isGenDtlCollapsed" class="clearfix pdL3 pdR3 col-xs-11 mr0">
        <div class="row">
          <!-- <div class="form-group col-xs-4">
            <label>Attention to</label>
            <input type="text" name="accountDetails.attention" class="form-control" [(ngModel)]="invFormData.accountDetails.attentionTo" />
          </div> -->

          <ng-container formGroupName="companyDetails">
            <div class="form-group col-xs-4">
              <label>Company name</label>
              <input type="text" class="form-control" formControlName="name" [ngClass]="{ 'has-error': isFormSubmitted && CreateInvoiceForm.controls['companyDetails'].get('name').invalid }"/>
            </div>
            <div class="form-group col-xs-4">
              <label>Address</label>
              <textarea class="form-control" formControlName="address" rows="5"></textarea>
            </div>
            <div class="col-xs-4"></div>
          </ng-container>

          <div class="form-group col-xs-2" formGroupName="userDetails">
            <label>Country</label>
            <sh-select class="sh-form_control" formControlName="countryCode" [options]="countrySource" [ngClass]="{ 'has-error': isFormSubmitted && CreateInvoiceForm.controls['userDetails'].get('countryCode').invalid }"></sh-select>
          </div>
          <ng-container formGroupName="invoiceDetails">
            <div class="form-group col-xs-4">
              <label>Invoice Number</label>
              <input type="text" class="form-control" formControlName="invoiceNumber" [ngClass]="{ 'has-error': isFormSubmitted && CreateInvoiceForm.controls['invoiceDetails'].get('invoiceNumber').invalid }"/>
            </div>
            <div class="form-group col-xs-2">
              <label>Date</label>
              <input type="text" [placeholder]="giddhDateFormat" formControlName="invoiceDate" class="form-control" bsDatepicker
              [bsConfig]="{ dateInputFormat: giddhDateFormat }">
            </div>
            <div class="form-group col-xs-2">
              <label>Due Date</label>
              <input type="text" [placeholder]="giddhDateFormat" formControlName="dueDate" class="form-control" bsDatepicker
              [bsConfig]="{ dateInputFormat: giddhDateFormat }" />
            </div>
          </ng-container>
        </div>
      </div>
    </div>
    <!-- end general details collapse pane -->

    <div class="collapse-pane clearfix">
      <div class="collapse-pane-heading" (click)="isMlngAddrCollapsed = !isMlngAddrCollapsed">
        <div class="ico-box-wrap">
          <div class="ico-box">
            <span [ngClass]="isMlngAddrCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
          </div>
        </div>
        <div class="ico-head">Address</div>
      </div>
      <div [collapse]="isMlngAddrCollapsed" class="clearfix pdL3 pdR3 col-xs-11 mr0">
        <div class="row">
          <div formGroupName="userDetails">
            <div class="col-xs-6">
              <div class="row" formGroupName="billingDetails">
                <div class="form-group" [ngClass]="{'col-xs-8':invFormData.accountDetails.country.countryName === 'India', 'col-xs-12': invFormData.accountDetails.country.countryName !== 'India' }">
                  <label>Billing Address</label>
                  <textarea formControlName="address" (keyup)="autoFillShippingDetails()" class="form-control"
                    rows="5"></textarea>
                </div>
                <div class="form-group col-xs-4" *ngIf="invFormData.accountDetails.country.countryName === 'India'">
                  <div>
                    <label>State</label>
                    <sh-select formControlName="stateCode" (selected)="autoFillShippingDetails()" #statesBilling class="splSales" [options]="statesSource$ | async"></sh-select>
                  </div>
                  <div class="mrT2">
                    <label>GSTIN</label>
                    <input formControlName="gstNumber" maxLength="15" type="text" class="form-control"
                      (keyup)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()" />
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xs-6">
              <div class="row" formGroupName="shippingDetails">
                <div class="form-group" [ngClass]="{'col-xs-8':invFormData.accountDetails.country.countryName === 'India', 'col-xs-12': invFormData.accountDetails.country.countryName !== 'India' }">
                  <label style="width:340px;">
                  <input type="checkbox" (change)="autoFillShippingDetails()" formControlName="autoFillShipping"> Shipping Address Same as Billing Address</label>
                  <textarea formControlName="address" [readonly]="autoFillShipping" class="form-control"
                    rows="5"></textarea>
                </div>
                <!-- <div class="form-group col-xs-4">
                  <div>
                    <label>State</label>
                    <sh-select formControlName="stateCode" [disabled]="autoFillShipping" #statesShipping class="splSales" [options]="statesSource$ | async"></sh-select>
                  </div>
                  <div class="mrT2">
                    <label>GSTIN</label>
                    <input formControlName="gstNumber" [readonly]="autoFillShipping" maxLength="15" type="text" class="form-control"
                      (keyup)="getStateCode('shippingDetails', statesShipping)" />
                  </div>
                </div> -->
              </div>
            </div>
          </div>
        </div>
        <!-- end row -->
      </div>
    </div>
    <!-- end mailing address collapse pane -->

    <div class="collapse-pane clearfix">
      <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
        <div class="ico-box-wrap">
          <div class="ico-box">
            <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
          </div>
        </div>
        <div class="ico-head">Other Details</div>
      </div>
      <div [collapse]="isOthrDtlCollapsed" class="clearfix pdL3 pdR3 col-xs-11 mr0">
        <div class="row" formGroupName="other">
          <div class="form-group col-xs-2">
            <label>Ship Date</label>
            <input formControlName="shippingDate" type="text" [placeholder]="giddhDateFormat" bsDatepicker
              class="form-control" [bsConfig]="{ dateInputFormat: giddhDateFormat }" />
          </div>
          <div class="form-group col-xs-2">
            <label>Ship Via</label>
            <input formControlName="shippedVia" type="text" class="form-control" />
          </div>
          <div class="form-group col-xs-2">
            <label>Tracking No.</label>
            <input formControlName="trackingNumber" type="text" class="form-control" />
          </div>
          <ng-container formGroupName="customFields">
            <div class="form-group col-xs-2">
              <label>Field 1</label>
              <input type="text" formControlName="customField1" class="form-control" />
            </div>
            <div class="form-group col-xs-2">
              <label>Field 2</label>
              <input type="text" formControlName="customField2" class="form-control"
              />
            </div>
            <div class="form-group col-xs-2">
              <label>Field 3</label>
              <input type="text" formControlName="customField3" class="form-control"
              />
            </div>
          </ng-container>
        </div>
      </div>
    </div>
    <!-- end other details collapse pane -->
  </section>
  <section class="clearfix pd1 pdB2 mrB2 whiteBg">
      <table class="table" formArrayName="entries">
        <thead>
          <tr>
            <td>#</td>
            <td>Date</td>
            <td>Description</td>
            <td>Quantity</td>
            <td>Rate</td>
            <td>Discount</td>
            <td>Amount</td>
          </tr>
        </thead>
        <tbody *ngFor="let entry of CreateInvoiceForm.get('entries')['controls']; let entryIdx = index; let first = first; let last = last">
          <tr [formGroupName]="entryIdx">
            <td>{{ entryIdx+1 }}</td>
            <td>
              <input 
                type="text"
                formControlName="entryDate"
                [placeholder]="giddhDateFormat" bsDatepicker
                class="form-control text-right mrT1"
                [bsConfig]="{ dateInputFormat: giddhDateFormat }" />
            </td>
            <td>
              <input type="text" formControlName="description" placeholder="Description" class="form-control mrT1"/>
            </td>
            <td>
              <input type="text" formControlName="quantity" placeholder="Quantity" class="form-control mrT1" />
            </td>
            <td>
              <input type="text" formControlName="rate" placeholder="Rate" class="form-control mrT1" />
            </td>
            <td>
              <input type="text" formControlName="discount" placeholder="Discount" class="form-control mrT1" />
            </td>
            <td>
              <input type="text" formControlName="amount" placeholder="Amount" class="form-control mrT1" />
            </td>
            <!-- <td>
              <div class="">
                <input type="text" [hidden]="transaction.hsnOrSac !== 'hsn'" readonly maxLength="10" placeholder="HSN/SAC" name="transaction.hsnNumber_{{entryIdx}}"
                  class="form-control text-right" [(ngModel)]="transaction.hsnNumber" />
                <input type="text" [hidden]="transaction.hsnOrSac !== 'sac'" readonly maxLength="10" placeholder="HSN/SAC" name="transaction.sacNumber_{{entryIdx}}"
                  class="form-control text-right" [(ngModel)]="transaction.sacNumber" />
              </div>
            </td> -->
  
            <!-- show/hide fields -->
            <!-- <td class="nested-table-wrap">
              <table width="100%" cellspacing="0" cellspadding="0">
                <tbody>
                  <tr>
                    <td *ngIf="transaction.isStockTxn">
                      <table class="nested-table" width="100%" cellspacing="0" cellspadding="0">
                        <tbody>
                          <tr>
                            <td width="25%">
                              <input type="number" (keyup)="txnChangeOccurred()" (ngModelChange)="transaction.setAmount(entry)" placeholder="Quantity"
                                name="transaction.quantity_{{entryIdx}}" class="form-control text-right" [(ngModel)]="transaction.quantity"
                              />
                            </td>
                            <td width="25%">
                              <select class="form-control" name="transaction.stockUnit_{{entryIdx}}" [(ngModel)]="transaction.stockUnit">
                                <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">{{stock.text}}</option>
                              </select>
                            </td>
                            <td width="25%">
                              <input type="number" (ngModelChange)="transaction.setAmount(entry)" (keyup)="txnChangeOccurred()" placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                class="form-control text-right" [(ngModel)]="transaction.rate" />
                            </td>
                            <td width="25%">
                              <input type="number" disabled="true" name="transaction.amount_{{entryIdx}}" class="form-control text-right" [(ngModel)]="transaction.amount"
                              />
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </td>
                    <td *ngIf="!transaction.isStockTxn">
                      <table class="nested-table" width="100%" cellspacing="0" cellspadding="0">
                        <tbody>
                          <tr>
                            <td width="25%">
                              <input type="text" disabled="true" class="form-control text-right" />
                            </td>
                            <td width="25%">
                              <input type="text" disabled="true" class="form-control text-right" />
                            </td>
                            <td width="25%">
                              <input type="text" disabled="true" class="form-control text-right" />
                            </td>
                            <td width="25%">
                              <input type="number" (ngModelChange)="transaction.setAmount(entry)" (keyup)="txnChangeOccurred()" placeholder="Amount" name="transaction.amount_{{entryIdx}}"
                                class="form-control text-right" [(ngModel)]="transaction.amount" />
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </td>
                  </tr>
                </tbody>
              </table>
            </td> -->
            <!-- <td> -->
              <!-- <discount-list (selectedDiscountItems)="selectedDiscountEvent($event, transaction, entry)"></discount-list> -->
            <!-- </td> -->
            <!-- <td>
              <input type="number" name="transaction.taxableValue_{{entryIdx}}" class="form-control text-right" readonly [(ngModel)]="transaction.taxableValue" />
            </td> -->
            <!-- <td class="tax-list-dd-wrap dropdown-container"> -->
              <!-- <sales-tax-list
                class="salesTax"
                [showTaxPopup]="false"
                [taxes]="companyTaxesList$ | async"
                [applicableTaxes]="transaction.applicableTaxes"
                [taxListAutoRender]="transaction.taxRenderData"
                (selectedTaxEvent)="selectedTaxEvent($event, entry)"
                (taxAmountSumEvent)="taxAmountEvent($event, transaction, entry)">
              </sales-tax-list> -->
            <!-- </td> -->
            <!-- <td>
              <input type="number" name="transaction.total_{{entryIdx}}" class="form-control text-right" readonly [(ngModel)]="transaction.total"
              />
            </td>-->
            <td class="action-panel-td alR">
              <span class="cp" *ngIf="last" (click)="addBlankRow()">
                <i class="icon-add" aria-hidden="true"></i>
              </span>
              <span class="cp" (click)="removeTransaction(entryIdx)">
                <i class="icon-cross" aria-hidden="true"></i>
              </span>
            </td> 
          </tr>
        </tbody>
      </table>
  
      <!-- sub total and total calc -->
      <!-- <table class="table">
        <tbody>
          <tr>
            <td width="50%">
              <div class="col-xs-8 pdT1">
                <label class="mrB1">Message</label>
                <textarea style="height:140px" class="form-control" name="message2" [(ngModel)]="invFormData.templateDetails.other.message2"></textarea>
              </div>
            </td>
            <td width="50%">
              <section class="tableSec">
                <div class="tableRow">
                  <div class="tableCell">Total Amount</div>
                  <div class="tableCell figureCell">{{invFormData.voucherDetails.subTotal | number:'1.2-2'}}</div>
                </div>
                <div class="tableRow">
                  <div class="tableCell">Discount</div>
                  <div class="tableCell figureCell">-{{invFormData.voucherDetails.totalDiscount | number:'1.2-2'}}</div>
                </div>
                <div class="tableRow">
                  <div class="tableCell">Taxable Value</div>
                  <div class="tableCell figureCell">{{invFormData.voucherDetails.totalTaxableValue | number:'1.2-2'}}</div>
                </div>
                <div class="tableRow">
                  <div class="tableCell">Tax</div>
                  <div class="tableCell figureCell">{{invFormData.voucherDetails.gstTaxesTotal | number:'1.2-2'}}</div>
                </div>
                <div class="tableRow">
                  <div class="tableCell">
                    <strong>Total</strong>
                  </div>
                  <div class="tableCell figureCell">
                    <strong>{{invFormData.voucherDetails.grandTotal | number:'1.2-2'}}</strong>
                  </div>
                </div>
                <div class="tableRow">
                  <div class="tableCell">Deposit</div>
                  <div class="tableCell figureCell">
                    <input type="number" (blur)="txnChangeOccurred()" placeholder="Amount" name="dueAmount" class="form-control" [(ngModel)]="dueAmount"
                    />
                  </div>
                </div>
                <div class="tableRow">
                  <div class="tableCell">
                    <strong>Balance Due</strong>
                  </div>
                  <div class="tableCell figureCell">
                    <strong>{{invFormData.voucherDetails.balanceDue | number:'1.2-2'}}</strong>
                  </div>
                </div>
              </section>
            </td>
          </tr>
        </tbody>
      </table> -->
      <!-- end -->
    </section>
  
    <section class="row">
      <section id="actionPane" class="text-center">
        <div class="col-xs-12">
          <div class="pull-right pr">
            <!-- <button type="button" (click)="resetInvoiceForm(invoiceForm)" class="btn btn-danger">Clear</button>
            <button type="button" (click)="triggerSubmitInvoiceForm(invoiceForm)" class="btn btn-default">Generate {{toggleActionText}} &amp; Update A/c</button> -->
            <button type="submit" class="btn btn-success">Generate Invoice</button>
          </div>
        </div>
      </section>
    </section>
</form>

<div bsModal #invoicePreviewModal="bs-modal" [config]="{ keyboard: true }" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg" style="height: 100%;">
      <div *ngIf="base64Data" class="modal-content">
        <iframe width="100%" height="600px" name="plugin" [attr.src]="base64Data" type="application/pdf"></iframe>
      </div>
  </div>
</div>

<style>
  .has-error {
    border: 1px solid red;
  }
</style>