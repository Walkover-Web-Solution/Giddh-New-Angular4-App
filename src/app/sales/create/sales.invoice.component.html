<form #invoiceForm="ngForm" (ngSubmit)="onSubmitInvoiceForm(invoiceForm)" novalidate class="clearfix mrB2">

  <div class="pdB1 bdrB">
    <h3>Sales</h3>
  </div>

  <div class="clearfix">
    <div class="clearfix pdT2 pdB2">
      <div class="col-xs-6">
        <div class="flex-row">
          <div class="flex-row-child">
            <div class="form-group noMarg size_380">
              <label>Customer Name or <a href (click)="toggleAccountAsidePane($event)">+ Add Customer</a></label>
              <input
              autocomplete="off"
              name="customerName"
              [(ngModel)]="invFormData.customerName"
              [typeahead]="accounts$ | async"
              typeaheadOptionField="name"
              placeholder="Search from accounts"
              typeaheadOptionsLimit="10"
              (typeaheadNoResults)="noResultsForCustomer($event)"
              (typeaheadOnSelect)="onSelectCustomer($event)"
              class="form-control">
            </div>
          </div>
          <div class="flex-row-child" *ngIf="typeaheadNoResultsOfCustomer">
            <div class="form-group noMarg">
              <label>Add Entry Against</label>
              <select class="form-control" name="account.uniqueName" [(ngModel)]="invFormData.account.uniqueName">
                <option [ngValue]="select">Select Bank</option>
                <option [ngValue]="bank.uniqueName" *ngFor="let bank of bankAccounts$ | async" >{{ bank.name }}</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xs-6 text-right">
        <p class="lead b">Balance Due: Rs.00.00</p>
      </div>
    </div>
    <div class="col-xs-12"><div class="bdrB"></div></div>
  </div>

  <section class="form-inline col-xs-12">

    <div class="collapse-pane">
      <div class="collapse-pane-heading" (click)="isGenDtlCollapsed = !isGenDtlCollapsed">
        <div class="ico-box-wrap">
          <div class="ico-box">
            <span [ngClass]="isGenDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
          </div>
        </div>
        <div class="ico-head">General Details</div>
      </div>
      <div [collapse]="isGenDtlCollapsed" class="clearfix pdL3 pdR3">
        <div class="form-group size_340">
          <label>Attention to</label>
          <input type="text" name="attention" class="form-control" [(ngModel)]="invFormData.account.attentionTo" />
        </div>
        <div class="form-group">
          <label>Invoice Date</label>
          <input type="text" name="invoiceDate" class="form-control"  [(ngModel)]="invFormData.invoiceDetails.invoiceDate" />
        </div>
        <div class="form-group">
          <label>Invoice Number</label>
          <input type="text" name="invoiceNumber" class="form-control" [(ngModel)]="invFormData.invoiceDetails.invoiceNumber" />
        </div>
        <div class="form-group">
          <label>Due Date</label>
          <input type="text" name="dueDate" class="form-control" [(ngModel)]="invFormData.invoiceDetails.dueDate" />
        </div>
        <div class="form-group">
          <label>Country</label>
          <input type="text" name="country" class="form-control" [(ngModel)]="invFormData.country.countryName" />
        </div>
      </div>
    </div>
    <!-- end general details collapse pane -->

    <div class="collapse-pane">
      <div class="collapse-pane-heading" (click)="isMlngAddrCollapsed = !isMlngAddrCollapsed">
        <div class="ico-box-wrap">
          <div class="ico-box">
            <span [ngClass]="isMlngAddrCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
          </div>
        </div>
        <div class="ico-head">Mailing Address</div>
      </div>
      <div [collapse]="isMlngAddrCollapsed" class="clearfix pdL3 pdR3">
        <div class="flex-row wid90p">
          <div class="flex-row-child">
            <div class="form-group size_340">
              <label>Billing Address</label>
              <textarea name="billingDetails.address" class="form-control" [(ngModel)]="invFormData.account.billingDetails.address"></textarea>
            </div>
            <div class="form-group">
              <div>
                <label>State</label>
                <input type="text" name="billingDetails.stateCode" class="form-control"  [(ngModel)]="invFormData.account.billingDetails.stateCode" />
              </div>
              <div class="mrT27">
                <label>GSTIN</label>
                <input type="text" name="billingDetails.gstNumber" class="form-control"  [(ngModel)]="invFormData.account.billingDetails.gstNumber" />
              </div>
            </div>
          </div>
          <div class="flex-row-child">
            <div class="form-group size_340">
              <label>Shipping Address</label>
              <textarea name="shippingDetails.address" class="form-control" [(ngModel)]="invFormData.account.shippingDetails.address"></textarea>
            </div>
            <div class="form-group">
              <div>
                <label>State</label>
                <input type="text" name="shippingDetails.stateCode" class="form-control" [(ngModel)]="invFormData.account.shippingDetails.stateCode" />
              </div>
              <div class="mrT27">
                <label>GSTIN</label>
                <input type="text" name="shippingDetails.gstNumber" class="form-control"  [(ngModel)]="invFormData.account.shippingDetails.gstNumber" />
              </div>
            </div>
          </div>
        </div>
        <!-- end row -->
      </div>
    </div>
    <!-- end mailing address collapse pane -->

    <div class="collapse-pane">
      <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
        <div class="ico-box-wrap">
          <div class="ico-box">
            <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
          </div>
        </div>
        <div class="ico-head">Other Details</div>
      </div>
      <div [collapse]="isOthrDtlCollapsed" class="clearfix pdL3 pdR3">
        <div class="form-group size_175">
          <label>Ship Date</label>
          <input type="text" name="shipDate" class="form-control" />
        </div>
        <div class="form-group size_175">
          <label>Ship Via</label>
          <input type="text" name="duedate" class="form-control" />
        </div>
        <div class="form-group size_175">
          <label>Tracking No.</label>
          <input type="text" name="country" class="form-control" />
        </div>
        <div class="form-group size_175">
          <label>Field 1</label>
          <input type="text" name="field_1" class="form-control" />
        </div>
        <div class="form-group size_175">
          <label>Field 2</label>
          <input type="text" name="field_2" class="form-control" />
        </div>
        <div class="form-group size_175">
          <label>Field 3</label>
          <input type="text" name="field_3" class="form-control" />
        </div>
      </div>
    </div>
    <!-- end other details collapse pane -->

  </section>

  <section class="clearfix pdT2 pdB2 mrB2 whiteBg">
   <table class="table">
      <thead>
        <tr>
          <th *ngFor="let item of theadArr;">{{item}}</th>
        </tr>
      </thead>
      <tbody *ngFor="let entry of invFormData.entries;">
        <tr *ngFor="let transaction of entry.transactions; let i = index">
          <td>{{ i+1 }}</td>
          <td><input type="text" name="tr.date" class="form-control" [(ngModel)]="transaction.date" /></td>
          <td>
            <input type="text" placeholder="Account" name="tr.accountName" class="form-control" [(ngModel)]="transaction.accountName" /><br>
            <input type="text" placeholder="Description" name="tr.description" class="form-control" [(ngModel)]="transaction.description" />
          </td>
          <td>
            <input type="text" placeholder="HSN" name="tr.hsnNumber" class="form-control" [(ngModel)]="transaction.hsnNumber" />
            <input type="text" placeholder="SAC" name="tr.sacNumber" class="form-control" [(ngModel)]="transaction.sacNumber" />
          </td>
          <td>
            <input type="text" placeholder="Quantity" name="tr.quantity" class="form-control" [(ngModel)]="transaction.quantity" />
          </td>
          <td>
            <select class="form-control" name="tr.stockUnit" [(ngModel)]="transaction.stockUnit">
              <option [ngValue]="select">Select</option>
            </select>
          </td>
          <td>
            <input type="text" placeholder="Rate" name="tr.rate" class="form-control" [(ngModel)]="transaction.rate" />
          </td>
          <td>
            <discount-list (selectedDiscountItems)="selectedDiscountEvent($event)"></discount-list>
            <!-- <select class="form-control" name="tr.discount" [(ngModel)]="transaction.discount">
              <option [ngValue]="'select'">Select</option>
            </select> -->
          </td>
          <td><input type="text" name="tr.discount" class="form-control" readonly [(ngModel)]="transaction.taxable" /></td>
          <td class="tax-list-dd-wrap">
            <tax-control *ngIf="showTaxBox"
              [taxes]="companyTaxesList$ | async"
              [applicableTaxes]="[]"
              [taxRenderData]="[]"
              [showTaxPopup]="false"
              [showHeading]="false"
              (selectedTaxEvent)="selectedTaxEvent($event)"
              (taxAmountSumEvent)="taxAmountEvent($event)">
            </tax-control>
            <!-- <select multiple class="form-control" name="tr.tax" [(ngModel)]="transaction.tax">
              <option [ngValue]="'select'">Select</option>
              <option [ngValue]="tax.uniqueName" *ngFor="let tax of taxList$ | async">{{tax.name}}</option>
            </select> -->
          </td>
          <td><input type="text" name="tr.discount" class="form-control" readonly [(ngModel)]="transaction.total" /></td>
        </tr>
      </tbody>
    </table>
  </section>

  <section class="row">
    <section id="actionPane" class="text-center">
      <div class="col-xs-12">
        <button type="button" class="btn btn-default pull-left">Clear</button>
        <div class="pull-right pr">
          <button type="submit" class="btn btn-default">Generate Invoice</button>
        </div>
      </div>
    </section>
  </section>
</form>

<!-- open account aside -->
<div class="aside-overlay" *ngIf="accountAsideMenuState === 'in'"></div>
<aside-menu-account [@slideInOut]="accountAsideMenuState" (closeAsideEvent)="toggleAccountAsidePane($event)"></aside-menu-account>
