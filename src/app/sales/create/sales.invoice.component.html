<div class="form-group mrB mrT2 clearfix">
  <div class="col-xs-12 clearfix">
    <div class="btn-group" dropdown>
      <button id="button1-basic" dropdownToggle type="button" class="btn spcl_dropdown dropdown-toggle"
              aria-controls="dropdown-basic">
        {{selectedPageLabel}}
        <span class="caret" *ngIf="!isPurchaseInvoice"></span>
      </button>
      <ul id="dropdown1-basic" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-basic">
        <ng-container *ngFor="let item of pageList">
          <li role="menuitem" (click)="pageChanged(item.value, item.additional.label)"
              *ngIf="item.label !== 'Purchase'">
            <a class="dropdown-item cp">{{ item.additional?.label }}</a>
          </li>
        </ng-container>
      </ul>
    </div>
    <!-- <label>Select Type</label> -->
    <!-- <sales-sh-select [width]="'150px'" [showLabelOnly]="true" [showClear]="false" [options]="pageList" [placeholder]="'Select Invoice Type'" (selected)="pageChanged()" name="selectedPage" [(ngModel)]="selectedPage"></sales-sh-select> -->

  </div>
</div>
<form #invoiceForm="ngForm" (ngSubmit)="onSubmitInvoiceForm(invoiceForm)" novalidate autocomplete="off">
  <div class="clearfix mrB1">
    <div class="clearfix pdT2">
      <div class="col-xs-9">
        <div class="flex-row">
          <div class="flex-row-child" [hidden]="isPurchaseInvoice">
            <div class="form-group noMarg">
              <label>Customers Name {{invFormData.voucherDetails.customerName}}</label>
              <!-- [useInBuiltFilterForIOptionTypeItems]="true" -->
              <!--  -->
              <sales-sh-select style="width: 280px;" name="voucherDetails.customerName"
                               [options]="customerAcList$ | async" [(ngModel)]="invFormData.voucherDetails.customerName"
                               [customFilter]="customMoveGroupFilter" (noOptionsFound)="noResultsForCustomer($event)"
                               (selected)="onSelectCustomer($event)" [placeholder]="'Select Customer'"
                               [notFoundLink]="true" [doNotReset]="true" [forceClearReactive]="forceClear$ | async"
                               [isFilterEnabled]="true" (noResultsClicked)="toggleAccountAsidePane($event)"
                               [multiple]="false" [ItemHeight]="67" [notFoundLinkText]="'Add Customer'" (keydown.enter)="enterPress($even)"
                               (keyup)="resetCustomerName($event)" [salesShSelectPading]="30">
                <ng-template #optionTemplate let-option="option">
                  <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                    <div class="item">{{ option.label }}</div>
                    <div class="item_unq">{{ option.value }}</div>
                  </a>
                </ng-template>
                <ng-template #notFoundLinkTemplate>
                  <a href="javascript:void(0)" class="list-item"
                     [keyboardShortcut]="'alt+c'" (onShortcutPress)="toggleAccountAsidePane()"
                     style="border-bottom: 1px solid #ccc;display: flex;justify-content: space-between;">
                    <div class="item">Add Customer</div>
                    <div class="item">Alt+C</div>
                  </a>
                </ng-template>
              </sales-sh-select>
            </div>
          </div>

          <div class="flex-row-child" [hidden]="!isPurchaseInvoice">
            <div class="form-group noMarg">
              <label>Vendor Name</label>
              <!-- [useInBuiltFilterForIOptionTypeItems]="true" -->
              <!--  -->
              <sales-sh-select style="width: 280px;" name="voucherDetails.customerName"
                               [options]="customerAcList$ | async" [(ngModel)]="invFormData.voucherDetails.customerName"
                               [customFilter]="customMoveGroupFilter" (noOptionsFound)="noResultsForCustomer($event)"
                               (selected)="onSelectCustomer($event)" [placeholder]="'Select Vendor'"
                               [notFoundLink]="true" [doNotReset]="true" [forceClearReactive]="forceClear$ | async"
                               [isFilterEnabled]="true" (noResultsClicked)="toggleAccountAsidePane($event)"
                               [multiple]="false" [ItemHeight]="67" [notFoundLinkText]="'Add Vendor'"
                               (keyup)="resetCustomerName($event)" [salesShSelectPading]="30">
                <ng-template #optionTemplate let-option="option">
                  <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                    <div class="item">{{ option.label }}</div>
                    <div class="item_unq">{{ option.value }}</div>
                  </a>
                </ng-template>
              </sales-sh-select>
            </div>
          </div>


                    <!-- <div class="flex-row-child mrL1 mrT2">
            Or
          </div> -->
                    <div class="flex-row-child  mrL2">
                        <!--*ngIf="typeaheadNoResultsOfCustomer"-->
                        <!-- <div class="form-group noMarg">
                            <label>Add Entry Against</label>
                            <sh-select name="accountDetails.uniqueName" [options]="bankAccounts$ | async" [(ngModel)]="invFormData.accountDetails.uniqueName" (selected)="onSelectBankCash($event)" [placeholder]="'Cash Account'" [notFoundLink]="false" [forceClearReactive]="forceClear$ | async"
                                [multiple]="false" [ItemHeight]="33" [useInBuiltFilterForIOptionTypeItems]="true">
                                <ng-template #optionTemplate1 let-option="option">
                                    <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                                        <div class="item">{{ option.label }}</div>
                                        <div class="item_unq">{{ option.value }}</div>
                                    </a>
                                </ng-template>
                            </sh-select>
                        </div> -->

                        <div *ngIf="!hideCheckBox || !invFormData.voucherDetails.customerName" class="form-group noMarg mt-2">
                            <input type="checkbox"  [(ngModel)]="updateAccount" name="checkBoxvalue" [value]="updateAccount" (change)="openToggleAccountAsidePane()"/> Maintain customer account/ledger
                        </div>
                    </div>
                    <!-- <div class="flex-row-child mrL3">
                <div class="form-group noMarg">
                    <label>Email Id</label>
                    <input type="email" placeholder="someone@example.com" name="accountDetails.email" class="form-control" [(ngModel)]="invFormData.accountDetails.email" />
                </div>
                </div> -->
                    <!-- <div class="flex-row-child mrL3">
                <div class="form-group noMarg">
                    <label>Mobile No.</label>
                    <input digitsOnlyDirective placeholder="9198XXXXXXXX" type="text" name="accountDetails.mobileNumber" class="form-control" [(ngModel)]="invFormData.accountDetails.mobileNumber" />
                </div>
                </div> -->
                </div>
            </div>
            <div class="col-xs-3 text-right" *ngIf="invFormData.voucherDetails.customerName">
                <p *ngIf="toggleFieldForSales" class="fs20 b">
                    <span class="balance-due">Balance Due: </span>
                    <span class="sp-rupees">Rs {{invFormData.voucherDetails.balanceDue | number:'1.2-2'}}</span>
                </p>
          <!-- <div class="flex-row-child mrL1 mrT2">
  Or
</div> -->
          <!-- <div class="flex-row-child  mrL2" *ngIf="!isCustomerSelected">
            *ngIf="typeaheadNoResultsOfCustomer"
            <div class="form-group noMarg">
              <label>Add Entry Against</label>
              <sh-select name="accountDetails.uniqueName" [options]="bankAccounts$ | async"
                         [(ngModel)]="invFormData.accountDetails.uniqueName" (selected)="onSelectBankCash($event)"
                         [placeholder]="'Cash Account'" [notFoundLink]="false"
                         [forceClearReactive]="forceClear$ | async"
                         [multiple]="false" [ItemHeight]="33" [useInBuiltFilterForIOptionTypeItems]="true">
                <ng-template #optionTemplate1 let-option="option">
                  <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                    <div class="item">{{ option.label }}</div>
                    <div class="item_unq">{{ option.value }}</div>
                  </a>
                </ng-template>
              </sh-select>
            </div>
          </div> -->
          <!-- <div class="flex-row-child mrL3">
      <div class="form-group noMarg">
          <label>Email Id</label>
          <input type="email" placeholder="someone@example.com" name="accountDetails.email" class="form-control" [(ngModel)]="invFormData.accountDetails.email" />
      </div>
      </div> -->
          <!-- <div class="flex-row-child mrL3">
      <div class="form-group noMarg">
          <label>Mobile No.</label>
          <input digitsOnlyDirective placeholder="9198XXXXXXXX" type="text" name="accountDetails.mobileNumber" class="form-control" [(ngModel)]="invFormData.accountDetails.mobileNumber" />
      </div>
      </div> -->
        </div>
      </div>
      <!-- <div class="col-xs-3 text-right" *ngIf="invFormData.voucherDetails.customerName">
        <p *ngIf="toggleFieldForSales" class="fs20 b">
          <span class="balance-due">Balance Due: </span>
          <span class="sp-rupees">Rs {{invFormData.voucherDetails.balanceDue | number:'1.2-2'}}</span>
        </p>
      </div> -->
    </div>
    <div class="col-xs-12 mrT1">
      <div class="bdrB"></div>
    </div>
  
  <img src="assets/images/new/search_customer.svg" class="img-responsive tip_img"
       *ngIf="!invFormData.voucherDetails.customerName"/>

  <ng-container *ngIf="invFormData.voucherDetails.customerName">
    <section class="form-inline col-xs-12 mrB1">
      <div class="collapse-pane clearfix">
        <!-- <div class="collapse-pane-heading" (click)="isGenDtlCollapsed = !isGenDtlCollapsed">
        <div class="ico-box-wrap">
            <div class="ico-box">
                <span [ngClass]="isGenDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
            </div>
        </div>
        <div class="ico-head">General Details</div>
        </div> -->
        <div class="clearfix pdR3 container mr0">
          <!--[collapse]="isGenDtlCollapsed" -->
          <div class="row">
            <div class="form-group pl0 m-r-15">
              <!--col-xs-3 -->
              <label>Attention to</label>
              <input type="text" name="accountDetails.attention" placeholder="Attention to"
                     class="form-control attentionTo" [(ngModel)]="invFormData.accountDetails.attentionTo"/>
            </div>
            <div class="form-group m-r-15">
              <!--col-xs-2-->
              <label>Email Id</label>
              <input type="email" placeholder="someone@example.com" name="accountDetails.email"
                     class="form-control attentionTo" [(ngModel)]="invFormData.accountDetails.email"/>
            </div>
            <div class="form-group m-r-15">
              <label>Mobile No.</label>
              <input digitsOnlyDirective placeholder="9198XXXXXXXX" type="text" name="accountDetails.mobileNumber"
                     class="form-control" [(ngModel)]="invFormData.accountDetails.mobileNumber"/>
            </div>
            <!-- <div class="form-group col-xs-2">
        <label>Country</label>
        <ng-select class="splSales" name="country" [options]="countrySource" [(ngModel)]="invFormData.accountDetails.country.countryName"></ng-select>
        </div>
        <div class="form-group col-xs-2">
        <label>Date</label>
        <input type="text" [placeholder]="giddhDateFormat" name="voucherDate" class="form-control" bsDatepicker [(ngModel)]="invFormData.voucherDetails.voucherDate" [bsConfig]="{ dateInputFormat: giddhDateFormat }">
        </div>
        <div class="form-group col-xs-2" *ngIf="toggleFieldForSales">
        <label>Due Date</label>
        <input type="text" [placeholder]="giddhDateFormat" name="dueDate" class="form-control" bsDatepicker [(ngModel)]="invFormData.voucherDetails.dueDate" [bsConfig]="{ dateInputFormat: giddhDateFormat }" />
        </div> -->
          </div>
          <div class="row mt10">
            <div class="form-group pl0 m-r-15">
              <!--col-xs-3 -->
              <label> {{ !isPurchaseInvoice ? 'Invoice No.' : 'Purchase Invoice No.' }}</label>
              <input type="text" name="accountDetails.invoiceNum" class="form-control"
                     [ngClass]="{'dateinvoice': !isPurchaseInvoice }"
                     [(ngModel)]="invFormData.voucherDetails.voucherNumber"/>
            </div>
            <div class="form-group m-r-15">
              <!--col-xs-2-->
              <label>Invoice Date</label>
              <input type="text" [placeholder]="giddhDateFormat" #voucherDate="ngModel" name="voucherDate"
                     class="form-control dateinvoice" bsDatepicker [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                     [(ngModel)]="invFormData.voucherDetails.voucherDate"
                     [class.invalid-inp]="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)"
              />
              <p class="text-danger" *ngIf="voucherDate.errors && (voucherDate.dirty || voucherDate.touched)">Invalid
                Date</p>
            </div>
            <div class="form-group m-r-15" *ngIf="isSalesInvoice || isPurchaseInvoice">
              <label> {{isPurchaseInvoice ? 'Bill Due Date' : 'Due Date'}}</label>
              <input type="text" [placeholder]="giddhDateFormat" #dueDate="ngModel" name="dueDate"
                     class="form-control dateinvoice" bsDatepicker [bsConfig]="{ dateInputFormat: giddhDateFormat }"
                     [(ngModel)]="invFormData.voucherDetails.dueDate"
                     [class.invalid-inp]="dueDate.errors && (dueDate.dirty || dueDate.touched)"
              />
              <p class="text-danger" *ngIf="dueDate.errors && (dueDate.dirty || dueDate.touched)">Invalid Date</p>
            </div>


            <!-- <div class="pull-right">
                <label class="upload_div" [ngClass]="{hide:blankLedger?.generateInvoice || blankLedger?.attachedFile}">
<input type="file" name="invoiceFile" id="invoiceFile" [options]="fileUploadOptions" ngFileSelect [uploadInput]="uploadInput"
  (uploadOutput)="onUploadOutput($event)">
<label for="invoiceFile" class="cp fs16">
  <i class="glyphicon glyphicon-paperclip"></i> Attach file</label>
                </label>
            </div> -->

            <!-- <div class="form-group col-xs-2">
        <label>Country</label>
        <ng-select class="splSales" name="country" [options]="countrySource" [(ngModel)]="invFormData.accountDetails.country.countryName"></ng-select>
        </div>
        <div class="form-group col-xs-2">
        <label>Date</label>
        <input type="text" [placeholder]="giddhDateFormat" name="voucherDate" class="form-control" bsDatepicker [(ngModel)]="invFormData.voucherDetails.voucherDate" [bsConfig]="{ dateInputFormat: giddhDateFormat }">
        </div>
        <div class="form-group col-xs-2" *ngIf="toggleFieldForSales">
        <label>Due Date</label>
        <input type="text" [placeholder]="giddhDateFormat" name="dueDate" class="form-control" bsDatepicker [(ngModel)]="invFormData.voucherDetails.dueDate" [bsConfig]="{ dateInputFormat: giddhDateFormat }" />
        </div> -->
          </div>
        </div>
      </div>
      <!-- end general details collapse pane -->
      <div class="collapse-pane clearfix">
        <!-- <div class="collapse-pane-heading" (click)="isMlngAddrCollapsed = !isMlngAddrCollapsed">
        <div class="ico-box-wrap">
            <div class="ico-box">
                <span [ngClass]="isMlngAddrCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
            </div>
        </div>
        <div class="ico-head">Address</div>
        </div> -->
        <div class="clearfix pdL3 pdR3 container mr0">
          <!--[collapse]="isMlngAddrCollapsed"-->
          <div class="row">
            <div class="">
              <div class="col-xs-4 pl0">
                <div class="row mt15">
                  <div class="form-group">
                    <label>Billing Address</label>
                    <div class="billing-address clearfix">
                      <textarea name="billingDetails.address" (keyup)="autoFillShippingDetails()" class="form-control"
                                [(ngModel)]="invFormData.accountDetails.billingDetails.address[0]" rows="3"></textarea>
                      <div class="">
                        <div class="col-sm-4 pd mrB1">
                          <!-- <label>Country</label> -->
                          <sales-sh-select [placeholder]="'Country'" [showBottomBorderOnly]="true" [width]="'100%'"
                                           class="select-bdr-bottom" [options]="countrySource" name="billlingCountry"
                                           [(ngModel)]="invFormData.accountDetails.country.countryName"></sales-sh-select>
                          <!-- <ng-select class="splSales" name="country" [options]="countrySource" [(ngModel)]="invFormData.accountDetails.country.countryName"></ng-select> -->
                        </div>
                        <div class="col-sm-4 pd mrB1">
                          <!-- <label>State</label> -->
                          <sales-sh-select [placeholder]="'State'" class="select-bdr-bottom"
                                           (selected)="autoFillShippingDetails()" #statesBilling
                                           [showBottomBorderOnly]="true" [options]="statesSource$ | async"
                                           name="billingDetails.stateCode"
                                           [(ngModel)]="invFormData.accountDetails.billingDetails.stateCode"></sales-sh-select>
                          <!-- <ng-select (selected)="autoFillShippingDetails()" #statesBilling class="splSales" name="billingDetails.stateCode" [options]="statesSource$ | async"
      [(ngModel)]="invFormData.accountDetails.billingDetails.stateCode"></ng-select> -->
                        </div>
                        <div class="col-sm-4 pd mrB1">
                          <!-- <label>GSTIN</label> -->
                          <input maxLength="15" type="text" name="billingDetails.gstNumber"
                                 class="form-control input-custom"
                                 [(ngModel)]="invFormData.accountDetails.billingDetails.gstNumber"
                                 (keyup)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()"
                                 placeholder="GSTIN"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- <div class="form-group col-xs-4" *ngIf="invFormData.accountDetails.country.countryName === 'India'">
              <div>
                  <label>State</label>
                  <ng-select (selected)="autoFillShippingDetails()" #statesBilling class="splSales" name="billingDetails.stateCode" [options]="statesSource$ | async" [(ngModel)]="invFormData.accountDetails.billingDetails.stateCode"></ng-select>
              </div>
              <div class="mrT2">
                  <label>GSTIN</label>
                  <input maxLength="15" type="text" name="billingDetails.gstNumber" class="form-control" [(ngModel)]="invFormData.accountDetails.billingDetails.gstNumber" (keyup)="getStateCode('billingDetails', statesBilling); autoFillShippingDetails()" />
              </div>
              </div> -->
                </div>
              </div>
              <div class="col-xs-4 mrL2">
                <div class="row mt15">
                  <div class="form-group p0 width100">
                    <label>
                      <input type="checkbox" (change)="autoFillShippingDetails()" name="autoFillShipping"
                             [attr.checked]="true"
                             [(ngModel)]="autoFillShipping"> Shipping Address Same as Billing Address</label>
                    <div class="billing-address" [ngClass]="{'disabled': autoFillShipping}">
                      <textarea [readonly]="autoFillShipping" name="shippingDetails.address" class="form-control"
                                [(ngModel)]="invFormData.accountDetails.shippingDetails.address[0]" rows="3"></textarea>
                      <div class="">
                        <div class="form-group">
                          <div class="col-sm-4 pd mrB1">
                            <div class="form-group">
                              <!-- <label>Country</label> -->
                              <!-- <ng-select class="splSales" name="country" [options]="countrySource" [(ngModel)]="invFormData.accountDetails.country.countryName"></ng-select> -->
                              <sales-sh-select [disabled]="autoFillShipping" [placeholder]="'Country'"
                                               [showBottomBorderOnly]="true" [width]="'100%'" class="select-bdr-bottom"
                                               [options]="countrySource" name="country"
                                               [(ngModel)]="invFormData.accountDetails.country.countryName"></sales-sh-select>
                            </div>
                          </div>
                          <div class="col-sm-4 pd mrB1">
                            <!-- <label>State</label> -->
                            <!-- <ng-select [disabled]="autoFillShipping" #statesShipping class="splSales" name="shippingDetails.stateCode" [options]="statesSource$ | async" [(ngModel)]="invFormData.accountDetails.shippingDetails.stateCode"></ng-select> -->
                            <!-- (selected)="autoFillShippingDetails()" -->
                            <sales-sh-select [disabled]="autoFillShipping" [placeholder]="'State'"
                                             class="select-bdr-bottom" #statesShipping [showBottomBorderOnly]="true"
                                             [options]="statesSource$ | async" name="shippingDetails.stateCode"
                                             [(ngModel)]="invFormData.accountDetails.shippingDetails.stateCode"></sales-sh-select>
                          </div>
                          <div class="col-sm-4 pd mrB1">
                            <!-- <label>GSTIN</label> -->
                            <input [readonly]="autoFillShipping" maxLength="15" type="text"
                                   name="shippingDetails.gstNumber" class="form-control input-custom"
                                   [(ngModel)]="invFormData.accountDetails.shippingDetails.gstNumber"
                                   (keyup)="getStateCode('shippingDetails', statesShipping)"
                                   placeholder="GSTIN"/>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- <div class="form-group col-xs-4" *ngIf="invFormData.accountDetails.country.countryName === 'India'">
              <div>
                  <label>State</label>
                  <ng-select [disabled]="autoFillShipping" #statesShipping class="splSales" name="shippingDetails.stateCode" [options]="statesSource$ | async" [(ngModel)]="invFormData.accountDetails.shippingDetails.stateCode"></ng-select>
              </div>
              <div class="mrT2">
                  <label>GSTIN</label>
                  <input [readonly]="autoFillShipping" maxLength="15" type="text" name="shippingDetails.gstNumber" class="form-control" [(ngModel)]="invFormData.accountDetails.shippingDetails.gstNumber" (keyup)="getStateCode('shippingDetails', statesShipping)" />
              </div>
              </div> -->
                </div>
              </div>
            </div>
          </div>
          <!-- end row -->
        </div>
      </div>
      <!-- end mailing address collapse pane -->
      <!-- end other details collapse pane -->
    </section>
    <section class="clearfix mrB2 whiteBg container-fluid">
      <table class="table table-custom-invoice basic mrT2">
        <thead>
        <tr>
          <th *ngFor="let item of theadArr;" [hidden]="!item.display" attr.data-field="{{item.label}}">{{item.label}}
          </th>
          <th class="nested-table-wrap">
            <table width="100%" class="nested-table" cellspacing="0" cellspadding="0">
              <thead>
              <tr>
                <th width="25%" *ngFor="let item of theadArrOpt;" attr.data-field="{{item.label}}">{{item.label}}</th>
              </tr>
              </thead>
            </table>
          </th>
          <th *ngFor="let item of theadArrReadOnly;" attr.data-field="{{item.label}}" [hidden]="!item.display">
            {{item.label}}
          </th>
        </tr>
        </thead>
        <tbody *ngFor="let entry of invFormData.entries; let entryIdx = index; let first = first; let last = last">
        <ng-container *ngFor="let transaction of entry.transactions;">
          <tr [hidden]="activeIndx !== entryIdx" class="row-active">
            <td>{{ entryIdx + 1 }}</td>
            <td style="min-width: 115px;width: 115px">
              <input type="text" [placeholder]="giddhDateFormat" bsDatepicker name="transaction.date_{{entryIdx}}"
                     class="form-control text-left" [(ngModel)]="entry.entryDate"
                     [bsConfig]="{ dateInputFormat: giddhDateFormat }"/>
            </td>
            <td style="min-width:215px">
              <div class="ng-select-wrap">
                <sh-select [options]="salesAccounts$ | async" [(ngModel)]="transaction.fakeAccForSelect2"
                           name="transaction.fakeAccForSelect2_{{entryIdx}}"
                           (selected)="onSelectSalesAccount($event,transaction,entryIdx, entry)"
                           [placeholder]="'Select A/c'" [notFoundLink]="true"
                           [forceClearReactive]="forceClear$ | async" (noResultsClicked)="onNoResultsClicked(entryIdx)"
                           [multiple]="false" [ItemHeight]="67" [useInBuiltFilterForFlattenAc]="true">

                  <ng-template #optionTemplate let-option="option">
                    <ng-container *ngIf="!option.additional?.stock">
                      <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                        <div class="item">{{ option.label }}</div>
                        <div class="item_unq">{{ option.additional?.uniqueName }}</div>
                      </a>
                    </ng-container>
                    <ng-container *ngIf="option.additional?.stock">
                      <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                        <div class="item">{{ option.label }}</div>
                        <div class="item_unq">{{ option.additional?.uniqueName }}</div>
                        <div class="item_stock">Stock: {{ option.additional?.stock.uniqueName }}</div>
                      </a>
                    </ng-container>
                  </ng-template>
                </sh-select>
              </div>
            </td>
            <td style="min-width:220px">
              <input type="text" placeholder="Description" name="transaction.description_{{entryIdx}}"
                     class="form-control" [(ngModel)]="transaction.description"/>
            </td>
            <td style="width:102px">
              <div class="">
                <input type="text" [hidden]="transaction.hsnOrSac !== 'hsn'" maxLength="10" placeholder="HSN/SAC"
                       name="transaction.hsnNumber_{{entryIdx}}" class="form-control text-right"
                       [(ngModel)]="transaction.hsnNumber"/>
                <input type="text" [hidden]="transaction.hsnOrSac !== 'sac'" maxLength="10" placeholder="HSN/SAC"
                       name="transaction.sacNumber_{{entryIdx}}" class="form-control text-right"
                       [(ngModel)]="transaction.sacNumber"/>
              </div>
            </td>
            <!-- show/hide fields -->
            <td class="nested-table-wrap" [style.width.px]="300">
              <table width="100%" cellspacing="0" cellspadding="0">
                <tbody>
                <tr>
                  <td *ngIf="transaction.isStockTxn">
                    <table class="nested-table" width="100%" cellspacing="0" cellspadding="0">
                      <tbody>
                      <tr>
                        <td width="25%" [style.padding.px]="0">
                          <input type="number" (keyup)="txnChangeOccurred()"
                                 (ngModelChange)="transaction.setAmount(entry)" placeholder="Quantity"
                                 name="transaction.quantity_{{entryIdx}}" class="form-control text-right"
                                 [(ngModel)]="transaction.quantity"/>
                        </td>
                        <td width="25%">
                          <select class="form-control" name="transaction.stockUnit_{{entryIdx}}"
                                  [(ngModel)]="transaction.stockUnit"
                                  (ngModelChange)="onChangeUnit(transaction, $event);transaction.setAmount(entry)">
                            <option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">{{stock.text}}
                            </option>
                          </select>
                        </td>
                        <td width="25%" [style.padding.px]="0">
                          <input type="number" (ngModelChange)="transaction.setAmount(entry)"
                                 (keyup)="txnChangeOccurred()" placeholder="Rate" name="transaction.rate_{{entryIdx}}"
                                 class="form-control text-right" [(ngModel)]="transaction.rate"/>
                        </td>
                        <!-- <td width="25%">
                <input type="number" disabled="true" name="transaction.amount_{{entryIdx}}" class="form-control text-right" [(ngModel)]="transaction.amount" />
            </td> -->
                      </tr>
                      </tbody>
                    </table>
                  </td>
                  <td *ngIf="!transaction.isStockTxn">
                    <table class="nested-table" width="100%" cellspacing="0" cellspadding="0">
                      <tbody>
                      <tr>
                        <td width="25%" [style.padding.px]="0">
                          <input type="text" disabled="true" class="form-control text-right"/>
                        </td>
                        <td width="25%">
                          <input type="text" disabled="true" class="form-control text-right"/>
                        </td>
                        <td width="25%" [style.padding.px]="0">
                          <input type="text" disabled="true" class="form-control text-right"/>
                        </td>
                        <!-- <td width="25%">
                <input type="number" (ngModelChange)="transaction.setAmount(entry)" (keyup)="txnChangeOccurred()" placeholder="Amount" name="transaction.amount_{{entryIdx}}" class="form-control text-right" [(ngModel)]="transaction.amount" />
            </td> -->
                      </tr>
                      </tbody>
                    </table>
                  </td>
                </tr>
                </tbody>
              </table>
            </td>

            <!-- <td style="width: 120px;">
            <input type="number" (keyup)="txnChangeOccurred()" (ngModelChange)="transaction.setAmount(entry)" placeholder="Quantity" name="transaction.quantity_{{entryIdx}}" class="form-control text-right" [(ngModel)]="transaction.quantity" [disabled]="!transaction.isStockTxn"
            />
        </td>
        <td style="width: 100px;">
            <select class="form-control" name="transaction.stockUnit_{{entryIdx}}" [(ngModel)]="transaction.stockUnit" [disabled]="!transaction.isStockTxn">
<option *ngFor="let stock of transaction.stockList" [ngValue]="stock.id">{{stock.text}}</option>
</select>
        </td>
        <td style="width: 100px;">
            <input type="number" (ngModelChange)="transaction.setAmount(entry)" (keyup)="txnChangeOccurred()" placeholder="Rate" name="transaction.rate_{{entryIdx}}" class="form-control text-right" [(ngModel)]="transaction.rate" [disabled]="!transaction.isStockTxn"
            />
        </td>
            -->
            <td style="width: 110px;">
              <input type="text" [disabled]="transaction.isStockTxn" (ngModelChange)="transaction.setAmount(entry)"
                     (keyup)="txnChangeOccurred()" placeholder="Amount"
                     name="transaction.amount_{{entryIdx}}"
                     class="form-control text-right" [(ngModel)]="transaction.amount"
                     decimalDigitsDirective [DecimalPlaces]="2"/>
              <!-- <input type="number"  name="transaction.amount_{{entryIdx}}" class="form-control text-right" [(ngModel)]="transaction.amount" /> -->
            </td>
            <td style="width: 100px">
              <discount-list
                #discountComponent
                [isMenuOpen]="false"
                [discountAccountsDetails]="entry.discounts"
                (discountTotalUpdated)="entry.discountSum = $event; selectedDiscountEvent(transaction, entry)"
                [totalAmount]="transaction.amount"></discount-list>
            </td>
            <!-- <td>
            <input type="number" name="transaction.taxableValue_{{entryIdx}}" class="form-control text-right" readonly [(ngModel)]="transaction.taxableValue" />
        </td> -->
            <td class="tax-list-dd-wrap dropdown-container" style="width: 100px">
              <sales-tax-list class="salesTax" [showTaxPopup]="false"
                              [applicableTaxes]="stockTaxList.length ? stockTaxList : transaction.applicableTaxes"
                              (selectedTaxEvent)="selectedTaxEvent($event)"
                              (closeOtherPopupEvent)="closeDiscountPopup()"
                              (taxAmountSumEvent)="taxAmountEvent($event, transaction, entry)">
              </sales-tax-list>
            </td>
            <td style="width: 120px;">
              <input type="text" name="transaction.total_{{entryIdx}}" class="form-control text-right"
                     [(ngModel)]="transaction.total" readonly
                     decimalDigitsDirective [DecimalPlaces]="2"/>
            </td>
            <td class="action-panel-td text-center">
                                <span class="cp" *ngIf="last" (click)="addBlankRow(transaction)">
                  <i class="icon-add" aria-hidden="true"></i>
                </span>
              <span class="cp" (click)="removeTransaction(entryIdx)">
                  <i class="icon-trash" aria-hidden="true"></i>
                </span>
            </td>
          </tr>
          <tr (click)="setActiveIndx(entryIdx)" [hidden]="activeIndx === entryIdx">
            <td>{{ entryIdx + 1 }}</td>
            <td style="min-width: 115px;width: 115px">{{moment(entry.entryDate).format(GIDDH_DATE_FORMAT)}}</td>
            <td style="min-width:215px">{{transaction.accountName}}
              <span *ngIf="transaction.stockDetails?.uniqueName">({{transaction.stockDetails?.name}})</span>
            </td>
            <td style="min-width:220px">{{transaction.description}}</td>
            <td style="width:102px">
              <span [hidden]="transaction.hsnOrSac !== 'hsn'">{{transaction.hsnNumber}}</span>
              <span [hidden]="transaction.hsnOrSac !== 'sac'">{{transaction.sacNumber}}</span>
            </td>
            <td style="width: 300px;">
              <table class="nested-table" width="100%" cellspacing="0" cellspadding="0">
                <tbody>
                <tr>
                  <td width="25%" [style.padding.px]="0" class="text-right">
                    {{transaction.quantity}}
                    <!-- <input type="text" disabled="true" class="form-control text-right" /> -->
                  </td>
                  <td width="25%" class="text-right">
                    {{transaction.stockUnit}}
                    <!-- <input type="text" disabled="true" class="form-control text-right" /> -->
                  </td>
                  <td width="25%" [style.padding.px]="0" class="text-right">
                    {{transaction.rate}}
                    <!-- <input type="text" disabled="true" class="form-control text-right" /> -->
                  </td>
                </tr>
                </tbody>
              </table>
            </td>
            <td class="text-right" style="width: 110px;">{{transaction.amount | number:'1.2-2'}}</td>
            <td class="text-right" style="width: 120px;">
              <!-- <span *ngFor="let discount of entry.discounts; let disIndx = index">
<span *ngIf="discount.amount">{{discount.amount}}
<span *ngIf="disIndx != (entry.discounts?.length -1)"> +</span>
</span>
</span> -->
              <!-- {{ transaction.discountSum }} -->
              {{ entry.discountSum }}
            </td>
            <!-- <td>{{transaction.taxableValue}}</td> -->
            <!-- <td class="text-right">{{transaction.taxSum}}</td> -->
            <td class="text-right">{{entry.taxSum}}%</td>
            <td class="text-right">{{transaction.total | number:'1.2-2'}}</td>
            <td class="text-center">
                                <span class="cp" (click)="removeTransaction(entryIdx)">
                  <i class="icon-trash" aria-hidden="true"></i>
                </span>
            </td>
          </tr>
        </ng-container>

                </tbody>
            </table>
            <!-- sub total and total calc -->
            <table class="table">
                <tbody>
                    <tr>
                        <td width="50%">
                            <div class="">
                                <div class="collapse-pane clearfix">
                                    <div class="collapse-pane-heading" (click)="isOthrDtlCollapsed = !isOthrDtlCollapsed">
                                        <div class="ico-box-wrap">
                                            <div class="ico-box">
                                                <span [ngClass]="isOthrDtlCollapsed ? 'icon-add' : 'icon-minus'" aria-hidden="true"></span>
                                            </div>
                                        </div>
                                        <div class="ico-head">Other Details</div>
                                    </div>
                                    <div [collapse]="isOthrDtlCollapsed" class="clearfix max-600 pdL3 mr0">
                                        <div class="row">
                                            <div class="form-group col-xs-4">
                                                <!-- <label>Ship Date</label> -->
                                                <input type="text" #shippingDate="ngModel" [placeholder]="giddhDateFormat" bsDatepicker name="shippingDate" [(ngModel)]="invFormData.templateDetails.other.shippingDate" class="form-control" [bsConfig]="{ dateInputFormat: giddhDateFormat }" placeholder="Ship Date"
                                                    [class.invalid-inp]="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)" />
                                                <p class="text-danger" *ngIf="shippingDate.errors && (shippingDate.dirty || shippingDate.touched)">Invalid Date</p>
                                                <!--[placeholder]="giddhDateFormat"-->
                                            </div>
                                            <div class="form-group col-xs-4">
                                                <!-- <label>Ship Via</label> -->
                                                <input type="text" name="shippedVia" [(ngModel)]="invFormData.templateDetails.other.shippedVia" class="form-control" placeholder="Ship Via" />
                                            </div>
                                            <div class="form-group col-xs-4">
                                                <!-- <label>Tracking No.</label> -->
                                                <input type="text" name="trackingNumber" [(ngModel)]="invFormData.templateDetails.other.trackingNumber" class="form-control" placeholder="Tracking No." />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group col-xs-4">
                                                <!-- <label>Field 1</label> -->
                                                <input type="text" name="customField1" [(ngModel)]="invFormData.templateDetails.other.customField1" class="form-control" placeholder="Field 1" />
                                            </div>
                                            <div class="form-group col-xs-4">
                                                <!-- <label>Field 2</label> -->
                                                <input type="text" name="customField2" [(ngModel)]="invFormData.templateDetails.other.customField2" class="form-control" placeholder="Field 2" />
                                            </div>
                                            <div class="form-group col-xs-4">
                                                <!-- <label>Field 3</label> -->
                                                <input type="text" name="customField3" [(ngModel)]="invFormData.templateDetails.other.customField3" class="form-control" placeholder="Field 3" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="pdT1 pl0 max-600" *ngIf="!isPurchaseInvoice">
                                <label class="mrB1">Note</label>
                                <textarea style="height:120px" class="form-control" name="message2" [(ngModel)]="invFormData.templateDetails.other.message2"></textarea>
                            </div>
                           
                            <!-- commented due to presently attachfile key is not available in request 
                            -->
                            <div class="pdT1 pl0 max-600 pos-rel" *ngIf="isPurchaseInvoice">
                                <label class="mrB1"><i class="glyphicon glyphicon-paperclip"></i> Attachment</label>
                                <label class="custom-file-label form-control cp pos-rel" for="invoiceFile"> <em *ngIf="!selectedFileName">Drag/Drop file or click here</em> <em *ngIf="selectedFileName" class="text-success">{{selectedFileName}}</em> <span class="text-success"><i class="fa fa-check" *ngIf="selectedFileName"></i></span>
                                    <input type="file" name="invoiceFile" id="invoiceFile" [options]="fileUploadOptions" ngFileSelect [uploadInput]="uploadInput" (uploadOutput)="onUploadOutput($event)" (change)="onFileChange($event.target.files)" droppable="true">
                                </label>
                            </div>
                        </td>
                        <td width="50%">
                            <section class="tableSec form-group">
                                <div class="tableRow">
                                    <div class="tableCell">Total Amount</div>
                                    <div class="tableCell figureCell">{{invFormData.voucherDetails.subTotal | number:'1.2-2'}}</div>
                                </div>
                                <div class="tableRow">
                                    <div class="tableCell">Discount</div>
                                    <div class="tableCell figureCell">-{{invFormData.voucherDetails.totalDiscount | number:'1.2-2'}}</div>
                                </div>
                                <div class="tableRow">
                                    <div class="tableCell">Taxable Value</div>
                                    <div class="tableCell figureCell">{{invFormData.voucherDetails.totalTaxableValue | number:'1.2-2'}}
                                    </div>
                                </div>
                                <div class="tableRow">
                                    <div class="tableCell">Tax</div>
                                    <div class="tableCell figureCell">{{invFormData.voucherDetails.gstTaxesTotal | number:'1.2-2'}}</div>
                                </div>
                                <div class="tableRow">
                                    <div class="tableCell">
                                        <strong>Total</strong>
                                    </div>
                                    <div class="tableCell figureCell">
                                        <strong>{{invFormData.voucherDetails.grandTotal | number:'1.2-2'}}</strong>
                                    </div>
                                </div>
                                <!-- <div class="tableRow" *ngIf="toggleFieldForSales && isCustomerSelected && !isPurchaseInvoice">
                                   (clickOutside)="dropdownisOpen=false;" [attachOutsideOnClick]="true" -->
                                    <div class="tableCell">
                                        <!-- 
                                        <div class="btn-group" dropdown #depositDropdown="bs-dropdown" [autoClose]="false">                                            
                                         -->
                                        <div class="btn-group">
                                            <!-- <button id="depositBoxTrigger" type="button" class="btn btn-default dropdown-toggle" aria-controls="deposit-dropdown" (click)="dropdownisOpen = dropdownisOpen">
                                            {{ isPurchaseInvoice ? 'Payment' :  'Deposit' }}
                                            </button> -->
                                            <!-- <ul (click)="clickedInside($event)" id="deposit-dropdown"  class="dropdown-menu form-group pd1" role="menu" aria-labelledby="button-dropup">
                                                <span class="caret"></span>
                                                <li role="menuitem">
                                                    <div class="">
                                                        <label>Amount</label>
                                                        <input type="number" (blur)="txnChangeOccurred()" placeholder="Amount" name="dueAmount" class="form-control max100" [(ngModel)]="dueAmount" />
                                                    </div>
                                                </li>
                                                <li role="menuitem" class="mrT1">
                                                    <div class="">
                                                        <label>Payment Mode</label>
                                                        <sh-select name="depositAccountUniqueName" [options]="bankAccounts$ | async" [(ngModel)]="depositAccountUniqueName" (selected)="onSelectPaymentMode($event)" [placeholder]="'Select Account'" [notFoundLink]="false" [forceClearReactive]="forceClear$ | async"
                                                            [multiple]="false" [ItemHeight]="33" [useInBuiltFilterForIOptionTypeItems]="true" class="text-left">
                                                            <ng-template #optionTemplate1 let-option="option">
                                                                <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                                                                    <div class="item">{{ option.label }}</div>
                                                                    <div class="item_unq">{{ option.value }}</div>
                                                                </a>
                                                            </ng-template>
                                                        </sh-select>
                                                    </div>
                                                </li>
                                            </ul> -->
                                        </div>
                                    </div>
                                    <!-- <div class="tableCell figureCell" (click)="dropdownisOpen = true">
                                        {{dueAmount | number:'1.2-2'}}
                                    </div>
                                </div> -->

                                <!-- <div class="tableRow" *ngIf="toggleFieldForSales">
                                    <div class="tableCell">
                                        <strong>Balance Due</strong>                                            
                                    </div>
                                    <div class="tableCell figureCell">
                                        <strong>{{invFormData.voucherDetails.balanceDue | number:'1.2-2'}}</strong>
                                    </div>

                                </div> -->
                              
                            </section>      
                            <table class="table" width="50%">
                               
                                <tr>
                                       
                                    <td >
                                    <section class="tableSec form-group deposit-box">

                                        <table >
                                            <tr>
                                                <td colspan="2"><p class="text-left ">Deposit</p></td>
                                            </tr>

                                            <tr>
                                                <td class="text-right"><label>Payment Mode</label></td>
                                                <td>
                                                    <sh-select name="accountDetails.uniqueName" [options]="bankAccounts$ | async" [(ngModel)]="invFormData.accountDetails.uniqueName" (selected)="onSelectBankCash($event)" [placeholder]="'Select account'" [notFoundLink]="false" [forceClearReactive]="forceClear$ | async"
                                                    [multiple]="false" [ItemHeight]="33" [useInBuiltFilterForIOptionTypeItems]="true"  class="text-left">
                                                        <ng-template #optionTemplate1 let-option="option">
                                                        <a href="javascript:void(0)" class="list-item" style="border-bottom: 1px solid #ccc;">
                                                    <div class="item">{{ option.label }}</div>
                                                        <div class="item_unq">{{ option.value }}</div>
                                                        </a>
                                                       </ng-template>
                                                    </sh-select>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="text-right"><label>  Amount  </label> </td>
                                                <strong *ngIf="!hideCheckBox"><label  class="text-right mr-1"> {{invFormData.voucherDetails.grandTotal | number:'1.2-2'}}</label> </strong>
                                                <td *ngIf="!hideCheckBox"></td>
                                               <td *ngIf="hideCheckBox"> 
                                                 <input  type="number" (blur)="txnChangeOccurred()" placeholder="Amount" name="dueAmount" class="form-control" [(ngModel)]="dueAmount" />
                                               </td>
                                            </tr>

                                            <tr>
                                                                                        
                                                <td class="text-right"><strong><label> Balance Due</label></strong>        </td>
                                                <strong><label class="text-right mr-1"> {{invFormData.voucherDetails.balanceDue | number:'1.2-2'}}</label> </strong>
                                                <td></td>
                                            </tr>
                                        </table>
                                        
                                        
                                      </section>
                                  </td>
                               </tr>
                            </table>
                            
                        </td>
                    </tr>
                </tbody>
            </table>
            <!-- end -->
        </section>
        <section class="clearfix">
            <section id="actionPane" class="text-center">
                <div class="col-xs-12">
                    <div class="pull-right pr">
                        <button type="button" (click)="resetInvoiceForm(invoiceForm)" class="btn btn-danger">Clear</button>

            <span class="" *ngIf="isPurchaseInvoice">
                            <button type="button" (click)="triggerSubmitInvoiceForm(invoiceForm, true)"
                                    class="btn btn-default" *ngIf="isCustomerSelected">Save &amp; Update A/c</button>
                            <button type="button" (click)="doAction(3);triggerSubmitInvoiceForm(invoiceForm, false)"
                                    class="btn btn-default">Save</button>
                        </span>

            <span class="" *ngIf="!isPurchaseInvoice">

                            <button type="button" (click)="triggerSubmitInvoiceForm(invoiceForm, true)"
                                    class="btn btn-default" *ngIf="isCustomerSelected" [disabled]="invoiceForm.invalid">Generate {{selectedPageLabel}}
                              &amp; Update A/c</button>

                            <div class="btn-group" dropdown [dropup]="true">

                                <button type="button" (click)="doAction(3);triggerSubmitInvoiceForm(invoiceForm, false)"
                                        class="btn btn-default"
                                        [disabled]="invoiceForm.invalid">Generate {{selectedPageLabel}}</button>
                                <button id="button-split" type="button" dropdownToggle
                                        class="btn btn-default dropdown-toggle dropdown-toggle-split"
                                        aria-controls="dropdown-split" *ngIf="selectedPage === 'Sales'"
                                        [disabled]="invoiceForm.invalid">
                                            <span class="caret"></span>
                        <span class="sr-only">Split button!</span>
                        </button>
                        <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu"
                            aria-labelledby="button-basic">
                            <li role="menuitem">
                                <a class="dropdown-item cp"
                                   (click)="doAction(1);triggerSubmitInvoiceForm(invoiceForm, false)">Generate & Close</a>
                            </li>
                            <li role="menuitem" (click)="doAction(2);triggerSubmitInvoiceForm(invoiceForm, false)">
                                <a class="dropdown-item cp">Generate & Recurring</a>
                            </li>
                        </ul>
                    </div>
                    </span>

            <!-- <button type="button" (click)="triggerSubmitInvoiceForm(invoiceForm)" class="btn btn-default" [disabled]="!isCustomerSelected">Generate {{selectedPageLabel}} {{toggleActionText}}</button> -->
            <!--<button type="submit" class="btn btn-success">Generate {{selectedPageLabel}}</button>-->
          </div>
        </div>
      </section>
    </section>
  </ng-container>
</form>
<!-- open account aside -->
<div class="aside-overlay"
     *ngIf="accountAsideMenuState === 'in' || asideMenuStateForProductService === 'in' || asideMenuStateForRecurringEntry === 'in'"></div>
<aside-menu-account [class]="accountAsideMenuState" [@slideInOut]="accountAsideMenuState"
                    (closeAsideEvent)="toggleAccountAsidePane($event)"
                    [isPurchaseInvoice]="isPurchaseInvoice"
                    [keyboardShortcut]="{'esc':accountAsideMenuState ==='in'}"
                    (onShortcutPress)="toggleAccountAsidePane()"></aside-menu-account>
<!-- open product service aside -->
<aside-menu-product-service [class]="asideMenuStateForProductService" [@slideInOut]="asideMenuStateForProductService"
                            (closeAsideEvent)="onNoResultsClicked()"
                            (animatePAside)="getActionFromAside($event)"></aside-menu-product-service>
<app-aside-recurring-entry [voucherType]="selectedPage" [voucherNumber]="voucherNumber"
                           [class]="asideMenuStateForRecurringEntry" [@slideInOut]="asideMenuStateForRecurringEntry"
                           (closeAsideEvent)="toggleRecurringAsidePane('out')"></app-aside-recurring-entry>
<!-- create Group modal -->
<section *ngIf="showCreateGroupModal">
  <div bsModal #createGroupModal="bs-modal" class="modal fade" role="dialog" [keyboardShortcut]="'esc'"
       (onShortcutPress)="closeCreateGroupModal()" [config]="modalConfig">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <sales-add-group-modal (actionFired)="closeCreateGroupModal($event)"></sales-add-group-modal>
      </div>
    </div>
  </div>
</section>
<!-- create Ac modal -->
<section *ngIf="showCreateAcModal">
  <div bsModal #createAcModal="bs-modal" class="modal fade" role="dialog" [config]="modalConfig">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <create-account-modal [gType]="createAcCategory" (actionFired)="closeCreateAcModal()"></create-account-modal>
      </div>
    </div>
  </div>
</section>
