<div ng-click="$event.stopPropagation()" class="ledger-panel"
     ng-class="{'pop-panel':!popover.draggable, 'fixed-panel': ledgerCtrl.showPanel, 'top0':hideHeader}">
  <div class="wrapper">
    <div class="basic_detail" ng-if="ledgerCtrl.showTaxationDiscountBox">
      <table>
        <tbody>
        <tr *ngIf="selectedAccount">
          <td class="pItem" *ngIf="selectedAccount.stock">
            <table>
              <tbody>
              <tr>
                <td ng-class="{width55: ledgerCtrl.selectedTxn.panel.unit != undefined}">
                  <label>Quantity</label>
                  <input type="number" name="" class="form-control" ng-model="ledgerCtrl.selectedTxn.panel.quantity"
                         ng-change="ledgerCtrl.onNewPanelChange().quantity(ledgerCtrl.selectedTxn, ledgerCtrl.blankLedger)"/>
                </td>
                <td ng-if="ledgerCtrl.selectedTxn.panel.unit">
                  <label>Unit</label>
                  <select class="form-control"
                          ng-options="unit as unit.stockUnitCode for unit in ledgerCtrl.selectedTxn.panel.units"
                          ng-model="ledgerCtrl.selectedTxn.panel.unit"
                          ng-change="ledgerCtrl.onNewPanelChange().unit(ledgerCtrl.selectedTxn, ledgerCtrl.blankLedger)">
                  </select>
                </td>
              </tr>
              </tbody>
            </table>
          </td>

          <td class="pItem" *ngIf="selectedAccount.stock">
            <label>&nbsp;</label>
            <label class="pdR pdL default_clr">x</label>
          </td>
          <td style="max-width:150px" class="pItem" *ngIf="selectedAccount.stock">
            <label>Price</label>
            <input type="number" name="" class="form-control" ng-model="ledgerCtrl.selectedTxn.panel.price"
                   ng-change="ledgerCtrl.onNewPanelChange().price(ledgerCtrl.selectedTxn, ledgerCtrl.blankLedger)"/>
          </td>
          <td class="pItem" *ngIf="selectedAccount.stock">
            <label>&nbsp;</label>
            <label class="pdR pdL default_clr">=</label>
          </td>
          <td class="pItem">
            <label class="primary_color">Amount</label>
            <input type="number" name="" class="form-control" [(ngModel)]="currentTxn.amount"
                   ng-model="ledgerCtrl.selectedTxn.panel.amount" (keyup)="calculateTotal()"/>
          </td>
          <td class="pItem" ng-if="ledgerCtrl.discountAccount != undefined">
            <label>&nbsp;</label>
            <label class="pdR pdL default_clr">-</label>
          </td>

          <!--discount-->
          <td style="max-width:150px" class="pItem"
              *ngIf="(discountAccountsList$ | async)?.accountDetails.length">
            <ledger-discount (discountUpdatedEvent)="currentTxn.discounts = $event"
                             (discountTotalUpdatedEvent)="currentTxn.discount = $event;calculateTotal()">
            </ledger-discount>
          </td>

          <td class="pItem"
              ng-if="ledgerCtrl.taxList.length > 0 && ledgerCtrl.discountAccount != undefined && ledgerCtrl.discountAccount.accountDetails.length > 0">
            <label>&nbsp;</label>
            <label class="pdR pdL default_clr">+</label>
          </td>
          <td style="max-width:150px" *ngIf="(companyTaxesList$ | async)?.length">
            <!--tax control component-->
            <tax-control [taxes]="companyTaxesList$ | async"
                         [applicableTaxes]="selectedAccount?.applicableTaxes"
                         (selectedTaxesEvent)="currentTxn.taxes = $event"
                         (taxAmountSumEvent)="currentTxn.tax = $event;calculateTotal()"
                         (isApplicableTaxesEvent)="blankLedger.applyApplicableTaxes = $event">
            </tax-control>
          </td>
          <td class="pItem">
            <label>&nbsp;</label>
            <label class="pdR pdL default_clr"> = </label>
          </td>
          <td class="pItem">
            <label class="primary_color">Total</label>
            <input type="number" name="" class="form-control" [(ngModel)]="currentTxn.total"
                   (keyup)="calculateAmount()"/>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="row pd1 inWords">
      <div class="col-xs-12">
        {{ currentTxn.total | myNumberToWordsPipe }}
      </div>
    </div>

    <div class="row">
      <div class="col-xs-12">
        <textarea rows="4" cols="" class="form-control" placeholder="Description"
                  [(ngModel)]="blankLedger.description"></textarea>
      </div>
    </div>

    <div class="col-xs-12 mrT mrB">
      <div class="row">
        <div class="cheq col-xs-6 pdT" *ngIf="showAdvanced">
          <div class="row">
            <table>
              <tbody>
              <tr>
                <td class="pdR">
                  <label class="default_clr">Cheque Number</label>
                  <input type="text" placeholder="XXXX2619" class="form-control"
                         [(ngModel)]="blankLedger.chequeNumber"/>
                </td>
                <td>
                  <label class="default_clr">Cheque Date</label>
                  <input type="text" [textMask]="{mask: dateMask, pipe: datePipe}" class="form-control"
                         [(ngModel)]="blankLedger.chequeClearanceDate"/>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="file_attached col-xs-5 pull-right text-right"
             *ngIf="blankLedger.attachedFile.length > 0">
          <div class="row">
            <span ng-bind="ledgerCtrl.selectedLedger.attachedFileName"></span>
            <label class="remove cp mrL1" *ngIf="false"
                   ng-click="ledgerCtrl.deleteAttachedFile()">(remove)</label>
          </div>
        </div>
      </div>
    </div>
    <!--map bank transactions-->

    <div class="row">
      <div class="col-xs-7 form-group pr" *ngIf="false" ng-if="ledgerCtrl.selectedLedger.isBankTransaction">
        <a href="javascript:void(0)" ng-click="ledgerCtrl.matchBankTransaction()">Map Transaction
          <span ng-if="ledgerCtrl.showMatchingEntries">with</span>
        </a>
        <ul class="list-unstyled map-txn-container" ng-if="ledgerCtrl.showMatchingEntries">
          <li class="cp" ng-repeat="entry in ledgerCtrl.matchingEntries">
            <table class="table table-bordered mr0">
              <tbody>
              <tr ng-repeat="txn in entry.transactions"
                  ng-click="ledgerCtrl.confirmBankTransactionMap(entry, ledgerCtrl.selectedLedger)">
                <td>{{""}}</td>
                <td>{{""}}</td>
                <td>{{""}}</td>
                <td>{{""}}</td>
              </tr>
              </tbody>
            </table>
          </li>
        </ul>
      </div>
    </div>

    <div class="row bdrB pdB1 mrB1" *ngIf="showAdvanced">
      <div class="col-xs-12 pdT">
        <table>
          <tr>
            <td class="pdR1"><label class="default_clr pull-left">Voucher type</label></td>
            <td colspan="4">
              <select2 [(ngModel)]="blankLedger.voucherType" [data]="voucherTypeList | async"
                       [options]="voucherDropDownOptions"></select2>
            </td>
            <td class="pdL1">
              <span>{{""}}</span>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="row">
      <div class="col-xs-6">
        <button class="no-btn" (click)="showAdvanced = !showAdvanced">Advance <i
          class="glyphicon glyphicon-triangle-bottom" [ngClass]="{rotate180:showAdvanced}"></i></button>
      </div>
      <div class="col-xs-6 text-right">
        <span class="primary_color">Compound Total: {{ currentTxn?.total }}</span>
      </div>
    </div>

    <div class="row">
      <div class="col-xs-3 pdT1">
        <button ng-hide="ledgerCtrl.selectedLedger.isBankTransaction" class="btn btn-danger"
                (click)="resetPanel()">Reset
        </button>
      </div>
      <div class="col-xs-9 pdT1">
        <div class="pull-right">
          <div class="mrR1 pull-left" ng-if="ledgerCtrl.showGenInvOpts">
            <label class="checkbox oh">
              <input class="pull-left" style="margin-top:4px;" type="checkbox" name="generateInvoice"
                     [(ngModel)]="blankLedger.generateInvoice" ng-click="$event.stopPropagation()">
              <span class="pull-left">Generate Invoice</span>
            </label>
          </div>
          <div class="upload_div" ng-if="ledgerCtrl.selectedLedger.attachedFileName.length == 0">
            <input type="file" name="invoiceFile" id="invoiceFile" ng-click="$event.stopPropagation()"
                   onchange="angular.element(this).scope().getInvoiceFile(this.files)">
            <label for="invoiceFile"><i class="glyphicon glyphicon-paperclip"></i></label>
          </div>
          <button ng-hide="ledgerCtrl.selectedLedger.isBankTransaction" class="btn btn-success"
                  (click)="addToDrOrCr('DEBIT')" [disabled]="currentTxn.type === 'DEBIT'">Add to DR
          </button>
          <button ng-hide="ledgerCtrl.selectedLedger.isBankTransaction" class="btn btn-success"
                  (click)="addToDrOrCr('CREDIT')" [disabled]="currentTxn.type === 'CREDIT'">Add to CR
          </button>
          <button id="saveLedger" class="btn btn-success" (click)="saveLedger()">Save</button>

        </div>
      </div>
    </div>
    <div class="row">

    </div>
  </div>
</div>
